{"file_contents":{"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 0 0% 9%;\n  --border: 0 0% 91%;\n  --card: 0 0% 98%;\n  --card-foreground: 0 0% 9%;\n  --card-border: 0 0% 95%;\n  --sidebar: 0 0% 96%;\n  --sidebar-foreground: 0 0% 9%;\n  --sidebar-border: 0 0% 93%;\n  --sidebar-primary: 203 89% 53%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 0 0% 92%;\n  --sidebar-accent-foreground: 0 0% 9%;\n  --sidebar-ring: 203 89% 53%;\n  --popover: 0 0% 94%;\n  --popover-foreground: 0 0% 9%;\n  --popover-border: 0 0% 91%;\n  --primary: 210 80% 48%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 210 12% 88%;\n  --secondary-foreground: 210 15% 20%;\n  --muted: 210 10% 93%;\n  --muted-foreground: 210 8% 45%;\n  --accent: 28 88% 95%;\n  --accent-foreground: 28 75% 25%;\n  --destructive: 0 84% 42%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 210 8% 75%;\n  --ring: 210 80% 48%;\n  --chart-1: 210 80% 48%;\n  --chart-2: 28 90% 55%;\n  --chart-3: 160 65% 45%;\n  --chart-4: 280 55% 55%;\n  --chart-5: 45 90% 58%;\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.02);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.03);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.03), 0px 1px 2px -1px hsl(0 0% 0% / 0.05);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.04), 0px 1px 2px -1px hsl(0 0% 0% / 0.06);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.05), 0px 2px 4px -1px hsl(0 0% 0% / 0.08);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.06), 0px 4px 6px -1px hsl(0 0% 0% / 0.10);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.08), 0px 8px 10px -1px hsl(0 0% 0% / 0.12);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.15);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 0 0% 7%;\n  --foreground: 0 0% 95%;\n  --border: 0 0% 16%;\n  --card: 0 0% 9%;\n  --card-foreground: 0 0% 95%;\n  --card-border: 0 0% 12%;\n  --sidebar: 0 0% 11%;\n  --sidebar-foreground: 0 0% 95%;\n  --sidebar-border: 0 0% 14%;\n  --sidebar-primary: 203 89% 55%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 0 0% 14%;\n  --sidebar-accent-foreground: 0 0% 95%;\n  --sidebar-ring: 203 89% 55%;\n  --popover: 0 0% 13%;\n  --popover-foreground: 0 0% 95%;\n  --popover-border: 0 0% 16%;\n  --primary: 210 80% 55%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 210 12% 18%;\n  --secondary-foreground: 210 10% 90%;\n  --muted: 210 10% 16%;\n  --muted-foreground: 210 8% 65%;\n  --accent: 28 65% 20%;\n  --accent-foreground: 28 85% 92%;\n  --destructive: 0 84% 42%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 210 8% 30%;\n  --ring: 210 80% 55%;\n  --chart-1: 210 80% 60%;\n  --chart-2: 28 90% 65%;\n  --chart-3: 160 65% 60%;\n  --chart-4: 280 55% 65%;\n  --chart-5: 45 90% 68%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 100% / 0.02);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 100% / 0.03);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 100% / 0.03), 0px 1px 2px -1px hsl(0 0% 100% / 0.05);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 100% / 0.04), 0px 1px 2px -1px hsl(0 0% 100% / 0.06);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 100% / 0.05), 0px 2px 4px -1px hsl(0 0% 100% / 0.08);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 100% / 0.06), 0px 4px 6px -1px hsl(0 0% 100% / 0.10);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 100% / 0.08), 0px 8px 10px -1px hsl(0 0% 100% / 0.12);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 100% / 0.15);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n\n  @keyframes zoom {\n    0%, 100% {\n      transform: scale(1);\n    }\n    50% {\n      transform: scale(1.05);\n    }\n  }\n}\n\n.perspective-1000 {\n  perspective: 1000px;\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","size_bytes":10746},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"Inter\", \"var(--font-sans)\"],\n        serif: [\"Georgia\", \"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n        display: [\"Fraunces\", \"Georgia\", \"serif\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4121},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"server/seed.ts":{"content":"import { storage } from \"./storage\";\nimport { REAL_CONFLICTS_2025 } from \"./real-conflicts-seed\";\n\nexport async function seedDatabase() {\n  console.log(\"Seeding database with 32 verified humanitarian conflicts...\");\n\n  // Only seed if database is empty or has fewer than 10 conflicts\n  // This prevents duplication on server restart while allowing manual cleanup\n  const existingConflicts = await storage.getConflicts();\n  if (existingConflicts.length >= 10) {\n    console.log(`Database already has ${existingConflicts.length} conflicts, skipping seed`);\n    return;\n  }\n  \n  console.log(`Database has ${existingConflicts.length} conflicts, proceeding with seed...`);\n\n  // Use real conflict data from verified sources\n  const conflicts = REAL_CONFLICTS_2025.map(conflict => ({\n    ...conflict,\n    imageUrl: null, // Will use colored severity cards\n    needsReview: false,\n    sourceData: {\n      source: conflict.source,\n      verified: true,\n      lastUpdated: new Date().toISOString(),\n    },\n  }));\n\n  const createdConflicts = await Promise.all(\n    conflicts.map((conflict) => storage.createConflict(conflict))\n  );\n\n  console.log(`Created ${createdConflicts.length} conflicts`);\n\n  // Seed organizations with realistic verification data\n  const organizations = [\n    {\n      name: \"Doctors Without Borders\",\n      description: \"Provides emergency medical care in conflict zones and areas affected by endemic diseases.\",\n      website: \"https://www.msf.org\",\n      ein: \"13-3433452\",\n      rating: \"4.8\",\n      causes: [\"Medical aid\", \"Emergency response\"],\n      countriesActive: [\"Syria\", \"Yemen\", \"Sudan\", \"Afghanistan\", \"Somalia\"],\n      verified: 1,\n      verificationStatus: \"verified\",\n      verificationLevel: 3,\n      charityNavigatorRating: \"4.0\",\n      guidestarSeal: \"platinum\",\n      financialTransparency: \"Excellent\",\n      verificationData: {\n        audit_available: true,\n        irs_990_public: true,\n        third_party_evaluations: [\"Charity Navigator\", \"GuideStar\", \"BBB Wise Giving\"],\n      },\n    },\n    {\n      name: \"International Rescue Committee\",\n      description: \"Helps people whose lives have been shattered by conflict and disaster to survive, recover and rebuild.\",\n      website: \"https://www.rescue.org\",\n      ein: \"13-5660870\",\n      rating: \"4.7\",\n      causes: [\"Refugee assistance\", \"Education\", \"Healthcare\"],\n      countriesActive: [\"Syria\", \"Yemen\", \"Somalia\", \"Afghanistan\", \"Ukraine\"],\n      verified: 1,\n      verificationStatus: \"verified\",\n      verificationLevel: 3,\n      charityNavigatorRating: \"4.0\",\n      guidestarSeal: \"platinum\",\n      financialTransparency: \"Excellent\",\n      verificationData: {\n        audit_available: true,\n        irs_990_public: true,\n        third_party_evaluations: [\"Charity Navigator\", \"GuideStar\"],\n      },\n    },\n    {\n      name: \"UNICEF\",\n      description: \"Works in over 190 countries to save children's lives, defend their rights, and help them fulfill their potential.\",\n      website: \"https://www.unicef.org\",\n      ein: \"13-1760110\",\n      rating: \"4.9\",\n      causes: [\"Children's welfare\", \"Education\", \"Healthcare\", \"Nutrition\"],\n      countriesActive: [\"Syria\", \"Yemen\", \"Sudan\", \"Somalia\", \"Afghanistan\", \"Ukraine\"],\n      verified: 1,\n      verificationStatus: \"verified\",\n      verificationLevel: 3,\n      charityNavigatorRating: \"4.0\",\n      guidestarSeal: \"platinum\",\n      financialTransparency: \"Excellent\",\n      verificationData: {\n        audit_available: true,\n        irs_990_public: true,\n        third_party_evaluations: [\"Charity Navigator\", \"GuideStar\", \"BBB Wise Giving\"],\n        un_accredited: true,\n      },\n    },\n    {\n      name: \"World Food Programme\",\n      description: \"The world's largest humanitarian organization fighting hunger worldwide, delivering food assistance in emergencies.\",\n      website: \"https://www.wfp.org\",\n      rating: \"4.8\",\n      causes: [\"Food security\", \"Emergency response\"],\n      countriesActive: [\"Yemen\", \"Sudan\", \"Somalia\", \"Syria\", \"Afghanistan\"],\n      verified: 1,\n      verificationStatus: \"verified\",\n      verificationLevel: 3,\n      charityNavigatorRating: \"4.0\",\n      financialTransparency: \"Excellent\",\n      verificationData: {\n        un_agency: true,\n        audit_available: true,\n        third_party_evaluations: [\"UN oversight\"],\n      },\n    },\n    {\n      name: \"Save the Children\",\n      description: \"Works in 120 countries to help children survive, learn and be protected from harm.\",\n      website: \"https://www.savethechildren.org\",\n      ein: \"06-0726487\",\n      rating: \"4.6\",\n      causes: [\"Children's welfare\", \"Education\", \"Protection\"],\n      countriesActive: [\"Syria\", \"Yemen\", \"Sudan\", \"Somalia\", \"Afghanistan\", \"Ukraine\"],\n      verified: 1,\n      verificationStatus: \"verified\",\n      verificationLevel: 2,\n      charityNavigatorRating: \"3.8\",\n      guidestarSeal: \"gold\",\n      financialTransparency: \"Good\",\n      verificationData: {\n        audit_available: true,\n        irs_990_public: true,\n        third_party_evaluations: [\"Charity Navigator\"],\n      },\n    },\n    {\n      name: \"International Medical Corps\",\n      description: \"Provides medical relief and healthcare training to those affected by disaster, disease and conflict.\",\n      website: \"https://internationalmedicalcorps.org\",\n      ein: \"95-3949646\",\n      rating: \"4.7\",\n      causes: [\"Medical aid\", \"Healthcare\", \"Mental health\"],\n      countriesActive: [\"Syria\", \"Yemen\", \"Sudan\", \"Ukraine\"],\n      verified: 1,\n      verificationStatus: \"verified\",\n      verificationLevel: 2,\n      charityNavigatorRating: \"3.9\",\n      guidestarSeal: \"gold\",\n      financialTransparency: \"Good\",\n      verificationData: {\n        audit_available: true,\n        irs_990_public: true,\n      },\n    },\n    {\n      name: \"Oxfam International\",\n      description: \"Works to end the injustice of poverty by providing clean water, food, and protection to communities in crisis.\",\n      website: \"https://www.oxfam.org\",\n      rating: \"4.5\",\n      causes: [\"Water & sanitation\", \"Food security\", \"Women's rights\"],\n      countriesActive: [\"Yemen\", \"Sudan\", \"Somalia\", \"Syria\"],\n      verified: 1,\n      verificationStatus: \"verified\",\n      verificationLevel: 2,\n      charityNavigatorRating: \"3.7\",\n      guidestarSeal: \"silver\",\n      financialTransparency: \"Good\",\n      verificationData: {\n        audit_available: true,\n        third_party_evaluations: [\"Charity Navigator\"],\n      },\n    },\n    {\n      name: \"Norwegian Refugee Council\",\n      description: \"Provides assistance to millions of people forced to flee their homes due to conflict and natural disasters.\",\n      website: \"https://www.nrc.no\",\n      rating: \"4.8\",\n      causes: [\"Refugee assistance\", \"Shelter\", \"Education\"],\n      countriesActive: [\"Syria\", \"Yemen\", \"Sudan\", \"Somalia\", \"Ukraine\"],\n      verified: 1,\n      verificationStatus: \"verified\",\n      verificationLevel: 3,\n      charityNavigatorRating: \"4.0\",\n      financialTransparency: \"Excellent\",\n      verificationData: {\n        audit_available: true,\n        third_party_evaluations: [\"International evaluations\"],\n      },\n    },\n  ];\n\n  const createdOrganizations = await Promise.all(\n    organizations.map((org) => storage.createOrganization(org))\n  );\n\n  console.log(`Created ${createdOrganizations.length} organizations`);\n\n  // Create admin user\n  console.log(\"Creating admin user...\");\n  const existingAdmin = await storage.getUserByEmail(\"admin@aidatlas.org\");\n  if (!existingAdmin) {\n    const adminUser = await storage.createUser(\n      {\n        name: \"Admin User\",\n        email: \"admin@aidatlas.org\",\n        preferences: {\n          causes: [],\n          regions: [],\n          donationRange: \"any\",\n        },\n        onboardingCompleted: true,\n      },\n      \"admin123\"\n    );\n    \n    // Set admin flag directly\n    await storage.updateUser(adminUser.id, { isAdmin: true });\n    console.log(\"✓ Admin user created: admin@aidatlas.org / admin123\");\n  } else {\n    console.log(\"✓ Admin user already exists\");\n  }\n\n  console.log(\"Database seeded successfully!\");\n\n  return {\n    conflicts: createdConflicts,\n    organizations: createdOrganizations,\n  };\n}\n","size_bytes":8163},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, decimal, jsonb, boolean, primaryKey } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull().unique(),\n  passwordHash: text(\"password_hash\").notNull(),\n  isAdmin: boolean(\"is_admin\").notNull().default(false),\n  preferences: jsonb(\"preferences\").$type<{\n    causes: string[];\n    regions: string[];\n    donationRange: string;\n  }>(),\n  onboardingCompleted: boolean(\"onboarding_completed\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const conflicts = pgTable(\"conflicts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  country: text(\"country\").notNull(),\n  region: text(\"region\").notNull(),\n  title: text(\"title\").notNull(),\n  summary: text(\"summary\").notNull(),\n  severityLevel: text(\"severity_level\").notNull(),\n  affectedGroups: jsonb(\"affected_groups\").$type<string[]>().notNull(),\n  imageUrl: text(\"image_url\"),\n  source: text(\"source\").default('manual'), // Track data source: reliefweb, acled, icrc, manual\n  needsReview: boolean(\"needs_review\").default(false), // Flag for admin review\n  sourceData: jsonb(\"source_data\"), // Store original source metadata\n  \n  // Detailed statistics (populated via OpenAI extraction from ReliefWeb)\n  peopleAffected: text(\"people_affected\"), // e.g., \"8.3 million\" or null\n  internallyDisplaced: text(\"internally_displaced\"), // e.g., \"2 million\" or null\n  refugeesAbroad: text(\"refugees_abroad\"), // e.g., \"1.5 million\" or null\n  crisisStartYear: text(\"crisis_start_year\"), // e.g., \"2009\" or null\n  primaryNeeds: jsonb(\"primary_needs\").$type<string[]>(), // [\"Food Security\", \"Medical Care\", \"Shelter\"]\n  detailsLastUpdated: timestamp(\"details_last_updated\"), // When statistics were last updated\n  \n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const organizations = pgTable(\"organizations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  ein: varchar(\"ein\", { length: 20 }), // Tax ID for US nonprofits\n  website: text(\"website\"),\n  email: varchar(\"email\", { length: 255 }),\n  phone: varchar(\"phone\", { length: 50 }),\n  address: text(\"address\"),\n  city: varchar(\"city\", { length: 100 }),\n  state: varchar(\"state\", { length: 50 }),\n  zip: varchar(\"zip\", { length: 20 }),\n  country: varchar(\"country\", { length: 100 }).default('USA'),\n  \n  // Legacy rating field (kept for backwards compatibility)\n  rating: decimal(\"rating\", { precision: 2, scale: 1 }),\n  verified: integer(\"verified\").notNull().default(1),\n  \n  // Causes and countries\n  causes: jsonb(\"causes\").$type<string[]>().notNull(),\n  countriesActive: jsonb(\"countries_active\").$type<string[]>().notNull(),\n  \n  // Verification status\n  verificationStatus: varchar(\"verification_status\", { length: 50 }).notNull().default('pending'),\n  verificationLevel: integer(\"verification_level\").notNull().default(0), // 0=unverified, 1-3=verified levels\n  verificationData: jsonb(\"verification_data\"),\n  lastVerified: timestamp(\"last_verified\"),\n  verifiedBy: varchar(\"verified_by\"), // References admin user\n  \n  // Third-party ratings\n  charityNavigatorRating: decimal(\"charity_navigator_rating\", { precision: 2, scale: 1 }),\n  charityNavigatorId: varchar(\"charity_navigator_id\", { length: 255 }),\n  financialRating: decimal(\"financial_rating\", { precision: 2, scale: 1 }),\n  accountabilityRating: decimal(\"accountability_rating\", { precision: 2, scale: 1 }),\n  \n  guidestarVerified: boolean(\"guidestar_verified\").default(false),\n  guidestarSeal: varchar(\"guidestar_seal\", { length: 50 }),\n  \n  bbbAccredited: boolean(\"bbb_accredited\").default(false),\n  \n  // Financial data\n  totalRevenue: decimal(\"total_revenue\", { precision: 15, scale: 2 }),\n  totalExpenses: decimal(\"total_expenses\", { precision: 15, scale: 2 }),\n  programExpenses: decimal(\"program_expenses\", { precision: 15, scale: 2 }),\n  administrativeExpenses: decimal(\"administrative_expenses\", { precision: 15, scale: 2 }),\n  fundraisingExpenses: decimal(\"fundraising_expenses\", { precision: 15, scale: 2 }),\n  programExpensePercentage: decimal(\"program_expense_percentage\", { precision: 5, scale: 2 }),\n  overheadPercentage: decimal(\"overhead_percentage\", { precision: 5, scale: 2 }),\n  fiscalYearEnd: timestamp(\"fiscal_year_end\"),\n  \n  // Trust score\n  trustScore: integer(\"trust_score\"), // 0-100\n  trustScoreUpdated: timestamp(\"trust_score_updated\"),\n  \n  // Risk assessment\n  riskLevel: varchar(\"risk_level\", { length: 20 }), // low, medium, high\n  riskScore: decimal(\"risk_score\", { precision: 3, scale: 2 }), // 0.0-1.0\n  riskAssessment: jsonb(\"risk_assessment\"),\n  \n  // Operational\n  yearsOperating: integer(\"years_operating\"),\n  consistent990Filing: boolean(\"consistent_990_filing\"),\n  lastImpactUpdate: timestamp(\"last_impact_update\"),\n  \n  // Stripe Connect (for payment processing)\n  stripeAccountId: varchar(\"stripe_account_id\", { length: 255 }),\n  stripeOnboardingCompleted: boolean(\"stripe_onboarding_completed\").default(false),\n  stripeChargesEnabled: boolean(\"stripe_charges_enabled\").default(false),\n  stripePayoutsEnabled: boolean(\"stripe_payouts_enabled\").default(false),\n  \n  // Status\n  isActive: boolean(\"is_active\").default(true),\n  isFeatured: boolean(\"is_featured\").default(false),\n  \n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Verification documents\nexport const verificationDocuments = pgTable(\"verification_documents\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  organizationId: varchar(\"organization_id\").notNull().references(() => organizations.id, { onDelete: 'cascade' }),\n  \n  documentType: varchar(\"document_type\", { length: 100 }).notNull(), // irs_determination_letter, form_990, etc.\n  fileUrl: text(\"file_url\").notNull(),\n  fileSize: integer(\"file_size\"),\n  mimeType: varchar(\"mime_type\", { length: 100 }),\n  \n  // OCR results\n  ocrText: text(\"ocr_text\"),\n  \n  // AI analysis\n  analysis: jsonb(\"analysis\"),\n  verified: boolean(\"verified\").default(false),\n  confidence: decimal(\"confidence\", { precision: 3, scale: 2 }), // 0.0-1.0\n  extractedData: jsonb(\"extracted_data\"),\n  \n  // Review\n  reviewedBy: varchar(\"reviewed_by\"), // References admin user\n  reviewedAt: timestamp(\"reviewed_at\"),\n  reviewNotes: text(\"review_notes\"),\n  \n  uploadedAt: timestamp(\"uploaded_at\").defaultNow(),\n});\n\n// Trust scores history\nexport const organizationTrustScores = pgTable(\"organization_trust_scores\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  organizationId: varchar(\"organization_id\").notNull().references(() => organizations.id, { onDelete: 'cascade' }),\n  \n  totalScore: integer(\"total_score\").notNull(), // 0-100\n  breakdown: jsonb(\"breakdown\").$type<{\n    ratings: number;\n    financial: number;\n    history: number;\n    verification: number;\n    impact_reporting: number;\n    user_feedback: number;\n  }>(), // Score breakdown by category\n  \n  calculatedAt: timestamp(\"calculated_at\").defaultNow(),\n});\n\n// Verification history (audit log)\nexport const verificationHistory = pgTable(\"verification_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  organizationId: varchar(\"organization_id\").notNull().references(() => organizations.id, { onDelete: 'cascade' }),\n  \n  action: varchar(\"action\", { length: 100 }), // submitted, verified, rejected, etc.\n  previousStatus: varchar(\"previous_status\", { length: 50 }),\n  newStatus: varchar(\"new_status\", { length: 50 }),\n  \n  performedBy: varchar(\"performed_by\"), // References admin user\n  notes: text(\"notes\"),\n  \n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User-reported issues\nexport const organizationReports = pgTable(\"organization_reports\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  organizationId: varchar(\"organization_id\").notNull().references(() => organizations.id, { onDelete: 'cascade' }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  \n  reportType: varchar(\"report_type\", { length: 100 }), // fraud, misinformation, poor_service, etc.\n  description: text(\"description\"),\n  evidenceUrls: jsonb(\"evidence_urls\").$type<string[]>(),\n  \n  status: varchar(\"status\", { length: 50 }).notNull().default('pending'), // pending, investigating, resolved, dismissed\n  resolution: text(\"resolution\"),\n  resolvedBy: varchar(\"resolved_by\"), // References admin user\n  resolvedAt: timestamp(\"resolved_at\"),\n  \n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Donation feedback (for trust scoring)\nexport const donationFeedback = pgTable(\"donation_feedback\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  donationId: varchar(\"donation_id\").notNull().references(() => donations.id, { onDelete: 'cascade' }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  organizationId: varchar(\"organization_id\").notNull().references(() => organizations.id, { onDelete: 'cascade' }),\n  \n  userSatisfied: boolean(\"user_satisfied\"),\n  rating: integer(\"rating\"), // 1-5 stars\n  feedbackText: text(\"feedback_text\"),\n  \n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const donations = pgTable(\"donations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  organizationId: varchar(\"organization_id\").notNull().references(() => organizations.id, { onDelete: 'cascade' }),\n  conflictId: varchar(\"conflict_id\").notNull().references(() => conflicts.id, { onDelete: 'cascade' }),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  type: text(\"type\").notNull(),\n  donorCountry: text(\"donor_country\"), // Track where donation originated from\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  passwordHash: true,\n});\n\nexport const insertConflictSchema = createInsertSchema(conflicts).omit({\n  id: true,\n  lastUpdated: true,\n});\n\nexport const insertOrganizationSchema = createInsertSchema(organizations).omit({\n  id: true,\n});\n\nexport const insertDonationSchema = createInsertSchema(donations).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  donorCountry: z.string().default('United States'), // Default to US for simplicity in MVP\n});\n\nexport const insertVerificationDocumentSchema = createInsertSchema(verificationDocuments).omit({\n  id: true,\n  uploadedAt: true,\n});\n\nexport const insertOrganizationTrustScoreSchema = createInsertSchema(organizationTrustScores).omit({\n  id: true,\n  calculatedAt: true,\n});\n\nexport const insertVerificationHistorySchema = createInsertSchema(verificationHistory).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertOrganizationReportSchema = createInsertSchema(organizationReports).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertDonationFeedbackSchema = createInsertSchema(donationFeedback).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertConflict = z.infer<typeof insertConflictSchema>;\nexport type Conflict = typeof conflicts.$inferSelect;\nexport type InsertOrganization = z.infer<typeof insertOrganizationSchema>;\nexport type Organization = typeof organizations.$inferSelect;\nexport type InsertDonation = z.infer<typeof insertDonationSchema>;\nexport type Donation = typeof donations.$inferSelect;\nexport type InsertVerificationDocument = z.infer<typeof insertVerificationDocumentSchema>;\nexport type VerificationDocument = typeof verificationDocuments.$inferSelect;\nexport type InsertOrganizationTrustScore = z.infer<typeof insertOrganizationTrustScoreSchema>;\nexport type OrganizationTrustScore = typeof organizationTrustScores.$inferSelect;\nexport type InsertVerificationHistory = z.infer<typeof insertVerificationHistorySchema>;\nexport type VerificationHistory = typeof verificationHistory.$inferSelect;\nexport type InsertOrganizationReport = z.infer<typeof insertOrganizationReportSchema>;\nexport type OrganizationReport = typeof organizationReports.$inferSelect;\nexport type InsertDonationFeedback = z.infer<typeof insertDonationFeedbackSchema>;\nexport type DonationFeedback = typeof donationFeedback.$inferSelect;\n\n// Behavioral Tracking Schema\nexport const userEvents = pgTable(\"user_events\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  conflictId: varchar(\"conflict_id\").references(() => conflicts.id, { onDelete: 'cascade' }),\n  organizationId: varchar(\"organization_id\").references(() => organizations.id, { onDelete: 'cascade' }),\n  eventType: text(\"event_type\").notNull(), // swipe_up, swipe_pass, swipe_down, view_details, donate, etc.\n  eventData: jsonb(\"event_data\").$type<{\n    timeSpent?: number; // seconds\n    swipeDirection?: string;\n    donationAmount?: number;\n    metadata?: Record<string, any>;\n  }>(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User preference vector (behavioral learning)\nexport const userPreferenceVectors = pgTable(\"user_preference_vectors\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().unique().references(() => users.id, { onDelete: 'cascade' }),\n  \n  // Geographic preferences (learned weights)\n  geoPreferences: jsonb(\"geo_preferences\").$type<Record<string, number>>().notNull().default(sql`'{}'::jsonb`),\n  \n  // Cause preferences (learned weights)\n  causePreferences: jsonb(\"cause_preferences\").$type<Record<string, number>>().notNull().default(sql`'{}'::jsonb`),\n  \n  // Demographic preferences\n  demographicPreferences: jsonb(\"demographic_preferences\").$type<Record<string, number>>().notNull().default(sql`'{}'::jsonb`),\n  \n  // Urgency preference (0-1 scale)\n  urgencyPreference: decimal(\"urgency_preference\", { precision: 3, scale: 2 }).notNull().default('0.5'),\n  \n  // Interaction count (for weight calculation)\n  interactionCount: integer(\"interaction_count\").notNull().default(0),\n  \n  // Last updated\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Content sources tracking (for automated pipeline)\nexport const contentSources = pgTable(\"content_sources\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sourceName: text(\"source_name\").notNull(), // reliefweb, acled, unhcr, etc.\n  sourceType: text(\"source_type\").notNull(), // authoritative, news, academic\n  apiEndpoint: text(\"api_endpoint\"),\n  credibilityScore: decimal(\"credibility_score\", { precision: 2, scale: 1 }).notNull().default('5.0'),\n  lastScraped: timestamp(\"last_scraped\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Scraped content (raw data before processing)\nexport const scrapedContent = pgTable(\"scraped_content\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sourceId: varchar(\"source_id\").notNull().references(() => contentSources.id, { onDelete: 'cascade' }),\n  contentType: text(\"content_type\").notNull(), // report, news_article, statistical_data\n  rawData: jsonb(\"raw_data\").notNull(), // Original scraped data\n  countryCode: text(\"country_code\"),\n  extractedAt: timestamp(\"extracted_at\").defaultNow(),\n  processed: boolean(\"processed\").notNull().default(false),\n});\n\n// Conflict approval queue (admin review)\nexport const conflictApprovals = pgTable(\"conflict_approvals\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  conflictId: varchar(\"conflict_id\").references(() => conflicts.id, { onDelete: 'cascade' }),\n  status: text(\"status\").notNull().default('pending'), // pending, approved, rejected\n  generatedContent: jsonb(\"generated_content\"), // AI-generated content awaiting approval\n  reviewedBy: varchar(\"reviewed_by\"),\n  reviewNotes: text(\"review_notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  reviewedAt: timestamp(\"reviewed_at\"),\n});\n\nexport const insertUserEventSchema = createInsertSchema(userEvents).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserPreferenceVectorSchema = createInsertSchema(userPreferenceVectors).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport const insertContentSourceSchema = createInsertSchema(contentSources).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertScrapedContentSchema = createInsertSchema(scrapedContent).omit({\n  id: true,\n  extractedAt: true,\n});\n\nexport const insertConflictApprovalSchema = createInsertSchema(conflictApprovals).omit({\n  id: true,\n  createdAt: true,\n  reviewedAt: true,\n});\n\nexport type InsertUserEvent = z.infer<typeof insertUserEventSchema>;\nexport type UserEvent = typeof userEvents.$inferSelect;\nexport type InsertUserPreferenceVector = z.infer<typeof insertUserPreferenceVectorSchema>;\nexport type UserPreferenceVector = typeof userPreferenceVectors.$inferSelect;\nexport type InsertContentSource = z.infer<typeof insertContentSourceSchema>;\nexport type ContentSource = typeof contentSources.$inferSelect;\nexport type InsertScrapedContent = z.infer<typeof insertScrapedContentSchema>;\nexport type ScrapedContent = typeof scrapedContent.$inferSelect;\nexport type InsertConflictApproval = z.infer<typeof insertConflictApprovalSchema>;\nexport type ConflictApproval = typeof conflictApprovals.$inferSelect;\n\n// Actions Schema (Protests, Petitions, Advocacy)\nexport const actions = pgTable(\"actions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  \n  // External tracking\n  externalId: text(\"external_id\"), // ID from source platform\n  source: text(\"source\"), // eventbrite, change_org, manual, etc.\n  \n  // Type and basic info\n  type: text(\"type\").notNull(), // protest, petition, advocacy\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  shortDescription: text(\"short_description\"), // AI-generated summary\n  \n  // Location (for protests/events)\n  locationName: text(\"location_name\"),\n  address: text(\"address\"),\n  city: text(\"city\"),\n  state: text(\"state\"),\n  country: text(\"country\"),\n  latitude: decimal(\"latitude\", { precision: 10, scale: 8 }),\n  longitude: decimal(\"longitude\", { precision: 11, scale: 8 }),\n  \n  // Timing\n  startTime: timestamp(\"start_time\"),\n  endTime: timestamp(\"end_time\"),\n  timezone: text(\"timezone\"),\n  \n  // Organizer\n  organizerName: text(\"organizer_name\"),\n  organizerDescription: text(\"organizer_description\"),\n  organizerUrl: text(\"organizer_url\"),\n  \n  // Petition-specific\n  target: text(\"target\"), // Who petition is addressed to\n  signatureCount: integer(\"signature_count\"),\n  signatureGoal: integer(\"signature_goal\"),\n  \n  // Advocacy-specific\n  representatives: jsonb(\"representatives\").$type<Array<{\n    name: string;\n    chamber: string;\n    party: string;\n    phone?: string;\n    contactForm?: string;\n  }>>(),\n  talkingPoints: jsonb(\"talking_points\").$type<string[]>(),\n  \n  // Conflict relevance\n  relatedConflicts: jsonb(\"related_conflicts\").$type<string[]>(), // Array of conflict IDs\n  relatedCountry: text(\"related_country\"), // ISO country code\n  tags: jsonb(\"tags\").$type<string[]>(), // humanitarian, refugee, medical, etc.\n  \n  // Engagement\n  url: text(\"url\").notNull(),\n  isFree: boolean(\"is_free\").notNull().default(true),\n  capacity: integer(\"capacity\"),\n  currentAttendance: integer(\"current_attendance\"),\n  \n  // AI-enhanced content\n  enhancedDescription: jsonb(\"enhanced_description\").$type<{\n    shortDescription?: string;\n    whyAttend?: string;\n    whySign?: string;\n    whatToExpect?: string;\n    whatToBring?: string[];\n    howItHelps?: string;\n    impact?: string;\n  }>(),\n  \n  // Status\n  status: text(\"status\").notNull().default('active'), // active, completed, cancelled\n  verificationStatus: text(\"verification_status\").notNull().default('unverified'), // verified, unverified, flagged\n  \n  // Metadata\n  scrapedAt: timestamp(\"scraped_at\").defaultNow(),\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User action participation tracking\nexport const userActionParticipation = pgTable(\"user_action_participation\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  actionId: varchar(\"action_id\").notNull().references(() => actions.id, { onDelete: 'cascade' }),\n  \n  // Participation type\n  participationType: text(\"participation_type\"), // attended, signed, contacted, shared, interested\n  \n  // User contribution\n  personalMessage: text(\"personal_message\"), // For advocacy: their customized message\n  \n  // Status\n  status: text(\"status\").notNull().default('interested'), // interested, committed, completed\n  reminded: boolean(\"reminded\").notNull().default(false),\n  \n  // Timestamps\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\n// User reminders for actions\nexport const actionReminders = pgTable(\"action_reminders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  actionId: varchar(\"action_id\").notNull().references(() => actions.id, { onDelete: 'cascade' }),\n  \n  reminderTime: timestamp(\"reminder_time\").notNull(),\n  reminderType: text(\"reminder_type\"), // 1_day_before, 1_hour_before, custom\n  sent: boolean(\"sent\").notNull().default(false),\n  \n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Action reports/flags\nexport const actionReports = pgTable(\"action_reports\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  actionId: varchar(\"action_id\").notNull().references(() => actions.id, { onDelete: 'cascade' }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  \n  reportType: text(\"report_type\"), // spam, inappropriate, misinformation, cancelled\n  description: text(\"description\"),\n  \n  status: text(\"status\").notNull().default('pending'), // pending, reviewed, resolved\n  reviewedBy: varchar(\"reviewed_by\"),\n  reviewedAt: timestamp(\"reviewed_at\"),\n  \n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Insert schemas and types for actions\nexport const insertActionSchema = createInsertSchema(actions).omit({\n  id: true,\n  scrapedAt: true,\n  lastUpdated: true,\n  createdAt: true,\n});\n\nexport const insertUserActionParticipationSchema = createInsertSchema(userActionParticipation).omit({\n  id: true,\n  createdAt: true,\n  completedAt: true,\n});\n\nexport const insertActionReminderSchema = createInsertSchema(actionReminders).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertActionReportSchema = createInsertSchema(actionReports).omit({\n  id: true,\n  createdAt: true,\n  reviewedAt: true,\n});\n\nexport type InsertAction = z.infer<typeof insertActionSchema>;\nexport type Action = typeof actions.$inferSelect;\nexport type InsertUserActionParticipation = z.infer<typeof insertUserActionParticipationSchema>;\nexport type UserActionParticipation = typeof userActionParticipation.$inferSelect;\nexport type InsertActionReminder = z.infer<typeof insertActionReminderSchema>;\nexport type ActionReminder = typeof actionReminders.$inferSelect;\nexport type InsertActionReport = z.infer<typeof insertActionReportSchema>;\nexport type ActionReport = typeof actionReports.$inferSelect;\n\n// ===== GAMIFICATION SCHEMA =====\n\n// Monthly Reports\nexport const monthlyReports = pgTable(\"monthly_reports\", {\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  month: varchar(\"month\", { length: 7 }).notNull(), // YYYY-MM format\n  reportData: jsonb(\"report_data\").$type<{\n    monthlyTotal: number;\n    donationCount: number;\n    momChange: number;\n    newBadges: any[];\n    streak: any;\n    donationsByCountry: any[];\n    donationsByCause: any[];\n    timeline: any[];\n    comparison: any;\n    suggestions: string[];\n  }>().notNull(),\n  generatedAt: timestamp(\"generated_at\").defaultNow(),\n}, (table) => ({\n  pk: primaryKey({ columns: [table.userId, table.month] })\n}));\n\n// User Badges\nexport const userBadges = pgTable(\"user_badges\", {\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  badgeType: varchar(\"badge_type\", { length: 100 }).notNull(),\n  badgeName: varchar(\"badge_name\", { length: 255 }),\n  badgeIcon: varchar(\"badge_icon\", { length: 50 }),\n  badgeDescription: text(\"badge_description\"),\n  earnedAt: timestamp(\"earned_at\").defaultNow(),\n}, (table) => ({\n  pk: primaryKey({ columns: [table.userId, table.badgeType] })\n}));\n\n// User Points\nexport const userPoints = pgTable(\"user_points\", {\n  userId: varchar(\"user_id\").primaryKey().references(() => users.id, { onDelete: 'cascade' }),\n  totalPoints: integer(\"total_points\").notNull().default(0),\n  pointsThisMonth: integer(\"points_this_month\").notNull().default(0),\n  level: integer(\"level\").notNull().default(1),\n  nextLevelPoints: integer(\"next_level_points\").notNull().default(100),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Points History\nexport const pointsHistory = pgTable(\"points_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  activityType: varchar(\"activity_type\", { length: 50 }).notNull(),\n  pointsEarned: integer(\"points_earned\").notNull(),\n  description: text(\"description\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Monthly Challenges\nexport const monthlyChallenges = pgTable(\"monthly_challenges\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  month: varchar(\"month\", { length: 7 }).notNull(), // YYYY-MM\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  description: text(\"description\"),\n  icon: varchar(\"icon\", { length: 50 }),\n  goal: integer(\"goal\"),\n  reward: text(\"reward\"),\n  displayOrder: integer(\"display_order\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n});\n\n// User Challenge Progress\nexport const userChallenges = pgTable(\"user_challenges\", {\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  challengeId: varchar(\"challenge_id\").notNull().references(() => monthlyChallenges.id, { onDelete: 'cascade' }),\n  progress: integer(\"progress\").notNull().default(0),\n  completed: boolean(\"completed\").notNull().default(false),\n  completedAt: timestamp(\"completed_at\"),\n}, (table) => ({\n  pk: primaryKey({ columns: [table.userId, table.challengeId] })\n}));\n\n// Impact Stories\nexport const impactStories = pgTable(\"impact_stories\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  organizationId: varchar(\"organization_id\").notNull().references(() => organizations.id, { onDelete: 'cascade' }),\n  conflictId: varchar(\"conflict_id\").references(() => conflicts.id, { onDelete: 'set null' }),\n  title: varchar(\"title\", { length: 500 }),\n  storyText: text(\"story_text\").notNull(),\n  imageUrl: text(\"image_url\"),\n  beneficiaryType: varchar(\"beneficiary_type\", { length: 100 }), // individual, family, community\n  impactMetric: varchar(\"impact_metric\", { length: 255 }), // \"100 families housed\"\n  publishedAt: timestamp(\"published_at\").defaultNow(),\n  isFeatured: boolean(\"is_featured\").notNull().default(false),\n});\n\n// CharityWatch Nonprofit Cache (for Support page)\nexport const charitywatchCache = pgTable(\"charitywatch_cache\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  country: text(\"country\").notNull(),\n  nonprofits: jsonb(\"nonprofits\").$type<Array<{\n    name: string;\n    charityWatchRating: string; // A+, A, A-, B+, B\n    programPercent: number; // 85, 92, etc.\n    logoUrl: string;\n    donateUrl: string;\n    website: string;\n    ein?: string;\n    founded?: string;\n    description: string[];\n  }>>().notNull(),\n  cachedAt: timestamp(\"cached_at\").defaultNow(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n});\n\n// Donation Tracking (external donations via Every.org/CharityWatch)\nexport const externalDonations = pgTable(\"external_donations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: 'cascade' }),\n  conflictId: varchar(\"conflict_id\").references(() => conflicts.id, { onDelete: 'set null' }),\n  conflictCountry: text(\"conflict_country\").notNull(),\n  nonprofitName: text(\"nonprofit_name\").notNull(),\n  nonprofitEin: text(\"nonprofit_ein\"),\n  donateUrl: text(\"donate_url\").notNull(),\n  status: varchar(\"status\", { length: 50 }).notNull().default('initiated'), // initiated, completed\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Insert schemas for gamification\nexport const insertMonthlyReportSchema = createInsertSchema(monthlyReports).omit({\n  generatedAt: true,\n});\n\nexport const insertUserBadgeSchema = createInsertSchema(userBadges).omit({\n  earnedAt: true,\n});\n\nexport const insertUserPointsSchema = createInsertSchema(userPoints).omit({\n  updatedAt: true,\n});\n\nexport const insertPointsHistorySchema = createInsertSchema(pointsHistory).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMonthlyChallengeSchema = createInsertSchema(monthlyChallenges).omit({\n  id: true,\n});\n\nexport const insertUserChallengeSchema = createInsertSchema(userChallenges).omit({\n  completedAt: true,\n});\n\nexport const insertImpactStorySchema = createInsertSchema(impactStories).omit({\n  id: true,\n  publishedAt: true,\n});\n\nexport const insertCharitywatchCacheSchema = createInsertSchema(charitywatchCache).omit({\n  id: true,\n  cachedAt: true,\n});\n\nexport const insertExternalDonationSchema = createInsertSchema(externalDonations).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types for gamification\nexport type InsertMonthlyReport = z.infer<typeof insertMonthlyReportSchema>;\nexport type MonthlyReport = typeof monthlyReports.$inferSelect;\nexport type InsertUserBadge = z.infer<typeof insertUserBadgeSchema>;\nexport type UserBadge = typeof userBadges.$inferSelect;\nexport type InsertUserPoints = z.infer<typeof insertUserPointsSchema>;\nexport type UserPoints = typeof userPoints.$inferSelect;\nexport type InsertPointsHistory = z.infer<typeof insertPointsHistorySchema>;\nexport type PointsHistory = typeof pointsHistory.$inferSelect;\nexport type InsertMonthlyChallenge = z.infer<typeof insertMonthlyChallengeSchema>;\nexport type MonthlyChallenge = typeof monthlyChallenges.$inferSelect;\nexport type InsertUserChallenge = z.infer<typeof insertUserChallengeSchema>;\nexport type UserChallenge = typeof userChallenges.$inferSelect;\nexport type InsertImpactStory = z.infer<typeof insertImpactStorySchema>;\nexport type ImpactStory = typeof impactStories.$inferSelect;\nexport type InsertCharitywatchCache = z.infer<typeof insertCharitywatchCacheSchema>;\nexport type CharitywatchCache = typeof charitywatchCache.$inferSelect;\nexport type InsertExternalDonation = z.infer<typeof insertExternalDonationSchema>;\nexport type ExternalDonation = typeof externalDonations.$inferSelect;\n","size_bytes":31501},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/examples/Navigation.tsx":{"content":"import Navigation from '../Navigation';\n\nexport default function NavigationExample() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Navigation />\n      <div className=\"pt-24 px-6 text-center\">\n        <h1 className=\"text-4xl font-display font-bold mb-4\">Navigation Example</h1>\n        <p className=\"text-muted-foreground\">Try clicking the navigation links above</p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":420},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/examples/OrganizationCard.tsx":{"content":"import OrganizationCard from '../OrganizationCard';\n\nexport default function OrganizationCardExample() {\n  return (\n    <div className=\"p-6 bg-background min-h-screen\">\n      <div className=\"max-w-md mx-auto space-y-4\">\n        <OrganizationCard\n          name=\"International Rescue Committee\"\n          description=\"Provides humanitarian aid and support to refugees and displaced persons worldwide, focusing on health, education, and economic wellbeing.\"\n          rating={4.5}\n          verified={true}\n          website=\"https://www.rescue.org\"\n          onDonate={() => console.log('Donate to IRC')}\n        />\n        <OrganizationCard\n          name=\"Doctors Without Borders\"\n          description=\"Delivers emergency medical care to people affected by conflict, epidemics, disasters, or exclusion from healthcare.\"\n          rating={4.8}\n          verified={true}\n          website=\"https://www.doctorswithoutborders.org\"\n          onDonate={() => console.log('Donate to MSF')}\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":1027},"client/src/components/examples/DonationModal.tsx":{"content":"import { useState } from \"react\";\nimport DonationModal from '../DonationModal';\nimport { Button } from \"@/components/ui/button\";\n\nexport default function DonationModalExample() {\n  const [open, setOpen] = useState(false);\n\n  const mockOrgs = [\n    {\n      id: \"irc\",\n      name: \"International Rescue Committee\",\n      description: \"Provides healthcare, education, and economic support to refugees\",\n    },\n    {\n      id: \"msf\",\n      name: \"Doctors Without Borders\",\n      description: \"Delivers emergency medical care in conflict zones\",\n    },\n    {\n      id: \"unicef\",\n      name: \"UNICEF\",\n      description: \"Protects children's rights and provides humanitarian aid\",\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n      <Button onClick={() => setOpen(true)} data-testid=\"button-open-modal\">\n        Open Donation Modal\n      </Button>\n      <DonationModal\n        open={open}\n        onClose={() => setOpen(false)}\n        conflictTitle=\"Syrian Refugee Crisis\"\n        organizations={mockOrgs}\n        onComplete={(amount, orgIds) => {\n          console.log(`Donated $${amount} to organizations:`, orgIds);\n          setOpen(false);\n        }}\n      />\n    </div>\n  );\n}\n","size_bytes":1242},"server/storage.ts":{"content":"import { \n  type User, \n  type InsertUser,\n  type Conflict,\n  type InsertConflict,\n  type Organization,\n  type InsertOrganization,\n  type Donation,\n  type InsertDonation,\n  type UserEvent,\n  type InsertUserEvent,\n  type UserPreferenceVector,\n  type InsertUserPreferenceVector,\n  type ContentSource,\n  type InsertContentSource,\n  type ScrapedContent,\n  type InsertScrapedContent,\n  type ConflictApproval,\n  type InsertConflictApproval,\n  type Action,\n  type InsertAction,\n  type UserActionParticipation,\n  type InsertUserActionParticipation,\n  type ActionReminder,\n  type InsertActionReminder,\n  type ActionReport,\n  type InsertActionReport,\n  type MonthlyReport,\n  type InsertMonthlyReport,\n  type UserBadge,\n  type InsertUserBadge,\n  type UserPoints,\n  type InsertUserPoints,\n  type PointsHistory,\n  type InsertPointsHistory,\n  type MonthlyChallenge,\n  type InsertMonthlyChallenge,\n  type UserChallenge,\n  type InsertUserChallenge,\n  type ImpactStory,\n  type InsertImpactStory,\n  type InsertOrganizationReport,\n  type OrganizationReport,\n  type InsertVerificationHistory,\n  type VerificationHistory,\n  charitywatchCache,\n  externalDonations,\n  users,\n  conflicts,\n  organizations,\n  donations,\n  userEvents,\n  userPreferenceVectors,\n  contentSources,\n  scrapedContent,\n  conflictApprovals,\n  actions,\n  userActionParticipation,\n  actionReminders,\n  actionReports,\n  monthlyReports,\n  userBadges,\n  userPoints,\n  pointsHistory,\n  monthlyChallenges,\n  userChallenges,\n  impactStories,\n  organizationReports,\n  verificationHistory\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, inArray, sql } from \"drizzle-orm\";\nimport bcrypt from \"bcrypt\";\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser, password: string): Promise<User>;\n  updateUser(id: string, user: Partial<Omit<User, 'id' | 'createdAt' | 'passwordHash'>>): Promise<User | undefined>;\n  verifyPassword(email: string, password: string): Promise<User | null>;\n  \n  // Conflict operations\n  getConflicts(): Promise<Conflict[]>;\n  getConflict(id: string): Promise<Conflict | undefined>;\n  getConflictsByRegion(region: string): Promise<Conflict[]>;\n  createConflict(conflict: InsertConflict): Promise<Conflict>;\n  \n  // Organization operations\n  getOrganizations(): Promise<Organization[]>;\n  getOrganization(id: string): Promise<Organization | undefined>;\n  getOrganizationsByConflict(conflictId: string): Promise<Organization[]>;\n  createOrganization(org: InsertOrganization): Promise<Organization>;\n  \n  // Donation operations\n  getDonations(userId: string): Promise<Donation[]>;\n  createDonation(donation: InsertDonation): Promise<Donation>;\n  getDonationGeography(userId: string): Promise<Array<{\n    id: string;\n    fromCountry: string;\n    toCountry: string;\n    amount: string;\n    createdAt: string;\n  }>>;\n  getAllDonationGeography(): Promise<Array<{\n    id: string;\n    fromCountry: string;\n    toCountry: string;\n    amount: string;\n    createdAt: string;\n  }>>;\n  getUserImpactStats(userId: string): Promise<{\n    totalDonated: number;\n    peopleHelped: number;\n    organizationsSupported: number;\n    conflictsSupported: number;\n  }>;\n  \n  // Behavioral tracking operations\n  createUserEvent(event: InsertUserEvent): Promise<UserEvent>;\n  getUserEvents(userId: string, limit?: number): Promise<UserEvent[]>;\n  \n  // Preference vector operations\n  getUserPreferenceVector(userId: string): Promise<UserPreferenceVector | undefined>;\n  createUserPreferenceVector(vector: InsertUserPreferenceVector): Promise<UserPreferenceVector>;\n  updateUserPreferenceVector(userId: string, updates: Partial<UserPreferenceVector>): Promise<UserPreferenceVector | undefined>;\n  \n  // Content source operations\n  getContentSources(activeOnly?: boolean): Promise<ContentSource[]>;\n  createContentSource(source: InsertContentSource): Promise<ContentSource>;\n  updateContentSource(id: string, updates: Partial<ContentSource>): Promise<ContentSource | undefined>;\n  \n  // Scraped content operations\n  createScrapedContent(content: InsertScrapedContent): Promise<ScrapedContent>;\n  getUnprocessedContent(limit?: number): Promise<ScrapedContent[]>;\n  markContentProcessed(id: string): Promise<void>;\n  storeScrapedContent(conflicts: Map<string, any>): Promise<number>;\n  processScrapedContent(limit?: number): Promise<number>;\n  \n  // Conflict approval operations\n  createConflictApproval(approval: InsertConflictApproval): Promise<ConflictApproval>;\n  getPendingApprovals(): Promise<ConflictApproval[]>;\n  approveConflict(id: string, reviewedBy: string, notes?: string): Promise<ConflictApproval | undefined>;\n  rejectConflict(id: string, reviewedBy: string, notes?: string): Promise<ConflictApproval | undefined>;\n  \n  // Action operations\n  getActions(filters?: { type?: string; status?: string; conflictId?: string; limit?: number }): Promise<Action[]>;\n  getAction(id: string): Promise<Action | undefined>;\n  getActionsByConflict(conflictId: string, limit?: number): Promise<Action[]>;\n  getActionsByLocation(latitude: number, longitude: number, radiusMiles?: number, limit?: number): Promise<Action[]>;\n  createAction(action: InsertAction): Promise<Action>;\n  updateAction(id: string, updates: Partial<Action>): Promise<Action | undefined>;\n  \n  // User action participation operations\n  getUserActionParticipation(userId: string, actionId: string): Promise<UserActionParticipation | undefined>;\n  createUserActionParticipation(participation: InsertUserActionParticipation): Promise<UserActionParticipation>;\n  updateUserActionParticipation(id: string, updates: Partial<UserActionParticipation>): Promise<UserActionParticipation | undefined>;\n  getUserParticipatedActions(userId: string, limit?: number): Promise<Action[]>;\n  \n  // Action reminder operations\n  createActionReminder(reminder: InsertActionReminder): Promise<ActionReminder>;\n  getUserActionReminders(userId: string): Promise<ActionReminder[]>;\n  deleteActionReminder(id: string): Promise<void>;\n  \n  // Action report operations\n  createActionReport(report: InsertActionReport): Promise<ActionReport>;\n  getActionReports(actionId?: string): Promise<ActionReport[]>;\n  \n  // Gamification - Monthly Reports\n  getMonthlyReport(userId: string, month: string): Promise<MonthlyReport | undefined>;\n  createMonthlyReport(report: InsertMonthlyReport): Promise<MonthlyReport>;\n  getUserMonthlyReports(userId: string, limit?: number): Promise<MonthlyReport[]>;\n  \n  // Gamification - Badges\n  getUserBadges(userId: string): Promise<UserBadge[]>;\n  awardBadge(badge: InsertUserBadge): Promise<UserBadge>;\n  hasBadge(userId: string, badgeType: string): Promise<boolean>;\n  \n  // Gamification - Points\n  getUserPoints(userId: string): Promise<UserPoints | undefined>;\n  createUserPoints(points: InsertUserPoints): Promise<UserPoints>;\n  addPoints(userId: string, activityType: string, pointsEarned: number, description?: string): Promise<UserPoints>;\n  getPointsHistory(userId: string, limit?: number): Promise<PointsHistory[]>;\n  \n  // Gamification - Challenges\n  getActiveChallenges(month: string): Promise<MonthlyChallenge[]>;\n  createChallenge(challenge: InsertMonthlyChallenge): Promise<MonthlyChallenge>;\n  getUserChallengeProgress(userId: string, challengeId: string): Promise<UserChallenge | undefined>;\n  updateChallengeProgress(userId: string, challengeId: string, progress: number): Promise<UserChallenge>;\n  getUserChallenges(userId: string): Promise<Array<UserChallenge & { challenge: MonthlyChallenge }>>;\n  \n  // Gamification - Impact Stories\n  getImpactStories(filters?: { organizationId?: string; conflictId?: string; featured?: boolean; limit?: number }): Promise<ImpactStory[]>;\n  createImpactStory(story: InsertImpactStory): Promise<ImpactStory>;\n  \n  // Verification operations\n  createOrganizationReport(report: any): Promise<void>;\n  getPendingVerifications(): Promise<Organization[]>;\n  approveOrganization(id: string, data: { verificationLevel: number; verifiedBy: string; notes?: string }): Promise<void>;\n  rejectOrganization(id: string, data: { reason: string; rejectedBy: string; notes?: string }): Promise<void>;\n  requestOrganizationInfo(id: string, data: { requestedItems: string[]; requestedBy: string; notes?: string }): Promise<void>;\n  \n  // Nonprofit cache operations\n  getCharitywatchCache(country: string): Promise<typeof charitywatchCache.$inferSelect | undefined>;\n  cacheCharitywatchData(country: string, nonprofits: any[], expiresAt: Date): Promise<void>;\n  \n  // External donation tracking\n  trackExternalDonation(data: {\n    userId: string;\n    conflictId?: string;\n    conflictCountry: string;\n    nonprofitName: string;\n    nonprofitEin?: string;\n    donateUrl: string;\n  }): Promise<typeof externalDonations.$inferSelect>;\n}\n\nexport class DbStorage implements IStorage {\n  // User operations\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.id, id));\n    return result[0];\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.email, email));\n    return result[0];\n  }\n\n  async createUser(insertUser: InsertUser, password: string): Promise<User> {\n    const passwordHash = await bcrypt.hash(password, 10);\n    \n    const result = await db.insert(users).values({\n      name: insertUser.name,\n      email: insertUser.email,\n      passwordHash,\n      preferences: insertUser.preferences ?? null,\n      onboardingCompleted: false,\n    }).returning();\n    \n    return result[0];\n  }\n\n  async updateUser(id: string, userData: Partial<Omit<User, 'id' | 'createdAt' | 'passwordHash'>>): Promise<User | undefined> {\n    const updateData: any = {};\n    \n    if (userData.name !== undefined) updateData.name = userData.name;\n    if (userData.email !== undefined) updateData.email = userData.email;\n    if (userData.preferences !== undefined) updateData.preferences = userData.preferences;\n    if (userData.onboardingCompleted !== undefined) updateData.onboardingCompleted = userData.onboardingCompleted;\n    \n    const result = await db.update(users)\n      .set(updateData)\n      .where(eq(users.id, id))\n      .returning();\n    \n    return result[0];\n  }\n\n  async verifyPassword(email: string, password: string): Promise<User | null> {\n    const user = await this.getUserByEmail(email);\n    if (!user) return null;\n    \n    const isValid = await bcrypt.compare(password, user.passwordHash);\n    if (!isValid) return null;\n    \n    return user;\n  }\n\n  // Conflict operations\n  async getConflicts(): Promise<Conflict[]> {\n    return await db.select().from(conflicts);\n  }\n\n  async getConflict(id: string): Promise<Conflict | undefined> {\n    const result = await db.select().from(conflicts).where(eq(conflicts.id, id));\n    return result[0];\n  }\n\n  async getConflictsByRegion(region: string): Promise<Conflict[]> {\n    return await db.select().from(conflicts).where(sql`lower(${conflicts.region}) = lower(${region})`);\n  }\n\n  async createConflict(insertConflict: InsertConflict): Promise<Conflict> {\n    const result = await db.insert(conflicts).values(insertConflict).returning();\n    return result[0];\n  }\n\n  // Organization operations\n  async getOrganizations(): Promise<Organization[]> {\n    return await db.select().from(organizations);\n  }\n\n  async getOrganization(id: string): Promise<Organization | undefined> {\n    const result = await db.select().from(organizations).where(eq(organizations.id, id));\n    return result[0];\n  }\n\n  async getOrganizationsByConflict(conflictId: string): Promise<Organization[]> {\n    const conflict = await this.getConflict(conflictId);\n    if (!conflict) return [];\n    \n    const allOrgs = await this.getOrganizations();\n    return allOrgs.filter((org) => org.countriesActive.includes(conflict.country));\n  }\n\n  async createOrganization(insertOrg: InsertOrganization): Promise<Organization> {\n    const result = await db.insert(organizations).values(insertOrg).returning();\n    return result[0];\n  }\n\n  // Donation operations\n  async getDonations(userId: string): Promise<Donation[]> {\n    return await db.select().from(donations).where(eq(donations.userId, userId));\n  }\n\n  async createDonation(insertDonation: InsertDonation): Promise<Donation> {\n    const result = await db.insert(donations).values(insertDonation).returning();\n    return result[0];\n  }\n\n  async getDonationGeography(userId: string): Promise<Array<{\n    id: string;\n    fromCountry: string;\n    toCountry: string;\n    amount: string;\n    createdAt: string;\n  }>> {\n    const userDonations = await db\n      .select({\n        id: donations.id,\n        donorCountry: donations.donorCountry,\n        conflictCountry: conflicts.country,\n        amount: donations.amount,\n        createdAt: donations.createdAt,\n      })\n      .from(donations)\n      .innerJoin(conflicts, eq(donations.conflictId, conflicts.id))\n      .where(eq(donations.userId, userId));\n\n    return userDonations.map((d) => ({\n      id: d.id,\n      fromCountry: d.donorCountry || 'United States',\n      toCountry: d.conflictCountry,\n      amount: d.amount,\n      createdAt: d.createdAt?.toISOString() || new Date().toISOString(),\n    }));\n  }\n\n  async getAllDonationGeography(): Promise<Array<{\n    id: string;\n    fromCountry: string;\n    toCountry: string;\n    amount: string;\n    createdAt: string;\n  }>> {\n    const allDonations = await db\n      .select({\n        id: donations.id,\n        donorCountry: donations.donorCountry,\n        conflictCountry: conflicts.country,\n        amount: donations.amount,\n        createdAt: donations.createdAt,\n      })\n      .from(donations)\n      .innerJoin(conflicts, eq(donations.conflictId, conflicts.id));\n\n    return allDonations.map((d) => ({\n      id: d.id,\n      fromCountry: d.donorCountry || 'United States',\n      toCountry: d.conflictCountry,\n      amount: d.amount,\n      createdAt: d.createdAt?.toISOString() || new Date().toISOString(),\n    }));\n  }\n\n  async getUserImpactStats(userId: string): Promise<{\n    totalDonated: number;\n    peopleHelped: number;\n    organizationsSupported: number;\n    conflictsSupported: number;\n  }> {\n    const userDonations = await this.getDonations(userId);\n    \n    const totalDonated = userDonations.reduce(\n      (sum, donation) => sum + parseFloat(donation.amount as string), \n      0\n    );\n    \n    const uniqueOrgs = new Set(userDonations.map(d => d.organizationId));\n    const uniqueConflicts = new Set(\n      userDonations.filter(d => d.conflictId).map(d => d.conflictId)\n    );\n    \n    // Estimate people helped: $10 per person (rough humanitarian aid estimate)\n    const peopleHelped = Math.floor(totalDonated / 10);\n    \n    return {\n      totalDonated,\n      peopleHelped,\n      organizationsSupported: uniqueOrgs.size,\n      conflictsSupported: uniqueConflicts.size,\n    };\n  }\n\n  // Behavioral tracking operations\n  async createUserEvent(event: InsertUserEvent): Promise<UserEvent> {\n    const result = await db.insert(userEvents).values(event).returning();\n    return result[0];\n  }\n\n  async getUserEvents(userId: string, limit: number = 100): Promise<UserEvent[]> {\n    return await db\n      .select()\n      .from(userEvents)\n      .where(eq(userEvents.userId, userId))\n      .orderBy(sql`${userEvents.createdAt} DESC`)\n      .limit(limit);\n  }\n\n  // Preference vector operations\n  async getUserPreferenceVector(userId: string): Promise<UserPreferenceVector | undefined> {\n    const result = await db\n      .select()\n      .from(userPreferenceVectors)\n      .where(eq(userPreferenceVectors.userId, userId));\n    return result[0];\n  }\n\n  async createUserPreferenceVector(vector: InsertUserPreferenceVector): Promise<UserPreferenceVector> {\n    const result = await db.insert(userPreferenceVectors).values(vector).returning();\n    return result[0];\n  }\n\n  async updateUserPreferenceVector(\n    userId: string, \n    updates: Partial<UserPreferenceVector>\n  ): Promise<UserPreferenceVector | undefined> {\n    const updateData: any = { updatedAt: sql`NOW()` };\n    \n    if (updates.geoPreferences !== undefined) updateData.geoPreferences = updates.geoPreferences;\n    if (updates.causePreferences !== undefined) updateData.causePreferences = updates.causePreferences;\n    if (updates.demographicPreferences !== undefined) updateData.demographicPreferences = updates.demographicPreferences;\n    if (updates.urgencyPreference !== undefined) updateData.urgencyPreference = updates.urgencyPreference;\n    if (updates.interactionCount !== undefined) updateData.interactionCount = updates.interactionCount;\n    \n    const result = await db\n      .update(userPreferenceVectors)\n      .set(updateData)\n      .where(eq(userPreferenceVectors.userId, userId))\n      .returning();\n    \n    return result[0];\n  }\n\n  // Content source operations\n  async getContentSources(activeOnly: boolean = true): Promise<ContentSource[]> {\n    if (activeOnly) {\n      return await db.select().from(contentSources).where(eq(contentSources.isActive, true));\n    }\n    return await db.select().from(contentSources);\n  }\n\n  async createContentSource(source: InsertContentSource): Promise<ContentSource> {\n    const result = await db.insert(contentSources).values(source).returning();\n    return result[0];\n  }\n\n  async updateContentSource(\n    id: string, \n    updates: Partial<ContentSource>\n  ): Promise<ContentSource | undefined> {\n    const updateData: any = {};\n    \n    if (updates.sourceName !== undefined) updateData.sourceName = updates.sourceName;\n    if (updates.sourceType !== undefined) updateData.sourceType = updates.sourceType;\n    if (updates.apiEndpoint !== undefined) updateData.apiEndpoint = updates.apiEndpoint;\n    if (updates.credibilityScore !== undefined) updateData.credibilityScore = updates.credibilityScore;\n    if (updates.lastScraped !== undefined) updateData.lastScraped = updates.lastScraped;\n    if (updates.isActive !== undefined) updateData.isActive = updates.isActive;\n    \n    const result = await db\n      .update(contentSources)\n      .set(updateData)\n      .where(eq(contentSources.id, id))\n      .returning();\n    \n    return result[0];\n  }\n\n  // Scraped content operations\n  async createScrapedContent(content: InsertScrapedContent): Promise<ScrapedContent> {\n    const result = await db.insert(scrapedContent).values(content).returning();\n    return result[0];\n  }\n\n  async getUnprocessedContent(limit: number = 50): Promise<ScrapedContent[]> {\n    return await db\n      .select()\n      .from(scrapedContent)\n      .where(eq(scrapedContent.processed, false))\n      .orderBy(sql`${scrapedContent.extractedAt} ASC`)\n      .limit(limit);\n  }\n\n  async markContentProcessed(id: string): Promise<void> {\n    await db\n      .update(scrapedContent)\n      .set({ processed: true })\n      .where(eq(scrapedContent.id, id));\n  }\n\n  async storeScrapedContent(conflicts: Map<string, any>): Promise<number> {\n    let storedCount = 0;\n    \n    // Get or create ReliefWeb source\n    let source = await db\n      .select()\n      .from(contentSources)\n      .where(eq(contentSources.sourceName, 'reliefweb'))\n      .limit(1);\n    \n    if (source.length === 0) {\n      const newSource = await db.insert(contentSources).values({\n        sourceName: 'reliefweb',\n        sourceType: 'authoritative',\n        apiEndpoint: 'https://api.reliefweb.int/v1/reports',\n        credibilityScore: '9.0',\n        isActive: true,\n      }).returning();\n      source = newSource;\n    }\n\n    const sourceId = source[0].id;\n\n    for (const [countryCode, conflictData] of conflicts.entries()) {\n      await db.insert(scrapedContent).values({\n        sourceId,\n        contentType: 'humanitarian_report',\n        rawData: conflictData,\n        countryCode,\n        processed: false,\n      });\n      storedCount++;\n    }\n\n    // Update last scraped timestamp\n    await db\n      .update(contentSources)\n      .set({ lastScraped: sql`NOW()` })\n      .where(eq(contentSources.id, sourceId));\n\n    return storedCount;\n  }\n\n  async processScrapedContent(limit: number = 10): Promise<number> {\n    // Get unprocessed content\n    const unprocessed = await this.getUnprocessedContent(limit);\n    \n    if (unprocessed.length === 0) {\n      return 0;\n    }\n\n    // For now, create placeholder approvals\n    // LLM processing will be added when OpenAI key is available\n    for (const content of unprocessed) {\n      const rawData = content.rawData as any;\n      \n      // Create approval with placeholder generated content\n      await this.createConflictApproval({\n        status: 'pending',\n        generatedContent: {\n          country: rawData.countryName,\n          region: this.getRegionFromCountryCode(rawData.countryCode),\n          title: `${rawData.countryName} Humanitarian Crisis`,\n          summary: `Ongoing humanitarian situation in ${rawData.countryName}. Based on ${rawData.reports?.length || 0} recent reports.`,\n          severityLevel: 'moderate',\n          affectedGroups: rawData.vulnerableGroups || [],\n          source: 'reliefweb',\n          rawContentId: content.id,\n        },\n      });\n\n      await this.markContentProcessed(content.id);\n    }\n\n    return unprocessed.length;\n  }\n\n  private getRegionFromCountryCode(countryCode: string): string {\n    // Simple region mapping - can be expanded\n    const regionMap: Record<string, string> = {\n      // Middle East\n      'SYR': 'Middle East', 'YEM': 'Middle East', 'IRQ': 'Middle East',\n      'PSE': 'Middle East', 'LBN': 'Middle East', 'JOR': 'Middle East',\n      // Africa\n      'ETH': 'Africa', 'SOM': 'Africa', 'SSD': 'Africa', 'SDN': 'Africa',\n      'COD': 'Africa', 'CAF': 'Africa', 'NGA': 'Africa', 'MLI': 'Africa',\n      // Asia\n      'AFG': 'Asia', 'MMR': 'Asia', 'BGD': 'Asia', 'PAK': 'Asia',\n      // Europe\n      'UKR': 'Europe',\n      // Latin America\n      'VEN': 'Latin America', 'COL': 'Latin America', 'HTI': 'Latin America',\n    };\n    \n    return regionMap[countryCode] || 'Other';\n  }\n\n  // Conflict approval operations\n  async createConflictApproval(approval: InsertConflictApproval): Promise<ConflictApproval> {\n    const result = await db.insert(conflictApprovals).values(approval).returning();\n    return result[0];\n  }\n\n  async getPendingApprovals(): Promise<ConflictApproval[]> {\n    return await db\n      .select()\n      .from(conflictApprovals)\n      .where(eq(conflictApprovals.status, 'pending'))\n      .orderBy(sql`${conflictApprovals.createdAt} ASC`);\n  }\n\n  async approveConflict(\n    id: string, \n    reviewedBy: string, \n    notes?: string\n  ): Promise<ConflictApproval | undefined> {\n    const result = await db\n      .update(conflictApprovals)\n      .set({\n        status: 'approved',\n        reviewedBy,\n        reviewNotes: notes || null,\n        reviewedAt: sql`NOW()`,\n      })\n      .where(eq(conflictApprovals.id, id))\n      .returning();\n    \n    return result[0];\n  }\n\n  async rejectConflict(\n    id: string, \n    reviewedBy: string, \n    notes?: string\n  ): Promise<ConflictApproval | undefined> {\n    const result = await db\n      .update(conflictApprovals)\n      .set({\n        status: 'rejected',\n        reviewedBy,\n        reviewNotes: notes || null,\n        reviewedAt: sql`NOW()`,\n      })\n      .where(eq(conflictApprovals.id, id))\n      .returning();\n    \n    return result[0];\n  }\n\n  // Action operations\n  async getActions(filters?: { \n    type?: string; \n    status?: string; \n    conflictId?: string; \n    limit?: number \n  }): Promise<Action[]> {\n    let query = db.select().from(actions);\n    \n    const conditions = [];\n    if (filters?.type) {\n      conditions.push(eq(actions.type, filters.type));\n    }\n    if (filters?.status) {\n      conditions.push(eq(actions.status, filters.status));\n    }\n    if (filters?.conflictId) {\n      conditions.push(sql`${filters.conflictId} = ANY(${actions.relatedConflicts})`);\n    }\n    \n    if (conditions.length > 0) {\n      query = query.where(sql`${sql.join(conditions, sql` AND `)}`);\n    }\n    \n    const limit = filters?.limit || 50;\n    return await query.limit(limit).orderBy(sql`${actions.createdAt} DESC`);\n  }\n\n  async getAction(id: string): Promise<Action | undefined> {\n    const result = await db.select().from(actions).where(eq(actions.id, id));\n    return result[0];\n  }\n\n  async getActionsByConflict(conflictId: string, limit = 20): Promise<Action[]> {\n    return await db\n      .select()\n      .from(actions)\n      .where(sql`${conflictId} = ANY(${actions.relatedConflicts})`)\n      .limit(limit)\n      .orderBy(sql`${actions.startTime} ASC NULLS LAST`);\n  }\n\n  async getActionsByLocation(\n    latitude: number, \n    longitude: number, \n    radiusMiles = 50, \n    limit = 20\n  ): Promise<Action[]> {\n    // Using simple distance calculation (this could be optimized with PostGIS)\n    // For now, we'll use a bounding box approach\n    const latDelta = radiusMiles / 69; // 1 degree latitude ≈ 69 miles\n    const lonDelta = radiusMiles / (69 * Math.cos(latitude * Math.PI / 180));\n    \n    const minLat = latitude - latDelta;\n    const maxLat = latitude + latDelta;\n    const minLon = longitude - lonDelta;\n    const maxLon = longitude + lonDelta;\n    \n    return await db\n      .select()\n      .from(actions)\n      .where(sql`\n        ${actions.latitude} IS NOT NULL \n        AND ${actions.longitude} IS NOT NULL\n        AND ${actions.latitude} BETWEEN ${minLat} AND ${maxLat}\n        AND ${actions.longitude} BETWEEN ${minLon} AND ${maxLon}\n        AND ${actions.status} = 'active'\n      `)\n      .limit(limit);\n  }\n\n  async createAction(action: InsertAction): Promise<Action> {\n    const result = await db.insert(actions).values(action).returning();\n    return result[0];\n  }\n\n  async updateAction(id: string, updates: Partial<Action>): Promise<Action | undefined> {\n    const updateData: any = {};\n    \n    if (updates.title !== undefined) updateData.title = updates.title;\n    if (updates.description !== undefined) updateData.description = updates.description;\n    if (updates.status !== undefined) updateData.status = updates.status;\n    if (updates.signatureCount !== undefined) updateData.signatureCount = updates.signatureCount;\n    if (updates.currentAttendance !== undefined) updateData.currentAttendance = updates.currentAttendance;\n    \n    if (Object.keys(updateData).length === 0) {\n      return this.getAction(id);\n    }\n    \n    updateData.lastUpdated = sql`NOW()`;\n    \n    const result = await db\n      .update(actions)\n      .set(updateData)\n      .where(eq(actions.id, id))\n      .returning();\n    \n    return result[0];\n  }\n\n  // User action participation operations\n  async getUserActionParticipation(\n    userId: string, \n    actionId: string\n  ): Promise<UserActionParticipation | undefined> {\n    const result = await db\n      .select()\n      .from(userActionParticipation)\n      .where(sql`${userActionParticipation.userId} = ${userId} AND ${userActionParticipation.actionId} = ${actionId}`);\n    \n    return result[0];\n  }\n\n  async createUserActionParticipation(\n    participation: InsertUserActionParticipation\n  ): Promise<UserActionParticipation> {\n    const result = await db\n      .insert(userActionParticipation)\n      .values(participation)\n      .returning();\n    \n    return result[0];\n  }\n\n  async updateUserActionParticipation(\n    id: string, \n    updates: Partial<UserActionParticipation>\n  ): Promise<UserActionParticipation | undefined> {\n    const updateData: any = {};\n    \n    if (updates.status !== undefined) updateData.status = updates.status;\n    if (updates.participationType !== undefined) updateData.participationType = updates.participationType;\n    if (updates.personalMessage !== undefined) updateData.personalMessage = updates.personalMessage;\n    if (updates.reminded !== undefined) updateData.reminded = updates.reminded;\n    \n    if (updates.status === 'completed') {\n      updateData.completedAt = sql`NOW()`;\n    }\n    \n    const result = await db\n      .update(userActionParticipation)\n      .set(updateData)\n      .where(eq(userActionParticipation.id, id))\n      .returning();\n    \n    return result[0];\n  }\n\n  async getUserParticipatedActions(userId: string, limit = 50): Promise<Action[]> {\n    const result = await db\n      .select({\n        action: actions,\n      })\n      .from(userActionParticipation)\n      .innerJoin(actions, eq(userActionParticipation.actionId, actions.id))\n      .where(eq(userActionParticipation.userId, userId))\n      .limit(limit)\n      .orderBy(sql`${userActionParticipation.createdAt} DESC`);\n    \n    return result.map(r => r.action);\n  }\n\n  // Action reminder operations\n  async createActionReminder(reminder: InsertActionReminder): Promise<ActionReminder> {\n    const result = await db.insert(actionReminders).values(reminder).returning();\n    return result[0];\n  }\n\n  async getUserActionReminders(userId: string): Promise<ActionReminder[]> {\n    return await db\n      .select()\n      .from(actionReminders)\n      .where(eq(actionReminders.userId, userId))\n      .orderBy(sql`${actionReminders.reminderTime} ASC`);\n  }\n\n  async deleteActionReminder(id: string): Promise<void> {\n    await db.delete(actionReminders).where(eq(actionReminders.id, id));\n  }\n\n  // Action report operations\n  async createActionReport(report: InsertActionReport): Promise<ActionReport> {\n    const result = await db.insert(actionReports).values(report).returning();\n    return result[0];\n  }\n\n  async getActionReports(actionId?: string): Promise<ActionReport[]> {\n    if (actionId) {\n      return await db\n        .select()\n        .from(actionReports)\n        .where(eq(actionReports.actionId, actionId))\n        .orderBy(sql`${actionReports.createdAt} DESC`);\n    }\n    \n    return await db\n      .select()\n      .from(actionReports)\n      .where(eq(actionReports.status, 'pending'))\n      .orderBy(sql`${actionReports.createdAt} DESC`);\n  }\n  \n  // Gamification - Monthly Reports\n  async getMonthlyReport(userId: string, month: string): Promise<MonthlyReport | undefined> {\n    const result = await db\n      .select()\n      .from(monthlyReports)\n      .where(sql`${monthlyReports.userId} = ${userId} AND ${monthlyReports.month} = ${month}`);\n    return result[0];\n  }\n  \n  async createMonthlyReport(report: InsertMonthlyReport): Promise<MonthlyReport> {\n    const result = await db.insert(monthlyReports).values(report).returning();\n    return result[0];\n  }\n  \n  async getUserMonthlyReports(userId: string, limit = 12): Promise<MonthlyReport[]> {\n    return await db\n      .select()\n      .from(monthlyReports)\n      .where(eq(monthlyReports.userId, userId))\n      .orderBy(sql`${monthlyReports.month} DESC`)\n      .limit(limit);\n  }\n  \n  // Gamification - Badges\n  async getUserBadges(userId: string): Promise<UserBadge[]> {\n    return await db\n      .select()\n      .from(userBadges)\n      .where(eq(userBadges.userId, userId))\n      .orderBy(sql`${userBadges.earnedAt} DESC`);\n  }\n  \n  async awardBadge(badge: InsertUserBadge): Promise<UserBadge> {\n    const result = await db.insert(userBadges).values(badge).returning();\n    return result[0];\n  }\n  \n  async hasBadge(userId: string, badgeType: string): Promise<boolean> {\n    const result = await db\n      .select()\n      .from(userBadges)\n      .where(sql`${userBadges.userId} = ${userId} AND ${userBadges.badgeType} = ${badgeType}`);\n    return result.length > 0;\n  }\n  \n  // Gamification - Points\n  async getUserPoints(userId: string): Promise<UserPoints | undefined> {\n    const result = await db\n      .select()\n      .from(userPoints)\n      .where(eq(userPoints.userId, userId));\n    return result[0];\n  }\n  \n  async createUserPoints(points: InsertUserPoints): Promise<UserPoints> {\n    const result = await db.insert(userPoints).values(points).returning();\n    return result[0];\n  }\n  \n  async addPoints(\n    userId: string, \n    activityType: string, \n    pointsEarned: number, \n    description?: string\n  ): Promise<UserPoints> {\n    return await db.transaction(async (tx) => {\n      await tx.insert(pointsHistory).values({\n        userId,\n        activityType,\n        pointsEarned,\n        description: description || null,\n      });\n      \n      let points = await tx\n        .select()\n        .from(userPoints)\n        .where(eq(userPoints.userId, userId))\n        .then(r => r[0]);\n      \n      if (!points) {\n        const created = await tx.insert(userPoints).values({ userId }).returning();\n        points = created[0];\n      }\n      \n      const newTotalPoints = points.totalPoints + pointsEarned;\n      const newPointsThisMonth = points.pointsThisMonth + pointsEarned;\n      \n      let newLevel = points.level;\n      let newNextLevelPoints = points.nextLevelPoints;\n      \n      if (newTotalPoints >= points.nextLevelPoints) {\n        newLevel = points.level + 1;\n        newNextLevelPoints = newLevel * 100;\n      }\n      \n      const result = await tx\n        .update(userPoints)\n        .set({\n          totalPoints: newTotalPoints,\n          pointsThisMonth: newPointsThisMonth,\n          level: newLevel,\n          nextLevelPoints: newNextLevelPoints,\n          updatedAt: sql`NOW()`,\n        })\n        .where(eq(userPoints.userId, userId))\n        .returning();\n      \n      return result[0];\n    });\n  }\n  \n  async getPointsHistory(userId: string, limit = 50): Promise<PointsHistory[]> {\n    return await db\n      .select()\n      .from(pointsHistory)\n      .where(eq(pointsHistory.userId, userId))\n      .orderBy(sql`${pointsHistory.createdAt} DESC`)\n      .limit(limit);\n  }\n  \n  // Gamification - Challenges\n  async getActiveChallenges(month: string): Promise<MonthlyChallenge[]> {\n    return await db\n      .select()\n      .from(monthlyChallenges)\n      .where(sql`${monthlyChallenges.month} = ${month} AND ${monthlyChallenges.isActive} = true`)\n      .orderBy(sql`${monthlyChallenges.displayOrder} ASC`);\n  }\n  \n  async createChallenge(challenge: InsertMonthlyChallenge): Promise<MonthlyChallenge> {\n    const result = await db.insert(monthlyChallenges).values(challenge).returning();\n    return result[0];\n  }\n  \n  async getUserChallengeProgress(\n    userId: string, \n    challengeId: string\n  ): Promise<UserChallenge | undefined> {\n    const result = await db\n      .select()\n      .from(userChallenges)\n      .where(sql`${userChallenges.userId} = ${userId} AND ${userChallenges.challengeId} = ${challengeId}`);\n    return result[0];\n  }\n  \n  async updateChallengeProgress(\n    userId: string, \n    challengeId: string, \n    progress: number\n  ): Promise<UserChallenge> {\n    return await db.transaction(async (tx) => {\n      const existing = await tx\n        .select()\n        .from(userChallenges)\n        .where(sql`${userChallenges.userId} = ${userId} AND ${userChallenges.challengeId} = ${challengeId}`)\n        .then(r => r[0]);\n      \n      const challenge = await tx\n        .select()\n        .from(monthlyChallenges)\n        .where(eq(monthlyChallenges.id, challengeId))\n        .then(r => r[0]);\n      \n      const isCompleted = challenge?.goal ? progress >= challenge.goal : false;\n      \n      if (existing) {\n        const result = await tx\n          .update(userChallenges)\n          .set({\n            progress,\n            completed: isCompleted,\n            completedAt: isCompleted ? sql`NOW()` : null,\n          })\n          .where(sql`${userChallenges.userId} = ${userId} AND ${userChallenges.challengeId} = ${challengeId}`)\n          .returning();\n        \n        return result[0];\n      } else {\n        const result = await tx\n          .insert(userChallenges)\n          .values({\n            userId,\n            challengeId,\n            progress,\n            completed: isCompleted,\n            completedAt: isCompleted ? sql`NOW()` : null,\n          })\n          .returning();\n        \n        return result[0];\n      }\n    });\n  }\n  \n  async getUserChallenges(\n    userId: string\n  ): Promise<Array<UserChallenge & { challenge: MonthlyChallenge }>> {\n    const result = await db\n      .select({\n        userChallenge: userChallenges,\n        challenge: monthlyChallenges,\n      })\n      .from(userChallenges)\n      .innerJoin(monthlyChallenges, eq(userChallenges.challengeId, monthlyChallenges.id))\n      .where(eq(userChallenges.userId, userId))\n      .orderBy(sql`${monthlyChallenges.displayOrder} ASC`);\n    \n    return result.map(r => ({ ...r.userChallenge, challenge: r.challenge }));\n  }\n  \n  // Gamification - Impact Stories\n  async getImpactStories(filters: { \n    organizationId?: string; \n    conflictId?: string; \n    featured?: boolean; \n    limit?: number \n  } = {}): Promise<ImpactStory[]> {\n    const { organizationId, conflictId, featured, limit = 20 } = filters;\n    \n    let query = db.select().from(impactStories);\n    \n    const conditions = [];\n    if (organizationId) {\n      conditions.push(sql`${impactStories.organizationId} = ${organizationId}`);\n    }\n    if (conflictId) {\n      conditions.push(sql`${impactStories.conflictId} = ${conflictId}`);\n    }\n    if (featured !== undefined) {\n      conditions.push(sql`${impactStories.isFeatured} = ${featured}`);\n    }\n    \n    if (conditions.length > 0) {\n      query = query.where(sql.join(conditions, sql` AND `)) as any;\n    }\n    \n    return await query\n      .orderBy(sql`${impactStories.publishedAt} DESC`)\n      .limit(limit);\n  }\n  \n  async createImpactStory(story: InsertImpactStory): Promise<ImpactStory> {\n    const result = await db.insert(impactStories).values(story).returning();\n    return result[0];\n  }\n\n  // Verification operations\n  async createOrganizationReport(report: InsertOrganizationReport): Promise<void> {\n    await db.insert(organizationReports).values(report);\n  }\n\n  async getPendingVerifications(): Promise<Organization[]> {\n    const result = await db\n      .select()\n      .from(organizations)\n      .where(sql`${organizations.verificationStatus} IN ('pending', 'in_review', 'needs_info')`)\n      .orderBy(sql`${organizations.createdAt} ASC`);\n    \n    return result;\n  }\n\n  async approveOrganization(\n    id: string, \n    data: { verificationLevel: number; verifiedBy: string; notes?: string }\n  ): Promise<void> {\n    await db.transaction(async (tx) => {\n      // Update organization\n      await tx\n        .update(organizations)\n        .set({\n          verificationStatus: 'verified',\n          verificationLevel: data.verificationLevel,\n          lastVerified: sql`NOW()`,\n          verifiedBy: data.verifiedBy,\n        })\n        .where(eq(organizations.id, id));\n      \n      // Log action\n      await tx.insert(verificationHistory).values({\n        organizationId: id,\n        action: 'approved',\n        newStatus: 'verified',\n        performedBy: data.verifiedBy,\n        notes: data.notes || null,\n      });\n    });\n  }\n\n  async rejectOrganization(\n    id: string, \n    data: { reason: string; rejectedBy: string; notes?: string }\n  ): Promise<void> {\n    await db.transaction(async (tx) => {\n      // Update organization\n      await tx\n        .update(organizations)\n        .set({\n          verificationStatus: 'rejected',\n          verificationData: sql`jsonb_set(\n            COALESCE(${organizations.verificationData}, '{}'::jsonb),\n            '{rejection_reason}',\n            ${JSON.stringify(data.reason)}::jsonb\n          )`,\n        })\n        .where(eq(organizations.id, id));\n      \n      // Log action\n      await tx.insert(verificationHistory).values({\n        organizationId: id,\n        action: 'rejected',\n        newStatus: 'rejected',\n        performedBy: data.rejectedBy,\n        notes: data.notes || null,\n      });\n    });\n  }\n\n  async requestOrganizationInfo(\n    id: string, \n    data: { requestedItems: string[]; requestedBy: string; notes?: string }\n  ): Promise<void> {\n    await db.transaction(async (tx) => {\n      // Update organization\n      await tx\n        .update(organizations)\n        .set({\n          verificationStatus: 'needs_info',\n          verificationData: sql`jsonb_set(\n            COALESCE(${organizations.verificationData}, '{}'::jsonb),\n            '{requested_items}',\n            ${JSON.stringify(data.requestedItems)}::jsonb\n          )`,\n        })\n        .where(eq(organizations.id, id));\n      \n      // Log action\n      await tx.insert(verificationHistory).values({\n        organizationId: id,\n        action: 'info_requested',\n        newStatus: 'needs_info',\n        performedBy: data.requestedBy,\n        notes: data.notes || null,\n      });\n    });\n  }\n\n  // Nonprofit cache operations\n  async getCharitywatchCache(country: string): Promise<typeof charitywatchCache.$inferSelect | undefined> {\n    const result = await db\n      .select()\n      .from(charitywatchCache)\n      .where(eq(charitywatchCache.country, country))\n      .orderBy(sql`${charitywatchCache.cachedAt} DESC`)\n      .limit(1);\n    \n    return result[0];\n  }\n\n  async cacheCharitywatchData(country: string, nonprofits: any[], expiresAt: Date): Promise<void> {\n    await db.insert(charitywatchCache).values({\n      country,\n      nonprofits: nonprofits as any,\n      expiresAt,\n    });\n  }\n\n  // External donation tracking\n  async trackExternalDonation(data: {\n    userId: string;\n    conflictId?: string;\n    conflictCountry: string;\n    nonprofitName: string;\n    nonprofitEin?: string;\n    donateUrl: string;\n  }): Promise<typeof externalDonations.$inferSelect> {\n    const result = await db.insert(externalDonations).values({\n      userId: data.userId,\n      conflictId: data.conflictId || null,\n      conflictCountry: data.conflictCountry,\n      nonprofitName: data.nonprofitName,\n      nonprofitEin: data.nonprofitEin || null,\n      donateUrl: data.donateUrl,\n      status: 'initiated',\n    }).returning();\n    \n    return result[0];\n  }\n}\n\nexport const storage = new DbStorage();\n","size_bytes":41606},"client/src/components/examples/DonationHistory.tsx":{"content":"import DonationHistory from '../DonationHistory';\n\nexport default function DonationHistoryExample() {\n  const mockDonations = [\n    {\n      id: \"1\",\n      organizationName: \"International Rescue Committee\",\n      conflictTitle: \"Syrian Refugee Crisis\",\n      amount: 100,\n      date: \"2025-01-15\",\n      type: \"one-time\",\n    },\n    {\n      id: \"2\",\n      organizationName: \"Doctors Without Borders\",\n      conflictTitle: \"Yemen Healthcare Crisis\",\n      amount: 50,\n      date: \"2025-01-10\",\n      type: \"one-time\",\n    },\n    {\n      id: \"3\",\n      organizationName: \"UNICEF\",\n      conflictTitle: \"Ukraine Education Support\",\n      amount: 75,\n      date: \"2025-01-05\",\n      type: \"one-time\",\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background p-6\">\n      <div className=\"max-w-2xl mx-auto\">\n        <h2 className=\"text-3xl font-display font-bold mb-6\">Donation History</h2>\n        <DonationHistory donations={mockDonations} />\n      </div>\n    </div>\n  );\n}\n","size_bytes":984},"client/src/components/DonationModal.tsx":{"content":"import { useState } from \"react\";\nimport { X, Heart, Info } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\n\ninterface Organization {\n  id: string;\n  name: string;\n  description: string;\n}\n\ninterface DonationModalProps {\n  open: boolean;\n  onClose: () => void;\n  conflictTitle: string;\n  organizations: Organization[];\n  onComplete: (amount: number, orgIds: string[]) => void;\n}\n\nconst PRESET_AMOUNTS = [10, 25, 50, 100, 250, 500];\n\nexport default function DonationModal({\n  open,\n  onClose,\n  conflictTitle,\n  organizations,\n  onComplete,\n}: DonationModalProps) {\n  const [amount, setAmount] = useState<number | null>(null);\n  const [customAmount, setCustomAmount] = useState(\"\");\n  const [selectedOrgs, setSelectedOrgs] = useState<string[]>(\n    organizations.map((o) => o.id)\n  );\n\n  const finalAmount = amount || parseFloat(customAmount) || 0;\n  const perOrgAmount = selectedOrgs.length > 0 \n    ? (finalAmount / selectedOrgs.length).toFixed(2)\n    : \"0.00\";\n\n  const handleDonate = () => {\n    if (finalAmount > 0 && selectedOrgs.length > 0) {\n      onComplete(finalAmount, selectedOrgs);\n      onClose();\n    }\n  };\n\n  const toggleOrg = (orgId: string) => {\n    setSelectedOrgs((prev) =>\n      prev.includes(orgId)\n        ? prev.filter((id) => id !== orgId)\n        : [...prev, orgId]\n    );\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-2xl font-display\">Support {conflictTitle}</DialogTitle>\n          <DialogDescription>\n            Your donation will be split equally among selected organizations\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6 mt-4\">\n          <div>\n            <h3 className=\"font-semibold mb-3\">Choose your donation amount</h3>\n            <div className=\"grid grid-cols-3 gap-3 mb-3\">\n              {PRESET_AMOUNTS.map((preset) => (\n                <Button\n                  key={preset}\n                  variant={amount === preset ? \"default\" : \"outline\"}\n                  onClick={() => {\n                    setAmount(preset);\n                    setCustomAmount(\"\");\n                  }}\n                  data-testid={`button-amount-${preset}`}\n                >\n                  ${preset}\n                </Button>\n              ))}\n            </div>\n            <div className=\"relative\">\n              <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground\">\n                $\n              </span>\n              <input\n                type=\"number\"\n                placeholder=\"Custom amount\"\n                value={customAmount}\n                onChange={(e) => {\n                  setCustomAmount(e.target.value);\n                  setAmount(null);\n                }}\n                className=\"w-full pl-8 pr-4 py-2 border border-input rounded-md bg-background\"\n                data-testid=\"input-custom-amount\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <h3 className=\"font-semibold mb-3\">Select organizations to support</h3>\n            <div className=\"space-y-2\">\n              {organizations.map((org) => {\n                const isSelected = selectedOrgs.includes(org.id);\n                return (\n                  <Card\n                    key={org.id}\n                    className={`p-4 cursor-pointer transition-all hover-elevate ${\n                      isSelected ? \"border-primary bg-primary/5\" : \"\"\n                    }`}\n                    onClick={() => toggleOrg(org.id)}\n                    data-testid={`org-selector-${org.id}`}\n                  >\n                    <div className=\"flex items-start gap-3\">\n                      <input\n                        type=\"checkbox\"\n                        checked={isSelected}\n                        onChange={() => {}}\n                        className=\"mt-1\"\n                        data-testid={`checkbox-org-${org.id}`}\n                      />\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center justify-between mb-1\">\n                          <h4 className=\"font-medium\">{org.name}</h4>\n                          {isSelected && finalAmount > 0 && (\n                            <Badge variant=\"secondary\" data-testid={`badge-split-${org.id}`}>\n                              ${perOrgAmount}\n                            </Badge>\n                          )}\n                        </div>\n                        <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                          {org.description}\n                        </p>\n                      </div>\n                    </div>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n\n          {finalAmount > 0 && selectedOrgs.length > 0 && (\n            <Card className=\"p-4 bg-accent/50\">\n              <div className=\"flex items-start gap-2\">\n                <Info className=\"h-5 w-5 text-accent-foreground mt-0.5\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-accent-foreground\">\n                    Your ${finalAmount} donation will be split equally\n                  </p>\n                  <p className=\"text-sm text-accent-foreground/80\">\n                    ${perOrgAmount} to each of {selectedOrgs.length} organization(s)\n                  </p>\n                </div>\n              </div>\n            </Card>\n          )}\n\n          <div className=\"flex gap-3 pt-4\">\n            <Button variant=\"outline\" onClick={onClose} className=\"flex-1\" data-testid=\"button-cancel\">\n              Cancel\n            </Button>\n            <Button\n              onClick={handleDonate}\n              disabled={finalAmount === 0 || selectedOrgs.length === 0}\n              className=\"flex-1\"\n              data-testid=\"button-complete-donation\"\n            >\n              <Heart className=\"h-4 w-4 mr-2\" />\n              Donate ${finalAmount.toFixed(0)}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":6386},"client/src/components/examples/HowItWorks.tsx":{"content":"import HowItWorks from '../HowItWorks';\n\nexport default function HowItWorksExample() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <HowItWorks />\n    </div>\n  );\n}\n","size_bytes":186},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/examples/Hero.tsx":{"content":"import Hero from '../Hero';\n\nexport default function HeroExample() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Hero\n        onGetStarted={() => console.log('Get started clicked')}\n        onLearnMore={() => console.log('Learn more clicked')}\n      />\n    </div>\n  );\n}\n","size_bytes":294},"client/src/components/ImpactStats.tsx":{"content":"import { TrendingUp, Users, Heart, Globe } from \"lucide-react\";\nimport { Card } from \"@/components/ui/card\";\n\ninterface ImpactStatsProps {\n  totalDonated: number;\n  peopleHelped: number;\n  organizationsSupported: number;\n  conflictsSupported: number;\n}\n\nexport default function ImpactStats({\n  totalDonated,\n  peopleHelped,\n  organizationsSupported,\n  conflictsSupported,\n}: ImpactStatsProps) {\n  const stats = [\n    {\n      label: \"Total Donated\",\n      value: `$${totalDonated.toLocaleString()}`,\n      icon: Heart,\n      color: \"text-chart-2\",\n      bg: \"bg-chart-2/10\",\n      gradient: \"from-chart-2/20 to-transparent\",\n    },\n    {\n      label: \"People Helped\",\n      value: peopleHelped.toLocaleString(),\n      icon: Users,\n      color: \"text-chart-3\",\n      bg: \"bg-chart-3/10\",\n      gradient: \"from-chart-3/20 to-transparent\",\n    },\n    {\n      label: \"Organizations\",\n      value: organizationsSupported.toString(),\n      icon: TrendingUp,\n      color: \"text-chart-1\",\n      bg: \"bg-chart-1/10\",\n      gradient: \"from-chart-1/20 to-transparent\",\n    },\n    {\n      label: \"Regions Supported\",\n      value: conflictsSupported.toString(),\n      icon: Globe,\n      color: \"text-chart-4\",\n      bg: \"bg-chart-4/10\",\n      gradient: \"from-chart-4/20 to-transparent\",\n    },\n  ];\n\n  return (\n    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n      {stats.map((stat) => {\n        const Icon = stat.icon;\n        return (\n          <Card \n            key={stat.label} \n            className=\"p-6 text-center relative overflow-hidden group hover:shadow-lg transition-all duration-300 hover:scale-105\" \n            data-testid={`stat-${stat.label.toLowerCase().replace(/\\s+/g, '-')}`}\n          >\n            <div className={`absolute inset-0 bg-gradient-to-br ${stat.gradient} opacity-0 group-hover:opacity-100 transition-opacity duration-300`} />\n            <div className=\"relative\">\n              <div className={`inline-flex items-center justify-center h-14 w-14 rounded-full ${stat.bg} mx-auto mb-3`}>\n                <Icon className={`h-7 w-7 ${stat.color}`} />\n              </div>\n              <p className=\"text-4xl font-display font-bold mb-1 bg-gradient-to-br from-foreground to-foreground/70 bg-clip-text text-transparent\">\n                {stat.value}\n              </p>\n              <p className=\"text-sm text-muted-foreground font-medium\">{stat.label}</p>\n            </div>\n          </Card>\n        );\n      })}\n    </div>\n  );\n}\n","size_bytes":2462},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertUserSchema, insertDonationSchema, insertUserEventSchema, insertOrganizationReportSchema } from \"@shared/schema\";\nimport { preferenceEngine } from \"./preference-engine\";\nimport { reportGenerator } from \"./report-generator\";\nimport { badgeService } from \"./badge-service\";\nimport { TrustScoreService } from \"./trust-score-service\";\nimport bcrypt from \"bcrypt\";\nimport { format } from \"date-fns\";\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n  }\n}\n\nconst SALT_ROUNDS = 10;\n\n// Authentication middleware\nexport function requireAuth(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.userId) {\n    return res.status(401).json({ error: \"Unauthorized\" });\n  }\n  next();\n}\n\n// Admin authorization middleware\nexport async function requireAdmin(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.userId) {\n    return res.status(401).json({ error: \"Unauthorized\" });\n  }\n  \n  const user = await storage.getUser(req.session.userId);\n  if (!user || !user.isAdmin) {\n    return res.status(403).json({ error: \"Forbidden - Admin access required\" });\n  }\n  \n  next();\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Auth routes\n  app.post(\"/api/auth/signup\", async (req, res) => {\n    try {\n      console.log(\"📝 SIGNUP REQUEST - Step 1: Received signup request\");\n      const { name, email, password } = req.body;\n      console.log(\"📝 SIGNUP REQUEST - Data:\", { name, email, passwordLength: password?.length });\n      \n      if (!name || !email || !password) {\n        console.log(\"❌ SIGNUP FAILED - Missing required fields\");\n        return res.status(400).json({ error: \"Name, email, and password are required\" });\n      }\n\n      console.log(\"📝 SIGNUP REQUEST - Step 2: Checking if user exists...\");\n      // Check if user exists\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        console.log(\"❌ SIGNUP FAILED - User already exists with email:\", email);\n        return res.status(400).json({ error: \"User already exists\" });\n      }\n      console.log(\"✅ SIGNUP REQUEST - User does not exist, proceeding...\");\n      \n      console.log(\"📝 SIGNUP REQUEST - Step 3: Creating user with hashed password...\");\n      // Create user with hashed password\n      const user = await storage.createUser({\n        name,\n        email,\n        preferences: {\n          causes: [],\n          regions: [],\n          donationRange: \"any\",\n        }\n      }, password);\n      console.log(\"✅ SIGNUP SUCCESS - User created with ID:\", user.id);\n\n      console.log(\"📝 SIGNUP REQUEST - Step 4: Setting session...\");\n      req.session.userId = user.id;\n      console.log(\"✅ SIGNUP SUCCESS - Session set, user ID:\", user.id);\n      \n      console.log(\"✅ SIGNUP COMPLETE - Returning user data\");\n      res.json({\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        onboardingCompleted: user.onboardingCompleted,\n      });\n    } catch (error) {\n      console.error(\"❌❌❌ SIGNUP ERROR - Full error:\", error);\n      console.error(\"❌ Error stack:\", error instanceof Error ? error.stack : 'No stack trace');\n      console.error(\"❌ Error message:\", error instanceof Error ? error.message : String(error));\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      console.log(\"🔐 LOGIN REQUEST - Step 1: Received login request\");\n      const { email, password } = req.body;\n      console.log(\"🔐 LOGIN REQUEST - Data:\", { email, passwordLength: password?.length });\n      \n      if (!email || !password) {\n        console.log(\"❌ LOGIN FAILED - Missing required fields\");\n        return res.status(400).json({ error: \"Email and password are required\" });\n      }\n\n      console.log(\"🔐 LOGIN REQUEST - Step 2: Verifying password...\");\n      const user = await storage.verifyPassword(email, password);\n      if (!user) {\n        console.log(\"❌ LOGIN FAILED - Invalid credentials for email:\", email);\n        return res.status(401).json({ error: \"Invalid credentials\" });\n      }\n      console.log(\"✅ LOGIN REQUEST - Password verified for user:\", user.id);\n      \n      console.log(\"🔐 LOGIN REQUEST - Step 3: Setting session...\");\n      req.session.userId = user.id;\n      console.log(\"✅ LOGIN SUCCESS - Session set, user ID:\", user.id);\n      \n      console.log(\"✅ LOGIN COMPLETE - Returning user data\");\n      res.json({\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        onboardingCompleted: user.onboardingCompleted,\n        preferences: user.preferences,\n      });\n    } catch (error) {\n      console.error(\"❌❌❌ LOGIN ERROR - Full error:\", error);\n      console.error(\"❌ Error stack:\", error instanceof Error ? error.stack : 'No stack trace');\n      console.error(\"❌ Error message:\", error instanceof Error ? error.message : String(error));\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ error: \"Failed to logout\" });\n      }\n      res.json({ message: \"Logged out successfully\" });\n    });\n  });\n\n  app.get(\"/api/auth/me\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json({\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        onboardingCompleted: user.onboardingCompleted,\n        preferences: user.preferences,\n      });\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // User routes\n  app.patch(\"/api/user/preferences\", requireAuth, async (req, res) => {\n    try {\n      const { preferences } = req.body;\n      const user = await storage.updateUser(req.session.userId!, { \n        preferences,\n        onboardingCompleted: true\n      });\n\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json(user);\n    } catch (error) {\n      console.error(\"Update preferences error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Conflict routes\n  app.get(\"/api/conflicts\", async (req, res) => {\n    try {\n      const { region } = req.query;\n      \n      let conflicts;\n      if (region && typeof region === \"string\") {\n        conflicts = await storage.getConflictsByRegion(region);\n      } else {\n        conflicts = await storage.getConflicts();\n      }\n\n      res.json(conflicts);\n    } catch (error) {\n      console.error(\"Get conflicts error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Personalized recommendations\n  app.get(\"/api/conflicts/personalized\", requireAuth, async (req, res) => {\n    try {\n      const personalizedFeed = await preferenceEngine.generatePersonalizedFeed(req.session.userId!);\n      res.json(personalizedFeed);\n    } catch (error) {\n      console.error(\"Get personalized conflicts error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.get(\"/api/conflicts/:id\", async (req, res) => {\n    try {\n      const conflict = await storage.getConflict(req.params.id);\n      if (!conflict) {\n        return res.status(404).json({ error: \"Conflict not found\" });\n      }\n\n      res.json(conflict);\n    } catch (error) {\n      console.error(\"Get conflict error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Organization routes\n  app.get(\"/api/organizations\", async (req, res) => {\n    try {\n      const { conflictId } = req.query;\n      \n      let organizations;\n      if (conflictId && typeof conflictId === \"string\") {\n        organizations = await storage.getOrganizationsByConflict(conflictId);\n      } else {\n        organizations = await storage.getOrganizations();\n      }\n\n      res.json(organizations);\n    } catch (error) {\n      console.error(\"Get organizations error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Donation routes\n  app.get(\"/api/donations\", requireAuth, async (req, res) => {\n    try {\n      const donations = await storage.getDonations(req.session.userId!);\n      res.json(donations);\n    } catch (error) {\n      console.error(\"Get donations error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Get ALL donations from ALL users for global impact visualization\n  // Requires authentication to protect user privacy\n  app.get(\"/api/donations/geography\", requireAuth, async (req, res) => {\n    try {\n      const donationGeography = await storage.getAllDonationGeography();\n      res.json(donationGeography);\n    } catch (error) {\n      console.error(\"Get donation geography error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/donations\", requireAuth, async (req, res) => {\n    try {\n      // Validate request body with Zod schema\n      const validationResult = insertDonationSchema.safeParse({\n        ...req.body,\n        userId: req.session.userId!,\n      });\n\n      if (!validationResult.success) {\n        return res.status(400).json({ \n          error: \"Invalid donation data\", \n          details: validationResult.error.errors \n        });\n      }\n\n      const donation = await storage.createDonation(validationResult.data);\n\n      res.json(donation);\n    } catch (error) {\n      console.error(\"Create donation error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.get(\"/api/user/impact\", requireAuth, async (req, res) => {\n    try {\n      const stats = await storage.getUserImpactStats(req.session.userId!);\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Get impact stats error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Behavioral tracking routes\n  app.post(\"/api/events/track\", requireAuth, async (req, res) => {\n    try {\n      const validationResult = insertUserEventSchema.safeParse({\n        ...req.body,\n        userId: req.session.userId!,\n      });\n\n      if (!validationResult.success) {\n        return res.status(400).json({ \n          error: \"Invalid event data\", \n          details: validationResult.error.errors \n        });\n      }\n\n      const event = await storage.createUserEvent(validationResult.data);\n\n      // Update preference vector if this is a swipe event\n      if (event.eventType.startsWith('swipe_') && event.conflictId) {\n        const conflict = await storage.getConflict(event.conflictId);\n        if (conflict) {\n          const swipeDirection = event.eventType.replace('swipe_', '') as 'up' | 'pass' | 'down';\n          const timeSpent = event.eventData?.timeSpent || 0;\n          \n          await preferenceEngine.updatePreferencesFromSwipe(\n            req.session.userId!,\n            conflict,\n            swipeDirection,\n            timeSpent\n          );\n        }\n      }\n\n      res.json(event);\n    } catch (error) {\n      console.error(\"Track event error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.get(\"/api/events\", requireAuth, async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 100;\n      const events = await storage.getUserEvents(req.session.userId!, limit);\n      res.json(events);\n    } catch (error) {\n      console.error(\"Get events error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Preference vector routes\n  app.get(\"/api/user/preference-vector\", requireAuth, async (req, res) => {\n    try {\n      let vector = await storage.getUserPreferenceVector(req.session.userId!);\n      \n      // Create if doesn't exist\n      if (!vector) {\n        vector = await storage.createUserPreferenceVector({\n          userId: req.session.userId!,\n          geoPreferences: {},\n          causePreferences: {},\n          demographicPreferences: {},\n          urgencyPreference: '0.5',\n          interactionCount: 0,\n        });\n      }\n\n      res.json(vector);\n    } catch (error) {\n      console.error(\"Get preference vector error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.patch(\"/api/user/preference-vector\", requireAuth, async (req, res) => {\n    try {\n      const { geoPreferences, causePreferences, demographicPreferences, urgencyPreference, interactionCount } = req.body;\n      \n      const vector = await storage.updateUserPreferenceVector(req.session.userId!, {\n        geoPreferences,\n        causePreferences,\n        demographicPreferences,\n        urgencyPreference,\n        interactionCount,\n      });\n\n      if (!vector) {\n        return res.status(404).json({ error: \"Preference vector not found\" });\n      }\n\n      res.json(vector);\n    } catch (error) {\n      console.error(\"Update preference vector error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Content source management routes (admin only - for now public)\n  app.get(\"/api/content-sources\", async (req, res) => {\n    try {\n      const activeOnly = req.query.activeOnly !== 'false';\n      const sources = await storage.getContentSources(activeOnly);\n      res.json(sources);\n    } catch (error) {\n      console.error(\"Get content sources error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Admin approval queue routes (for future admin dashboard)\n  app.get(\"/api/admin/approvals/pending\", requireAdmin, async (req, res) => {\n    try {\n      const approvals = await storage.getPendingApprovals();\n      res.json(approvals);\n    } catch (error) {\n      console.error(\"Get pending approvals error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/admin/approvals/:id/approve\", requireAdmin, async (req, res) => {\n    try {\n      const { notes } = req.body;\n      const approval = await storage.approveConflict(\n        req.params.id,\n        req.session.userId!,\n        notes\n      );\n\n      if (!approval) {\n        return res.status(404).json({ error: \"Approval not found\" });\n      }\n\n      res.json(approval);\n    } catch (error) {\n      console.error(\"Approve conflict error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.post(\"/api/admin/approvals/:id/reject\", requireAdmin, async (req, res) => {\n    try {\n      const { notes } = req.body;\n      const approval = await storage.rejectConflict(\n        req.params.id,\n        req.session.userId!,\n        notes\n      );\n\n      if (!approval) {\n        return res.status(404).json({ error: \"Approval not found\" });\n      }\n\n      res.json(approval);\n    } catch (error) {\n      console.error(\"Reject conflict error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Content Pipeline Routes (Admin Only)\n  app.post(\"/api/pipeline/scrape\", requireAdmin, async (req, res) => {\n    try {\n      const { ReliefWebScraper } = await import(\"./reliefweb-scraper\");\n      const scraper = new ReliefWebScraper();\n      const { daysBack = 7 } = req.body;\n\n      const conflicts = await scraper.scrape(daysBack);\n      \n      // Store scraped content in database\n      const storedCount = await storage.storeScrapedContent(conflicts);\n\n      res.json({\n        success: true,\n        countriesScraped: conflicts.size,\n        reportsStored: storedCount,\n        message: `Scraped ${conflicts.size} countries, stored ${storedCount} reports`,\n      });\n    } catch (error) {\n      console.error(\"Scrape error:\", error);\n      res.status(500).json({ error: \"Failed to scrape content\" });\n    }\n  });\n\n  app.post(\"/api/pipeline/process\", requireAdmin, async (req, res) => {\n    try {\n      const { limit = 10 } = req.body;\n      \n      // Process unprocessed scraped content with LLM\n      const processed = await storage.processScrapedContent(limit);\n\n      res.json({\n        success: true,\n        processedCount: processed,\n        message: `Processed ${processed} conflict profiles`,\n      });\n    } catch (error) {\n      console.error(\"Process error:\", error);\n      res.status(500).json({ error: \"Failed to process content\" });\n    }\n  });\n\n  app.post(\"/api/pipeline/run\", requireAdmin, async (req, res) => {\n    try {\n      const { daysBack = 7, processLimit = 10 } = req.body;\n      \n      // Check if OpenAI API key is configured\n      const openaiApiKey = process.env.OPENAI_API_KEY;\n      if (!openaiApiKey) {\n        return res.status(400).json({ \n          error: \"OpenAI API key not configured\",\n          message: \"Please add OPENAI_API_KEY to your environment variables to enable AI content generation\"\n        });\n      }\n      \n      // Step 1: Scrape\n      console.log(\"[Pipeline] Starting scrape...\");\n      const { ReliefWebScraper } = await import(\"./reliefweb-scraper\");\n      const scraper = new ReliefWebScraper();\n      const conflicts = await scraper.scrape(daysBack);\n      const storedCount = await storage.storeScrapedContent(conflicts);\n\n      console.log(`[Pipeline] Scraped ${conflicts.size} countries, stored ${storedCount} reports`);\n\n      // Step 2: Process with AI pipeline\n      console.log(\"[Pipeline] Starting AI processing...\");\n      const { ContentPipeline } = await import(\"./content-pipeline\");\n      const pipeline = new ContentPipeline(storage, {\n        openaiApiKey,\n        enableQualityControl: true,\n        minArticlesRequired: 2, // Require at least 2 articles per country\n      });\n\n      // Prepare country data for processing\n      const countriesToProcess: Array<{\n        country: string;\n        region: string;\n        articles: Array<{\n          title: string;\n          body: string;\n          source: string;\n          url?: string;\n          date?: string;\n        }>;\n      }> = [];\n\n      // Helper to determine region from country name\n      const determineRegion = (countryName: string): string => {\n        const lowerName = countryName.toLowerCase();\n        if (lowerName.includes('syria') || lowerName.includes('yemen') || lowerName.includes('iraq') || lowerName.includes('lebanon')) {\n          return 'Middle East';\n        }\n        if (lowerName.includes('somalia') || lowerName.includes('ethiopia') || lowerName.includes('kenya') || lowerName.includes('sudan')) {\n          return 'East Africa';\n        }\n        if (lowerName.includes('ukraine') || lowerName.includes('poland') || lowerName.includes('belarus')) {\n          return 'Eastern Europe';\n        }\n        if (lowerName.includes('afghanistan') || lowerName.includes('pakistan')) {\n          return 'South Asia';\n        }\n        if (lowerName.includes('nigeria') || lowerName.includes('cameroon') || lowerName.includes('mali')) {\n          return 'West Africa';\n        }\n        if (lowerName.includes('haiti') || lowerName.includes('venezuela')) {\n          return 'Caribbean & Latin America';\n        }\n        return 'Other';\n      };\n\n      for (const [country, reports] of Array.from(conflicts.entries())) {\n        if (countriesToProcess.length >= processLimit) break;\n\n        countriesToProcess.push({\n          country: reports.countryName,\n          region: determineRegion(reports.countryName),\n          articles: reports.reports.map((r: any) => ({\n            title: r.title,\n            body: r.body,\n            source: r.source || 'UN OCHA ReliefWeb',\n            url: r.url,\n            date: r.date,\n          })),\n        });\n      }\n\n      // Process batch\n      const results = await pipeline.processBatch(countriesToProcess);\n      \n      const successCount = results.filter(r => r.success).length;\n      const failedCount = results.filter(r => !r.success).length;\n\n      res.json({\n        success: true,\n        scraped: {\n          countriesScraped: conflicts.size,\n          reportsStored: storedCount,\n        },\n        processed: {\n          total: results.length,\n          successful: successCount,\n          failed: failedCount,\n          results: results.map(r => ({\n            country: r.country,\n            success: r.success,\n            conflictId: r.conflictId,\n            qualityScore: r.qualityScore,\n            errors: r.errors,\n            warnings: r.warnings,\n          })),\n        },\n        message: `Pipeline complete: scraped ${conflicts.size} countries, processed ${successCount}/${results.length} profiles successfully`,\n      });\n    } catch (error) {\n      console.error(\"Pipeline error:\", error);\n      res.status(500).json({ \n        error: \"Failed to run pipeline\",\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // ===== ACTIONS ROUTES =====\n  \n  // Get actions with filters\n  app.get(\"/api/actions\", async (req, res) => {\n    try {\n      const { type, status, conflictId, limit } = req.query;\n      \n      const actions = await storage.getActions({\n        type: type as string,\n        status: status as string,\n        conflictId: conflictId as string,\n        limit: limit ? parseInt(limit as string) : undefined,\n      });\n      \n      res.json(actions);\n    } catch (error) {\n      console.error(\"Get actions error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve actions\" });\n    }\n  });\n\n  // Get recommended actions for user\n  app.get(\"/api/actions/recommended\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 20;\n      \n      // Get user preferences and preference vector\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      \n      const preferenceVector = await storage.getUserPreferenceVector(userId);\n      \n      // Get all active actions\n      const allActions = await storage.getActions({ status: 'active' });\n      \n      // Score and rank actions using the action matcher\n      const { actionMatcher } = await import('./action-matcher');\n      const userPreferences = {\n        regions: user.preferences?.regions || [],\n        causes: user.preferences?.causes || [],\n        demographics: user.preferences?.affectedGroups || [],\n        location: user.preferences?.location,\n      };\n      \n      const scoredActions = actionMatcher.rankActions(\n        allActions,\n        userPreferences,\n        preferenceVector || undefined\n      );\n      \n      // Return top matches with scores and reasons\n      const recommended = scoredActions.slice(0, limit).map(item => ({\n        ...item.action,\n        matchScore: item.score,\n        matchReasons: item.reasons,\n      }));\n      \n      res.json(recommended);\n    } catch (error) {\n      console.error(\"Get recommended actions error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve recommended actions\" });\n    }\n  });\n\n  // Get actions by location\n  app.get(\"/api/actions/location\", async (req, res) => {\n    try {\n      const { latitude, longitude, radius, limit } = req.query;\n      \n      if (!latitude || !longitude) {\n        return res.status(400).json({ error: \"Latitude and longitude are required\" });\n      }\n      \n      const lat = parseFloat(latitude as string);\n      const lon = parseFloat(longitude as string);\n      const radiusMiles = radius ? parseFloat(radius as string) : 50;\n      const limitNum = limit ? parseInt(limit as string) : 20;\n      \n      const actions = await storage.getActionsByLocation(lat, lon, radiusMiles, limitNum);\n      \n      res.json(actions);\n    } catch (error) {\n      console.error(\"Get actions by location error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve actions by location\" });\n    }\n  });\n\n  // Get user's participated actions\n  app.get(\"/api/actions/user/participated\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n      \n      const actions = await storage.getUserParticipatedActions(userId, limit);\n      \n      res.json(actions);\n    } catch (error) {\n      console.error(\"Get participated actions error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve participated actions\" });\n    }\n  });\n\n  // Get single action\n  app.get(\"/api/actions/:id\", async (req, res) => {\n    try {\n      const action = await storage.getAction(req.params.id);\n      \n      if (!action) {\n        return res.status(404).json({ error: \"Action not found\" });\n      }\n      \n      res.json(action);\n    } catch (error) {\n      console.error(\"Get action error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve action\" });\n    }\n  });\n\n  // Create action (admin only)\n  app.post(\"/api/actions\", requireAdmin, async (req, res) => {\n    try {\n      const action = await storage.createAction(req.body);\n      res.json(action);\n    } catch (error) {\n      console.error(\"Create action error:\", error);\n      res.status(500).json({ error: \"Failed to create action\" });\n    }\n  });\n\n  // Update action\n  app.put(\"/api/actions/:id\", requireAdmin, async (req, res) => {\n    try {\n      const action = await storage.updateAction(req.params.id, req.body);\n      \n      if (!action) {\n        return res.status(404).json({ error: \"Action not found\" });\n      }\n      \n      res.json(action);\n    } catch (error) {\n      console.error(\"Update action error:\", error);\n      res.status(500).json({ error: \"Failed to update action\" });\n    }\n  });\n\n  // Participate in action\n  app.post(\"/api/actions/:actionId/participate\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const { actionId } = req.params;\n      const { participationType, personalMessage } = req.body;\n      \n      // Check if action exists\n      const action = await storage.getAction(actionId);\n      if (!action) {\n        return res.status(404).json({ error: \"Action not found\" });\n      }\n      \n      // Check if already participating\n      const existing = await storage.getUserActionParticipation(userId, actionId);\n      if (existing) {\n        return res.status(400).json({ \n          error: \"Already participating in this action\",\n          participation: existing \n        });\n      }\n      \n      // Create participation\n      const participation = await storage.createUserActionParticipation({\n        userId,\n        actionId,\n        participationType: participationType || 'interested',\n        personalMessage: personalMessage || null,\n        status: 'pending',\n      });\n      \n      res.json(participation);\n    } catch (error) {\n      console.error(\"Participate in action error:\", error);\n      res.status(500).json({ error: \"Failed to participate in action\" });\n    }\n  });\n\n  // Update participation status\n  app.put(\"/api/actions/participation/:id\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const { id } = req.params;\n      \n      // Verify user owns this participation\n      const existing = await storage.getUserActionParticipation(userId, id);\n      if (!existing || existing.userId !== userId) {\n        return res.status(403).json({ error: \"Forbidden\" });\n      }\n      \n      const participation = await storage.updateUserActionParticipation(id, req.body);\n      \n      if (!participation) {\n        return res.status(404).json({ error: \"Participation not found\" });\n      }\n      \n      res.json(participation);\n    } catch (error) {\n      console.error(\"Update participation error:\", error);\n      res.status(500).json({ error: \"Failed to update participation\" });\n    }\n  });\n\n  // ===== ACTION REMINDERS ROUTES =====\n  \n  // Get user's reminders\n  app.get(\"/api/actions/reminders\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const reminders = await storage.getUserActionReminders(userId);\n      \n      res.json(reminders);\n    } catch (error) {\n      console.error(\"Get reminders error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve reminders\" });\n    }\n  });\n\n  // Create reminder\n  app.post(\"/api/actions/reminders\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const { actionId, reminderTime, reminderType } = req.body;\n      \n      if (!actionId || !reminderTime) {\n        return res.status(400).json({ error: \"Action ID and reminder time are required\" });\n      }\n      \n      const reminder = await storage.createActionReminder({\n        userId,\n        actionId,\n        reminderTime: new Date(reminderTime),\n        reminderType: reminderType || 'push',\n        sent: false,\n      });\n      \n      res.json(reminder);\n    } catch (error) {\n      console.error(\"Create reminder error:\", error);\n      res.status(500).json({ error: \"Failed to create reminder\" });\n    }\n  });\n\n  // Delete reminder\n  app.delete(\"/api/actions/reminders/:id\", requireAuth, async (req, res) => {\n    try {\n      await storage.deleteActionReminder(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Delete reminder error:\", error);\n      res.status(500).json({ error: \"Failed to delete reminder\" });\n    }\n  });\n\n  // ===== ACTION REPORTS ROUTES =====\n  \n  // Report an action\n  app.post(\"/api/actions/reports\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const { actionId, reason, description } = req.body;\n      \n      if (!actionId || !reason) {\n        return res.status(400).json({ error: \"Action ID and reason are required\" });\n      }\n      \n      const report = await storage.createActionReport({\n        actionId,\n        reportedBy: userId,\n        reason,\n        description: description || null,\n        status: 'pending',\n      });\n      \n      res.json(report);\n    } catch (error) {\n      console.error(\"Create report error:\", error);\n      res.status(500).json({ error: \"Failed to report action\" });\n    }\n  });\n\n  // Get reports (admin only)\n  app.get(\"/api/actions/reports\", requireAdmin, async (req, res) => {\n    try {\n      const actionId = req.query.actionId as string | undefined;\n      const reports = await storage.getActionReports(actionId);\n      \n      res.json(reports);\n    } catch (error) {\n      console.error(\"Get reports error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve reports\" });\n    }\n  });\n\n  // ===== GAMIFICATION ROUTES =====\n\n  // Get monthly impact report\n  app.get(\"/api/reports/:month?\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const month = req.params.month as string | undefined;\n      \n      const report = await reportGenerator.generateMonthlyReport(userId, month || format(new Date(), 'yyyy-MM'));\n      \n      // Flatten the report structure for frontend consumption\n      if (report && typeof report.reportData === 'object') {\n        const data = report.reportData as any;\n        res.json({\n          userId: report.userId,\n          month: report.month,\n          totalDonated: data.monthlyTotal || 0,\n          donationCount: data.donationCount || 0,\n          currentStreak: data.streak?.current || 0,\n          momChange: data.momChange || 0,\n          topCountries: (data.donationsByCountry || []).map((item: any) => ({\n            country: item.country,\n            total: item.amount\n          })),\n          topCauses: (data.donationsByCause || []).map((item: any) => ({\n            cause: item.cause,\n            total: item.amount\n          })),\n          newMilestones: (data.newBadges || []).map((badge: any) => badge.name),\n        });\n      } else {\n        res.json(null);\n      }\n    } catch (error) {\n      console.error(\"Get report error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve report\" });\n    }\n  });\n\n  // Get user badges\n  app.get(\"/api/badges\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const badges = await storage.getUserBadges(userId);\n      res.json(badges);\n    } catch (error) {\n      console.error(\"Get badges error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve badges\" });\n    }\n  });\n\n  // Check and award new badges\n  app.post(\"/api/badges/check\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const newBadges = await badgeService.checkAndAwardBadges(userId);\n      res.json({ newBadges });\n    } catch (error) {\n      console.error(\"Check badges error:\", error);\n      res.status(500).json({ error: \"Failed to check badges\" });\n    }\n  });\n\n  // Get all badge definitions\n  app.get(\"/api/badges/definitions\", async (req, res) => {\n    try {\n      const definitions = badgeService.getAllBadgeDefinitions();\n      res.json(definitions);\n    } catch (error) {\n      console.error(\"Get badge definitions error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve badge definitions\" });\n    }\n  });\n\n  // Get user points\n  app.get(\"/api/points\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const points = await storage.getUserPoints(userId);\n      res.json(points);\n    } catch (error) {\n      console.error(\"Get points error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve points\" });\n    }\n  });\n\n  // Get points history\n  app.get(\"/api/points/history\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const limit = parseInt(req.query.limit as string) || 50;\n      const history = await storage.getPointsHistory(userId, limit);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Get points history error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve points history\" });\n    }\n  });\n\n  // Get active challenges\n  app.get(\"/api/challenges\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const challenges = await storage.getActiveChallenges(userId);\n      res.json(challenges);\n    } catch (error) {\n      console.error(\"Get challenges error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve challenges\" });\n    }\n  });\n\n  // Update challenge progress\n  app.post(\"/api/challenges/:id/progress\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const challengeId = req.params.id;\n      const { increment } = req.body;\n      \n      if (!increment || increment <= 0) {\n        return res.status(400).json({ error: \"Valid increment is required\" });\n      }\n      \n      const result = await storage.updateChallengeProgress(userId, challengeId, increment);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Update challenge progress error:\", error);\n      res.status(500).json({ error: \"Failed to update challenge progress\" });\n    }\n  });\n\n  // Get user impact stats\n  app.get(\"/api/impact/stats\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n      const stats = await storage.getUserImpactStats(userId);\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Get impact stats error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve impact stats\" });\n    }\n  });\n\n  // ===== VERIFICATION & TRUST SCORE ROUTES =====\n\n  // Get organization trust score\n  app.get(\"/api/organizations/:id/trust-score\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const trustService = new TrustScoreService();\n      const score = await trustService.calculateTrustScore(id);\n      \n      res.json(score);\n    } catch (error) {\n      console.error(\"Get trust score error:\", error);\n      res.status(500).json({ error: \"Failed to calculate trust score\" });\n    }\n  });\n\n  // Report an organization\n  app.post(\"/api/organizations/:id/report\", requireAuth, async (req, res) => {\n    try {\n      const { id: organizationId } = req.params;\n      const userId = req.session.userId!;\n      \n      const reportData = insertOrganizationReportSchema.parse({\n        organizationId,\n        userId,\n        ...req.body,\n      });\n      \n      await storage.createOrganizationReport(reportData);\n      \n      res.json({\n        success: true,\n        message: \"Report submitted successfully\",\n      });\n    } catch (error) {\n      console.error(\"Submit report error:\", error);\n      res.status(500).json({ error: \"Failed to submit report\" });\n    }\n  });\n\n  // Admin: Get pending verifications\n  app.get(\"/api/admin/verifications/pending\", requireAdmin, async (req, res) => {\n    try {\n      const pending = await storage.getPendingVerifications();\n      res.json({ organizations: pending });\n    } catch (error) {\n      console.error(\"Get pending verifications error:\", error);\n      res.status(500).json({ error: \"Failed to fetch pending verifications\" });\n    }\n  });\n\n  // Admin: Approve organization\n  app.post(\"/api/admin/organizations/:id/approve\", requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { notes, verification_level } = req.body;\n      const adminId = req.session.userId!;\n      \n      await storage.approveOrganization(id, {\n        verificationLevel: verification_level || 2,\n        verifiedBy: adminId,\n        notes,\n      });\n      \n      res.json({\n        success: true,\n        message: \"Organization approved\",\n      });\n    } catch (error) {\n      console.error(\"Approve organization error:\", error);\n      res.status(500).json({ error: \"Failed to approve organization\" });\n    }\n  });\n\n  // Admin: Reject organization\n  app.post(\"/api/admin/organizations/:id/reject\", requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { reason, notes } = req.body;\n      const adminId = req.session.userId!;\n      \n      await storage.rejectOrganization(id, {\n        reason,\n        rejectedBy: adminId,\n        notes,\n      });\n      \n      res.json({\n        success: true,\n        message: \"Organization rejected\",\n      });\n    } catch (error) {\n      console.error(\"Reject organization error:\", error);\n      res.status(500).json({ error: \"Failed to reject organization\" });\n    }\n  });\n\n  // Admin: Request more information\n  app.post(\"/api/admin/organizations/:id/request-info\", requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { requested_items, notes } = req.body;\n      const adminId = req.session.userId!;\n      \n      await storage.requestOrganizationInfo(id, {\n        requestedItems: requested_items,\n        requestedBy: adminId,\n        notes,\n      });\n      \n      res.json({\n        success: true,\n        message: \"Information request sent\",\n      });\n    } catch (error) {\n      console.error(\"Request info error:\", error);\n      res.status(500).json({ error: \"Failed to request information\" });\n    }\n  });\n\n  // ============================================\n  // SUPPORT FEATURE - AI-POWERED NONPROFIT RESEARCH\n  // ============================================\n  \n  app.get(\"/api/nonprofits/:country\", async (req, res) => {\n    try {\n      const { country } = req.params;\n      console.log(`🔍 Nonprofit research request for: ${country}`);\n\n      // Import the AI researcher\n      const { NonprofitResearcher } = await import('./nonprofit-researcher');\n      const researcher = new NonprofitResearcher();\n\n      // Check cache first\n      const cached = await storage.getCharitywatchCache(country);\n      if (cached && cached.expiresAt > new Date()) {\n        console.log(`✅ Using cached data for ${country}`);\n        return res.json({\n          country,\n          nonprofits: cached.nonprofits,\n          cached: true,\n          cachedAt: cached.cachedAt,\n        });\n      }\n\n      // Research nonprofits using AI\n      console.log(`🤖 Researching new nonprofit data for ${country}`);\n      const nonprofits = await researcher.researchNonprofits(country);\n\n      if (nonprofits.length === 0) {\n        return res.status(404).json({\n          error: `No nonprofits found for ${country}`,\n          message: 'Please try another country or check back later.'\n        });\n      }\n\n      // Cache for 6 hours\n      const expiresAt = new Date();\n      expiresAt.setHours(expiresAt.getHours() + 6);\n\n      await storage.cacheCharitywatchData(country, nonprofits, expiresAt);\n      console.log(`✅ Cached ${nonprofits.length} nonprofits for ${country}`);\n\n      res.json({\n        country,\n        nonprofits,\n        cached: false,\n        cachedAt: new Date(),\n      });\n    } catch (error) {\n      console.error('Nonprofit research error:', error);\n      res.status(500).json({\n        error: 'Failed to research nonprofits',\n        message: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // Track external donations\n  app.post(\"/api/donations/external\", requireAuth, async (req, res) => {\n    try {\n      const { conflictId, conflictCountry, nonprofitName, nonprofitEin, donateUrl } = req.body;\n      \n      const donation = await storage.trackExternalDonation({\n        userId: req.session.userId!,\n        conflictId,\n        conflictCountry,\n        nonprofitName,\n        nonprofitEin,\n        donateUrl,\n      });\n\n      console.log(`📊 Tracked external donation: ${nonprofitName} for ${conflictCountry}`);\n      \n      res.json(donation);\n    } catch (error) {\n      console.error('Track donation error:', error);\n      res.status(500).json({ error: 'Failed to track donation' });\n    }\n  });\n\n  // ===========================================\n  // CHARITYWATCH DIAGNOSTIC API - TEST SCRAPER\n  // ===========================================\n  \n  app.get(\"/api/test/charitywatch/:country\", async (req, res) => {\n    try {\n      const { country } = req.params;\n      console.log(`\\n${'='.repeat(60)}`);\n      console.log(`🔍 DIAGNOSTIC: Testing CharityWatch scraper for ${country}`);\n      console.log('='.repeat(60));\n      \n      // Import scraper\n      const { CharityWatchScraper } = await import('./charitywatch-scraper');\n      const scraper = new CharityWatchScraper();\n      \n      // Run scraping with full diagnostics\n      const result = await scraper.scrapeNonprofitsForCountry(country);\n      \n      console.log(`\\n${'='.repeat(60)}`);\n      console.log(`✅ DIAGNOSTIC COMPLETE`);\n      console.log(`   Found: ${result.nonprofits.length}/3 nonprofits`);\n      console.log(`   Logs: ${result.logs.length} entries`);\n      console.log(`   Errors: ${result.errors.length} entries`);\n      console.log('='.repeat(60) + '\\n');\n      \n      // Return comprehensive diagnostic data\n      res.json({\n        country,\n        success: result.nonprofits.length > 0,\n        nonprofits: result.nonprofits.map(n => ({\n          name: n.name,\n          charityWatchUrl: n.charityWatchUrl,\n          rating: n.charityWatchRating,\n          programPercent: n.programPercent,\n          website: n.website,\n          ein: n.ein,\n          founded: n.founded,\n        })),\n        diagnostics: {\n          totalLogs: result.logs.length,\n          totalErrors: result.errors.length,\n          logs: result.logs,\n          errors: result.errors,\n        },\n        summary: {\n          nonprofitsFound: result.nonprofits.length,\n          targetCount: 3,\n          status: result.nonprofits.length >= 3 ? 'SUCCESS' : result.nonprofits.length > 0 ? 'PARTIAL' : 'FAILED',\n        }\n      });\n    } catch (error) {\n      console.error('❌ DIAGNOSTIC ERROR:', error);\n      res.status(500).json({\n        error: 'Diagnostic test failed',\n        message: error instanceof Error ? error.message : String(error),\n        stack: error instanceof Error ? error.stack : undefined,\n      });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","size_bytes":44272},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport session from \"express-session\";\nimport { seedDatabase } from \"./seed\";\nimport { seedGlobalDonations } from \"./seed-global-donations\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\n\n// Session configuration\napp.use(session({\n  secret: process.env.SESSION_SECRET || \"aidatlas-dev-secret-change-in-production\",\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    httpOnly: true,\n    secure: false, // Set to false for development on HTTP\n    sameSite: 'lax', // Lax works for same-site (Replit serves on same domain)\n    maxAge: 1000 * 60 * 60 * 24 * 7, // 7 days\n  }\n}));\n\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\n// Prevent caching in development mode\nif (app.get(\"env\") === \"development\") {\n  app.use((req, res, next) => {\n    res.set('Cache-Control', 'no-store, no-cache, must-revalidate, private');\n    res.set('Pragma', 'no-cache');\n    res.set('Expires', '0');\n    next();\n  });\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  // Seed database on startup (in development)\n  if (app.get(\"env\") === \"development\") {\n    try {\n      await seedDatabase();\n      await seedGlobalDonations();\n    } catch (error) {\n      log(\"Database already seeded or error seeding:\" + (error instanceof Error ? error.message : String(error)));\n    }\n  }\n\n  const server = await registerRoutes(app);\n\n  // TEMPORARILY DISABLED: Automated daily scraping for competition demo\n  // Re-enable after obtaining ReliefWeb API approval\n  // const { AutomatedScraper } = await import(\"./automated-scraper-cron\");\n  // const { storage } = await import(\"./storage\");\n  // const autoScraper = new AutomatedScraper(storage);\n  // autoScraper.startDailyScraping();\n  // log(\"✓ Automated daily scraping enabled (runs at midnight UTC)\");\n  log(\"⏸ Automated scraping disabled for competition demo (31 conflicts seeded)\");\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":3844},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/HowItWorks.tsx":{"content":"import { Compass, Heart, BarChart3 } from \"lucide-react\";\nimport { Card } from \"@/components/ui/card\";\n\nexport default function HowItWorks() {\n  const steps = [\n    {\n      icon: Compass,\n      title: \"Discover\",\n      description: \"Swipe through curated conflict profiles and humanitarian causes that match your interests and values.\",\n      color: \"text-chart-1\",\n    },\n    {\n      icon: Heart,\n      title: \"Choose\",\n      description: \"Select verified organizations working on the ground and decide how to allocate your donation.\",\n      color: \"text-chart-2\",\n    },\n    {\n      icon: BarChart3,\n      title: \"Impact\",\n      description: \"Track your contribution's real-world impact with transparent updates and detailed reports.\",\n      color: \"text-chart-3\",\n    },\n  ];\n\n  return (\n    <section className=\"py-24 px-6 bg-gradient-to-b from-muted/30 via-background to-background relative overflow-hidden\">\n      <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(59,130,246,0.05),transparent_50%)]\" />\n      <div className=\"max-w-6xl mx-auto relative\">\n        <div className=\"text-center mb-16\">\n          <div className=\"inline-block mb-4 px-4 py-2 rounded-full bg-primary/10 border border-primary/20\">\n            <p className=\"text-sm font-medium text-primary\">Simple & Transparent</p>\n          </div>\n          <h2 className=\"text-5xl font-display font-bold mb-4 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent\">\n            How It Works\n          </h2>\n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n            Making humanitarian giving simple, transparent, and engaging\n          </p>\n        </div>\n\n        <div className=\"grid md:grid-cols-3 gap-8 relative\">\n          <div className=\"hidden md:block absolute top-1/2 left-1/3 right-1/3 h-0.5 bg-gradient-to-r from-primary/20 via-primary to-primary/20 -translate-y-1/2\" />\n          \n          {steps.map((step, index) => {\n            const Icon = step.icon;\n            return (\n              <Card \n                key={step.title} \n                className=\"p-8 text-center relative hover:shadow-xl transition-all duration-300 group hover:scale-105 border-2 hover:border-primary/30\" \n                data-testid={`card-step-${index + 1}`}\n              >\n                <div className=\"absolute -top-4 left-1/2 -translate-x-1/2 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold shadow-lg\">\n                  {index + 1}\n                </div>\n                <div className={`inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-background to-muted mb-6 ${step.color} shadow-lg group-hover:shadow-xl transition-shadow`}>\n                  <Icon className=\"h-10 w-10\" />\n                </div>\n                <h3 className=\"text-2xl font-semibold mb-3 font-display group-hover:text-primary transition-colors\">\n                  {step.title}\n                </h3>\n                <p className=\"text-muted-foreground leading-relaxed\">{step.description}</p>\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n    </section>\n  );\n}\n","size_bytes":3205},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/pages/Impact.tsx":{"content":"import Navigation from \"@/components/Navigation\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Trophy, Star, Flame, Target, TrendingUp, Award, Zap, Calendar, Coins } from \"lucide-react\";\nimport * as LucideIcons from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { Donation } from \"@shared/schema\";\nimport { AreaChart, Area, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from 'recharts';\nimport { format, parseISO } from 'date-fns';\nimport DonationGlobe, { type DonationArc } from \"@/components/DonationGlobe\";\nimport { ErrorBoundary } from \"@/components/ErrorBoundary\";\n\ninterface ImpactStats {\n  totalDonated: number;\n  peopleHelped: number;\n  organizationsSupported: number;\n  conflictsSupported: number;\n}\n\ninterface UserBadge {\n  id: string;\n  userId: string;\n  badgeType: string;\n  badgeName: string;\n  badgeIcon: string;\n  badgeDescription: string;\n  earnedAt: string;\n}\n\ninterface UserPoints {\n  id: string;\n  userId: string;\n  totalPoints: number;\n  level: number;\n}\n\ninterface Challenge {\n  id: string;\n  title: string;\n  description: string;\n  targetValue: number;\n  rewardPoints: number;\n  startDate: string;\n  endDate: string;\n  userProgress?: number;\n  completed?: boolean;\n}\n\ninterface MonthlyReport {\n  userId: string;\n  month: string;\n  totalDonated: number;\n  donationCount: number;\n  currentStreak: number;\n  momChange: number;\n  topCountries: Array<{ country: string; total: number }>;\n  topCauses: Array<{ cause: string; total: number }>;\n  newMilestones: string[];\n}\n\nconst CHART_COLORS = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6'];\n\nexport default function Impact() {\n  const { user, loading: authLoading } = useAuth();\n\n  const { data: stats, isLoading: statsLoading } = useQuery<ImpactStats>({\n    queryKey: ['/api/impact/stats'],\n    enabled: !!user,\n  });\n\n  const { data: badges = [], isLoading: badgesLoading } = useQuery<UserBadge[]>({\n    queryKey: ['/api/badges'],\n    enabled: !!user,\n  });\n\n  const { data: points, isLoading: pointsLoading } = useQuery<UserPoints>({\n    queryKey: ['/api/points'],\n    enabled: !!user,\n  });\n\n  const { data: challenges = [], isLoading: challengesLoading } = useQuery<Challenge[]>({\n    queryKey: ['/api/challenges'],\n    enabled: !!user,\n  });\n\n  const { data: report, isLoading: reportLoading } = useQuery<MonthlyReport>({\n    queryKey: ['/api/reports'],\n    enabled: !!user,\n  });\n\n  const { data: donations = [], isLoading: donationsLoading } = useQuery<Donation[]>({\n    queryKey: ['/api/donations'],\n    enabled: !!user,\n  });\n\n  const { data: donationGeography = [], isLoading: geographyLoading } = useQuery<DonationArc[]>({\n    queryKey: ['/api/donations/geography'],\n    enabled: !!user,\n  });\n\n  const isLoading = authLoading || statsLoading || badgesLoading || pointsLoading || challengesLoading || reportLoading || donationsLoading || geographyLoading;\n\n  const getIconComponent = (iconName: string) => {\n    const Icon = (LucideIcons as any)[iconName];\n    return Icon || Trophy;\n  };\n\n  const donationsByMonth = donations.reduce((acc, d) => {\n    if (!d.createdAt) return acc;\n    const month = format(parseISO(d.createdAt), 'MMM yyyy');\n    if (!acc[month]) acc[month] = 0;\n    acc[month] += parseFloat(d.amount);\n    return acc;\n  }, {} as Record<string, number>);\n\n  const chartData = Object.entries(donationsByMonth).map(([month, amount]) => ({\n    month,\n    amount\n  })).slice(-6);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navigation />\n        <div className=\"pt-24 pb-12 px-6 flex items-center justify-center\">\n          <p className=\"text-muted-foreground\">Loading your impact...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navigation />\n        <div className=\"pt-24 pb-12 px-6 text-center\">\n          <p className=\"text-muted-foreground\">Please log in to view your impact.</p>\n        </div>\n      </div>\n    );\n  }\n\n  const impactStats = stats || {\n    totalDonated: 0,\n    peopleHelped: 0,\n    organizationsSupported: 0,\n    conflictsSupported: 0,\n  };\n\n  const userPoints = points || { totalPoints: 0, level: 1 };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Navigation />\n      \n      <div className=\"pt-24 pb-12 px-6\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-4xl font-display font-bold mb-2\" data-testid=\"text-page-title\">Your Impact Dashboard</h1>\n            <p className=\"text-muted-foreground\">\n              Track your contributions, earn badges, and see the difference you're making\n            </p>\n          </div>\n\n          <Tabs defaultValue=\"overview\" className=\"space-y-6\" data-testid=\"tabs-impact\">\n            <TabsList className=\"grid w-full grid-cols-4\">\n              <TabsTrigger value=\"overview\" data-testid=\"tab-overview\">Overview</TabsTrigger>\n              <TabsTrigger value=\"badges\" data-testid=\"tab-badges\">Badges</TabsTrigger>\n              <TabsTrigger value=\"challenges\" data-testid=\"tab-challenges\">Challenges</TabsTrigger>\n              <TabsTrigger value=\"report\" data-testid=\"tab-report\">Monthly Report</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"overview\" className=\"space-y-6\">\n              <Card data-testid=\"card-global-impact\">\n                <CardHeader>\n                  <CardTitle>Good Actions Around the World</CardTitle>\n                  <CardDescription>\n                    Visualizing your global humanitarian impact across borders\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"flex items-center justify-center\">\n                  <ErrorBoundary\n                    fallback={\n                      <div \n                        className=\"flex items-center justify-center bg-card rounded-lg border\"\n                        style={{ \n                          width: Math.min(800, typeof window !== 'undefined' ? window.innerWidth - 100 : 800), \n                          height: 600 \n                        }}\n                        data-testid=\"globe-error\"\n                      >\n                        <div className=\"text-center text-muted-foreground p-6\">\n                          <p className=\"font-medium\">3D Globe Visualization Unavailable</p>\n                          <p className=\"text-sm mt-2\">\n                            Your browser or environment doesn't support WebGL visualization.\n                          </p>\n                          <p className=\"text-sm mt-1\">\n                            Your donations are making a global impact across {donationGeography.length} locations!\n                          </p>\n                        </div>\n                      </div>\n                    }\n                  >\n                    <DonationGlobe \n                      donations={donationGeography} \n                      width={Math.min(800, typeof window !== 'undefined' ? window.innerWidth - 100 : 800)}\n                      height={600}\n                    />\n                  </ErrorBoundary>\n                </CardContent>\n              </Card>\n\n              <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n                <Card data-testid=\"card-total-donated\">\n                  <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                    <CardTitle className=\"text-sm font-medium\">Total Donated</CardTitle>\n                    <Coins className=\"h-4 w-4 text-muted-foreground\" />\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\" data-testid=\"text-total-donated\">${impactStats.totalDonated.toFixed(2)}</div>\n                    <p className=\"text-xs text-muted-foreground\">Your total contributions</p>\n                  </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-people-helped\">\n                  <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                    <CardTitle className=\"text-sm font-medium\">People Helped</CardTitle>\n                    <Target className=\"h-4 w-4 text-muted-foreground\" />\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\" data-testid=\"text-people-helped\">{impactStats.peopleHelped.toLocaleString()}</div>\n                    <p className=\"text-xs text-muted-foreground\">Lives impacted</p>\n                  </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-points\">\n                  <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                    <CardTitle className=\"text-sm font-medium\">Impact Points</CardTitle>\n                    <Zap className=\"h-4 w-4 text-muted-foreground\" />\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\" data-testid=\"text-points\">{userPoints.totalPoints}</div>\n                    <p className=\"text-xs text-muted-foreground\">Level {userPoints.level}</p>\n                  </CardContent>\n                </Card>\n\n                <Card data-testid=\"card-streak\">\n                  <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                    <CardTitle className=\"text-sm font-medium\">Current Streak</CardTitle>\n                    <Flame className=\"h-4 w-4 text-muted-foreground\" />\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"text-2xl font-bold\" data-testid=\"text-streak\">{report?.currentStreak || 0}</div>\n                    <p className=\"text-xs text-muted-foreground\">Months active</p>\n                  </CardContent>\n                </Card>\n              </div>\n\n              <Card data-testid=\"card-donation-chart\">\n                <CardHeader>\n                  <CardTitle>Donation Trend</CardTitle>\n                  <CardDescription>Your donations over the last 6 months</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {chartData.length > 0 ? (\n                    <ResponsiveContainer width=\"100%\" height={300}>\n                      <AreaChart data={chartData}>\n                        <CartesianGrid strokeDasharray=\"3 3\" />\n                        <XAxis dataKey=\"month\" />\n                        <YAxis />\n                        <Tooltip />\n                        <Area type=\"monotone\" dataKey=\"amount\" stroke=\"#10b981\" fill=\"#10b981\" fillOpacity={0.3} />\n                      </AreaChart>\n                    </ResponsiveContainer>\n                  ) : (\n                    <div className=\"h-[300px] flex items-center justify-center text-muted-foreground\">\n                      No donation data yet\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {report && report.topCauses && report.topCauses.length > 0 && (\n                <div className=\"grid gap-4 md:grid-cols-2\">\n                  <Card data-testid=\"card-top-countries\">\n                    <CardHeader>\n                      <CardTitle>Top Countries</CardTitle>\n                      <CardDescription>Where you've made the most impact</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-4\">\n                        {report.topCountries.slice(0, 5).map((item, index) => (\n                          <div key={item.country} data-testid={`country-${index}`}>\n                            <div className=\"flex items-center justify-between text-sm mb-1\">\n                              <span>{item.country}</span>\n                              <span className=\"text-muted-foreground\">${item.total.toFixed(2)}</span>\n                            </div>\n                            <Progress value={(item.total / report.totalDonated) * 100} />\n                          </div>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  <Card data-testid=\"card-top-causes\">\n                    <CardHeader>\n                      <CardTitle>Top Causes</CardTitle>\n                      <CardDescription>Your focus areas</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-4\">\n                        {report.topCauses.slice(0, 5).map((item, index) => (\n                          <div key={item.cause} data-testid={`cause-${index}`}>\n                            <div className=\"flex items-center justify-between text-sm mb-1\">\n                              <span>{item.cause}</span>\n                              <span className=\"text-muted-foreground\">${item.total.toFixed(2)}</span>\n                            </div>\n                            <Progress value={(item.total / report.totalDonated) * 100} />\n                          </div>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n              )}\n            </TabsContent>\n\n            <TabsContent value=\"badges\" className=\"space-y-6\">\n              <Card data-testid=\"card-badges\">\n                <CardHeader>\n                  <CardTitle>Your Badges</CardTitle>\n                  <CardDescription>\n                    {badges.length > 0 ? `You've earned ${badges.length} badge${badges.length !== 1 ? 's' : ''}!` : 'Start donating to earn badges'}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {badges.length > 0 ? (\n                    <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                      {badges.map((badge, index) => {\n                        const IconComponent = getIconComponent(badge.badgeIcon);\n                        return (\n                          <Card key={badge.id} className=\"p-4\" data-testid={`badge-${index}`}>\n                            <div className=\"flex items-start gap-4\">\n                              <div className=\"p-3 bg-primary/10 rounded-full\">\n                                <IconComponent className=\"h-6 w-6 text-primary\" />\n                              </div>\n                              <div className=\"flex-1\">\n                                <h4 className=\"font-semibold mb-1\">{badge.badgeName}</h4>\n                                <p className=\"text-sm text-muted-foreground\">{badge.badgeDescription}</p>\n                                <p className=\"text-xs text-muted-foreground mt-2\">\n                                  Earned {format(parseISO(badge.earnedAt), 'MMM d, yyyy')}\n                                </p>\n                              </div>\n                            </div>\n                          </Card>\n                        );\n                      })}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-12\">\n                      <Trophy className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                      <p className=\"text-muted-foreground\">No badges earned yet. Keep making donations to unlock achievements!</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"challenges\" className=\"space-y-6\">\n              <Card data-testid=\"card-challenges\">\n                <CardHeader>\n                  <CardTitle>Active Challenges</CardTitle>\n                  <CardDescription>Complete challenges to earn bonus points</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {challenges.length > 0 ? (\n                    <div className=\"space-y-4\">\n                      {challenges.map((challenge, index) => {\n                        const progress = ((challenge.userProgress || 0) / challenge.targetValue) * 100;\n                        return (\n                          <Card key={challenge.id} className=\"p-4\" data-testid={`challenge-${index}`}>\n                            <div className=\"flex items-start justify-between mb-2\">\n                              <div>\n                                <h4 className=\"font-semibold\">{challenge.title}</h4>\n                                <p className=\"text-sm text-muted-foreground\">{challenge.description}</p>\n                              </div>\n                              <Badge variant={challenge.completed ? \"default\" : \"secondary\"}>\n                                {challenge.rewardPoints} pts\n                              </Badge>\n                            </div>\n                            <div className=\"space-y-2\">\n                              <Progress value={progress} />\n                              <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                                <span>{challenge.userProgress || 0} / {challenge.targetValue}</span>\n                                <span>{progress.toFixed(0)}% complete</span>\n                              </div>\n                            </div>\n                          </Card>\n                        );\n                      })}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-12\">\n                      <Target className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                      <p className=\"text-muted-foreground\">No active challenges at the moment. Check back soon!</p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"report\" className=\"space-y-6\">\n              {report ? (\n                <>\n                  <Card data-testid=\"card-monthly-summary\">\n                    <CardHeader>\n                      <CardTitle>Monthly Summary - {format(parseISO(report.month), 'MMMM yyyy')}</CardTitle>\n                      <CardDescription>Your impact this month</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"grid gap-4 md:grid-cols-3\">\n                        <div>\n                          <div className=\"text-2xl font-bold\">${report.totalDonated.toFixed(2)}</div>\n                          <p className=\"text-sm text-muted-foreground\">Total Donated</p>\n                          {report.momChange !== 0 && (\n                            <p className={`text-xs mt-1 ${report.momChange > 0 ? 'text-green-600' : 'text-red-600'}`}>\n                              {report.momChange > 0 ? '+' : ''}{report.momChange.toFixed(1)}% vs last month\n                            </p>\n                          )}\n                        </div>\n                        <div>\n                          <div className=\"text-2xl font-bold\">{report.donationCount}</div>\n                          <p className=\"text-sm text-muted-foreground\">Donations Made</p>\n                        </div>\n                        <div>\n                          <div className=\"text-2xl font-bold\">{report.currentStreak}</div>\n                          <p className=\"text-sm text-muted-foreground\">Month Streak</p>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  {report.newMilestones && report.newMilestones.length > 0 && (\n                    <Card data-testid=\"card-milestones\">\n                      <CardHeader>\n                        <CardTitle>New Milestones</CardTitle>\n                        <CardDescription>Achievements unlocked this month</CardDescription>\n                      </CardHeader>\n                      <CardContent>\n                        <div className=\"space-y-2\">\n                          {report.newMilestones.map((milestone, index) => (\n                            <div key={index} className=\"flex items-center gap-2\" data-testid={`milestone-${index}`}>\n                              <Award className=\"h-4 w-4 text-primary\" />\n                              <span className=\"text-sm\">{milestone}</span>\n                            </div>\n                          ))}\n                        </div>\n                      </CardContent>\n                    </Card>\n                  )}\n                </>\n              ) : (\n                <Card>\n                  <CardContent className=\"pt-6\">\n                    <div className=\"text-center py-12\">\n                      <Calendar className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                      <p className=\"text-muted-foreground\">No monthly report available yet. Start donating to generate your first report!</p>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n            </TabsContent>\n          </Tabs>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":21424},"client/src/components/OrganizationCard.tsx":{"content":"import { ExternalLink, CheckCircle, Star } from \"lucide-react\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport TrustBadge from \"./TrustBadge\";\n\ninterface OrganizationCardProps {\n  id: string;\n  name: string;\n  description: string;\n  rating: number;\n  verified: boolean;\n  website?: string;\n  onDonate: () => void;\n}\n\nexport default function OrganizationCard({\n  id,\n  name,\n  description,\n  rating,\n  verified,\n  website,\n  onDonate,\n}: OrganizationCardProps) {\n  return (\n    <Card className=\"p-5 hover:shadow-xl transition-all duration-300 group hover:scale-[1.02] border-2 hover:border-primary/20\" data-testid={`card-org-${name.toLowerCase().replace(/\\s+/g, '-')}`}>\n      <div className=\"flex items-start justify-between gap-4 mb-3\">\n        <div className=\"flex-1 space-y-2\">\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <h4 className=\"font-semibold text-base group-hover:text-primary transition-colors\">{name}</h4>\n            {verified && (\n              <Badge variant=\"default\" className=\"text-xs px-2 py-0.5 bg-chart-3 hover:bg-chart-3\" data-testid=\"badge-verified\">\n                <CheckCircle className=\"h-3 w-3 mr-1\" />\n                Verified\n              </Badge>\n            )}\n          </div>\n          <div className=\"flex items-center gap-1 mb-1\">\n            {[...Array(5)].map((_, i) => (\n              <Star\n                key={i}\n                className={`h-3.5 w-3.5 transition-all ${\n                  i < rating ? \"fill-chart-2 text-chart-2\" : \"text-muted\"\n                }`}\n              />\n            ))}\n            <span className=\"text-xs text-muted-foreground ml-1 font-medium\">{rating.toFixed(1)}</span>\n          </div>\n          <TrustBadge organizationId={id} variant=\"compact\" />\n        </div>\n      </div>\n      \n      <p className=\"text-sm text-muted-foreground line-clamp-2 mb-4 leading-relaxed\">\n        {description}\n      </p>\n\n      <div className=\"flex items-center gap-2\">\n        <Button\n          onClick={onDonate}\n          className=\"flex-1 bg-gradient-to-r from-primary to-chart-1 shadow-md\"\n          data-testid={`button-donate-${name.toLowerCase().replace(/\\s+/g, '-')}`}\n        >\n          Donate\n        </Button>\n        {website && (\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            onClick={() => window.open(website, '_blank')}\n            data-testid=\"button-website\"\n            className=\"hover:bg-primary/10 hover:border-primary/30\"\n          >\n            <ExternalLink className=\"h-4 w-4\" />\n          </Button>\n        )}\n      </div>\n    </Card>\n  );\n}\n","size_bytes":2699},"client/src/components/Navigation.tsx":{"content":"import { Heart, Home, User, History, Settings, Megaphone, Trophy } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function Navigation() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n\n  const navItems = [\n    { path: \"/\", label: \"Home\", icon: Home },\n    { path: \"/discover\", label: \"Discover\", icon: Heart },\n    { path: \"/actions\", label: \"Actions\", icon: Megaphone },\n    { path: \"/challenges\", label: \"Challenges\", icon: Trophy },\n    { path: \"/impact\", label: \"Impact\", icon: History },\n    { path: \"/profile\", label: \"Profile\", icon: User },\n  ];\n\n  // Add Admin link for authenticated users\n  if (user) {\n    navItems.push({ path: \"/admin\", label: \"Admin\", icon: Settings });\n  }\n\n  return (\n    <nav className=\"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-sm border-b\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex items-center justify-between h-16\">\n          <Link href=\"/\" className=\"flex items-center gap-2 text-xl font-display font-bold\" data-testid=\"link-logo\">\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 bg-primary/20 blur-lg rounded-full\" />\n              <Heart className=\"relative h-6 w-6 text-primary fill-primary\" />\n            </div>\n            <span className=\"bg-gradient-to-r from-primary to-chart-2 bg-clip-text text-transparent\">\n              AidAtlas\n            </span>\n          </Link>\n\n          <div className=\"hidden md:flex items-center gap-2\">\n            {navItems.map((item) => {\n              const Icon = item.icon;\n              const isActive = location === item.path;\n              return (\n                <Link key={item.path} href={item.path} asChild>\n                  <Button\n                    variant={isActive ? \"default\" : \"ghost\"}\n                    data-testid={`nav-${item.label.toLowerCase()}`}\n                  >\n                    <Icon className=\"h-4 w-4 mr-2\" />\n                    {item.label}\n                  </Button>\n                </Link>\n              );\n            })}\n          </div>\n\n          <div className=\"md:hidden flex items-center gap-1\">\n            {navItems.map((item) => {\n              const Icon = item.icon;\n              const isActive = location === item.path;\n              return (\n                <Link key={item.path} href={item.path} asChild>\n                  <Button\n                    variant={isActive ? \"default\" : \"ghost\"}\n                    size=\"icon\"\n                    data-testid={`nav-mobile-${item.label.toLowerCase()}`}\n                  >\n                    <Icon className=\"h-5 w-5\" />\n                  </Button>\n                </Link>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    </nav>\n  );\n}\n","size_bytes":2911},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: \n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1079},"client/src/pages/Profile.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport Navigation from \"@/components/Navigation\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Trophy, Award, Heart, DollarSign, Target, Share2, Sparkles, Crown, Star, Zap } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Donation } from \"@shared/schema\";\nimport { format } from \"date-fns\";\nimport { Link } from \"wouter\";\n\ninterface UnlockedBadge {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n  color: string;\n  unlocked: boolean;\n  glowing?: boolean;\n}\n\ninterface RecentActivity {\n  id: string;\n  type: 'donation' | 'challenge' | 'badge';\n  title: string;\n  description: string;\n  xp?: number;\n  time: string;\n}\n\nconst ALL_BADGES: Omit<UnlockedBadge, 'unlocked' | 'glowing'>[] = [\n  { id: 'first-step', name: 'First Step', description: 'Make your first donation', icon: 'Heart', color: 'from-pink-500 to-rose-500' },\n  { id: 'generous-giver', name: 'Generous Giver', description: 'Donate $100 or more', icon: 'DollarSign', color: 'from-green-500 to-emerald-500' },\n  { id: 'action-hero', name: 'Action Hero', description: 'Participate in 10 actions', icon: 'Zap', color: 'from-yellow-500 to-orange-500' },\n  { id: 'peace-dove', name: 'Peace Dove', description: 'Complete all daily challenges', icon: 'Trophy', color: 'from-purple-500 to-pink-500' },\n  { id: 'streak-master', name: 'Streak Master', description: 'Donate for 7 consecutive days', icon: 'Target', color: 'from-blue-500 to-cyan-500' },\n  { id: 'world-changer', name: 'World Changer', description: 'Support 10+ conflicts', icon: 'Crown', color: 'from-indigo-500 to-purple-500' },\n];\n\nexport default function Profile() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [xp, setXP] = useState(0);\n  const [level, setLevel] = useState(1);\n  const [badges, setBadges] = useState<UnlockedBadge[]>([]);\n  const [recentActivity, setRecentActivity] = useState<RecentActivity[]>([]);\n  const [showSharePopup, setShowSharePopup] = useState(false);\n\n  const { data: donations = [] } = useQuery<Donation[]>({\n    queryKey: ['/api/donations'],\n    enabled: !!user,\n  });\n\n  const { data: stats } = useQuery<any>({\n    queryKey: ['/api/impact/stats'],\n    enabled: !!user,\n  });\n\n  // Load XP and badges from localStorage\n  useEffect(() => {\n    const savedXP = localStorage.getItem('user-xp');\n    if (savedXP) {\n      const xpValue = parseInt(savedXP);\n      setXP(xpValue);\n      setLevel(Math.floor(xpValue / 500) + 1);\n    }\n\n    const savedBadges = localStorage.getItem('unlocked-badges');\n    const unlockedIds = savedBadges ? JSON.parse(savedBadges) : [];\n    \n    const badgeList = ALL_BADGES.map(badge => ({\n      ...badge,\n      unlocked: unlockedIds.includes(badge.id),\n      glowing: false,\n    }));\n    setBadges(badgeList);\n\n    const savedActivity = localStorage.getItem('recent-activity');\n    if (savedActivity) {\n      setRecentActivity(JSON.parse(savedActivity));\n    }\n  }, []);\n\n  // Listen for new donations and challenges\n  useEffect(() => {\n    const handleDonation = (event: CustomEvent) => {\n      const newActivity: RecentActivity = {\n        id: Date.now().toString(),\n        type: 'donation',\n        title: 'Donation Made',\n        description: `$${event.detail?.amount || 0} donated`,\n        xp: Math.floor((event.detail?.amount || 0) * 10),\n        time: new Date().toISOString(),\n      };\n      \n      addActivity(newActivity);\n    };\n\n    const handleChallenge = (event: CustomEvent) => {\n      const newActivity: RecentActivity = {\n        id: Date.now().toString(),\n        type: 'challenge',\n        title: 'Challenge Completed',\n        description: event.detail?.title || 'Daily challenge',\n        xp: event.detail?.xp || 0,\n        time: new Date().toISOString(),\n      };\n      \n      addActivity(newActivity);\n    };\n\n    window.addEventListener('donation-made', handleDonation as EventListener);\n    window.addEventListener('challenge-completed', handleChallenge as EventListener);\n\n    return () => {\n      window.removeEventListener('donation-made', handleDonation as EventListener);\n      window.removeEventListener('challenge-completed', handleChallenge as EventListener);\n    };\n  }, [recentActivity]);\n\n  const addActivity = (activity: RecentActivity) => {\n    const updated = [activity, ...recentActivity].slice(0, 10);\n    setRecentActivity(updated);\n    localStorage.setItem('recent-activity', JSON.stringify(updated));\n  };\n\n  const handleShareStreak = () => {\n    setShowSharePopup(true);\n    setTimeout(() => setShowSharePopup(false), 3000);\n    \n    toast({\n      title: \"Link Copied!\",\n      description: \"Your profile link has been copied to clipboard\",\n    });\n  };\n\n  const currentLevelXP = (level - 1) * 500;\n  const nextLevelXP = level * 500;\n  const progressToNextLevel = ((xp - currentLevelXP) / (nextLevelXP - currentLevelXP)) * 100;\n  const xpNeeded = nextLevelXP - xp;\n\n  const donationsToNextBadge = Math.max(0, 100 - (stats?.totalDonated || 0));\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navigation />\n        <div className=\"pt-24 pb-12 px-6 max-w-md mx-auto\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-display font-bold mb-2\">Your Profile</h1>\n            <p className=\"text-muted-foreground\">Log in or sign up to view your profile and track your impact</p>\n          </div>\n          \n          <Card className=\"p-6\">\n            <div className=\"space-y-4\">\n              <Link href=\"/login\">\n                <Button className=\"w-full bg-gradient-to-r from-primary to-chart-1\" data-testid=\"button-go-login\">\n                  Log In\n                </Button>\n              </Link>\n              <Link href=\"/signup\">\n                <Button variant=\"outline\" className=\"w-full\" data-testid=\"button-go-signup\">\n                  Create Account\n                </Button>\n              </Link>\n            </div>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-blue-50/20 dark:via-blue-950/20 to-background\">\n      <Navigation />\n      \n      <div className=\"pt-24 pb-12 px-6\">\n        <div className=\"max-w-5xl mx-auto\">\n          {/* Gradient Header */}\n          <Card className=\"mb-8 overflow-hidden bg-gradient-to-br from-purple-500 via-pink-500 to-orange-500 border-0 shadow-2xl\">\n            <div className=\"p-8 text-white\">\n              <div className=\"flex items-start justify-between mb-6\">\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"h-24 w-24 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center border-4 border-white/30 shadow-xl\">\n                    <Crown className=\"h-12 w-12 text-white\" />\n                  </div>\n                  <div>\n                    <h1 className=\"text-4xl font-display font-bold mb-2\">{user.name}</h1>\n                    <div className=\"flex items-center gap-3\">\n                      <Badge className=\"bg-white/20 backdrop-blur-sm text-white border-white/30\">\n                        Level {level}\n                      </Badge>\n                      <Badge className=\"bg-yellow-400/90 text-yellow-900 border-0 shadow-lg\">\n                        <Star className=\"h-3 w-3 mr-1\" />\n                        {xp} XP\n                      </Badge>\n                    </div>\n                  </div>\n                </div>\n                <Button \n                  variant=\"secondary\"\n                  className=\"bg-white/20 backdrop-blur-sm hover:bg-white/30 text-white border-white/30\"\n                  onClick={handleShareStreak}\n                  data-testid=\"button-share-streak\"\n                >\n                  <Share2 className=\"h-4 w-4 mr-2\" />\n                  Share My Streak\n                </Button>\n              </div>\n\n              {/* XP Progress Bar */}\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"font-medium\">Level {level}</span>\n                  <span>Level {level + 1}</span>\n                </div>\n                <div className=\"bg-white/20 backdrop-blur-sm rounded-full h-4 overflow-hidden shadow-inner\">\n                  <div \n                    className=\"h-full bg-gradient-to-r from-yellow-400 to-orange-400 transition-all duration-500 ease-out shadow-lg\"\n                    style={{ width: `${progressToNextLevel}%` }}\n                  />\n                </div>\n                <p className=\"text-sm text-white/90\">{xpNeeded} XP until next level</p>\n              </div>\n            </div>\n          </Card>\n\n          {/* Next Goal Section */}\n          <Card className=\"mb-8 p-6 bg-gradient-to-br from-white to-blue-50 dark:from-gray-900 dark:to-blue-950/20 border-2 border-blue-200 dark:border-blue-800\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"p-3 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl shadow-lg\">\n                <Target className=\"h-6 w-6 text-white\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-semibold text-lg mb-2\">Next Goal</h3>\n                <p className=\"text-muted-foreground mb-3\">\n                  ${donationsToNextBadge.toFixed(2)} more in donations to unlock the <strong>Generous Giver</strong> badge\n                </p>\n                <Progress value={((stats?.totalDonated || 0) / 100) * 100} className=\"h-2\" />\n              </div>\n            </div>\n          </Card>\n\n          <div className=\"grid lg:grid-cols-2 gap-8 mb-8\">\n            {/* Impact Stats */}\n            <Card className=\"p-6\">\n              <h2 className=\"text-xl font-semibold mb-6 flex items-center gap-2\">\n                <Trophy className=\"h-5 w-5 text-yellow-500\" />\n                Impact Stats\n              </h2>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"text-center p-4 bg-gradient-to-br from-pink-50 to-rose-50 dark:from-pink-950/20 dark:to-rose-950/20 rounded-xl\">\n                  <Heart className=\"h-8 w-8 mx-auto mb-2 text-pink-500\" />\n                  <div className=\"text-2xl font-bold\">${stats?.totalDonated?.toFixed(2) || '0.00'}</div>\n                  <div className=\"text-xs text-muted-foreground\">Total Donated</div>\n                </div>\n                <div className=\"text-center p-4 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20 rounded-xl\">\n                  <Target className=\"h-8 w-8 mx-auto mb-2 text-blue-500\" />\n                  <div className=\"text-2xl font-bold\">{donations.length}</div>\n                  <div className=\"text-xs text-muted-foreground\">Donations</div>\n                </div>\n                <div className=\"text-center p-4 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/20 dark:to-emerald-950/20 rounded-xl\">\n                  <Award className=\"h-8 w-8 mx-auto mb-2 text-green-500\" />\n                  <div className=\"text-2xl font-bold\">{badges.filter(b => b.unlocked).length}</div>\n                  <div className=\"text-xs text-muted-foreground\">Badges</div>\n                </div>\n                <div className=\"text-center p-4 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-950/20 dark:to-pink-950/20 rounded-xl\">\n                  <Zap className=\"h-8 w-8 mx-auto mb-2 text-purple-500\" />\n                  <div className=\"text-2xl font-bold\">{stats?.conflictsSupported || 0}</div>\n                  <div className=\"text-xs text-muted-foreground\">Conflicts Supported</div>\n                </div>\n              </div>\n            </Card>\n\n            {/* Badge Collection */}\n            <Card className=\"p-6\">\n              <h2 className=\"text-xl font-semibold mb-6 flex items-center gap-2\">\n                <Award className=\"h-5 w-5 text-purple-500\" />\n                Badge Collection\n              </h2>\n              <div className=\"grid grid-cols-3 gap-4\">\n                {badges.map((badge) => {\n                  const isLocked = !badge.unlocked;\n                  \n                  return (\n                    <div\n                      key={badge.id}\n                      className={`relative text-center p-4 rounded-xl transition-all duration-300 ${\n                        isLocked \n                          ? 'opacity-40 grayscale' \n                          : `bg-gradient-to-br ${badge.color} shadow-lg hover:scale-105 ${badge.glowing ? 'animate-pulse' : ''}`\n                      }`}\n                      data-testid={`badge-${badge.id}`}\n                      style={{\n                        animation: badge.glowing ? 'glow 1s ease-in-out infinite' : 'none'\n                      }}\n                    >\n                      {isLocked && (\n                        <div className=\"absolute inset-0 bg-gray-900/50 rounded-xl flex items-center justify-center\">\n                          <div className=\"text-white text-2xl\">🔒</div>\n                        </div>\n                      )}\n                      <div className=\"text-4xl mb-2\">{isLocked ? '🔒' : badge.icon === 'Heart' ? '❤️' : badge.icon === 'Trophy' ? '🏆' : badge.icon === 'DollarSign' ? '💰' : badge.icon === 'Zap' ? '⚡' : badge.icon === 'Target' ? '🎯' : '👑'}</div>\n                      <div className={`text-xs font-semibold ${isLocked ? 'text-gray-500' : 'text-white'}`}>\n                        {badge.name}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </Card>\n          </div>\n\n          {/* Recent Activity */}\n          <Card className=\"p-6\">\n            <h2 className=\"text-xl font-semibold mb-6 flex items-center gap-2\">\n              <Sparkles className=\"h-5 w-5 text-yellow-500\" />\n              Recent Activity\n            </h2>\n            {recentActivity.length > 0 ? (\n              <div className=\"space-y-3\">\n                {recentActivity.map((activity) => (\n                  <div\n                    key={activity.id}\n                    className=\"flex items-start gap-4 p-4 bg-gradient-to-r from-purple-50/50 to-pink-50/50 dark:from-purple-950/20 dark:to-pink-950/20 rounded-lg hover:shadow-md transition-shadow\"\n                    data-testid={`activity-${activity.id}`}\n                  >\n                    <div className={`p-2 rounded-full ${\n                      activity.type === 'donation' ? 'bg-pink-500' :\n                      activity.type === 'challenge' ? 'bg-purple-500' :\n                      'bg-green-500'\n                    } text-white shadow-lg`}>\n                      {activity.type === 'donation' && <Heart className=\"h-4 w-4\" />}\n                      {activity.type === 'challenge' && <Target className=\"h-4 w-4\" />}\n                      {activity.type === 'badge' && <Award className=\"h-4 w-4\" />}\n                    </div>\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-semibold text-sm\">{activity.title}</h4>\n                      <p className=\"text-xs text-muted-foreground\">{activity.description}</p>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {activity.time && format(new Date(activity.time), 'MMM d, h:mm a')}\n                      </p>\n                    </div>\n                    {activity.xp && (\n                      <Badge className=\"bg-gradient-to-r from-yellow-400 to-orange-400 text-white border-0\">\n                        +{activity.xp} XP\n                      </Badge>\n                    )}\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Sparkles className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\n                <p>No recent activity yet. Start making donations and completing challenges!</p>\n              </div>\n            )}\n          </Card>\n        </div>\n      </div>\n\n      {/* Share Popup */}\n      {showSharePopup && (\n        <div className=\"fixed bottom-8 right-8 z-50 animate-in slide-in-from-bottom-5 duration-300\">\n          <Card className=\"p-4 bg-gradient-to-br from-green-500 to-emerald-500 text-white border-0 shadow-2xl\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-white/20 rounded-full\">\n                <Share2 className=\"h-5 w-5\" />\n              </div>\n              <div>\n                <p className=\"font-semibold\">Link Copied!</p>\n                <p className=\"text-sm text-white/90\">Share your impact with friends</p>\n              </div>\n            </div>\n          </Card>\n        </div>\n      )}\n\n      <style>{`\n        @keyframes glow {\n          0%, 100% {\n            box-shadow: 0 0 20px rgba(168, 85, 247, 0.4);\n          }\n          50% {\n            box-shadow: 0 0 40px rgba(168, 85, 247, 0.8);\n          }\n        }\n      `}</style>\n    </div>\n  );\n}\n","size_bytes":17272},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/DonationHistory.tsx":{"content":"import { Calendar, Heart } from \"lucide-react\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface DonationRecord {\n  id: string;\n  organizationName: string;\n  conflictTitle: string;\n  amount: number;\n  date: string;\n  type: string;\n}\n\ninterface DonationHistoryProps {\n  donations: DonationRecord[];\n}\n\nexport default function DonationHistory({ donations }: DonationHistoryProps) {\n  if (donations.length === 0) {\n    return (\n      <Card className=\"p-8 text-center\">\n        <Heart className=\"h-12 w-12 mx-auto mb-3 text-muted-foreground\" />\n        <p className=\"text-muted-foreground\">No donations yet. Start making an impact!</p>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-3\">\n      {donations.map((donation, index) => (\n        <Card\n          key={donation.id}\n          className=\"p-4\"\n          data-testid={`donation-record-${index}`}\n        >\n          <div className=\"flex items-start justify-between gap-4\">\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2 mb-1\">\n                <h4 className=\"font-semibold\">{donation.organizationName}</h4>\n                <Badge variant=\"secondary\" className=\"text-xs\" data-testid={`badge-type-${donation.type}`}>\n                  {donation.type}\n                </Badge>\n              </div>\n              <p className=\"text-sm text-muted-foreground mb-2\">\n                {donation.conflictTitle}\n              </p>\n              <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                <Calendar className=\"h-3 w-3\" />\n                {new Date(donation.date).toLocaleDateString('en-US', {\n                  year: 'numeric',\n                  month: 'long',\n                  day: 'numeric',\n                })}\n              </div>\n            </div>\n            <div className=\"text-right\">\n              <p className=\"text-2xl font-display font-bold text-chart-2\" data-testid={`text-amount-${donation.id}`}>\n                ${donation.amount}\n              </p>\n            </div>\n          </div>\n        </Card>\n      ))}\n    </div>\n  );\n}\n","size_bytes":2146},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/pages/Home.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport Navigation from \"@/components/Navigation\";\nimport Hero from \"@/components/Hero\";\nimport HowItWorks from \"@/components/HowItWorks\";\nimport OrganizationCard from \"@/components/OrganizationCard\";\nimport ImpactStats from \"@/components/ImpactStats\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { CheckCircle, Globe, TrendingUp, Shield } from \"lucide-react\";\n\nexport default function Home() {\n  const [, setLocation] = useLocation();\n  \n  const featuredOrganizations = [\n    {\n      id: \"irc\",\n      name: \"International Rescue Committee\",\n      description: \"Provides humanitarian aid and support to refugees and displaced persons worldwide.\",\n      rating: 4.5,\n      verified: true,\n      website: \"https://www.rescue.org\",\n    },\n    {\n      id: \"msf\",\n      name: \"Doctors Without Borders\",\n      description: \"Delivers emergency medical care to people affected by conflict and disasters.\",\n      rating: 4.8,\n      verified: true,\n      website: \"https://www.doctorswithoutborders.org\",\n    },\n    {\n      id: \"unicef\",\n      name: \"UNICEF\",\n      description: \"Works to protect children's rights and provide humanitarian assistance worldwide.\",\n      rating: 4.6,\n      verified: true,\n      website: \"https://www.unicef.org\",\n    },\n  ];\n\n  const trustFeatures = [\n    {\n      icon: CheckCircle,\n      title: \"Verified Organizations\",\n      description: \"All partner organizations are thoroughly vetted and verified\",\n    },\n    {\n      icon: Shield,\n      title: \"Transparent Impact\",\n      description: \"Track exactly where your donations go and who they help\",\n    },\n    {\n      icon: TrendingUp,\n      title: \"Real-Time Updates\",\n      description: \"Get updates on how your contributions make a difference\",\n    },\n    {\n      icon: Globe,\n      title: \"Global Reach\",\n      description: \"Support humanitarian efforts in conflict zones worldwide\",\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Navigation />\n      \n      <div className=\"pt-16\">\n        <Hero\n          onGetStarted={() => setLocation(\"/discover\")}\n          onLearnMore={() => {\n            document.getElementById(\"how-it-works\")?.scrollIntoView({ behavior: \"smooth\" });\n          }}\n        />\n\n        <div id=\"how-it-works\">\n          <HowItWorks />\n        </div>\n\n        <section className=\"py-20 px-6\">\n          <div className=\"max-w-6xl mx-auto\">\n            <div className=\"text-center mb-12\">\n              <h2 className=\"text-4xl font-display font-bold mb-4\">Global Impact</h2>\n              <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n                Together, we're making a difference\n              </p>\n            </div>\n            <ImpactStats\n              totalDonated={2847250}\n              peopleHelped={156842}\n              organizationsSupported={47}\n              conflictsSupported={23}\n            />\n          </div>\n        </section>\n\n        <section className=\"py-20 px-6 bg-muted/30\">\n          <div className=\"max-w-6xl mx-auto\">\n            <div className=\"text-center mb-12\">\n              <h2 className=\"text-4xl font-display font-bold mb-4\">Why Trust Us</h2>\n              <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n                Built on transparency, verified organizations, and real impact\n              </p>\n            </div>\n\n            <div className=\"grid md:grid-cols-2 gap-6 mb-12\">\n              {trustFeatures.map((feature) => {\n                const Icon = feature.icon;\n                return (\n                  <Card key={feature.title} className=\"p-6\" data-testid={`card-trust-${feature.title.toLowerCase().replace(/\\s+/g, '-')}`}>\n                    <Icon className=\"h-10 w-10 text-primary mb-4\" />\n                    <h3 className=\"text-xl font-semibold mb-2\">{feature.title}</h3>\n                    <p className=\"text-muted-foreground\">{feature.description}</p>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-20 px-6\">\n          <div className=\"max-w-6xl mx-auto\">\n            <div className=\"text-center mb-12\">\n              <h2 className=\"text-4xl font-display font-bold mb-4\">Featured Organizations</h2>\n              <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n                Trusted partners making a real difference\n              </p>\n            </div>\n\n            <div className=\"grid md:grid-cols-3 gap-6\">\n              {featuredOrganizations.map((org) => (\n                <OrganizationCard\n                  key={org.id}\n                  {...org}\n                  onDonate={() => setLocation(\"/discover\")}\n                />\n              ))}\n            </div>\n          </div>\n        </section>\n\n        <section className=\"relative py-32 px-6 overflow-hidden\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-primary via-chart-1 to-chart-2\" />\n          <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_30%_50%,rgba(255,255,255,0.1),transparent_50%)]\" />\n          <div className=\"relative max-w-4xl mx-auto text-center text-white\">\n            <div className=\"inline-block mb-6 px-4 py-2 rounded-full bg-white/20 backdrop-blur-md border border-white/30\">\n              <p className=\"text-sm font-medium\">Join thousands making an impact</p>\n            </div>\n            <h2 className=\"text-5xl md:text-6xl font-display font-bold mb-6\">\n              Ready to Make a Difference?\n            </h2>\n            <p className=\"text-xl mb-10 opacity-90 max-w-2xl mx-auto\">\n              Start discovering humanitarian causes and support organizations making real impact in conflict zones worldwide.\n            </p>\n            <Button\n              size=\"lg\"\n              onClick={() => setLocation(\"/discover\")}\n              className=\"bg-white text-primary hover:bg-white/90 text-lg px-12 py-6 shadow-2xl h-auto\"\n              data-testid=\"button-cta-bottom\"\n            >\n              Start Your Journey\n            </Button>\n          </div>\n        </section>\n\n        <footer className=\"bg-card/50 backdrop-blur-sm border-t py-12 px-6\">\n          <div className=\"max-w-6xl mx-auto text-center\">\n            <p className=\"text-muted-foreground\">\n              © 2025 <span className=\"font-semibold bg-gradient-to-r from-primary to-chart-2 bg-clip-text text-transparent\">AidAtlas</span>. Making humanitarian giving accessible and impactful.\n            </p>\n          </div>\n        </footer>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6658},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"design_guidelines.md":{"content":"# Design Guidelines: Humanitarian Donation Platform MVP\n\n## Design Approach\n\n**Reference-Based Strategy**: Drawing inspiration from Tinder's swipe mechanics, Airbnb's trust-building card design, and Linear's typography restraint. This platform requires emotional engagement while maintaining credibility and clarity for donation actions.\n\n**Core Principles**:\n- **Trust through transparency**: Clean layouts, verified badges, clear information hierarchy\n- **Emotional connection without exploitation**: Dignified imagery, hopeful tone, respectful presentation\n- **Effortless interaction**: Intuitive swipe mechanics, minimal friction to donate\n- **Mobile-first excellence**: Touch-optimized, thumb-friendly navigation zones\n\n---\n\n## Typography\n\n**Font Stack** (via Google Fonts CDN):\n- **Primary**: Inter (400, 500, 600, 700) - UI text, body copy, interface elements\n- **Display**: Fraunces (600, 700) - Hero headlines, impact numbers, emotional emphasis\n\n**Scale & Hierarchy**:\n- **Hero/Display**: text-4xl to text-6xl (Fraunces 600)\n- **Section Headers**: text-2xl to text-3xl (Inter 600)\n- **Card Titles**: text-xl to text-2xl (Inter 600)\n- **Body Text**: text-base to text-lg (Inter 400)\n- **Metadata/Labels**: text-sm to text-base (Inter 500)\n- **Micro-copy**: text-xs to text-sm (Inter 400)\n\n**Line Heights**: leading-tight for headlines, leading-relaxed for body text\n\n---\n\n## Layout System\n\n**Spacing Primitives** (Tailwind units): Consistently use **2, 4, 6, 8, 12, 16, 20, 24** for rhythm\n- Component padding: p-4, p-6, p-8\n- Section spacing: py-12, py-16, py-20 (mobile), py-20, py-24, py-32 (desktop)\n- Card gaps: gap-4, gap-6\n- Element margins: mb-2, mb-4, mb-6\n\n**Container Strategy**:\n- Full viewport: w-full\n- Content containers: max-w-7xl mx-auto px-4 (mobile), px-6 (tablet), px-8 (desktop)\n- Card interface: max-w-md mx-auto (centered mobile experience)\n- Text content: max-w-prose\n\n**Responsive Breakpoints**: sm (640px), md (768px), lg (1024px), xl (1280px)\n\n---\n\n## Component Library\n\n### Navigation\n**Top Navigation Bar**:\n- Fixed header: h-16, backdrop-blur-lg, border-b\n- Logo left-aligned, profile/menu right-aligned\n- Mobile: Hamburger menu with slide-out drawer\n- Navigation links: Desktop horizontal, mobile vertical list\n\n### Card Interface (Core Feature)\n**Swipeable Conflict Cards**:\n- Card container: max-w-md, aspect-ratio-[3/4], rounded-2xl, shadow-2xl\n- Image zone: Top 50-60% with gradient overlay (top to transparent)\n- Content zone: Bottom 40-50%, p-6, white background\n- Swipe indicators: Left/right edge glow/shadow on drag\n- Card stack: Show 2-3 cards behind with scale/opacity reduction\n\n**Card Content Structure**:\n- Country/Region: text-sm, uppercase, tracking-wide, opacity-70\n- Conflict Title: text-2xl, font-semibold, mb-2\n- Summary: text-base, leading-relaxed, line-clamp-3\n- Tags/Badges: Pill-shaped, text-xs, px-3, py-1, rounded-full\n- CTA buttons: Fixed bottom zone, gap-3, full-width\n\n**Action Buttons (Below Cards)**:\n- Three-button layout: Pass, Details, Support\n- Icon-based with labels: Large touch targets (h-14, w-14 for icons)\n- Center button (Details) emphasized: Larger, primary styling\n\n### Organization Cards\n**Verified Organization Display**:\n- Compact card: p-4, rounded-xl, border\n- Logo: h-12, w-12, rounded-lg\n- Name + verification badge: Inline display\n- Rating stars + Charity Navigator score\n- Description: text-sm, line-clamp-2\n- Donate button: Secondary style, right-aligned\n\n### Forms\n**Preference Quiz**:\n- Progress indicator: Stepped dots, top of screen\n- Question card: Centered, max-w-lg, p-8\n- Multi-select chips: Pill buttons, toggle state, gap-2, flex-wrap\n- Navigation: Previous/Next buttons, bottom fixed bar\n\n**Donation Flow**:\n- Amount selector: Grid of preset buttons (2x3 layout) + custom input\n- Organization allocation: Checkbox list with percentages\n- Payment form: Single-column, generous spacing (gap-6)\n- Summary panel: Sticky sidebar (desktop) or bottom sheet (mobile)\n\n### Data Visualization\n**Impact Dashboard**:\n- Stats grid: grid-cols-2 md:grid-cols-4, gap-4\n- Stat cards: p-6, rounded-xl, text-center\n- Large numbers: text-4xl, Fraunces font\n- Labels: text-sm, opacity-70\n- Icons: text-3xl, mb-2\n\n**Donation History**:\n- Timeline list: Vertical with connecting line\n- History items: p-4, rounded-lg, flex layout\n- Date badges: Absolute positioned, text-xs\n- Organization thumbnails: h-10, w-10, rounded-full\n\n### Modals & Overlays\n**Detail Modal**:\n- Full-screen mobile, centered card desktop (max-w-2xl)\n- Header: Fixed with close button, h-16\n- Scrollable content: p-6\n- Footer: Sticky with primary CTA\n\n**Bottom Sheets** (Mobile):\n- Drag handle: Centered pill shape\n- Backdrop: backdrop-blur-sm, bg-black/20\n- Content: rounded-t-3xl, min-h-[50vh]\n\n---\n\n## Images\n\n**Hero Section**: \n- Full-width hero with humanitarian imagery (people helping people, hope-focused)\n- h-[70vh] on desktop, h-[60vh] on mobile\n- Gradient overlay: from-black/60 via-black/30 to-transparent\n- Content overlaid: Centered, text-white, with blurred button backgrounds (backdrop-blur-md, bg-white/20)\n\n**Conflict Cards**: \n- Contextual imagery showing conflict regions with dignity\n- Each card features one compelling image\n- Aspect ratio: 4:3 or 16:9, object-cover\n\n**Organization Logos**: \n- Square format, h-12 w-12 for list view\n- h-20 w-20 for detail view\n- Background: white with subtle border\n\n**Impact Visuals**: \n- Before/after imagery where appropriate\n- Beneficiary stories: Respectful portraits\n- Data visualizations: Charts and infographics\n\n---\n\n## Icon System\n\n**Library**: Heroicons (via CDN) - outline for regular, solid for emphasis\n\n**Usage**:\n- Navigation: 24px icons\n- Cards: 20px for metadata icons\n- Buttons: 20px inline with text\n- Feature highlights: 32-40px decorative\n\n**Key Icons**: MapPin, Heart, Users, Globe, ChartBar, CheckCircle, ExclamationTriangle\n\n---\n\n## Animations\n\n**Strategic Use Only**:\n- Card swipe physics: Spring animation, subtle bounce\n- Page transitions: Fade + slight slide (150ms)\n- Button states: Scale on press (0.95), 100ms\n- Loading states: Skeleton screens, gentle pulse\n- Success feedback: Checkmark scale-in animation\n\n**Avoid**: Excessive parallax, continuous animations, scroll-triggered effects\n\n---\n\n## Landing Page Structure\n\n**Sections** (8 comprehensive sections):\n1. **Hero**: Full-width image, headline \"Support Where It Matters Most\", subtitle, dual CTAs (Start Giving / Learn More)\n2. **How It Works**: 3-column grid with icons - Discover, Choose, Impact\n3. **Live Impact**: Real-time donation map visualization with stats overlay\n4. **Featured Conflicts**: Carousel of 3 current priority conflict cards\n5. **Trust & Verification**: 2-column layout - left text about verification, right organization badges/ratings\n6. **Impact Stories**: 3 testimonial cards with beneficiary updates\n7. **Transparency**: Split layout - pie chart of fund distribution, list of partner organizations\n8. **Final CTA**: Centered with background image, Get Started button, newsletter signup\n\n**Multi-Column Strategy**:\n- Hero/CTA sections: Single column, centered\n- Features: 3 columns desktop, 1 mobile\n- Organizations: 2-3 columns desktop\n- Impact stats: 4 columns desktop, 2 mobile","size_bytes":7206},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider } from \"@/hooks/useAuth\";\nimport Home from \"@/pages/Home\";\nimport Discover from \"@/pages/Discover\";\nimport Impact from \"@/pages/Impact\";\nimport Profile from \"@/pages/Profile\";\nimport Actions from \"@/pages/Actions\";\nimport Challenges from \"@/pages/Challenges\";\nimport Support from \"@/pages/Support\";\nimport Login from \"@/pages/Login\";\nimport Signup from \"@/pages/Signup\";\nimport Admin from \"@/pages/Admin\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Home} />\n      <Route path=\"/login\" component={Login} />\n      <Route path=\"/signup\" component={Signup} />\n      <Route path=\"/discover\" component={Discover} />\n      <Route path=\"/impact\" component={Impact} />\n      <Route path=\"/actions\" component={Actions} />\n      <Route path=\"/challenges\" component={Challenges} />\n      <Route path=\"/support/:country\" component={Support} />\n      <Route path=\"/profile\" component={Profile} />\n      <Route path=\"/admin\" component={Admin} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":1618},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/examples/ConflictCard.tsx":{"content":"import ConflictCard from '../ConflictCard';\nimport syriaImage from '@assets/generated_images/Syrian_refugee_camp_aerial_2ae266a3.png';\n\nexport default function ConflictCardExample() {\n  return (\n    <div className=\"p-6 bg-background min-h-screen flex items-center justify-center\">\n      <ConflictCard\n        country=\"Syria\"\n        region=\"Middle East\"\n        title=\"Syrian Refugee Crisis\"\n        summary=\"Millions of Syrian refugees need urgent humanitarian assistance including shelter, food, and medical care. The ongoing conflict has displaced families across the region, creating one of the largest humanitarian crises of our time.\"\n        imageUrl={syriaImage}\n        affectedGroups={[\"Children\", \"Women\", \"Elderly\", \"Displaced Families\"]}\n        severityLevel=\"high\"\n        onSupport={() => console.log('Support clicked')}\n        onDetails={() => console.log('Details clicked')}\n        onPass={() => console.log('Pass clicked')}\n      />\n    </div>\n  );\n}\n","size_bytes":972},"client/src/components/PreferenceQuiz.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowRight, ArrowLeft, Star } from \"lucide-react\";\n\ninterface QuizQuestion {\n  id: string;\n  question: string;\n  description?: string;\n  options: string[];\n  multi?: boolean;\n  ranked?: boolean;\n  maxRanked?: number;\n}\n\ninterface PreferenceQuizProps {\n  onComplete: (preferences: Record<string, string | string[]>) => void;\n}\n\nconst QUESTIONS: QuizQuestion[] = [\n  {\n    id: \"regions\",\n    question: \"Which regions would you like to support?\",\n    description: \"Select all that interest you\",\n    options: [\"Middle East\", \"Africa\", \"Asia\", \"Eastern Europe\", \"Latin America\", \"No Preference\"],\n    multi: true,\n  },\n  {\n    id: \"causes\",\n    question: \"What causes are most important to you?\",\n    description: \"Select and rank your top 3\",\n    options: [\"Healthcare\", \"Education\", \"Food Security\", \"Shelter\", \"Clean Water\", \"Women's Rights\", \"Refugee Support\", \"Child Protection\"],\n    ranked: true,\n    maxRanked: 3,\n  },\n  {\n    id: \"donationRange\",\n    question: \"What's your preferred donation range?\",\n    description: \"This helps us show relevant opportunities\",\n    options: [\"$5-20\", \"$20-50\", \"$50-100\", \"$100+\"],\n    multi: false,\n  },\n];\n\nexport default function PreferenceQuiz({ onComplete }: PreferenceQuizProps) {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [answers, setAnswers] = useState<Record<string, string | string[]>>({});\n\n  const currentQuestion = QUESTIONS[currentStep];\n  const currentAnswer = answers[currentQuestion.id] || (currentQuestion.multi || currentQuestion.ranked ? [] : \"\");\n\n  const toggleOption = (option: string) => {\n    if (currentQuestion.ranked) {\n      const current = currentAnswer as string[];\n      const maxRanked = currentQuestion.maxRanked || 3;\n      \n      if (current.includes(option)) {\n        // Remove from ranking\n        setAnswers({\n          ...answers,\n          [currentQuestion.id]: current.filter((o) => o !== option),\n        });\n      } else if (current.length < maxRanked) {\n        // Add to ranking\n        setAnswers({\n          ...answers,\n          [currentQuestion.id]: [...current, option],\n        });\n      }\n    } else if (currentQuestion.multi) {\n      const current = currentAnswer as string[];\n      setAnswers({\n        ...answers,\n        [currentQuestion.id]: current.includes(option)\n          ? current.filter((o) => o !== option)\n          : [...current, option],\n      });\n    } else {\n      setAnswers({ ...answers, [currentQuestion.id]: option });\n    }\n  };\n\n  const removeRankedOption = (option: string) => {\n    if (currentQuestion.ranked) {\n      const current = currentAnswer as string[];\n      setAnswers({\n        ...answers,\n        [currentQuestion.id]: current.filter((o) => o !== option),\n      });\n    }\n  };\n\n  const canContinue = () => {\n    if (currentQuestion.ranked) {\n      const maxRanked = currentQuestion.maxRanked || 3;\n      return (currentAnswer as string[]).length === maxRanked;\n    } else if (currentQuestion.multi) {\n      return (currentAnswer as string[]).length > 0;\n    } else {\n      return currentAnswer !== \"\";\n    }\n  };\n\n  const handleNext = () => {\n    if (currentStep < QUESTIONS.length - 1) {\n      setCurrentStep(currentStep + 1);\n    } else {\n      onComplete(answers);\n    }\n  };\n\n  const handleBack = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const rankedItems = currentQuestion.ranked ? (currentAnswer as string[]) : [];\n\n  return (\n    <div className=\"w-full max-w-2xl mx-auto p-6\">\n      <div className=\"flex items-center justify-center gap-3 mb-10\">\n        {QUESTIONS.map((_, index) => (\n          <div\n            key={index}\n            className={`h-2.5 rounded-full transition-all duration-300 ${\n              index <= currentStep \n                ? \"w-16 bg-gradient-to-r from-primary to-chart-1 shadow-lg shadow-primary/30\" \n                : \"w-2.5 bg-muted\"\n            }`}\n            data-testid={`progress-step-${index}`}\n          />\n        ))}\n      </div>\n\n      <Card className=\"p-10 shadow-2xl border-2 relative overflow-hidden\">\n        <div className=\"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-primary/5 to-transparent rounded-full blur-3xl -translate-y-1/2 translate-x-1/2\" />\n        \n        <div className=\"relative\">\n          <div className=\"inline-block mb-4 px-3 py-1 rounded-full bg-primary/10 border border-primary/20\">\n            <p className=\"text-xs font-medium text-primary\">Step {currentStep + 1} of {QUESTIONS.length}</p>\n          </div>\n          \n          <h2 className=\"text-4xl font-display font-bold mb-3 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent\">\n            {currentQuestion.question}\n          </h2>\n          <p className=\"text-center text-sm text-muted-foreground mb-6 font-medium\">\n            {currentQuestion.description || (currentQuestion.multi ? \"Select all that apply\" : \"Choose one option\")}\n            {currentQuestion.ranked && (\n              <span className=\"block mt-2 text-xs text-primary font-semibold\">\n                You must select exactly {currentQuestion.maxRanked || 3} causes\n              </span>\n            )}\n          </p>\n\n          {currentQuestion.ranked && rankedItems.length > 0 && (\n            <div className=\"mb-6 p-4 rounded-lg bg-primary/5 border border-primary/20\">\n              <p className=\"text-xs font-semibold text-primary mb-3\">Your Ranking ({rankedItems.length}/{currentQuestion.maxRanked})</p>\n              <div className=\"flex flex-wrap gap-2\">\n                {rankedItems.map((item, index) => (\n                  <Badge\n                    key={item}\n                    variant=\"default\"\n                    className=\"gap-2 pl-2 pr-3 py-2\"\n                    data-testid={`ranked-item-${index + 1}`}\n                  >\n                    <div className=\"flex items-center justify-center w-5 h-5 rounded-full bg-background/20 text-xs font-bold\">\n                      {index + 1}\n                    </div>\n                    <span>{item}</span>\n                    <button\n                      onClick={() => removeRankedOption(item)}\n                      className=\"ml-1 hover:text-destructive transition-colors\"\n                      data-testid={`remove-ranked-${index + 1}`}\n                    >\n                      ×\n                    </button>\n                  </Badge>\n                ))}\n              </div>\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-2 gap-3 mb-10\">\n            {currentQuestion.options.map((option) => {\n              const isSelected = currentQuestion.ranked\n                ? rankedItems.includes(option)\n                : currentQuestion.multi\n                ? (currentAnswer as string[]).includes(option)\n                : currentAnswer === option;\n              \n              const rankIndex = currentQuestion.ranked ? rankedItems.indexOf(option) : -1;\n              const isRanked = rankIndex !== -1;\n\n              return (\n                <button\n                  key={option}\n                  onClick={() => toggleOption(option)}\n                  disabled={currentQuestion.ranked && !isRanked && rankedItems.length >= (currentQuestion.maxRanked || 3)}\n                  className={`p-5 rounded-xl border-2 transition-all duration-200 hover:scale-[1.02] hover:shadow-lg relative ${\n                    isSelected\n                      ? \"border-primary bg-gradient-to-br from-primary/10 to-primary/5 shadow-md shadow-primary/20\"\n                      : \"border-border hover:border-primary/30\"\n                  } ${currentQuestion.ranked && !isRanked && rankedItems.length >= (currentQuestion.maxRanked || 3) ? \"opacity-40 cursor-not-allowed hover:scale-100\" : \"\"}`}\n                  data-testid={`option-${option.toLowerCase().replace(/\\s+/g, '-')}`}\n                >\n                  {isRanked && (\n                    <div className=\"absolute -top-2 -left-2 w-7 h-7 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold shadow-lg\">\n                      {rankIndex + 1}\n                    </div>\n                  )}\n                  <Badge\n                    variant={isSelected ? \"default\" : \"secondary\"}\n                    className=\"w-full justify-center text-sm py-2 font-medium\"\n                  >\n                    {option}\n                  </Badge>\n                </button>\n              );\n            })}\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            {currentStep > 0 && (\n              <Button\n                variant=\"outline\"\n                onClick={handleBack}\n                data-testid=\"button-back\"\n                className=\"px-6\"\n              >\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back\n              </Button>\n            )}\n            <Button\n              className=\"flex-1 bg-gradient-to-r from-primary to-chart-1 shadow-lg shadow-primary/30 px-8\"\n              onClick={handleNext}\n              disabled={!canContinue()}\n              data-testid=\"button-next\"\n            >\n              {currentStep < QUESTIONS.length - 1 ? \"Next\" : \"Complete Setup\"}\n              <ArrowRight className=\"h-4 w-4 ml-2\" />\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":9481},"client/src/components/examples/ImpactStats.tsx":{"content":"import ImpactStats from '../ImpactStats';\n\nexport default function ImpactStatsExample() {\n  return (\n    <div className=\"min-h-screen bg-background p-6\">\n      <div className=\"max-w-6xl mx-auto\">\n        <h2 className=\"text-3xl font-display font-bold mb-6 text-center\">Your Impact</h2>\n        <ImpactStats\n          totalDonated={1250}\n          peopleHelped={342}\n          organizationsSupported={8}\n          conflictsSupported={5}\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":478},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/hooks/useAuth.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { useLocation } from 'wouter';\n\ninterface User {\n  id: string;\n  name: string;\n  email: string;\n  onboardingCompleted: boolean;\n  preferences?: {\n    causes: string[];\n    regions: string[];\n    donationRange: string;\n  };\n}\n\ninterface AuthContextType {\n  user: User | null;\n  loading: boolean;\n  login: (email: string, password: string) => Promise<void>;\n  signup: (name: string, email: string, password: string) => Promise<void>;\n  logout: () => Promise<void>;\n  updateUser: (user: User) => void;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const response = await fetch('/api/auth/me', {\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setUser(data);\n      }\n    } catch (error) {\n      console.error('Auth check failed:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const login = async (email: string, password: string) => {\n    const response = await fetch('/api/auth/login', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ email, password }),\n      credentials: 'include'\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.error || 'Login failed');\n    }\n\n    const data = await response.json();\n    setUser(data);\n  };\n\n  const signup = async (name: string, email: string, password: string) => {\n    const response = await fetch('/api/auth/signup', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name, email, password }),\n      credentials: 'include'\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.error || 'Signup failed');\n    }\n\n    const data = await response.json();\n    setUser(data);\n  };\n\n  const logout = async () => {\n    await fetch('/api/auth/logout', { \n      method: 'POST',\n      credentials: 'include'\n    });\n    setUser(null);\n    setLocation('/');\n  };\n\n  const updateUser = (updatedUser: User) => {\n    setUser(updatedUser);\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, loading, login, signup, logout, updateUser }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within AuthProvider');\n  }\n  return context;\n}\n","size_bytes":2845},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"server/preference-engine.ts":{"content":"import { storage } from \"./storage\";\nimport type { Conflict, UserPreferenceVector } from \"@shared/schema\";\n\nexport class PreferenceEngine {\n  \n  async updatePreferencesFromSwipe(\n    userId: string,\n    conflict: Conflict,\n    swipeDirection: 'up' | 'pass' | 'down',\n    timeSpent: number\n  ): Promise<UserPreferenceVector> {\n    // Get or create preference vector\n    let vector = await storage.getUserPreferenceVector(userId);\n    if (!vector) {\n      vector = await storage.createUserPreferenceVector({\n        userId,\n        geoPreferences: {},\n        causePreferences: {},\n        demographicPreferences: {},\n        urgencyPreference: '0.5',\n        interactionCount: 0,\n      });\n    }\n\n    // Calculate engagement weight (0-1 scale)\n    const engagementWeight = this.calculateEngagementWeight(swipeDirection, timeSpent);\n    \n    // Increment interaction count\n    const newInteractionCount = vector.interactionCount + 1;\n\n    // Calculate learning rate based on interaction count\n    const learningRate = this.calculateLearningRate(newInteractionCount);\n\n    // Update geo preferences\n    const updatedGeo = this.updateGeographicPreferences(\n      vector.geoPreferences as Record<string, number>,\n      conflict.region,\n      engagementWeight,\n      learningRate\n    );\n\n    // Update cause preferences (from affected groups)\n    const updatedCauses = this.updateCausePreferences(\n      vector.causePreferences as Record<string, number>,\n      conflict.affectedGroups,\n      engagementWeight,\n      learningRate\n    );\n\n    // Update demographic preferences\n    const updatedDemo = this.updateDemographicPreferences(\n      vector.demographicPreferences as Record<string, number>,\n      conflict.affectedGroups,\n      engagementWeight,\n      learningRate\n    );\n\n    // Update urgency preference\n    const updatedUrgency = this.updateUrgencyPreference(\n      parseFloat(vector.urgencyPreference as string),\n      conflict.severityLevel,\n      engagementWeight,\n      learningRate\n    );\n\n    // Update vector in database\n    const updatedVector = await storage.updateUserPreferenceVector(userId, {\n      geoPreferences: updatedGeo,\n      causePreferences: updatedCauses,\n      demographicPreferences: updatedDemo,\n      urgencyPreference: updatedUrgency.toString(),\n      interactionCount: newInteractionCount,\n    });\n\n    return updatedVector!;\n  }\n\n  private calculateEngagementWeight(swipeDirection: string, timeSpent: number): number {\n    // Base weight based on swipe direction\n    let baseWeight = 0;\n    if (swipeDirection === 'up') baseWeight = 1.0;      // Strong positive signal\n    else if (swipeDirection === 'pass') baseWeight = -0.3;  // Mild negative signal\n    else if (swipeDirection === 'down') baseWeight = -0.7;  // Strong negative signal\n\n    // Boost weight if user spent time reading (>5 seconds = engaged)\n    const timeBoost = Math.min(timeSpent / 30, 1.0); // Max boost at 30 seconds\n    const finalWeight = baseWeight * (1 + timeBoost * 0.3); // Up to 30% boost\n\n    return Math.max(-1, Math.min(1, finalWeight)); // Clamp to [-1, 1]\n  }\n\n  private updateGeographicPreferences(\n    current: Record<string, number>,\n    region: string,\n    weight: number,\n    learningRate: number\n  ): Record<string, number> {\n    const updated = { ...current };\n    const currentValue = updated[region] || 0;\n    \n    // Exponential moving average with dynamic learning rate\n    updated[region] = currentValue * (1 - learningRate) + weight * learningRate;\n\n    return updated;\n  }\n\n  private updateCausePreferences(\n    current: Record<string, number>,\n    affectedGroups: string[],\n    weight: number,\n    learningRate: number\n  ): Record<string, number> {\n    const updated = { ...current };\n\n    // Map affected groups to causes\n    const causeMapping: Record<string, string[]> = {\n      'children': ['Education', 'Child Protection', 'Healthcare'],\n      'women': ['Women\\'s Rights', 'Healthcare'],\n      'refugees': ['Refugee Support', 'Shelter', 'Food Security'],\n      'elderly': ['Healthcare', 'Shelter'],\n      'displaced families': ['Shelter', 'Food Security', 'Refugee Support'],\n    };\n\n    affectedGroups.forEach(group => {\n      const lowerGroup = group.toLowerCase();\n      Object.entries(causeMapping).forEach(([key, causes]) => {\n        if (lowerGroup.includes(key)) {\n          causes.forEach(cause => {\n            const currentValue = updated[cause] || 0;\n            updated[cause] = currentValue * (1 - learningRate) + weight * learningRate;\n          });\n        }\n      });\n    });\n\n    return updated;\n  }\n\n  private updateDemographicPreferences(\n    current: Record<string, number>,\n    affectedGroups: string[],\n    weight: number,\n    learningRate: number\n  ): Record<string, number> {\n    const updated = { ...current };\n\n    affectedGroups.forEach(group => {\n      const currentValue = updated[group] || 0;\n      updated[group] = currentValue * (1 - learningRate) + weight * learningRate;\n    });\n\n    return updated;\n  }\n\n  private updateUrgencyPreference(\n    current: number,\n    severityLevel: string,\n    weight: number,\n    learningRate: number\n  ): number {\n    // Map severity to urgency score\n    const severityScores: Record<string, number> = {\n      'critical': 1.0,\n      'severe': 0.75,\n      'moderate': 0.5,\n      'low': 0.25,\n    };\n\n    const severityScore = severityScores[severityLevel.toLowerCase()] || 0.5;\n    // Use half the learning rate for urgency (slower adaptation)\n    const urgencyLearningRate = learningRate * 0.5;\n\n    // Only update if positive engagement\n    if (weight > 0) {\n      return current * (1 - urgencyLearningRate) + severityScore * urgencyLearningRate;\n    }\n\n    return current;\n  }\n\n  private calculateLearningRate(interactionCount: number): number {\n    // Decreasing learning rate as user has more interactions\n    // Prevents oscillation with many interactions\n    const initialRate = 0.1;\n    const decayFactor = 0.995;\n    return initialRate * Math.pow(decayFactor, interactionCount);\n  }\n\n  async generatePersonalizedFeed(userId: string): Promise<Conflict[]> {\n    // Get user's preference vector\n    const vector = await storage.getUserPreferenceVector(userId);\n    const user = await storage.getUser(userId);\n    \n    // Get all conflicts\n    const allConflicts = await storage.getConflicts();\n\n    // Cold start strategy if no interactions yet\n    if (!vector || vector.interactionCount === 0) {\n      return this.coldStartRecommendations(allConflicts, user?.preferences);\n    }\n\n    // Score each conflict based on preference vector\n    const scoredConflicts = allConflicts.map(conflict => ({\n      conflict,\n      score: this.scoreConflict(conflict, vector, user?.preferences),\n    }));\n\n    // Sort by score descending\n    scoredConflicts.sort((a, b) => b.score - a.score);\n\n    // Apply tiered recommendation strategy\n    return this.applyTieredStrategy(scoredConflicts);\n  }\n\n  private scoreConflict(\n    conflict: Conflict,\n    vector: UserPreferenceVector,\n    quizPreferences?: any\n  ): number {\n    let score = 0;\n\n    // Geographic preference score (40% weight)\n    const geoScore = (vector.geoPreferences as Record<string, number>)[conflict.region] || 0;\n    score += geoScore * 0.4;\n\n    // Cause preference score (40% weight)\n    const causeScores = conflict.affectedGroups.map(group => {\n      const causePrefs = vector.causePreferences as Record<string, number>;\n      return Object.entries(causePrefs)\n        .filter(([cause]) => group.toLowerCase().includes(cause.toLowerCase()))\n        .reduce((sum, [, value]) => sum + value, 0);\n    });\n    const avgCauseScore = causeScores.length > 0 \n      ? causeScores.reduce((a, b) => a + b, 0) / causeScores.length \n      : 0;\n    score += avgCauseScore * 0.4;\n\n    // Urgency match score (20% weight)\n    const severityScores: Record<string, number> = {\n      'critical': 1.0,\n      'severe': 0.75,\n      'moderate': 0.5,\n      'low': 0.25,\n    };\n    const conflictUrgency = severityScores[conflict.severityLevel.toLowerCase()] || 0.5;\n    const userUrgency = parseFloat(vector.urgencyPreference as string);\n    const urgencyMatch = 1 - Math.abs(conflictUrgency - userUrgency);\n    score += urgencyMatch * 0.2;\n\n    // Blend with quiz preferences if interaction count is low\n    if (vector.interactionCount < 20 && quizPreferences) {\n      const quizScore = this.scoreFromQuizPreferences(conflict, quizPreferences);\n      const behavioralWeight = Math.min(vector.interactionCount / 20, 1.0);\n      score = score * behavioralWeight + quizScore * (1 - behavioralWeight);\n    }\n\n    return score;\n  }\n\n  private scoreFromQuizPreferences(conflict: Conflict, quizPreferences: any): number {\n    let score = 0;\n\n    // Region match\n    if (quizPreferences.regions && quizPreferences.regions.includes(conflict.region)) {\n      score += 0.5;\n    }\n\n    // Cause match (if quiz had causes)\n    if (quizPreferences.causes) {\n      const matchingCauses = quizPreferences.causes.filter((cause: string) =>\n        conflict.affectedGroups.some(group => \n          group.toLowerCase().includes(cause.toLowerCase())\n        )\n      );\n      score += (matchingCauses.length / quizPreferences.causes.length) * 0.5;\n    }\n\n    return score;\n  }\n\n  private coldStartRecommendations(\n    conflicts: Conflict[],\n    quizPreferences?: any\n  ): Conflict[] {\n    if (!quizPreferences) {\n      // Pure cold start - show popular/recent conflicts\n      return conflicts.slice(0, 10);\n    }\n\n    // Score based on quiz preferences only\n    const scored = conflicts.map(conflict => ({\n      conflict,\n      score: this.scoreFromQuizPreferences(conflict, quizPreferences),\n    }));\n\n    scored.sort((a, b) => b.score - a.score);\n    return scored.map(s => s.conflict);\n  }\n\n  private applyTieredStrategy(\n    scoredConflicts: Array<{ conflict: Conflict; score: number }>\n  ): Conflict[] {\n    const result: Conflict[] = [];\n\n    // 60% highly matched (top scores)\n    const highMatchCount = Math.ceil(scoredConflicts.length * 0.6);\n    const highMatches = scoredConflicts.slice(0, highMatchCount);\n    result.push(...highMatches.map(s => s.conflict));\n\n    // 30% exploratory (mid-range scores)\n    const exploratoryCount = Math.ceil(scoredConflicts.length * 0.3);\n    const midStart = Math.floor(scoredConflicts.length * 0.2);\n    const midEnd = Math.floor(scoredConflicts.length * 0.8);\n    const exploratoryPool = scoredConflicts.slice(midStart, midEnd);\n    const exploratory = this.shuffle(exploratoryPool).slice(0, exploratoryCount);\n    result.push(...exploratory.map(s => s.conflict));\n\n    // 10% popular (based on donation activity - for now random from all)\n    const popularCount = Math.ceil(scoredConflicts.length * 0.1);\n    const popular = this.shuffle(scoredConflicts).slice(0, popularCount);\n    result.push(...popular.map(s => s.conflict));\n\n    // Shuffle the final result to mix tiers\n    return this.shuffle(result);\n  }\n\n  private shuffle<T>(array: T[]): T[] {\n    const shuffled = [...array];\n    for (let i = shuffled.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n    }\n    return shuffled;\n  }\n}\n\nexport const preferenceEngine = new PreferenceEngine();\n","size_bytes":11217},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"replit.md":{"content":"# AidAtlas - Humanitarian Donation Platform\n\n## Overview\n\nAidAtlas is a mobile-first humanitarian donation platform that gamifies charitable giving through a swipe-based interface. It connects users with curated conflict profiles and verified organizations, enabling them to track their global impact. The platform uses personalized recommendations and behavioral learning to align donors with humanitarian causes, featuring automated daily conflict scraping from trusted sources and verified real-world crisis data. AidAtlas also facilitates discovery and participation in advocacy campaigns.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Technology Stack:**\n- React with TypeScript (Vite)\n- Wouter for client-side routing\n- TanStack Query for server state management\n- Tailwind CSS with a custom design system\n- shadcn/ui component library (Radix UI primitives)\n\n**Design System:**\n- Typography: Inter (UI/body) and Fraunces (display/headlines)\n- Custom color system with HSL variables for light/dark mode\n- Consistent spacing, mobile-first responsive design\n\n**State Management:**\n- React Query for server state\n- Context API for authentication state\n- Local component state for UI interactions\n\n**Key Architectural Decisions:**\n- Component-based architecture\n- Separation of concerns\n- Custom hooks for authentication and notifications\n- Path aliases for source organization\n\n### Backend Architecture\n\n**Technology Stack:**\n- Node.js with Express.js\n- TypeScript with ES modules\n- Drizzle ORM for database interactions\n- bcrypt for password hashing\n- express-session for session management\n\n**API Design:**\n- RESTful endpoints\n- Session-based authentication with cookie-based management\n- Middleware pattern for authentication\n- Centralized storage abstraction layer\n\n**Personalization Engine:**\n- Tracks user swipe behavior (up/pass/down) and time spent\n- Updates preference vectors for geographic regions, causes, and demographics\n- Calculates engagement weight for behavioral learning\n\n**Key Architectural Decisions:**\n- Storage abstraction for database flexibility\n- In-memory session storage (production should use PostgreSQL)\n- Combines explicit user preferences with implicit behavioral learning\n- Seed data for initial database population\n\n### Data Storage\n\n**Database:** PostgreSQL via Neon serverless driver\n\n**ORM:** Drizzle ORM with a schema-first approach\n\n**Schema Design:**\n- **Core Tables:** `users`, `conflicts`, `organizations`, `donations`, `userEvents`, `userPreferenceVectors`\n- **Content Pipeline Tables:** `contentSources`, `scrapedContent`, `conflictApprovals`\n\n**Data Modeling Decisions:**\n- JSONB for flexible storage of preferences and dynamic data\n- UUID primary keys\n- Timestamp tracking for audit trails\n- Cascading deletes for related data\n- Separation of explicit and learned user preferences\n\n## External Dependencies\n\n**Database:**\n- **Neon Serverless PostgreSQL** - Cloud-hosted database.\n\n**UI Component Library:**\n- **shadcn/ui** - Built on Radix UI primitives for accessibility.\n\n**Typography:**\n- **Google Fonts API** - Inter and Fraunces font families.\n\n**Authentication:**\n- **express-session** - Cookie-based sessions.\n- **bcrypt** - Password hashing.\n- **connect-pg-simple** - PostgreSQL session store (planned).\n\n**Build Tools:**\n- **Vite** - Frontend build tool.\n- **esbuild** - Backend bundling.\n- **tsx** - TypeScript execution.\n\n**Development Tools:**\n- **Drizzle Kit** - Database migrations.\n\n**Content Pipeline:**\n- **ReliefWeb Scraper** - Fetches humanitarian reports from UN OCHA API.\n- **OpenAI Service** - Generates conflict profiles using GPT-4.\n- **Quality Control System** - Bias detection, sentiment analysis, fact-checking for content.\n\n**AI Content Generation:**\n- OpenAI GPT-4o-mini for AI-powered nonprofit research.\n\n**3D Visualization:**\n- **react-globe.gl** - Interactive 3D globe using WebGL and Three.js\n- **i18n-iso-countries** - Country name standardization\n- **world-atlas** - Geographic topology data\n- **topojson-client** - Topology data processing\n\n**Environment Variables:**\n- `DATABASE_URL`\n- `SESSION_SECRET`\n- `NODE_ENV`\n- `OPENAI_API_KEY`\n\n## Features\n\n### Interactive 3D Globe Visualization\n\nThe Impact page includes an interactive 3D globe that visualizes **global community impact** - showing ALL donation flows from ALL users across the platform:\n\n**Architecture:**\n- **DonationGlobe component**: Renders animated arcs showing donation flows between countries\n- **WebGL Detection**: Proactive capability check with graceful fallback for unsupported environments\n- **ErrorBoundary**: Defense-in-depth error handling for WebGL initialization failures\n- **Country Mapping**: Converts country names to geographic coordinates for visualization\n\n**Data Flow:**\n1. Backend API endpoint `/api/donations/geography` provides ALL donation flow data (not user-specific)\n2. Component maps donor and recipient countries to coordinates\n3. Globe renders animated green arcs from donor to recipient locations\n4. Auto-rotating Earth with night texture for visual appeal\n\n**Graceful Degradation:**\n- Proactive WebGL capability check (isWebGLAvailable utility)\n- Shows informative fallback message in non-WebGL environments\n- Maintains full Impact page functionality without globe support\n\n**Database Integration:**\n- `donations.donorCountry` field tracks donation origin (defaults to \"United States\")\n- Geography data includes: fromCountry, toCountry, amount, createdAt\n- 50 seeded global donations from 15 donor countries to 31 conflict regions for demo","size_bytes":5609},"client/src/components/examples/PreferenceQuiz.tsx":{"content":"import PreferenceQuiz from '../PreferenceQuiz';\n\nexport default function PreferenceQuizExample() {\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n      <PreferenceQuiz\n        onComplete={(preferences) => {\n          console.log('Quiz completed with preferences:', preferences);\n        }}\n      />\n    </div>\n  );\n}\n","size_bytes":367},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ConflictCard.tsx":{"content":"import { Heart, MapPin, Users, AlertCircle } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\n\ninterface ConflictCardProps {\n  country: string;\n  region: string;\n  title: string;\n  summary: string;\n  imageUrl: string | null;\n  affectedGroups: string[];\n  severityLevel: string;\n  onSupport: () => void;\n  onDetails: () => void;\n  onPass: () => void;\n}\n\nexport default function ConflictCard({\n  country,\n  region,\n  title,\n  summary,\n  imageUrl,\n  affectedGroups,\n  severityLevel,\n  onSupport,\n  onDetails,\n  onPass,\n}: ConflictCardProps) {\n  // Severity-based visual identity (respectful, muted colors)\n  const severityStyles = {\n    critical: {\n      background: \"bg-gradient-to-br from-red-900 to-red-950\",\n      badge: \"bg-red-700 text-white border-red-600\",\n    },\n    high: {\n      background: \"bg-gradient-to-br from-orange-800 to-orange-950\",\n      badge: \"bg-orange-600 text-white border-orange-500\",\n    },\n    moderate: {\n      background: \"bg-gradient-to-br from-amber-700 to-amber-900\",\n      badge: \"bg-amber-600 text-white border-amber-500\",\n    },\n  };\n\n  const severity = severityLevel.toLowerCase() as keyof typeof severityStyles;\n  const styles = severityStyles[severity] || severityStyles.moderate;\n\n  return (\n    <div className=\"w-full max-w-md mx-auto perspective-1000\">\n      <Card className=\"overflow-hidden shadow-2xl hover:shadow-primary/20 transition-all duration-500 hover:scale-[1.02] border-2\" data-testid=\"card-conflict\">\n        <div className={`relative h-96 group ${styles.background}`}>\n          {/* Subtle overlay for depth */}\n          <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent\" />\n          <div className=\"absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\" />\n          \n          {/* Large country name overlay for visual identity */}\n          <div className=\"absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none\">\n            <h2 className=\"text-8xl font-bold text-white font-display uppercase tracking-tight\">\n              {country.split('/')[0].split(' ')[0]}\n            </h2>\n          </div>\n          \n          <div className=\"absolute top-4 left-4 right-4 flex items-start justify-between gap-2\">\n            <Badge className={`${styles.badge} shadow-lg border`} data-testid=\"badge-severity\">\n              <AlertCircle className=\"h-3 w-3 mr-1\" />\n              {severityLevel} Priority\n            </Badge>\n            <div className=\"flex items-center gap-1 text-white text-xs bg-black/40 backdrop-blur-md px-3 py-1.5 rounded-full shadow-lg border border-white/30\">\n              <MapPin className=\"h-3 w-3\" />\n              {country}\n            </div>\n          </div>\n\n          <div className=\"absolute bottom-6 left-6 right-6 text-white\">\n            <p className=\"text-xs uppercase tracking-widest opacity-90 mb-2 font-medium\">{region}</p>\n            <h3 className=\"text-3xl font-bold mb-2 font-display leading-tight drop-shadow-2xl\">{title}</h3>\n          </div>\n        </div>\n\n        <div className=\"p-6 bg-gradient-to-b from-card to-background\">\n          <p className=\"text-base text-foreground leading-relaxed mb-5 line-clamp-3\">\n            {summary}\n          </p>\n          \n          <div className=\"flex items-center gap-2 mb-6 flex-wrap\">\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground font-medium\">\n              <Users className=\"h-4 w-4\" />\n              <span>Most Affected:</span>\n            </div>\n            {affectedGroups.slice(0, 3).map((group) => (\n              <Badge key={group} variant=\"secondary\" className=\"text-xs shadow-sm\" data-testid={`badge-group-${group}`}>\n                {group}\n              </Badge>\n            ))}\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"outline\"\n              size=\"default\"\n              onClick={onPass}\n              className=\"flex-1 group/btn\"\n              data-testid=\"button-pass\"\n            >\n              <span className=\"group-hover/btn:scale-110 transition-transform inline-block\">Pass</span>\n            </Button>\n            <Button\n              variant=\"secondary\"\n              size=\"default\"\n              onClick={onDetails}\n              className=\"flex-1\"\n              data-testid=\"button-details\"\n            >\n              Details\n            </Button>\n            <Button\n              variant=\"default\"\n              size=\"default\"\n              onClick={onSupport}\n              className=\"flex-1 bg-gradient-to-r from-primary to-chart-1 shadow-lg shadow-primary/30\"\n              data-testid=\"button-support\"\n            >\n              <Heart className=\"h-4 w-4 mr-2\" />\n              Support\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":5029},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/pages/Discover.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport Navigation from \"@/components/Navigation\";\nimport ConflictCard from \"@/components/ConflictCard\";\nimport DonationModal from \"@/components/DonationModal\";\nimport ConflictDetailsModal from \"@/components/ConflictDetailsModal\";\nimport PreferenceQuiz from \"@/components/PreferenceQuiz\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Conflict, Organization } from \"@shared/schema\";\n\ninterface PreferenceData {\n  causes: string[];\n  regions: string[];\n  donationRange: string;\n}\n\nexport default function Discover() {\n  const { user } = useAuth();\n  const [, navigate] = useLocation();\n  const [showQuiz, setShowQuiz] = useState(() => {\n    // If user is authenticated, use onboardingCompleted status\n    if (user) {\n      return !user.onboardingCompleted;\n    }\n    // For anonymous users, check localStorage to persist quiz dismissal\n    const anonymousQuizCompleted = localStorage.getItem('anonymousQuizCompleted');\n    return anonymousQuizCompleted !== 'true';\n  });\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [donationModalOpen, setDonationModalOpen] = useState(false);\n  const [detailsModalOpen, setDetailsModalOpen] = useState(false);\n  const [selectedConflict, setSelectedConflict] = useState<Conflict | null>(null);\n  const { toast } = useToast();\n  const cardViewStartTime = useRef<number>(Date.now());\n\n  // Use personalized endpoint if user is logged in\n  const { data: conflicts = [], isLoading, isError, error } = useQuery<Conflict[]>({\n    queryKey: user ? ['/api/conflicts/personalized'] : ['/api/conflicts'],\n    enabled: !showQuiz,\n    retry: 3, // Retry failed requests 3 times\n    retryDelay: 1000, // Wait 1 second between retries\n  });\n\n  // Track event mutation\n  const trackEventMutation = useMutation({\n    mutationFn: async (eventData: {\n      conflictId?: string;\n      organizationId?: string;\n      eventType: string;\n      eventData?: any;\n    }) => {\n      const res = await apiRequest('POST', '/api/events/track', eventData);\n      return await res.json();\n    },\n  });\n\n  const filteredConflicts = conflicts.filter((conflict: Conflict) => {\n    if (!user?.preferences) return true;\n    \n    const matchesRegion = user.preferences.regions.length === 0 || \n      user.preferences.regions.includes(conflict.region);\n    \n    return matchesRegion;\n  });\n\n  const displayConflicts = filteredConflicts.length > 0 ? filteredConflicts : conflicts;\n  const currentConflict = displayConflicts[currentIndex];\n\n  useEffect(() => {\n    if (user && !user.onboardingCompleted) {\n      setShowQuiz(true);\n    }\n  }, [user]);\n\n  useEffect(() => {\n    if (currentIndex >= displayConflicts.length && displayConflicts.length > 0) {\n      setCurrentIndex(0);\n    }\n  }, [displayConflicts.length, currentIndex]);\n\n  // Reset timer when card changes\n  useEffect(() => {\n    cardViewStartTime.current = Date.now();\n  }, [currentIndex]);\n\n  // Show warning toast if refresh fails but we have cached data\n  useEffect(() => {\n    if (isError && conflicts.length > 0) {\n      toast({\n        title: \"Using cached data\",\n        description: \"Couldn't refresh conflicts. Showing previously loaded data.\",\n        variant: \"default\",\n      });\n    }\n  }, [isError, conflicts.length, toast]);\n\n  const calculateTimeSpent = () => {\n    return Math.floor((Date.now() - cardViewStartTime.current) / 1000);\n  };\n\n  const { data: organizations = [], isLoading: orgsLoading, isError: orgsError } = useQuery<Organization[]>({\n    queryKey: ['/api/organizations'],\n    enabled: !!currentConflict,\n    retry: 3, // Retry failed requests 3 times\n    retryDelay: 1000, // Wait 1 second between retries\n  });\n\n  const savePreferencesMutation = useMutation({\n    mutationFn: async (preferences: PreferenceData) => {\n      const res = await apiRequest('PATCH', '/api/user/preferences', { preferences });\n      return await res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/me'] });\n      if (user) {\n        user.preferences = data.preferences;\n        user.onboardingCompleted = true;\n      }\n      setShowQuiz(false);\n      toast({\n        title: \"Preferences saved!\",\n        description: \"We'll show you causes that match your interests.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to save preferences. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createDonationMutation = useMutation({\n    mutationFn: async ({ organizationId, amount }: { organizationId: string; amount: number }) => {\n      const res = await apiRequest('POST', '/api/donations', {\n        organizationId,\n        conflictId: currentConflict ? currentConflict.id : '',\n        amount: amount.toString(),\n        type: 'one-time',\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/donations'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/user/impact'] });\n    },\n  });\n\n  const trackSwipe = (direction: 'up' | 'pass' | 'down') => {\n    if (!currentConflict) return;\n    \n    const timeSpent = calculateTimeSpent();\n    trackEventMutation.mutate({\n      conflictId: currentConflict.id,\n      eventType: `swipe_${direction}`,\n      eventData: {\n        swipeDirection: direction,\n        timeSpent,\n      },\n    });\n  };\n\n  const handleQuizComplete = (preferences: any) => {\n    // If user is not authenticated, just close the quiz and let them browse anonymously\n    if (!user) {\n      setShowQuiz(false);\n      localStorage.setItem('anonymousQuizCompleted', 'true'); // Persist quiz dismissal\n      toast({\n        title: \"Browsing anonymously\",\n        description: \"Sign up to save your preferences and track your impact!\",\n      });\n      return;\n    }\n    \n    const preferenceData: PreferenceData = {\n      causes: preferences.causes || [],\n      regions: preferences.regions || [],\n      donationRange: preferences.donationRange || '',\n    };\n    savePreferencesMutation.mutate(preferenceData);\n  };\n\n  // Show quiz first if needed (before checking conflicts)\n  if (showQuiz) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navigation />\n        <div className=\"pt-24 pb-12\">\n          <PreferenceQuiz onComplete={handleQuizComplete} />\n        </div>\n      </div>\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navigation />\n        <div className=\"pt-24 pb-12 px-6 flex items-center justify-center\">\n          <p className=\"text-muted-foreground\">Loading conflicts...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Error boundary: Only block if we have NO data at all (first load failure)\n  // If we have cached data, continue showing it with a toast warning (handled in useEffect above)\n  if (isError && conflicts.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navigation />\n        <div className=\"pt-24 pb-12 px-6 text-center max-w-md mx-auto\">\n          <h2 className=\"text-2xl font-bold mb-4\">Unable to Load Conflicts</h2>\n          <p className=\"text-muted-foreground mb-6\">\n            We're having trouble loading humanitarian causes right now. This could be a temporary network issue.\n          </p>\n          <Button \n            onClick={() => queryClient.invalidateQueries({ queryKey: user ? ['/api/conflicts/personalized'] : ['/api/conflicts'] })}\n            data-testid=\"button-retry-load\"\n          >\n            Try Again\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!currentConflict || displayConflicts.length === 0) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navigation />\n        <div className=\"pt-24 pb-12 px-6 text-center max-w-md mx-auto\">\n          <h2 className=\"text-2xl font-bold mb-4\">No Conflicts Available</h2>\n          <p className=\"text-muted-foreground\">\n            No conflicts match your current region preferences. Try adjusting your preferences or check back later.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  const handleSupport = () => {\n    trackSwipe('up');\n    // Navigate to Support page for this country\n    navigate(`/support/${encodeURIComponent(currentConflict.country)}`);\n  };\n\n  const handleDonationComplete = async (amount: number, orgIds: string[]) => {\n    const perOrgAmount = amount / orgIds.length;\n    \n    try {\n      await Promise.all(\n        orgIds.map((orgId) =>\n          createDonationMutation.mutateAsync({\n            organizationId: orgId,\n            amount: perOrgAmount,\n          })\n        )\n      );\n      \n      // Track donation event\n      trackEventMutation.mutate({\n        conflictId: currentConflict.id,\n        eventType: 'donate',\n        eventData: {\n          donationAmount: amount,\n          organizationIds: orgIds,\n        },\n      });\n      \n      toast({\n        title: \"Thank you for your donation!\",\n        description: `$${amount} donated to ${orgIds.length} organization(s)`,\n      });\n      handleNext();\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to process donation. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleNext = () => {\n    if (currentIndex < displayConflicts.length - 1) {\n      setCurrentIndex(currentIndex + 1);\n    } else {\n      toast({\n        title: \"You've seen all conflicts!\",\n        description: \"More causes will be added soon.\",\n      });\n    }\n  };\n\n  const handlePass = () => {\n    trackSwipe('pass');\n    handleNext();\n  };\n\n  const handleDetails = () => {\n    // Track view details event\n    if (currentConflict) {\n      trackEventMutation.mutate({\n        conflictId: currentConflict.id,\n        eventType: 'view_details',\n        eventData: {\n          timeSpent: calculateTimeSpent(),\n        },\n      });\n    }\n    \n    setSelectedConflict(currentConflict);\n    setDetailsModalOpen(true);\n  };\n\n  const handleDetailsSupport = () => {\n    // Navigate to Support page for AI-researched nonprofits\n    const target = selectedConflict ?? currentConflict;\n    if (target) {\n      setDetailsModalOpen(false);\n      navigate(`/support/${encodeURIComponent(target.country)}`);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Navigation />\n      \n      <div className=\"pt-24 pb-12 px-6 min-h-screen bg-gradient-to-b from-background via-muted/20 to-background\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"text-center mb-12\">\n            <div className=\"inline-block mb-4 px-4 py-2 rounded-full bg-primary/10 border border-primary/20\">\n              <p className=\"text-sm font-medium text-primary\">Personalized for you</p>\n            </div>\n            <h1 className=\"text-5xl font-display font-bold mb-3 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent\">\n              Discover Causes\n            </h1>\n            <p className=\"text-lg text-muted-foreground mb-2\">\n              Swipe through humanitarian crises and choose where to make an impact\n            </p>\n            <div className=\"flex items-center justify-center gap-2 mt-4\">\n              {displayConflicts.map((_, idx) => (\n                <div\n                  key={idx}\n                  className={`h-1.5 rounded-full transition-all duration-300 ${\n                    idx === currentIndex \n                      ? \"w-8 bg-primary\" \n                      : idx < currentIndex \n                        ? \"w-1.5 bg-chart-2\" \n                        : \"w-1.5 bg-muted\"\n                  }`}\n                  data-testid={`progress-dot-${idx}`}\n                />\n              ))}\n            </div>\n          </div>\n\n          <ConflictCard\n            {...currentConflict}\n            onSupport={handleSupport}\n            onDetails={handleDetails}\n            onPass={handlePass}\n          />\n\n          <div className=\"text-center mt-8\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setShowQuiz(true)}\n              data-testid=\"button-update-preferences\"\n              className=\"backdrop-blur-sm\"\n            >\n              Update Preferences\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {selectedConflict && (\n        <>\n          <DonationModal\n            open={donationModalOpen}\n            onClose={() => setDonationModalOpen(false)}\n            conflictTitle={selectedConflict.title}\n            organizations={organizations.filter(org => \n              org.countriesActive.includes(selectedConflict.country)\n            )}\n            onComplete={handleDonationComplete}\n          />\n\n          <ConflictDetailsModal\n            conflict={selectedConflict}\n            isOpen={detailsModalOpen}\n            onClose={() => setDetailsModalOpen(false)}\n            onSupport={handleDetailsSupport}\n          />\n        </>\n      )}\n    </div>\n  );\n}\n","size_bytes":13242},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/neon-serverless\";\nimport { Pool, neonConfig } from \"@neondatabase/serverless\";\nimport * as schema from \"@shared/schema\";\nimport ws from \"ws\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL environment variable is required\");\n}\n\n// Configure WebSocket for Neon\nneonConfig.webSocketConstructor = ws;\n\nconst pool = new Pool({ \n  connectionString: process.env.DATABASE_URL\n});\nexport const db = drizzle(pool, { schema });\n","size_bytes":474},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/Hero.tsx":{"content":"import { ArrowRight } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface HeroProps {\n  onGetStarted: () => void;\n  onLearnMore: () => void;\n}\n\nexport default function Hero({ onGetStarted, onLearnMore }: HeroProps) {\n  return (\n    <div className=\"relative h-[85vh] flex items-center justify-center overflow-hidden\">\n      <div \n        className=\"absolute inset-0 bg-cover bg-center scale-110 animate-[zoom_20s_ease-in-out_infinite]\"\n        style={{\n          backgroundImage: `url('https://images.unsplash.com/photo-1488521787991-ed7bbaae773c?w=1920&q=80')`,\n        }}\n      />\n      <div className=\"absolute inset-0 bg-gradient-to-br from-primary/40 via-black/60 to-black/80\" />\n      <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_70%_70%,rgba(59,130,246,0.15),transparent_50%)]\" />\n      \n      <div className=\"relative z-10 max-w-5xl mx-auto px-6 text-center text-white\">\n        <div className=\"inline-block mb-6 px-4 py-2 rounded-full bg-white/10 backdrop-blur-md border border-white/20\">\n          <p className=\"text-sm font-medium\">🌍 Making humanitarian giving simple & impactful</p>\n        </div>\n        <h1 className=\"text-6xl md:text-8xl font-display font-bold mb-6 leading-tight\" data-testid=\"text-hero-title\">\n          Support Where It\n          <br />\n          <span className=\"bg-gradient-to-r from-white via-blue-100 to-white bg-clip-text text-transparent\">\n            Matters Most\n          </span>\n        </h1>\n        <p className=\"text-xl md:text-2xl mb-10 text-white/90 max-w-3xl mx-auto leading-relaxed\">\n          Swipe through curated humanitarian crises, discover verified organizations, and watch your impact grow across conflict zones worldwide.\n        </p>\n        <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\n          <Button\n            size=\"lg\"\n            onClick={onGetStarted}\n            className=\"text-lg px-10 py-6 bg-white text-primary hover:bg-white/90 shadow-2xl shadow-primary/20 border-0 h-auto\"\n            data-testid=\"button-get-started\"\n          >\n            Start Discovering\n            <ArrowRight className=\"ml-2 h-5 w-5\" />\n          </Button>\n          <Button\n            size=\"lg\"\n            variant=\"outline\"\n            onClick={onLearnMore}\n            className=\"text-lg px-10 py-6 bg-white/10 backdrop-blur-md border-white/30 text-white hover:bg-white/20 h-auto\"\n            data-testid=\"button-learn-more\"\n          >\n            How It Works\n          </Button>\n        </div>\n        \n        <div className=\"mt-16 flex items-center justify-center gap-12 text-sm\">\n          <div className=\"text-center\">\n            <p className=\"text-3xl font-display font-bold mb-1\">2.8M+</p>\n            <p className=\"text-white/70\">Donated</p>\n          </div>\n          <div className=\"h-12 w-px bg-white/20\" />\n          <div className=\"text-center\">\n            <p className=\"text-3xl font-display font-bold mb-1\">156K+</p>\n            <p className=\"text-white/70\">People Helped</p>\n          </div>\n          <div className=\"h-12 w-px bg-white/20\" />\n          <div className=\"text-center\">\n            <p className=\"text-3xl font-display font-bold mb-1\">47</p>\n            <p className=\"text-white/70\">Organizations</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3336},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"server/content-preprocessor.ts":{"content":"import nlp from 'compromise';\n// @ts-ignore - No type definitions available for sentiment\nimport Sentiment from 'sentiment';\n\nexport interface ScrapedArticle {\n  title: string;\n  body: string;\n  source: string;\n  url?: string;\n  date?: string;\n  credibility: 'verified_un' | 'verified_academic' | 'news_media';\n}\n\nexport interface ProcessedArticle extends ScrapedArticle {\n  entities: {\n    locations: string[];\n    organizations: string[];\n    persons: string[];\n    dates: string[];\n  };\n  readability: number;\n  sentiment: 'positive' | 'negative' | 'neutral';\n  wordCount: number;\n  keyPhrases: string[];\n}\n\nexport class ContentPreprocessor {\n  private sentiment: typeof Sentiment;\n\n  constructor() {\n    this.sentiment = new Sentiment();\n  }\n\n  /**\n   * Preprocess a single article: clean, analyze, extract entities\n   */\n  preprocessArticle(article: ScrapedArticle): ProcessedArticle {\n    // Clean HTML and excessive whitespace\n    const cleanedBody = this.cleanText(article.body);\n    \n    // Extract entities using compromise\n    const entities = this.extractEntities(cleanedBody);\n    \n    // Calculate readability score\n    const readability = this.calculateReadability(cleanedBody);\n    \n    // Analyze sentiment\n    const sentimentScore = this.analyzeSentiment(cleanedBody);\n    \n    // Extract key phrases\n    const keyPhrases = this.extractKeyPhrases(cleanedBody);\n    \n    // Count words\n    const wordCount = cleanedBody.split(/\\s+/).length;\n\n    return {\n      ...article,\n      body: cleanedBody,\n      entities,\n      readability,\n      sentiment: sentimentScore,\n      wordCount,\n      keyPhrases,\n    };\n  }\n\n  /**\n   * Preprocess multiple articles\n   */\n  preprocessArticles(articles: ScrapedArticle[]): ProcessedArticle[] {\n    return articles.map(article => this.preprocessArticle(article));\n  }\n\n  /**\n   * Clean text: remove HTML, excessive whitespace\n   */\n  private cleanText(text: string): string {\n    // Remove HTML tags (basic)\n    let cleaned = text.replace(/<[^>]*>/g, ' ');\n    \n    // Remove excessive whitespace\n    cleaned = cleaned.replace(/\\s+/g, ' ').trim();\n    \n    // Remove URLs\n    cleaned = cleaned.replace(/https?:\\/\\/[^\\s]+/g, '');\n    \n    return cleaned;\n  }\n\n  /**\n   * Extract named entities using compromise\n   */\n  private extractEntities(text: string) {\n    const doc = nlp(text);\n    \n    // Extract locations (places, countries, cities)\n    const locations = doc.places().out('array') as string[];\n    \n    // Extract organizations\n    const organizations = doc.organizations().out('array') as string[];\n    \n    // Extract people\n    const persons = doc.people().out('array') as string[];\n    \n    // Extract dates (compromise doesn't have .dates() method, use custom extraction)\n    const dateMatches = text.match(/\\d{1,2}\\/\\d{1,2}\\/\\d{2,4}|\\d{4}-\\d{2}-\\d{2}|(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]* \\d{1,2},? \\d{4}/gi) || [];\n    \n    return {\n      locations: Array.from(new Set(locations)).slice(0, 10), // Dedupe and limit\n      organizations: Array.from(new Set(organizations)).slice(0, 10),\n      persons: Array.from(new Set(persons)).slice(0, 10),\n      dates: Array.from(new Set(dateMatches)).slice(0, 5),\n    };\n  }\n\n  /**\n   * Calculate Flesch Reading Ease score\n   */\n  private calculateReadability(text: string): number {\n    const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);\n    const words = text.split(/\\s+/).filter(w => w.length > 0);\n    const syllables = words.reduce((sum, word) => sum + this.countSyllables(word), 0);\n    \n    if (sentences.length === 0 || words.length === 0) {\n      return 0;\n    }\n    \n    const avgWordsPerSentence = words.length / sentences.length;\n    const avgSyllablesPerWord = syllables / words.length;\n    \n    // Flesch Reading Ease formula\n    const score = 206.835 - (1.015 * avgWordsPerSentence) - (84.6 * avgSyllablesPerWord);\n    \n    // Clamp between 0-100\n    return Math.max(0, Math.min(100, Math.round(score)));\n  }\n\n  /**\n   * Count syllables in a word (simplified)\n   */\n  private countSyllables(word: string): number {\n    word = word.toLowerCase().replace(/[^a-z]/g, '');\n    if (word.length === 0) return 0;\n    \n    const vowels = 'aeiouy';\n    let syllableCount = 0;\n    let previousWasVowel = false;\n    \n    for (const char of word) {\n      const isVowel = vowels.includes(char);\n      if (isVowel && !previousWasVowel) {\n        syllableCount++;\n      }\n      previousWasVowel = isVowel;\n    }\n    \n    // Adjust for silent 'e'\n    if (word.endsWith('e') && syllableCount > 1) {\n      syllableCount--;\n    }\n    \n    return Math.max(1, syllableCount);\n  }\n\n  /**\n   * Analyze sentiment using sentiment library\n   */\n  private analyzeSentiment(text: string): 'positive' | 'negative' | 'neutral' {\n    // Limit text length for performance\n    const limitedText = text.slice(0, 5000);\n    \n    const result = this.sentiment.analyze(limitedText);\n    const score = result.score;\n    \n    if (score > 1) {\n      return 'positive';\n    } else if (score < -1) {\n      return 'negative';\n    } else {\n      return 'neutral';\n    }\n  }\n\n  /**\n   * Extract key phrases using compromise\n   */\n  private extractKeyPhrases(text: string): string[] {\n    const doc = nlp(text);\n    \n    // Extract noun phrases\n    const nounPhrases = doc.nouns().out('array') as string[];\n    \n    // Extract important terms (people, places, orgs)\n    const terms = doc.terms().out('array') as string[];\n    \n    // Combine and dedupe\n    const allPhrases = [...nounPhrases, ...terms];\n    const uniquePhrases = Array.from(new Set(allPhrases));\n    \n    // Filter out common words and sort by length (longer phrases often more meaningful)\n    const filtered = uniquePhrases\n      .filter(phrase => phrase.length > 3 && phrase.split(' ').length <= 4)\n      .sort((a, b) => b.length - a.length)\n      .slice(0, 20);\n    \n    return filtered;\n  }\n\n  /**\n   * Aggregate multiple articles into a context summary\n   */\n  aggregateArticles(articles: ProcessedArticle[]): {\n    allEntities: ProcessedArticle['entities'];\n    avgReadability: number;\n    sentimentDistribution: Record<string, number>;\n    totalWordCount: number;\n    topKeyPhrases: string[];\n    sources: string[];\n  } {\n    // Combine all entities\n    const allEntities = {\n      locations: [] as string[],\n      organizations: [] as string[],\n      persons: [] as string[],\n      dates: [] as string[],\n    };\n    \n    articles.forEach(article => {\n      allEntities.locations.push(...article.entities.locations);\n      allEntities.organizations.push(...article.entities.organizations);\n      allEntities.persons.push(...article.entities.persons);\n      allEntities.dates.push(...article.entities.dates);\n    });\n    \n    // Deduplicate and limit\n    allEntities.locations = Array.from(new Set(allEntities.locations)).slice(0, 20);\n    allEntities.organizations = Array.from(new Set(allEntities.organizations)).slice(0, 15);\n    allEntities.persons = Array.from(new Set(allEntities.persons)).slice(0, 15);\n    allEntities.dates = Array.from(new Set(allEntities.dates)).slice(0, 10);\n    \n    // Calculate average readability\n    const avgReadability = articles.length > 0\n      ? Math.round(articles.reduce((sum, a) => sum + a.readability, 0) / articles.length)\n      : 0;\n    \n    // Sentiment distribution\n    const sentimentDistribution = {\n      positive: articles.filter(a => a.sentiment === 'positive').length,\n      negative: articles.filter(a => a.sentiment === 'negative').length,\n      neutral: articles.filter(a => a.sentiment === 'neutral').length,\n    };\n    \n    // Total word count\n    const totalWordCount = articles.reduce((sum, a) => sum + a.wordCount, 0);\n    \n    // Aggregate key phrases\n    const allKeyPhrases = articles.flatMap(a => a.keyPhrases);\n    const phraseFrequency = allKeyPhrases.reduce((acc, phrase) => {\n      acc[phrase] = (acc[phrase] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n    \n    const topKeyPhrases = Object.entries(phraseFrequency)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 30)\n      .map(([phrase]) => phrase);\n    \n    // List of sources\n    const sources = Array.from(new Set(articles.map(a => a.source)));\n    \n    return {\n      allEntities,\n      avgReadability,\n      sentimentDistribution,\n      totalWordCount,\n      topKeyPhrases,\n      sources,\n    };\n  }\n}\n","size_bytes":8344},"server/action-matcher.ts":{"content":"import type { Action, UserPreferenceVector } from \"@shared/schema\";\n\ninterface ActionScore {\n  action: Action;\n  score: number;\n  reasons: string[];\n}\n\ninterface UserPreferences {\n  regions?: string[];\n  causes?: string[];\n  demographics?: string[];\n  location?: string;\n}\n\nexport class ActionMatcher {\n  /**\n   * Calculate how well an action matches a user's preferences\n   * Returns a score from 0-100 and reasons for the match\n   */\n  scoreAction(\n    action: Action,\n    userPreferences: UserPreferences,\n    preferenceVector?: UserPreferenceVector\n  ): ActionScore {\n    let score = 0;\n    const reasons: string[] = [];\n\n    // 1. Geographic match (30 points max)\n    if (userPreferences.regions && action.country) {\n      const regionMatch = userPreferences.regions.some(region => \n        action.country?.toLowerCase().includes(region.toLowerCase())\n      );\n      if (regionMatch) {\n        score += 30;\n        reasons.push(`Location match: ${action.country}`);\n      }\n    }\n\n    // 2. Location proximity match (20 points max)\n    if (userPreferences.location) {\n      const actionCity = action.city?.trim();\n      const actionAddress = action.address?.trim();\n      \n      // Only check if action has actual location data\n      if (actionCity || actionAddress) {\n        const actionLocation = `${actionCity || ''} ${actionAddress || ''}`.toLowerCase().trim();\n        const userLocation = userPreferences.location.toLowerCase().trim();\n        \n        // Ensure we're not matching empty strings\n        if (actionLocation && userLocation) {\n          const locationMatch = actionLocation.includes(userLocation) || \n                               userLocation.includes(actionLocation);\n          if (locationMatch) {\n            score += 20;\n            reasons.push(`Near you: ${actionCity || actionAddress}`);\n          }\n        }\n      }\n    }\n\n    // 3. Tag/cause alignment (30 points max)\n    if (userPreferences.causes && action.tags) {\n      const actionTags = Array.isArray(action.tags) ? action.tags : [];\n      const causeMatch = userPreferences.causes.some(cause =>\n        actionTags.some((tag: string) => \n          tag.toLowerCase().includes(cause.toLowerCase())\n        )\n      );\n      if (causeMatch) {\n        score += 30;\n        const matchedTags = actionTags.filter((tag: string) =>\n          userPreferences.causes?.some(cause => \n            tag.toLowerCase().includes(cause.toLowerCase())\n          )\n        );\n        reasons.push(`Cause match: ${matchedTags.join(', ')}`);\n      }\n    }\n\n    // 4. Related conflicts alignment (10 points max)\n    // This checks if the action is related to conflicts the user cares about\n    if (action.relatedConflicts && Array.isArray(action.relatedConflicts) && action.relatedConflicts.length > 0) {\n      score += 10;\n      reasons.push(`Related to humanitarian conflicts`);\n    }\n\n    // 5. Behavioral learning bonus (10 points max)\n    if (preferenceVector) {\n      // Add bonus based on learned preferences\n      const regionBonus = this.calculateVectorBonus(\n        action.country || '',\n        preferenceVector.geoPreferences || {}\n      );\n      \n      // Check tags against cause preferences\n      let causeBonus = 0;\n      if (action.tags && Array.isArray(action.tags)) {\n        causeBonus = Math.max(\n          ...action.tags.map((tag: string) =>\n            this.calculateVectorBonus(tag, preferenceVector.causePreferences || {})\n          )\n        );\n      }\n      \n      const behaviorBonus = Math.min(10, (regionBonus + causeBonus) / 2);\n      if (behaviorBonus > 0) {\n        score += behaviorBonus;\n        reasons.push(`Matches your behavior patterns`);\n      }\n    }\n\n    // 6. Urgency bonus for upcoming actions (max 10 points)\n    if (action.startTime) {\n      const daysUntil = Math.floor(\n        (new Date(action.startTime).getTime() - Date.now()) / (1000 * 60 * 60 * 24)\n      );\n      if (daysUntil >= 0 && daysUntil <= 7) {\n        score += 10;\n        reasons.push(`Happening soon`);\n      } else if (daysUntil > 7 && daysUntil <= 30) {\n        score += 5;\n      }\n    }\n\n    return { action, score, reasons };\n  }\n\n  /**\n   * Calculate bonus score based on preference vector weights\n   */\n  private calculateVectorBonus(\n    value: string,\n    weights: Record<string, number>\n  ): number {\n    const valueLower = value.toLowerCase();\n    let maxWeight = 0;\n\n    for (const [key, weight] of Object.entries(weights)) {\n      if (valueLower.includes(key.toLowerCase()) && weight > maxWeight) {\n        maxWeight = weight;\n      }\n    }\n\n    // Convert weight to 0-5 scale\n    return Math.min(5, maxWeight * 5);\n  }\n\n  /**\n   * Rank actions by relevance to user\n   */\n  rankActions(\n    actions: Action[],\n    userPreferences: UserPreferences,\n    preferenceVector?: UserPreferenceVector\n  ): ActionScore[] {\n    const scored = actions.map(action =>\n      this.scoreAction(action, userPreferences, preferenceVector)\n    );\n\n    // Sort by score (highest first)\n    return scored.sort((a, b) => b.score - a.score);\n  }\n\n  /**\n   * Get top N recommended actions\n   */\n  getTopRecommendations(\n    actions: Action[],\n    userPreferences: UserPreferences,\n    preferenceVector?: UserPreferenceVector,\n    limit: number = 10\n  ): ActionScore[] {\n    const ranked = this.rankActions(actions, userPreferences, preferenceVector);\n    return ranked.slice(0, limit);\n  }\n\n  /**\n   * Filter actions by minimum score threshold\n   */\n  filterByScore(\n    actions: Action[],\n    userPreferences: UserPreferences,\n    preferenceVector?: UserPreferenceVector,\n    minScore: number = 20\n  ): ActionScore[] {\n    const ranked = this.rankActions(actions, userPreferences, preferenceVector);\n    return ranked.filter(item => item.score >= minScore);\n  }\n}\n\nexport const actionMatcher = new ActionMatcher();\n","size_bytes":5790},"server/badge-service.ts":{"content":"import { storage } from \"./storage\";\nimport type { InsertUserBadge, Donation, Conflict, Organization } from \"@shared/schema\";\n\ninterface BadgeDefinition {\n  type: string;\n  name: string;\n  description: string;\n  icon: string;\n  checkCriteria: (userId: string, cachedData?: CachedBadgeData) => Promise<boolean>;\n}\n\ninterface CachedBadgeData {\n  donations: Donation[];\n  conflicts: Map<string, Conflict>;\n  organizations: Map<string, Organization>;\n  stats: {\n    totalDonated: number;\n    peopleHelped: number;\n    organizationsSupported: number;\n    conflictsSupported: number;\n  };\n  participatedActions: any[];\n}\n\nexport class BadgeService {\n  private badges: BadgeDefinition[] = [\n    {\n      type: \"first_donation\",\n      name: \"First Step\",\n      description: \"Made your first donation\",\n      icon: \"Star\",\n      checkCriteria: async (userId, cachedData) => {\n        const donations = cachedData?.donations ?? await storage.getDonations(userId);\n        return donations.length >= 1;\n      },\n    },\n    {\n      type: \"donation_5\",\n      name: \"Helping Hand\",\n      description: \"Made 5 donations\",\n      icon: \"Hand\",\n      checkCriteria: async (userId, cachedData) => {\n        const donations = cachedData?.donations ?? await storage.getDonations(userId);\n        return donations.length >= 5;\n      },\n    },\n    {\n      type: \"donation_10\",\n      name: \"Dedicated Donor\",\n      description: \"Made 10 donations\",\n      icon: \"Heart\",\n      checkCriteria: async (userId, cachedData) => {\n        const donations = cachedData?.donations ?? await storage.getDonations(userId);\n        return donations.length >= 10;\n      },\n    },\n    {\n      type: \"donation_25\",\n      name: \"Champion of Change\",\n      description: \"Made 25 donations\",\n      icon: \"Trophy\",\n      checkCriteria: async (userId, cachedData) => {\n        const donations = cachedData?.donations ?? await storage.getDonations(userId);\n        return donations.length >= 25;\n      },\n    },\n    {\n      type: \"donation_50\",\n      name: \"Humanitarian Hero\",\n      description: \"Made 50 donations\",\n      icon: \"Award\",\n      checkCriteria: async (userId, cachedData) => {\n        const donations = cachedData?.donations ?? await storage.getDonations(userId);\n        return donations.length >= 50;\n      },\n    },\n    {\n      type: \"total_100\",\n      name: \"Century Club\",\n      description: \"Donated $100 or more in total\",\n      icon: \"DollarSign\",\n      checkCriteria: async (userId, cachedData) => {\n        const stats = cachedData?.stats ?? await storage.getUserImpactStats(userId);\n        return stats.totalDonated >= 100;\n      },\n    },\n    {\n      type: \"total_500\",\n      name: \"Major Donor\",\n      description: \"Donated $500 or more in total\",\n      icon: \"Gem\",\n      checkCriteria: async (userId, cachedData) => {\n        const stats = cachedData?.stats ?? await storage.getUserImpactStats(userId);\n        return stats.totalDonated >= 500;\n      },\n    },\n    {\n      type: \"total_1000\",\n      name: \"Platinum Philanthropist\",\n      description: \"Donated $1,000 or more in total\",\n      icon: \"Crown\",\n      checkCriteria: async (userId, cachedData) => {\n        const stats = cachedData?.stats ?? await storage.getUserImpactStats(userId);\n        return stats.totalDonated >= 1000;\n      },\n    },\n    {\n      type: \"streak_3\",\n      name: \"Consistent Giver\",\n      description: \"Maintained a 3-month donation streak\",\n      icon: \"Flame\",\n      checkCriteria: async (userId, cachedData) => {\n        const streak = await this.calculateCurrentStreak(userId, cachedData);\n        return streak >= 3;\n      },\n    },\n    {\n      type: \"streak_6\",\n      name: \"Committed Supporter\",\n      description: \"Maintained a 6-month donation streak\",\n      icon: \"Sparkles\",\n      checkCriteria: async (userId, cachedData) => {\n        const streak = await this.calculateCurrentStreak(userId, cachedData);\n        return streak >= 6;\n      },\n    },\n    {\n      type: \"streak_12\",\n      name: \"Year of Impact\",\n      description: \"Maintained a 12-month donation streak\",\n      icon: \"Globe\",\n      checkCriteria: async (userId, cachedData) => {\n        const streak = await this.calculateCurrentStreak(userId, cachedData);\n        return streak >= 12;\n      },\n    },\n    {\n      type: \"countries_3\",\n      name: \"Global Citizen\",\n      description: \"Supported causes in 3 different countries\",\n      icon: \"MapPin\",\n      checkCriteria: async (userId, cachedData) => {\n        const countries = await this.getUniqueCountries(userId, cachedData);\n        return countries >= 3;\n      },\n    },\n    {\n      type: \"countries_5\",\n      name: \"Worldly Supporter\",\n      description: \"Supported causes in 5 different countries\",\n      icon: \"Map\",\n      checkCriteria: async (userId, cachedData) => {\n        const countries = await this.getUniqueCountries(userId, cachedData);\n        return countries >= 5;\n      },\n    },\n    {\n      type: \"countries_10\",\n      name: \"International Impact\",\n      description: \"Supported causes in 10 different countries\",\n      icon: \"Earth\",\n      checkCriteria: async (userId, cachedData) => {\n        const countries = await this.getUniqueCountries(userId, cachedData);\n        return countries >= 10;\n      },\n    },\n    {\n      type: \"causes_3\",\n      name: \"Well-Rounded Helper\",\n      description: \"Supported 3 different causes\",\n      icon: \"Target\",\n      checkCriteria: async (userId, cachedData) => {\n        const causes = await this.getUniqueCauses(userId, cachedData);\n        return causes >= 3;\n      },\n    },\n    {\n      type: \"causes_5\",\n      name: \"Diverse Donor\",\n      description: \"Supported 5 different causes\",\n      icon: \"Palette\",\n      checkCriteria: async (userId, cachedData) => {\n        const causes = await this.getUniqueCauses(userId, cachedData);\n        return causes >= 5;\n      },\n    },\n    {\n      type: \"orgs_5\",\n      name: \"Network Builder\",\n      description: \"Supported 5 different organizations\",\n      icon: \"Network\",\n      checkCriteria: async (userId, cachedData) => {\n        const stats = cachedData?.stats ?? await storage.getUserImpactStats(userId);\n        return stats.organizationsSupported >= 5;\n      },\n    },\n    {\n      type: \"orgs_10\",\n      name: \"Coalition Champion\",\n      description: \"Supported 10 different organizations\",\n      icon: \"Users\",\n      checkCriteria: async (userId, cachedData) => {\n        const stats = cachedData?.stats ?? await storage.getUserImpactStats(userId);\n        return stats.organizationsSupported >= 10;\n      },\n    },\n    {\n      type: \"action_participant\",\n      name: \"Activist\",\n      description: \"Participated in your first action\",\n      icon: \"Megaphone\",\n      checkCriteria: async (userId, cachedData) => {\n        const actions = cachedData?.participatedActions ?? await storage.getUserParticipatedActions(userId, 100);\n        return actions.length >= 1;\n      },\n    },\n    {\n      type: \"action_5\",\n      name: \"Action Hero\",\n      description: \"Participated in 5 actions\",\n      icon: \"Zap\",\n      checkCriteria: async (userId, cachedData) => {\n        const actions = cachedData?.participatedActions ?? await storage.getUserParticipatedActions(userId, 100);\n        return actions.length >= 5;\n      },\n    },\n  ];\n\n  async checkAndAwardBadges(userId: string): Promise<InsertUserBadge[]> {\n    const awardedBadges: InsertUserBadge[] = [];\n\n    const cachedData = await this.fetchCachedData(userId);\n\n    for (const badge of this.badges) {\n      const hasBadge = await storage.hasBadge(userId, badge.type);\n      \n      if (!hasBadge) {\n        const meetsCriteria = await badge.checkCriteria(userId, cachedData);\n        \n        if (meetsCriteria) {\n          const newBadge: InsertUserBadge = {\n            userId,\n            badgeType: badge.type,\n            badgeName: badge.name,\n            badgeIcon: badge.icon,\n            badgeDescription: badge.description,\n          };\n          \n          await storage.awardBadge(newBadge);\n          awardedBadges.push(newBadge);\n        }\n      }\n    }\n\n    return awardedBadges;\n  }\n\n  private async fetchCachedData(userId: string): Promise<CachedBadgeData> {\n    const donations = await storage.getDonations(userId);\n    \n    const conflictIds = [...new Set(donations.map(d => d.conflictId))];\n    const organizationIds = [...new Set(donations.map(d => d.organizationId))];\n    \n    const conflicts = new Map<string, Conflict>();\n    for (const id of conflictIds) {\n      const conflict = await storage.getConflict(id);\n      if (conflict) conflicts.set(id, conflict);\n    }\n    \n    const organizations = new Map<string, Organization>();\n    for (const id of organizationIds) {\n      const org = await storage.getOrganization(id);\n      if (org) organizations.set(id, org);\n    }\n    \n    const stats = await storage.getUserImpactStats(userId);\n    const participatedActions = await storage.getUserParticipatedActions(userId, 100);\n    \n    return {\n      donations,\n      conflicts,\n      organizations,\n      stats,\n      participatedActions,\n    };\n  }\n\n  async checkSpecificBadge(userId: string, badgeType: string): Promise<boolean> {\n    const badge = this.badges.find(b => b.type === badgeType);\n    if (!badge) return false;\n\n    const hasBadge = await storage.hasBadge(userId, badgeType);\n    if (hasBadge) return false;\n\n    const meetsCriteria = await badge.checkCriteria(userId);\n    \n    if (meetsCriteria) {\n      await storage.awardBadge({\n        userId,\n        badgeType: badge.type,\n        badgeName: badge.name,\n        badgeIcon: badge.icon,\n        badgeDescription: badge.description,\n      });\n      return true;\n    }\n\n    return false;\n  }\n\n  async getAllBadgeDefinitions() {\n    return this.badges.map(b => ({\n      type: b.type,\n      name: b.name,\n      description: b.description,\n      icon: b.icon,\n    }));\n  }\n\n  private async calculateCurrentStreak(userId: string, cachedData?: CachedBadgeData): Promise<number> {\n    const donations = cachedData?.donations ?? await storage.getDonations(userId);\n    \n    if (donations.length === 0) return 0;\n\n    const monthsWithDonations = new Set<string>();\n    donations.forEach(d => {\n      const month = new Date(d.createdAt!).toISOString().substring(0, 7);\n      monthsWithDonations.add(month);\n    });\n\n    const currentMonth = new Date().toISOString().substring(0, 7);\n    if (!monthsWithDonations.has(currentMonth)) {\n      return 0;\n    }\n\n    let streak = 1;\n    let checkDate = new Date();\n    \n    for (let i = 1; i < 24; i++) {\n      checkDate.setMonth(checkDate.getMonth() - 1);\n      const checkMonth = checkDate.toISOString().substring(0, 7);\n      \n      if (monthsWithDonations.has(checkMonth)) {\n        streak++;\n      } else {\n        break;\n      }\n    }\n\n    return streak;\n  }\n\n  private async getUniqueCountries(userId: string, cachedData?: CachedBadgeData): Promise<number> {\n    const donations = cachedData?.donations ?? await storage.getDonations(userId);\n    const conflicts = cachedData?.conflicts ?? new Map<string, Conflict>();\n    const countries = new Set<string>();\n\n    for (const donation of donations) {\n      let conflict = conflicts.get(donation.conflictId);\n      if (!conflict) {\n        conflict = await storage.getConflict(donation.conflictId);\n      }\n      if (conflict) {\n        countries.add(conflict.country);\n      }\n    }\n\n    return countries.size;\n  }\n\n  private async getUniqueCauses(userId: string, cachedData?: CachedBadgeData): Promise<number> {\n    const donations = cachedData?.donations ?? await storage.getDonations(userId);\n    const organizations = cachedData?.organizations ?? new Map<string, Organization>();\n    const causes = new Set<string>();\n\n    for (const donation of donations) {\n      let org = organizations.get(donation.organizationId);\n      if (!org) {\n        org = await storage.getOrganization(donation.organizationId);\n      }\n      if (org && org.causes) {\n        org.causes.forEach(cause => causes.add(cause));\n      }\n    }\n\n    return causes.size;\n  }\n}\n\nexport const badgeService = new BadgeService();\n","size_bytes":12046},"client/src/pages/Admin.tsx":{"content":"import { useState } from \"react\";\nimport Navigation from \"@/components/Navigation\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { ConflictApproval } from \"@shared/schema\";\nimport { PlayCircle, Loader2, CheckCircle, XCircle, AlertCircle } from \"lucide-react\";\n\nexport default function Admin() {\n  const { toast } = useToast();\n  const [reviewNotes, setReviewNotes] = useState<Record<string, string>>({});\n\n  const { data: approvals = [], isLoading } = useQuery<ConflictApproval[]>({\n    queryKey: ['/api/admin/approvals/pending'],\n  });\n\n  const runPipelineMutation = useMutation({\n    mutationFn: async ({ daysBack = 7 }: { daysBack?: number }) => {\n      const res = await apiRequest('POST', '/api/pipeline/run', { daysBack });\n      return await res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/approvals/pending'] });\n      toast({\n        title: \"Pipeline Complete!\",\n        description: data.message,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Pipeline Failed\",\n        description: \"Failed to run content pipeline\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: async ({ id, notes }: { id: string; notes?: string }) => {\n      const res = await apiRequest('POST', `/api/admin/approvals/${id}/approve`, { notes });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/approvals/pending'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/conflicts'] });\n      toast({\n        title: \"Conflict Approved!\",\n        description: \"The conflict profile has been published.\",\n      });\n    },\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: async ({ id, notes }: { id: string; notes?: string }) => {\n      const res = await apiRequest('POST', `/api/admin/approvals/${id}/reject`, { notes });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/approvals/pending'] });\n      toast({\n        title: \"Conflict Rejected\",\n        description: \"The conflict profile has been rejected.\",\n      });\n    },\n  });\n\n  const handleApprove = (approvalId: string) => {\n    approveMutation.mutate({ \n      id: approvalId, \n      notes: reviewNotes[approvalId] \n    });\n  };\n\n  const handleReject = (approvalId: string) => {\n    rejectMutation.mutate({ \n      id: approvalId, \n      notes: reviewNotes[approvalId] \n    });\n  };\n\n  const handleRunPipeline = () => {\n    runPipelineMutation.mutate({ daysBack: 7 });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Navigation />\n      \n      <div className=\"pt-24 pb-12 px-6\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div>\n                <h1 className=\"text-4xl font-display font-bold mb-2\">Content Pipeline</h1>\n                <p className=\"text-muted-foreground\">\n                  Review and approve AI-generated conflict profiles from trusted humanitarian sources\n                </p>\n              </div>\n              \n              <Button \n                onClick={handleRunPipeline} \n                disabled={runPipelineMutation.isPending}\n                size=\"lg\"\n                data-testid=\"button-run-pipeline\"\n              >\n                {runPipelineMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                    Running...\n                  </>\n                ) : (\n                  <>\n                    <PlayCircle className=\"mr-2 h-5 w-5\" />\n                    Run Pipeline\n                  </>\n                )}\n              </Button>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardDescription>Pending Review</CardDescription>\n                  <CardTitle className=\"text-3xl\">{approvals.length}</CardTitle>\n                </CardHeader>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardDescription>Source</CardDescription>\n                  <CardTitle className=\"text-lg\">UN OCHA ReliefWeb</CardTitle>\n                </CardHeader>\n              </Card>\n              <Card>\n                <CardHeader className=\"pb-3\">\n                  <CardDescription>Last Run</CardDescription>\n                  <CardTitle className=\"text-lg\">Manual Trigger</CardTitle>\n                </CardHeader>\n              </Card>\n            </div>\n          </div>\n\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : approvals.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <AlertCircle className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                <p className=\"text-lg font-medium mb-2\">No pending approvals</p>\n                <p className=\"text-muted-foreground mb-4\">\n                  Run the pipeline to scrape and process new humanitarian crisis data\n                </p>\n                <Button onClick={handleRunPipeline} variant=\"outline\">\n                  <PlayCircle className=\"mr-2 h-4 w-4\" />\n                  Run Pipeline Now\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"space-y-6\">\n              <h2 className=\"text-2xl font-bold\">Pending Approvals</h2>\n              \n              {approvals.map((approval) => {\n                const content = approval.generatedContent as any;\n                return (\n                  <Card key={approval.id} data-testid={`approval-card-${approval.id}`}>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <CardTitle>{content?.title || 'Untitled Conflict'}</CardTitle>\n                          <CardDescription className=\"mt-2\">\n                            {content?.country} • {content?.region}\n                          </CardDescription>\n                        </div>\n                        <Badge variant=\"outline\">{content?.severityLevel || 'moderate'}</Badge>\n                      </div>\n                    </CardHeader>\n                    \n                    <CardContent className=\"space-y-4\">\n                      <div>\n                        <h4 className=\"font-medium mb-2\">Summary</h4>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {content?.summary || 'No summary available'}\n                        </p>\n                      </div>\n\n                      {content?.affectedGroups && content.affectedGroups.length > 0 && (\n                        <div>\n                          <h4 className=\"font-medium mb-2\">Affected Groups</h4>\n                          <div className=\"flex flex-wrap gap-2\">\n                            {content.affectedGroups.map((group: string, idx: number) => (\n                              <Badge key={idx} variant=\"secondary\">{group}</Badge>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n\n                      <div>\n                        <h4 className=\"font-medium mb-2\">Source</h4>\n                        <Badge>{content?.source || 'reliefweb'}</Badge>\n                      </div>\n\n                      <div>\n                        <h4 className=\"font-medium mb-2\">Review Notes (Optional)</h4>\n                        <Textarea\n                          placeholder=\"Add notes about this conflict profile...\"\n                          value={reviewNotes[approval.id] || ''}\n                          onChange={(e) => setReviewNotes(prev => ({\n                            ...prev,\n                            [approval.id]: e.target.value\n                          }))}\n                          data-testid={`textarea-notes-${approval.id}`}\n                        />\n                      </div>\n                    </CardContent>\n\n                    <CardFooter className=\"flex gap-3\">\n                      <Button\n                        variant=\"default\"\n                        onClick={() => handleApprove(approval.id)}\n                        disabled={approveMutation.isPending || rejectMutation.isPending}\n                        data-testid={`button-approve-${approval.id}`}\n                      >\n                        <CheckCircle className=\"mr-2 h-4 w-4\" />\n                        Approve & Publish\n                      </Button>\n                      <Button\n                        variant=\"destructive\"\n                        onClick={() => handleReject(approval.id)}\n                        disabled={approveMutation.isPending || rejectMutation.isPending}\n                        data-testid={`button-reject-${approval.id}`}\n                      >\n                        <XCircle className=\"mr-2 h-4 w-4\" />\n                        Reject\n                      </Button>\n                    </CardFooter>\n                  </Card>\n                );\n              })}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":9903},"server/content-pipeline.ts":{"content":"import { ContentPreprocessor, type ScrapedArticle, type ProcessedArticle } from './content-preprocessor';\nimport { OpenAIService } from './openai-service';\nimport type { IStorage } from './storage';\n\ninterface PipelineConfig {\n  openaiApiKey?: string;\n  enableQualityControl: boolean;\n  minArticlesRequired: number;\n}\n\ninterface PipelineResult {\n  success: boolean;\n  country: string;\n  conflictId?: string;\n  errors: string[];\n  warnings: string[];\n  qualityScore?: number;\n}\n\ninterface QualityControlResult {\n  biasScore: number;\n  emotionalToneScore: number;\n  factCheckWarnings: string[];\n  overallScore: number;\n  passed: boolean;\n}\n\nexport class ContentPipeline {\n  private preprocessor: ContentPreprocessor;\n  private openaiService?: OpenAIService;\n  private storage: IStorage;\n  private config: PipelineConfig;\n\n  constructor(storage: IStorage, config: PipelineConfig) {\n    this.storage = storage;\n    this.config = config;\n    this.preprocessor = new ContentPreprocessor();\n    \n    // Initialize OpenAI service if API key is provided\n    if (config.openaiApiKey) {\n      this.openaiService = new OpenAIService(config.openaiApiKey);\n    }\n  }\n\n  /**\n   * Process scraped content for a specific country\n   */\n  async processCountry(\n    country: string,\n    region: string,\n    rawArticles: Array<{\n      title: string;\n      body: string;\n      source: string;\n      url?: string;\n      date?: string;\n    }>\n  ): Promise<PipelineResult> {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n\n    try {\n      // Check minimum articles requirement\n      if (rawArticles.length < this.config.minArticlesRequired) {\n        errors.push(`Insufficient articles: ${rawArticles.length} (minimum: ${this.config.minArticlesRequired})`);\n        return {\n          success: false,\n          country,\n          errors,\n          warnings,\n        };\n      }\n\n      // Step 1: Preprocess articles\n      console.log(`[Pipeline] Preprocessing ${rawArticles.length} articles for ${country}`);\n      const scrapedArticles: ScrapedArticle[] = rawArticles.map(article => ({\n        ...article,\n        credibility: this.determineCredibility(article.source),\n      }));\n\n      const processedArticles = this.preprocessor.preprocessArticles(scrapedArticles);\n\n      // Get aggregated context\n      const context = this.preprocessor.aggregateArticles(processedArticles);\n\n      // Check if we have enough quality content\n      if (context.totalWordCount < 500) {\n        warnings.push('Low total word count - may result in thin content');\n      }\n\n      // Step 2: Generate AI content (if OpenAI is configured)\n      if (!this.openaiService) {\n        errors.push('OpenAI service not configured - cannot generate content');\n        return {\n          success: false,\n          country,\n          errors,\n          warnings,\n        };\n      }\n\n      console.log(`[Pipeline] Generating swipe card for ${country}`);\n      const swipeCardResult = await this.openaiService.generateSwipeCard(\n        { country, region },\n        processedArticles\n      );\n\n      // Check validation\n      if (!swipeCardResult.validation.isValid) {\n        errors.push(...swipeCardResult.validation.errors);\n      }\n      warnings.push(...swipeCardResult.validation.warnings);\n\n      console.log(`[Pipeline] Generating detailed view for ${country}`);\n      const detailedViewResult = await this.openaiService.generateDetailedView(\n        { country, region },\n        processedArticles,\n        swipeCardResult.content\n      );\n\n      warnings.push(...detailedViewResult.validation.warnings);\n\n      // Step 3: Quality control (if enabled)\n      let qualityScore = 100;\n      if (this.config.enableQualityControl) {\n        console.log(`[Pipeline] Running quality control for ${country}`);\n        const qualityResult = await this.runQualityControl(\n          swipeCardResult.content,\n          detailedViewResult.content,\n          processedArticles\n        );\n\n        qualityScore = qualityResult.overallScore;\n        warnings.push(...qualityResult.factCheckWarnings);\n\n        if (!qualityResult.passed) {\n          errors.push(`Quality control failed: score ${qualityResult.overallScore}/100`);\n        }\n      }\n\n      // Step 4: Auto-publish conflict directly (bypass approval queue)\n      console.log(`[Pipeline] Auto-publishing conflict for ${country}`);\n      \n      const conflict = await this.storage.createConflict({\n        country,\n        region,\n        title: swipeCardResult.content.headline,\n        summary: swipeCardResult.content.summary,\n        severityLevel: this.determineSeverity(swipeCardResult.content.affectedGroups),\n        affectedGroups: swipeCardResult.content.affectedGroups.map(g => g.group),\n        imageUrl: null, // Will be generated separately or use default\n        source: 'reliefweb',\n        needsReview: qualityScore < 70, // Flag low-quality content for review\n        sourceData: {\n          qualityScore,\n          warnings,\n          swipeCard: swipeCardResult.content,\n          detailedView: detailedViewResult.content,\n          preprocessing: {\n            entities: context.allEntities,\n            readability: context.avgReadability,\n            sentiment: context.sentimentDistribution,\n          },\n          sourceUrls: context.sources,\n        },\n      });\n\n      console.log(`[Pipeline] ✓ Published conflict ${conflict.id} for ${country} (quality: ${qualityScore}/100)`);\n\n      return {\n        success: true,\n        country,\n        conflictId: conflict.id,\n        errors,\n        warnings,\n        qualityScore,\n      };\n    } catch (error) {\n      console.error(`[Pipeline] Error processing ${country}:`, error);\n      errors.push(`Processing error: ${error instanceof Error ? error.message : 'Unknown error'}`);\n      \n      return {\n        success: false,\n        country,\n        errors,\n        warnings,\n      };\n    }\n  }\n\n  /**\n   * Run quality control checks on generated content\n   */\n  private async runQualityControl(\n    swipeCard: any,\n    detailedView: any,\n    articles: ProcessedArticle[]\n  ): Promise<QualityControlResult> {\n    const warnings: string[] = [];\n    \n    // Bias detection\n    const biasScore = this.detectBias(swipeCard, detailedView, articles);\n    \n    // Emotional tone analysis\n    const emotionalToneScore = this.analyzeEmotionalTone(swipeCard);\n    \n    // Fact-checking (basic)\n    const factCheckWarnings = this.checkFacts(swipeCard, detailedView, articles);\n    warnings.push(...factCheckWarnings);\n    \n    // Calculate overall score\n    const overallScore = Math.round((biasScore + emotionalToneScore) / 2);\n    \n    return {\n      biasScore,\n      emotionalToneScore,\n      factCheckWarnings,\n      overallScore,\n      passed: overallScore >= 70, // Threshold for approval\n    };\n  }\n\n  /**\n   * Detect bias in generated content\n   */\n  private detectBias(swipeCard: any, detailedView: any, articles: ProcessedArticle[]): number {\n    let score = 100;\n    const issues: string[] = [];\n    \n    // Check sentiment distribution in source articles\n    const sentiments = articles.map(a => a.sentiment);\n    const negativeCount = sentiments.filter(s => s === 'negative').length;\n    const positiveCount = sentiments.filter(s => s === 'positive').length;\n    const neutralCount = sentiments.filter(s => s === 'neutral').length;\n    \n    // If sources are heavily negative but generated content doesn't acknowledge severity\n    if (negativeCount > positiveCount * 2 && negativeCount > neutralCount) {\n      // Check if generated content uses appropriate tone\n      const combinedText = `${swipeCard.summary} ${detailedView.extendedSummary}`.toLowerCase();\n      const positiveWords = ['hope', 'improving', 'better', 'progress', 'recovery'];\n      const hasPositiveBias = positiveWords.some(word => combinedText.includes(word));\n      \n      if (hasPositiveBias) {\n        score -= 15;\n        issues.push('Overly positive tone given negative source sentiment');\n      }\n    }\n    \n    // Check for political bias keywords that should be avoided\n    const politicalBiasKeywords = [\n      'terrorist', 'regime', 'dictator', 'enemy', 'radical',\n      'extremist', 'militant', 'insurgent'\n    ];\n    const combinedText = `${swipeCard.summary} ${detailedView.extendedSummary}`.toLowerCase();\n    \n    politicalBiasKeywords.forEach(keyword => {\n      if (combinedText.includes(keyword)) {\n        score -= 8;\n        issues.push(`Political bias keyword detected: \"${keyword}\"`);\n      }\n    });\n    \n    // Check for one-sided narrative (should mention multiple perspectives)\n    const hasBalancedLanguage = [\n      'according to', 'reported by', 'sources indicate', \n      'organizations state', 'data shows'\n    ].some(phrase => combinedText.includes(phrase));\n    \n    if (!hasBalancedLanguage) {\n      score -= 10;\n      issues.push('Lacks attribution or source references');\n    }\n    \n    if (issues.length > 0) {\n      console.warn(`[QC] Bias issues found: ${issues.join('; ')}`);\n    }\n    \n    return Math.max(0, score);\n  }\n\n  /**\n   * Analyze emotional tone (avoid exploitation, maintain empathy)\n   */\n  private analyzeEmotionalTone(swipeCard: any): number {\n    let score = 100;\n    const issues: string[] = [];\n    \n    const text = `${swipeCard.headline} ${swipeCard.summary} ${swipeCard.emotionalHook}`.toLowerCase();\n    \n    // Exploitative language to avoid\n    const exploitativeTerms = [\n      'devastating', 'horrific', 'tragic', 'nightmare', \n      'catastrophic', 'apocalyptic', 'hellish', 'terrible',\n      'awful', 'dire', 'desperate'\n    ];\n    \n    let exploitativeCount = 0;\n    exploitativeTerms.forEach(term => {\n      if (text.includes(term)) {\n        exploitativeCount++;\n        score -= 8;\n        issues.push(`Exploitative term: \"${term}\"`);\n      }\n    });\n    \n    // Multiple exploitative terms is worse\n    if (exploitativeCount > 2) {\n      score -= 10;\n      issues.push('Excessive sensationalism');\n    }\n    \n    // Check for \"poverty porn\" patterns (focusing on suffering without agency)\n    const povertyPornPatterns = [\n      { pattern: /starving children/i, name: 'starving children' },\n      { pattern: /dying (babies|infants)/i, name: 'dying babies' },\n      { pattern: /hopeless/i, name: 'hopeless' },\n      { pattern: /helpless victims/i, name: 'helpless victims' },\n      { pattern: /suffering (children|families)/i, name: 'suffering focus' },\n    ];\n    \n    povertyPornPatterns.forEach(({ pattern, name }) => {\n      if (pattern.test(text)) {\n        score -= 15;\n        issues.push(`Poverty porn pattern: \"${name}\"`);\n      }\n    });\n    \n    // Check for agency and hope balance\n    const agencyWords = ['families', 'communities', 'people', 'residents', 'survivors'];\n    const hasAgency = agencyWords.some(word => text.includes(word));\n    \n    const victimWords = ['victims', 'displaced', 'refugees', 'crisis'];\n    const victimCount = victimWords.filter(word => text.includes(word)).length;\n    \n    // If all victims and no agency, penalize\n    if (victimCount >= 2 && !hasAgency) {\n      score -= 12;\n      issues.push('Lacks agency - focuses only on victimhood');\n    }\n    \n    // Check for solution-oriented language\n    const solutionWords = ['support', 'help', 'aid', 'assistance', 'relief', 'organizations'];\n    const hasSolutionFocus = solutionWords.some(word => text.includes(word));\n    \n    if (!hasSolutionFocus) {\n      score -= 8;\n      issues.push('Lacks solution-oriented language');\n    }\n    \n    if (issues.length > 0) {\n      console.warn(`[QC] Emotional tone issues: ${issues.join('; ')}`);\n    }\n    \n    return Math.max(0, score);\n  }\n\n  /**\n   * Fact-checking - verify claims against source material\n   */\n  private checkFacts(swipeCard: any, detailedView: any, articles: ProcessedArticle[]): string[] {\n    const warnings: string[] = [];\n    \n    // Combine all source text for checking\n    const sourceText = articles.map(a => a.body.toLowerCase()).join(' ');\n    const combinedGenerated = `${swipeCard.summary} ${detailedView.extendedSummary}`;\n    \n    // Extract numbers from generated content\n    const numbersInGenerated = combinedGenerated.match(/\\d+(?:,\\d+)*(?:\\.\\d+)?(?:\\s*(?:million|thousand|billion|k|m))?/gi) || [];\n    \n    if (numbersInGenerated.length === 0) {\n      warnings.push('No specific statistics provided - content may be too vague');\n    } else {\n      // Check if at least some numbers appear in source material\n      const numbersInSources = sourceText.match(/\\d+(?:,\\d+)*(?:\\.\\d+)?/g) || [];\n      \n      if (numbersInSources.length === 0 && numbersInGenerated.length > 0) {\n        warnings.push('Generated content contains statistics not found in source material');\n      }\n    }\n    \n    // Check if affected groups are mentioned in sources\n    swipeCard.affectedGroups.forEach((group: any) => {\n      const groupName = group.group.toLowerCase();\n      if (!sourceText.includes(groupName) && !sourceText.includes(groupName.slice(0, -1))) { // Check singular too\n        warnings.push(`Affected group \"${group.group}\" not found in source articles`);\n      }\n      \n      // Check if the impact described makes sense given source tone\n      const impactText = group.impact.toLowerCase();\n      if (impactText.includes('million') || impactText.includes('thousand')) {\n        // Verify large numbers are plausible\n        const hasLargeScale = sourceText.includes('million') || sourceText.includes('thousand') || \n                              sourceText.includes('hundreds') || sourceText.includes('many');\n        if (!hasLargeScale) {\n          warnings.push(`Large-scale impact for \"${group.group}\" not supported by source material`);\n        }\n      }\n    });\n    \n    // Check for unsupported claims\n    const criticalClaims = [\n      { pattern: /genocide/i, claim: 'genocide' },\n      { pattern: /war crime/i, claim: 'war crime' },\n      { pattern: /massacre/i, claim: 'massacre' },\n      { pattern: /ethnic cleansing/i, claim: 'ethnic cleansing' },\n    ];\n    \n    criticalClaims.forEach(({ pattern, claim }) => {\n      if (pattern.test(combinedGenerated) && !pattern.test(sourceText)) {\n        warnings.push(`Critical claim \"${claim}\" not supported by source material`);\n      }\n    });\n    \n    // Check timeline consistency if provided\n    if (detailedView.timeline && detailedView.timeline.length > 0) {\n      const timelineEvents = detailedView.timeline.map((t: any) => t.event.toLowerCase());\n      \n      // Verify at least some timeline events match source content\n      const matchedEvents = timelineEvents.filter((event: string) => {\n        // Check if event description appears in sources\n        const eventWords = event.split(' ').filter(w => w.length > 4); // Key words only\n        return eventWords.some(word => sourceText.includes(word));\n      });\n      \n      if (matchedEvents.length < timelineEvents.length / 2) {\n        warnings.push('Timeline events not well-supported by source material');\n      }\n    }\n    \n    // Log warnings for debugging\n    if (warnings.length > 0) {\n      console.warn(`[QC] Fact-check warnings: ${warnings.join('; ')}`);\n    }\n    \n    return warnings;\n  }\n\n  /**\n   * Determine credibility level from source name\n   */\n  private determineCredibility(source: string): 'verified_un' | 'verified_academic' | 'news_media' {\n    const lowerSource = source.toLowerCase();\n    \n    if (lowerSource.includes('un ') || lowerSource.includes('ocha') || lowerSource.includes('unhcr') || lowerSource.includes('unicef')) {\n      return 'verified_un';\n    }\n    \n    if (lowerSource.includes('acled') || lowerSource.includes('icrc') || lowerSource.includes('research')) {\n      return 'verified_academic';\n    }\n    \n    return 'news_media';\n  }\n\n  /**\n   * Determine severity level from affected groups\n   */\n  private determineSeverity(affectedGroups: Array<{ urgency: string }>): 'Critical' | 'High' | 'Moderate' {\n    const urgencies = affectedGroups.map(g => g.urgency);\n    \n    if (urgencies.includes('critical')) {\n      return 'Critical';\n    }\n    \n    if (urgencies.includes('high')) {\n      return 'High';\n    }\n    \n    return 'Moderate';\n  }\n\n  /**\n   * Process multiple countries in batch\n   */\n  async processBatch(\n    countries: Array<{\n      country: string;\n      region: string;\n      articles: Array<{\n        title: string;\n        body: string;\n        source: string;\n        url?: string;\n        date?: string;\n      }>;\n    }>\n  ): Promise<PipelineResult[]> {\n    console.log(`[Pipeline] Processing batch of ${countries.length} countries`);\n    \n    const results: PipelineResult[] = [];\n    \n    // Process sequentially to avoid rate limits\n    for (const countryData of countries) {\n      const result = await this.processCountry(\n        countryData.country,\n        countryData.region,\n        countryData.articles\n      );\n      results.push(result);\n      \n      // Add delay to respect rate limits\n      await new Promise(resolve => setTimeout(resolve, 1000));\n    }\n    \n    return results;\n  }\n}\n","size_bytes":16986},"client/src/pages/Actions.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { CalendarIcon, MapPinIcon, Users, FileText, Calendar, Clock, CheckCircle2, Heart } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { Action } from \"@shared/schema\";\nimport Navigation from \"@/components/Navigation\";\n\nexport default function Actions() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [selectedAction, setSelectedAction] = useState<Action | null>(null);\n  const [activeTab, setActiveTab] = useState<string>(\"recommended\");\n  const [personalMessage, setPersonalMessage] = useState(\"\");\n\n  const { data: actions = [], isLoading, isError: actionsError } = useQuery<Action[]>({\n    queryKey: [\"/api/actions\"],\n    enabled: !!user,\n  });\n\n  const { data: participatedActions = [], isError: participatedError } = useQuery<Action[]>({\n    queryKey: [\"/api/actions/user/participated\"],\n    enabled: !!user,\n  });\n\n  // Fetch recommended actions with match scores\n  interface RecommendedAction extends Action {\n    matchScore?: number;\n    matchReasons?: string[];\n  }\n\n  const { data: recommendedActions = [], isError: recommendedError } = useQuery<RecommendedAction[]>({\n    queryKey: [\"/api/actions/recommended\"],\n    enabled: !!user,\n  });\n\n  // Show error toast if queries fail\n  useEffect(() => {\n    if (actionsError || participatedError || recommendedError) {\n      toast({\n        title: \"Error loading actions\",\n        description: \"Failed to load actions. Please try again later.\",\n        variant: \"destructive\",\n      });\n    }\n  }, [actionsError, participatedError, recommendedError, toast]);\n\n  const participateMutation = useMutation({\n    mutationFn: async ({ actionId, participationType }: { actionId: string; participationType: string }) => {\n      const res = await apiRequest('POST', `/api/actions/${actionId}/participate`, {\n        participationType,\n        personalMessage: personalMessage || null,\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Participation recorded!\",\n        description: \"You've successfully joined this action.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/actions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/actions/user/participated\"] });\n      setSelectedAction(null);\n      setPersonalMessage(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to participate in action\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredActions = activeTab === \"all\" \n    ? actions.filter(a => a.status === \"active\")\n    : activeTab === \"recommended\"\n    ? recommendedActions\n    : activeTab === \"participated\"\n    ? participatedActions\n    : actions.filter(a => a.type === activeTab && a.status === \"active\");\n\n  const getActionIcon = (type: string) => {\n    switch (type) {\n      case \"protest\":\n        return <Users className=\"w-4 h-4\" />;\n      case \"petition\":\n        return <FileText className=\"w-4 h-4\" />;\n      case \"advocacy\":\n        return <Heart className=\"w-4 h-4\" />;\n      default:\n        return <Calendar className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getActionTypeColor = (type: string) => {\n    switch (type) {\n      case \"protest\":\n        return \"bg-red-500\";\n      case \"petition\":\n        return \"bg-blue-500\";\n      case \"advocacy\":\n        return \"bg-green-500\";\n      default:\n        return \"bg-gray-500\";\n    }\n  };\n\n  const isParticipating = (actionId: string) => {\n    return participatedActions.some(a => a.id === actionId);\n  };\n\n  if (isLoading) {\n    return (\n      <>\n        <Navigation />\n        <div className=\"flex items-center justify-center min-h-screen\">\n          <div className=\"text-center\">\n            <p className=\"text-muted-foreground\">Loading actions...</p>\n          </div>\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <>\n      <Navigation />\n      <div className=\"container mx-auto px-4 py-8 max-w-7xl\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-4xl font-bold mb-2\">Take Action</h1>\n          <p className=\"text-muted-foreground text-lg\">\n            Join protests, sign petitions, and participate in advocacy campaigns for humanitarian causes\n          </p>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"mb-6\">\n          <TabsList>\n            <TabsTrigger value=\"recommended\" data-testid=\"tab-recommended\">For You</TabsTrigger>\n            <TabsTrigger value=\"all\" data-testid=\"tab-all\">All Actions</TabsTrigger>\n            <TabsTrigger value=\"protest\" data-testid=\"tab-protest\">Protests</TabsTrigger>\n            <TabsTrigger value=\"petition\" data-testid=\"tab-petition\">Petitions</TabsTrigger>\n            <TabsTrigger value=\"advocacy\" data-testid=\"tab-advocacy\">Advocacy</TabsTrigger>\n            <TabsTrigger value=\"participated\" data-testid=\"tab-participated\">My Actions</TabsTrigger>\n          </TabsList>\n        </Tabs>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {filteredActions.length === 0 ? (\n            <div className=\"col-span-full text-center py-12\">\n              <p className=\"text-muted-foreground text-lg\">No actions found for this category.</p>\n            </div>\n          ) : (\n            filteredActions.map((action) => (\n              <Card \n                key={action.id} \n                className=\"hover-elevate cursor-pointer transition-all\"\n                onClick={() => setSelectedAction(action)}\n                data-testid={`action-card-${action.id}`}\n              >\n                <CardHeader>\n                  <div className=\"flex items-start justify-between gap-2 mb-2\">\n                    <Badge variant=\"secondary\" className=\"capitalize\">\n                      <span className=\"flex items-center gap-1\">\n                        {getActionIcon(action.type)}\n                        {action.type}\n                      </span>\n                    </Badge>\n                    {isParticipating(action.id) && (\n                      <Badge variant=\"default\" className=\"bg-green-600\">\n                        <CheckCircle2 className=\"w-3 h-3 mr-1\" />\n                        Joined\n                      </Badge>\n                    )}\n                  </div>\n                  <CardTitle className=\"line-clamp-2\">{action.title}</CardTitle>\n                  <CardDescription className=\"line-clamp-2\">\n                    {action.description}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  {/* Show match score and reasons for recommended actions */}\n                  {activeTab === \"recommended\" && 'matchScore' in action && (action as RecommendedAction).matchScore !== undefined && (\n                    <div className=\"mb-4 p-3 bg-primary/10 rounded-md\">\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <div className=\"flex items-center gap-1\">\n                          <Heart className=\"w-4 h-4 text-primary fill-primary\" />\n                          <span className=\"font-semibold text-sm text-primary\">\n                            {(action as RecommendedAction).matchScore}% Match\n                          </span>\n                        </div>\n                      </div>\n                      {(action as RecommendedAction).matchReasons && (action as RecommendedAction).matchReasons!.length > 0 && (\n                        <div className=\"flex flex-wrap gap-1\">\n                          {(action as RecommendedAction).matchReasons!.map((reason: string, idx: number) => (\n                            <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                              {reason}\n                            </Badge>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  )}\n                  \n                  <div className=\"space-y-2 text-sm\">\n                    {action.organizerName && (\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <Users className=\"w-4 h-4\" />\n                        <span>{action.organizerName}</span>\n                      </div>\n                    )}\n                    \n                    {action.startTime && (\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <CalendarIcon className=\"w-4 h-4\" />\n                        <span>{format(new Date(action.startTime), \"MMM d, yyyy h:mm a\")}</span>\n                      </div>\n                    )}\n                    \n                    {action.address && (\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <MapPinIcon className=\"w-4 h-4\" />\n                        <span className=\"line-clamp-1\">{action.address}</span>\n                      </div>\n                    )}\n\n                    {action.type === \"petition\" && action.signatureCount !== null && (\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <FileText className=\"w-4 h-4\" />\n                        <span>{action.signatureCount.toLocaleString()} signatures</span>\n                      </div>\n                    )}\n\n                    {action.type === \"protest\" && action.currentAttendance !== null && (\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <Users className=\"w-4 h-4\" />\n                        <span>{action.currentAttendance} attending</span>\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      </div>\n\n      <Dialog open={!!selectedAction} onOpenChange={() => setSelectedAction(null)}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          {selectedAction && (\n            <>\n              <DialogHeader>\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Badge variant=\"secondary\" className=\"capitalize\">\n                    <span className=\"flex items-center gap-1\">\n                      {getActionIcon(selectedAction.type)}\n                      {selectedAction.type}\n                    </span>\n                  </Badge>\n                  {isParticipating(selectedAction.id) && (\n                    <Badge variant=\"default\" className=\"bg-green-600\">\n                      <CheckCircle2 className=\"w-3 h-3 mr-1\" />\n                      You're participating\n                    </Badge>\n                  )}\n                </div>\n                <DialogTitle className=\"text-2xl\">{selectedAction.title}</DialogTitle>\n                <DialogDescription className=\"text-base\">\n                  {selectedAction.description}\n                </DialogDescription>\n              </DialogHeader>\n\n              <div className=\"space-y-6 mt-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {selectedAction.organizerName && (\n                    <div className=\"flex items-start gap-3\">\n                      <Users className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\n                      <div>\n                        <p className=\"font-medium text-sm\">Organizer</p>\n                        <p className=\"text-sm text-muted-foreground\">{selectedAction.organizerName}</p>\n                      </div>\n                    </div>\n                  )}\n\n                  {selectedAction.startTime && (\n                    <div className=\"flex items-start gap-3\">\n                      <CalendarIcon className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\n                      <div>\n                        <p className=\"font-medium text-sm\">Start Time</p>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {format(new Date(selectedAction.startTime), \"MMMM d, yyyy\")}\n                          <br />\n                          {format(new Date(selectedAction.startTime), \"h:mm a\")}\n                        </p>\n                      </div>\n                    </div>\n                  )}\n\n                  {selectedAction.endTime && (\n                    <div className=\"flex items-start gap-3\">\n                      <Clock className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\n                      <div>\n                        <p className=\"font-medium text-sm\">End Time</p>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {format(new Date(selectedAction.endTime), \"MMMM d, yyyy\")}\n                          <br />\n                          {format(new Date(selectedAction.endTime), \"h:mm a\")}\n                        </p>\n                      </div>\n                    </div>\n                  )}\n\n                  {selectedAction.address && (\n                    <div className=\"flex items-start gap-3\">\n                      <MapPinIcon className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\n                      <div>\n                        <p className=\"font-medium text-sm\">Location</p>\n                        <p className=\"text-sm text-muted-foreground\">{selectedAction.address}</p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {selectedAction.tags && selectedAction.tags.length > 0 && (\n                  <div>\n                    <p className=\"font-medium text-sm mb-2\">Tags</p>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {selectedAction.tags.map((tag, idx) => (\n                        <Badge key={idx} variant=\"outline\">\n                          {tag}\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {selectedAction.type === \"petition\" && selectedAction.signatureCount !== null && (\n                  <div>\n                    <p className=\"font-medium text-sm mb-1\">Petition Progress</p>\n                    <p className=\"text-2xl font-bold text-primary\">\n                      {selectedAction.signatureCount.toLocaleString()} signatures\n                    </p>\n                  </div>\n                )}\n\n                {selectedAction.type === \"protest\" && selectedAction.currentAttendance !== null && (\n                  <div>\n                    <p className=\"font-medium text-sm mb-1\">Attendance</p>\n                    <p className=\"text-2xl font-bold text-primary\">\n                      {selectedAction.currentAttendance} people attending\n                    </p>\n                  </div>\n                )}\n\n                {!isParticipating(selectedAction.id) && (\n                  <div>\n                    <p className=\"font-medium text-sm mb-2\">Add a personal message (optional)</p>\n                    <Textarea\n                      placeholder=\"Share why this action matters to you...\"\n                      value={personalMessage}\n                      onChange={(e) => setPersonalMessage(e.target.value)}\n                      className=\"min-h-[100px]\"\n                      data-testid=\"input-personal-message\"\n                    />\n                  </div>\n                )}\n              </div>\n\n              <DialogFooter className=\"gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setSelectedAction(null)}\n                  data-testid=\"button-cancel\"\n                >\n                  Close\n                </Button>\n                {!isParticipating(selectedAction.id) && (\n                  <Button\n                    onClick={() => \n                      participateMutation.mutate({\n                        actionId: selectedAction.id,\n                        participationType: \"committed\",\n                      })\n                    }\n                    disabled={participateMutation.isPending}\n                    data-testid=\"button-participate\"\n                  >\n                    {participateMutation.isPending ? \"Joining...\" : \"Join This Action\"}\n                  </Button>\n                )}\n              </DialogFooter>\n            </>\n          )}\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","size_bytes":17061},"server/reliefweb-scraper.ts":{"content":"/**\n * ReliefWeb API Scraper\n * Fetches verified humanitarian crisis data from UN OCHA ReliefWeb\n */\n\nexport interface ReliefWebReport {\n  id: string;\n  title: string;\n  body: string;\n  date: {\n    created: string;\n  };\n  primary_country: {\n    name: string;\n    iso3: string;\n  };\n  country: Array<{\n    name: string;\n    iso3: string;\n  }>;\n  disaster?: Array<{\n    name: string;\n    type: string;\n  }>;\n  vulnerable_groups?: Array<{\n    name: string;\n  }>;\n  theme?: Array<{\n    name: string;\n  }>;\n  source: Array<{\n    name: string;\n  }>;\n  url: string;\n}\n\nexport interface ConflictData {\n  countryName: string;\n  countryCode: string;\n  reports: Array<{\n    title: string;\n    body: string;\n    url: string;\n    date: string;\n    source: string;\n  }>;\n  disasters: string[];\n  themes: string[];\n  vulnerableGroups: string[];\n  sources: string[];\n}\n\nexport class ReliefWebScraper {\n  private static readonly BASE_URL = 'https://api.reliefweb.int/v1/reports';\n  private static readonly APP_NAME = 'aidatlas-humanitarian-app';\n\n  /**\n   * Fetch recent humanitarian reports from ReliefWeb\n   * @param daysBack Number of days to look back (default: 7)\n   */\n  async fetchRecentReports(daysBack: number = 7): Promise<ReliefWebReport[]> {\n    // Minimal request to avoid API rejection\n    const requestBody = {\n      appname: ReliefWebScraper.APP_NAME,\n      limit: 100,\n    };\n\n    try {\n      const response = await fetch(ReliefWebScraper.BASE_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(requestBody),\n      });\n\n      if (!response.ok) {\n        throw new Error(`ReliefWeb API error: ${response.status} ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      return data.data.map((item: any) => item.fields);\n    } catch (error) {\n      console.error('Error fetching from ReliefWeb:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Extract and aggregate conflict data by country\n   */\n  extractConflicts(reports: ReliefWebReport[]): Map<string, ConflictData> {\n    const conflictsByCountry = new Map<string, ConflictData>();\n\n    for (const report of reports) {\n      if (!report.primary_country) continue;\n\n      const countryCode = report.primary_country.iso3;\n      const countryName = report.primary_country.name;\n\n      if (!conflictsByCountry.has(countryCode)) {\n        conflictsByCountry.set(countryCode, {\n          countryName,\n          countryCode,\n          reports: [],\n          disasters: [],\n          themes: [],\n          vulnerableGroups: [],\n          sources: [],\n        });\n      }\n\n      const conflict = conflictsByCountry.get(countryCode)!;\n\n      // Add report\n      conflict.reports.push({\n        title: report.title || '',\n        body: report.body || '',\n        url: report.url || '',\n        date: report.date?.created || '',\n        source: report.source?.[0]?.name || 'Unknown',\n      });\n\n      // Aggregate metadata (deduplicated)\n      if (report.disaster) {\n        for (const disaster of report.disaster) {\n          if (!conflict.disasters.includes(disaster.name)) {\n            conflict.disasters.push(disaster.name);\n          }\n        }\n      }\n\n      if (report.theme) {\n        for (const theme of report.theme) {\n          if (!conflict.themes.includes(theme.name)) {\n            conflict.themes.push(theme.name);\n          }\n        }\n      }\n\n      if (report.vulnerable_groups) {\n        for (const group of report.vulnerable_groups) {\n          if (!conflict.vulnerableGroups.includes(group.name)) {\n            conflict.vulnerableGroups.push(group.name);\n          }\n        }\n      }\n\n      if (report.source) {\n        for (const source of report.source) {\n          if (!conflict.sources.includes(source.name)) {\n            conflict.sources.push(source.name);\n          }\n        }\n      }\n    }\n\n    return conflictsByCountry;\n  }\n\n  /**\n   * Run complete scraping process\n   */\n  async scrape(daysBack: number = 7): Promise<Map<string, ConflictData>> {\n    console.log(`[ReliefWeb] Fetching reports from last ${daysBack} days...`);\n    const reports = await this.fetchRecentReports(daysBack);\n    console.log(`[ReliefWeb] Fetched ${reports.length} reports`);\n\n    const conflicts = this.extractConflicts(reports);\n    console.log(`[ReliefWeb] Identified ${conflicts.size} countries with humanitarian crises`);\n\n    return conflicts;\n  }\n}\n","size_bytes":4421},"server/openai-service.ts":{"content":"import OpenAI from 'openai';\nimport type { ProcessedArticle } from './content-preprocessor';\n\ninterface SwipeCardContent {\n  headline: string;\n  summary: string;\n  affectedGroups: Array<{\n    group: string;\n    count: string;\n    impact: string;\n    urgency: 'critical' | 'high' | 'moderate';\n  }>;\n  keyNeeds: Array<{\n    need: string;\n    description: string;\n    icon: string;\n  }>;\n  emotionalHook: string;\n  sourcesUsed: string[];\n  contentWarnings: string[];\n}\n\ninterface DetailedViewContent {\n  extendedSummary: string;\n  timeline: Array<{\n    date: string;\n    event: string;\n    significance: string;\n  }>;\n  currentSituation: {\n    overview: string;\n    recentDevelopments: string[];\n    outlook: string;\n  };\n  howOrganizationsHelp: Array<{\n    interventionType: string;\n    description: string;\n    impactExample: string;\n    gaps: string;\n  }>;\n  contextBackground: {\n    rootCauses: string;\n    keyActors: string;\n    regionalImpact: string;\n  };\n  waysToHelp: {\n    donationImpact: string;\n    urgentNeeds: string[];\n    longTermSupport: string;\n  };\n}\n\ninterface GenerationResult<T> {\n  content: T;\n  validation: {\n    isValid: boolean;\n    errors: string[];\n    warnings: string[];\n  };\n  rawResponse: string;\n}\n\nexport class OpenAIService {\n  private client: OpenAI;\n  private model = 'gpt-4o-2024-11-20'; // Latest model with structured outputs\n\n  constructor(apiKey?: string) {\n    if (!apiKey) {\n      throw new Error('OpenAI API key is required');\n    }\n    this.client = new OpenAI({ apiKey });\n  }\n\n  /**\n   * Generate swipe card content from preprocessed articles\n   */\n  async generateSwipeCard(\n    conflictData: {\n      country: string;\n      region: string;\n    },\n    articles: ProcessedArticle[]\n  ): Promise<GenerationResult<SwipeCardContent>> {\n    // Prepare context from articles\n    const context = this.prepareContext(articles, 5000);\n\n    const systemPrompt = `You are a humanitarian content writer creating engaging, accurate content for a donation app.\n\nTONE GUIDELINES:\n- Empathetic but not exploitative\n- Factual and grounded in sources\n- Human-centered (focus on people, not politics)\n- Hopeful but honest\n- Avoid sensationalism or \"poverty porn\"\n- Use active voice and clear language\n\nCRITICAL RULES:\n1. Every statistic must come from the sources provided\n2. Use \"people\" and \"families\" language, not just numbers\n3. Focus on impact and needs, not the political conflict\n4. Include hope: mention ongoing aid efforts\n5. Keep it digestible: users will read this in 10-15 seconds`;\n\n    const userPrompt = `Create a brief profile card for ${conflictData.country} humanitarian crisis.\n\nSOURCE MATERIAL:\n${context}\n\nGenerate a swipe card with:\n- Headline (40-60 characters): Brief, impactful title\n- Summary (150-200 words): 2-3 sentence overview that hooks without sensationalism\n- Affected groups (3-5): Specific groups with concrete numbers and impacts\n- Key needs (3-5): Critical humanitarian needs with context\n- Emotional hook: One sentence that makes this personal and relatable\n- Content warnings: Any sensitive content (violence, death, etc.)\n\nExample of good vs bad:\n❌ BAD: \"Devastating war leaves millions suffering\"\n✅ GOOD: \"2.3 million families need shelter after displacement\"\n\n❌ BAD: \"Children are dying from lack of medical care\"\n✅ GOOD: \"Medical facilities need support to treat 50,000 children\"`;\n\n    try {\n      const response = await this.client.chat.completions.create({\n        model: this.model,\n        messages: [\n          { role: 'system', content: systemPrompt },\n          { role: 'user', content: userPrompt }\n        ],\n        temperature: 0.3, // Low temperature for factual content\n        response_format: {\n          type: 'json_schema',\n          json_schema: {\n            name: 'swipe_card',\n            strict: true,\n            schema: {\n              type: 'object',\n              properties: {\n                headline: { type: 'string' },\n                summary: { type: 'string' },\n                affectedGroups: {\n                  type: 'array',\n                  items: {\n                    type: 'object',\n                    properties: {\n                      group: { type: 'string' },\n                      count: { type: 'string' },\n                      impact: { type: 'string' },\n                      urgency: { type: 'string', enum: ['critical', 'high', 'moderate'] }\n                    },\n                    required: ['group', 'count', 'impact', 'urgency'],\n                    additionalProperties: false\n                  }\n                },\n                keyNeeds: {\n                  type: 'array',\n                  items: {\n                    type: 'object',\n                    properties: {\n                      need: { type: 'string' },\n                      description: { type: 'string' },\n                      icon: { type: 'string' }\n                    },\n                    required: ['need', 'description', 'icon'],\n                    additionalProperties: false\n                  }\n                },\n                emotionalHook: { type: 'string' },\n                sourcesUsed: {\n                  type: 'array',\n                  items: { type: 'string' }\n                },\n                contentWarnings: {\n                  type: 'array',\n                  items: { type: 'string' }\n                }\n              },\n              required: ['headline', 'summary', 'affectedGroups', 'keyNeeds', 'emotionalHook', 'sourcesUsed', 'contentWarnings'],\n              additionalProperties: false\n            }\n          }\n        }\n      });\n\n      const rawResponse = response.choices[0].message.content || '{}';\n      const content = JSON.parse(rawResponse) as SwipeCardContent;\n\n      // Validate the generated content\n      const validation = this.validateSwipeCard(content, articles);\n\n      return {\n        content,\n        validation,\n        rawResponse\n      };\n    } catch (error) {\n      console.error('Error generating swipe card:', error);\n      throw new Error(`Failed to generate swipe card: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Generate detailed view content\n   */\n  async generateDetailedView(\n    conflictData: {\n      country: string;\n      region: string;\n    },\n    articles: ProcessedArticle[],\n    cardContent: SwipeCardContent\n  ): Promise<GenerationResult<DetailedViewContent>> {\n    const context = this.prepareContext(articles, 10000);\n\n    const systemPrompt = `You are writing an in-depth profile for users who want to learn more before donating.\n\nMaintain the same tone as the swipe card:\n- Empathetic, factual, human-centered\n- Hopeful but honest\n- Avoid sensationalism`;\n\n    const userPrompt = `Create a detailed view for ${conflictData.country} humanitarian crisis.\n\nPREVIOUSLY GENERATED CARD:\n${JSON.stringify(cardContent, null, 2)}\n\nFULL SOURCE MATERIAL:\n${context}\n\nGenerate comprehensive content including:\n- Extended summary (300-500 words)\n- Timeline of key events\n- Current situation analysis\n- How organizations are helping\n- Background context (root causes, key actors, regional impact)\n- Ways to help (donation impact, urgent needs)`;\n\n    try {\n      const response = await this.client.chat.completions.create({\n        model: this.model,\n        messages: [\n          { role: 'system', content: systemPrompt },\n          { role: 'user', content: userPrompt }\n        ],\n        temperature: 0.3,\n        response_format: {\n          type: 'json_schema',\n          json_schema: {\n            name: 'detailed_view',\n            strict: true,\n            schema: {\n              type: 'object',\n              properties: {\n                extendedSummary: { type: 'string' },\n                timeline: {\n                  type: 'array',\n                  items: {\n                    type: 'object',\n                    properties: {\n                      date: { type: 'string' },\n                      event: { type: 'string' },\n                      significance: { type: 'string' }\n                    },\n                    required: ['date', 'event', 'significance'],\n                    additionalProperties: false\n                  }\n                },\n                currentSituation: {\n                  type: 'object',\n                  properties: {\n                    overview: { type: 'string' },\n                    recentDevelopments: {\n                      type: 'array',\n                      items: { type: 'string' }\n                    },\n                    outlook: { type: 'string' }\n                  },\n                  required: ['overview', 'recentDevelopments', 'outlook'],\n                  additionalProperties: false\n                },\n                howOrganizationsHelp: {\n                  type: 'array',\n                  items: {\n                    type: 'object',\n                    properties: {\n                      interventionType: { type: 'string' },\n                      description: { type: 'string' },\n                      impactExample: { type: 'string' },\n                      gaps: { type: 'string' }\n                    },\n                    required: ['interventionType', 'description', 'impactExample', 'gaps'],\n                    additionalProperties: false\n                  }\n                },\n                contextBackground: {\n                  type: 'object',\n                  properties: {\n                    rootCauses: { type: 'string' },\n                    keyActors: { type: 'string' },\n                    regionalImpact: { type: 'string' }\n                  },\n                  required: ['rootCauses', 'keyActors', 'regionalImpact'],\n                  additionalProperties: false\n                },\n                waysToHelp: {\n                  type: 'object',\n                  properties: {\n                    donationImpact: { type: 'string' },\n                    urgentNeeds: {\n                      type: 'array',\n                      items: { type: 'string' }\n                    },\n                    longTermSupport: { type: 'string' }\n                  },\n                  required: ['donationImpact', 'urgentNeeds', 'longTermSupport'],\n                  additionalProperties: false\n                }\n              },\n              required: ['extendedSummary', 'timeline', 'currentSituation', 'howOrganizationsHelp', 'contextBackground', 'waysToHelp'],\n              additionalProperties: false\n            }\n          }\n        }\n      });\n\n      const rawResponse = response.choices[0].message.content || '{}';\n      const content = JSON.parse(rawResponse) as DetailedViewContent;\n\n      const validation = this.validateDetailedView(content);\n\n      return {\n        content,\n        validation,\n        rawResponse\n      };\n    } catch (error) {\n      console.error('Error generating detailed view:', error);\n      throw new Error(`Failed to generate detailed view: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Prepare context from articles for AI processing\n   */\n  private prepareContext(articles: ProcessedArticle[], maxLength: number): string {\n    let context = '';\n    \n    for (const article of articles) {\n      const articleText = `\nSOURCE: ${article.source}\nTITLE: ${article.title}\nDATE: ${article.date || 'Unknown'}\nCREDIBILITY: ${article.credibility}\nCONTENT: ${article.body}\nKEY ENTITIES: ${JSON.stringify(article.entities)}\n---\n`;\n      \n      if ((context + articleText).length > maxLength) {\n        break;\n      }\n      \n      context += articleText;\n    }\n    \n    return context;\n  }\n\n  /**\n   * Validate swipe card content\n   */\n  private validateSwipeCard(\n    content: SwipeCardContent,\n    articles: ProcessedArticle[]\n  ): { isValid: boolean; errors: string[]; warnings: string[] } {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n\n    // Check headline length\n    if (content.headline.length < 40 || content.headline.length > 60) {\n      warnings.push(`Headline length (${content.headline.length}) should be 40-60 characters`);\n    }\n\n    // Check summary length\n    const summaryWordCount = content.summary.split(/\\s+/).length;\n    if (summaryWordCount < 30 || summaryWordCount > 80) {\n      warnings.push(`Summary word count (${summaryWordCount}) should be 30-80 words`);\n    }\n\n    // Check affected groups\n    if (content.affectedGroups.length < 3 || content.affectedGroups.length > 5) {\n      warnings.push(`Should have 3-5 affected groups, got ${content.affectedGroups.length}`);\n    }\n\n    // Check key needs\n    if (content.keyNeeds.length < 3 || content.keyNeeds.length > 5) {\n      warnings.push(`Should have 3-5 key needs, got ${content.keyNeeds.length}`);\n    }\n\n    // Check for sources\n    if (content.sourcesUsed.length === 0) {\n      errors.push('No sources referenced');\n    }\n\n    const isValid = errors.length === 0;\n\n    return { isValid, errors, warnings };\n  }\n\n  /**\n   * Validate detailed view content\n   */\n  private validateDetailedView(\n    content: DetailedViewContent\n  ): { isValid: boolean; errors: string[]; warnings: string[] } {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n\n    // Check extended summary length\n    const summaryWordCount = content.extendedSummary.split(/\\s+/).length;\n    if (summaryWordCount < 300 || summaryWordCount > 500) {\n      warnings.push(`Extended summary word count (${summaryWordCount}) should be 300-500 words`);\n    }\n\n    // Check timeline has events\n    if (content.timeline.length === 0) {\n      warnings.push('Timeline should have at least some events');\n    }\n\n    // Check organization interventions\n    if (content.howOrganizationsHelp.length === 0) {\n      warnings.push('Should describe how organizations are helping');\n    }\n\n    const isValid = errors.length === 0;\n\n    return { isValid, errors, warnings };\n  }\n}\n","size_bytes":13840},"client/src/pages/Signup.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Link } from \"wouter\";\nimport { Heart } from \"lucide-react\";\n\nexport default function Signup() {\n  const [, setLocation] = useLocation();\n  const [username, setUsername] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const { toast } = useToast();\n  const { signup } = useAuth();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(\"\"); // Clear previous errors\n\n    try {\n      await signup(username, email, password);\n      toast({\n        title: \"Account created!\",\n        description: \"Welcome to AidAtlas. Let's personalize your experience.\",\n      });\n      setLocation(\"/discover\");\n    } catch (error: any) {\n      const errorMessage = error.message || \"Could not create account\";\n      console.error('Signup error:', error);\n      setError(errorMessage);\n      toast({\n        title: \"Signup failed\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-muted/20 to-background flex items-center justify-center px-6\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <Link href=\"/\">\n            <a className=\"inline-flex items-center gap-2 mb-4\">\n              <Heart className=\"h-8 w-8 text-primary fill-primary\" />\n              <span className=\"text-3xl font-display font-bold\">AidAtlas</span>\n            </a>\n          </Link>\n          <h1 className=\"text-4xl font-display font-bold mb-2\">Join AidAtlas</h1>\n          <p className=\"text-muted-foreground\">Create an account to start making a difference</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Sign Up</CardTitle>\n            <CardDescription>Create your account to get started</CardDescription>\n          </CardHeader>\n          <form onSubmit={handleSubmit}>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username\">Username</Label>\n                <Input\n                  id=\"username\"\n                  type=\"text\"\n                  placeholder=\"johndoe\"\n                  value={username}\n                  onChange={(e) => setUsername(e.target.value)}\n                  required\n                  data-testid=\"input-username\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"you@example.com\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  data-testid=\"input-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">Password</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"••••••••\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  minLength={6}\n                  data-testid=\"input-password\"\n                />\n                <p className=\"text-xs text-muted-foreground\">\n                  At least 6 characters\n                </p>\n              </div>\n            </CardContent>\n            <CardFooter className=\"flex flex-col gap-4\">\n              {error && (\n                <div className=\"w-full p-3 bg-destructive/10 border border-destructive/20 rounded-md\">\n                  <p className=\"text-sm text-destructive text-center\" data-testid=\"text-error\">\n                    {error}\n                  </p>\n                </div>\n              )}\n              <Button \n                type=\"submit\" \n                className=\"w-full bg-gradient-to-r from-primary to-chart-1\"\n                disabled={isLoading}\n                data-testid=\"button-signup\"\n              >\n                {isLoading ? \"Creating account...\" : \"Create Account\"}\n              </Button>\n              <p className=\"text-sm text-center text-muted-foreground\">\n                Already have an account?{\" \"}\n                <Link href=\"/login\">\n                  <a className=\"text-primary hover:underline font-medium\" data-testid=\"link-login\">\n                    Log in\n                  </a>\n                </Link>\n              </p>\n            </CardFooter>\n          </form>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5204},"client/src/pages/Login.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Link } from \"wouter\";\nimport { Heart } from \"lucide-react\";\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const { toast } = useToast();\n  const { login } = useAuth();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setError(\"\"); // Clear previous errors\n\n    try {\n      await login(email, password);\n      toast({\n        title: \"Welcome back!\",\n        description: \"Successfully logged in.\",\n      });\n      setLocation(\"/discover\");\n    } catch (error: any) {\n      const errorMessage = error.message || \"Invalid credentials\";\n      console.error('Login error:', error);\n      setError(errorMessage);\n      toast({\n        title: \"Login failed\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background via-muted/20 to-background flex items-center justify-center px-6\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <Link href=\"/\">\n            <a className=\"inline-flex items-center gap-2 mb-4\">\n              <Heart className=\"h-8 w-8 text-primary fill-primary\" />\n              <span className=\"text-3xl font-display font-bold\">AidAtlas</span>\n            </a>\n          </Link>\n          <h1 className=\"text-4xl font-display font-bold mb-2\">Welcome Back</h1>\n          <p className=\"text-muted-foreground\">Log in to continue making an impact</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Log In</CardTitle>\n            <CardDescription>Enter your credentials to access your account</CardDescription>\n          </CardHeader>\n          <form onSubmit={handleSubmit}>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"you@example.com\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  required\n                  data-testid=\"input-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">Password</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"••••••••\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  required\n                  data-testid=\"input-password\"\n                />\n              </div>\n            </CardContent>\n            <CardFooter className=\"flex flex-col gap-4\">\n              {error && (\n                <div className=\"w-full p-3 bg-destructive/10 border border-destructive/20 rounded-md\">\n                  <p className=\"text-sm text-destructive text-center\" data-testid=\"text-error\">\n                    {error}\n                  </p>\n                </div>\n              )}\n              <Button \n                type=\"submit\" \n                className=\"w-full bg-gradient-to-r from-primary to-chart-1\"\n                disabled={isLoading}\n                data-testid=\"button-login\"\n              >\n                {isLoading ? \"Logging in...\" : \"Log In\"}\n              </Button>\n              <p className=\"text-sm text-center text-muted-foreground\">\n                Don't have an account?{\" \"}\n                <Link href=\"/signup\">\n                  <a className=\"text-primary hover:underline font-medium\" data-testid=\"link-signup\">\n                    Sign up\n                  </a>\n                </Link>\n              </p>\n            </CardFooter>\n          </form>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4491},"server/report-generator.ts":{"content":"import { storage } from \"./storage\";\nimport { format, startOfMonth, endOfMonth, subMonths, parseISO } from \"date-fns\";\nimport type { Donation, Conflict, Organization } from \"@shared/schema\";\n\ninterface DonationByCountry {\n  country: string;\n  amount: number;\n  count: number;\n}\n\ninterface DonationByCause {\n  cause: string;\n  amount: number;\n  count: number;\n}\n\ninterface TimelineEntry {\n  date: string;\n  amount: number;\n}\n\ninterface StreakInfo {\n  current: number;\n  longest: number;\n  isActive: boolean;\n}\n\ninterface MonthComparison {\n  previousMonth: string;\n  previousTotal: number;\n  change: number;\n  changePercent: number;\n}\n\nexport class ReportGenerator {\n  async generateMonthlyReport(userId: string, month: string) {\n    const existingReport = await storage.getMonthlyReport(userId, month);\n    if (existingReport) {\n      return existingReport;\n    }\n\n    const monthStart = startOfMonth(parseISO(`${month}-01`));\n    const monthEnd = endOfMonth(monthStart);\n\n    const allDonations = await storage.getDonations(userId);\n    \n    const monthDonations = allDonations.filter(d => {\n      const donationDate = new Date(d.createdAt!);\n      return donationDate >= monthStart && donationDate <= monthEnd;\n    });\n\n    const monthlyTotal = monthDonations.reduce((sum, d) => sum + Number(d.amount), 0);\n    const donationCount = monthDonations.length;\n\n    const previousMonth = format(subMonths(monthStart, 1), 'yyyy-MM');\n    const momChange = await this.calculateMoMChange(userId, month, previousMonth);\n\n    const newBadges = await this.getNewBadgesForMonth(userId, month);\n\n    const streak = await this.calculateStreak(userId, month);\n\n    const donationsByCountry = await this.getDonationsByCountry(userId, monthDonations);\n    const donationsByCause = await this.getDonationsByCause(userId, monthDonations);\n\n    const timeline = await this.getMonthlyTimeline(monthDonations);\n\n    const comparison = await this.getMonthComparison(userId, month);\n\n    const suggestions = this.generateSuggestions(\n      monthlyTotal,\n      donationCount,\n      donationsByCountry,\n      donationsByCause,\n      streak\n    );\n\n    const reportData = {\n      monthlyTotal,\n      donationCount,\n      momChange,\n      newBadges,\n      streak,\n      donationsByCountry,\n      donationsByCause,\n      timeline,\n      comparison,\n      suggestions,\n    };\n\n    const report = await storage.createMonthlyReport({\n      userId,\n      month,\n      reportData,\n    });\n\n    return report;\n  }\n\n  private async calculateMoMChange(\n    userId: string,\n    currentMonth: string,\n    previousMonth: string\n  ): Promise<number> {\n    const currentMonthStart = startOfMonth(parseISO(`${currentMonth}-01`));\n    const currentMonthEnd = endOfMonth(currentMonthStart);\n    \n    const previousMonthStart = startOfMonth(parseISO(`${previousMonth}-01`));\n    const previousMonthEnd = endOfMonth(previousMonthStart);\n\n    const allDonations = await storage.getDonations(userId);\n    \n    const currentDonations = allDonations.filter(d => {\n      const donationDate = new Date(d.createdAt!);\n      return donationDate >= currentMonthStart && donationDate <= currentMonthEnd;\n    });\n    \n    const previousDonations = allDonations.filter(d => {\n      const donationDate = new Date(d.createdAt!);\n      return donationDate >= previousMonthStart && donationDate <= previousMonthEnd;\n    });\n\n    const currentTotal = currentDonations.reduce((sum, d) => sum + Number(d.amount), 0);\n    const previousTotal = previousDonations.reduce((sum, d) => sum + Number(d.amount), 0);\n\n    if (previousTotal === 0) return 0;\n\n    return ((currentTotal - previousTotal) / previousTotal) * 100;\n  }\n\n  private async getNewBadgesForMonth(userId: string, month: string): Promise<any[]> {\n    const monthStart = startOfMonth(parseISO(`${month}-01`));\n    const monthEnd = endOfMonth(monthStart);\n\n    const allBadges = await storage.getUserBadges(userId);\n    \n    const newBadges = allBadges.filter(b => {\n      const earnedDate = new Date(b.earnedAt!);\n      return earnedDate >= monthStart && earnedDate <= monthEnd;\n    });\n\n    return newBadges.map(b => ({\n      type: b.badgeType,\n      name: b.badgeName,\n      icon: b.badgeIcon,\n      earnedAt: b.earnedAt,\n    }));\n  }\n\n  private async calculateStreak(userId: string, currentMonth: string): Promise<StreakInfo> {\n    const allDonations = await storage.getDonations(userId);\n    \n    const monthsWithDonations = new Set<string>();\n    allDonations.forEach(d => {\n      const donationMonth = format(new Date(d.createdAt!), 'yyyy-MM');\n      monthsWithDonations.add(donationMonth);\n    });\n\n    let currentStreak = 0;\n    let longestStreak = 0;\n    let tempStreak = 0;\n    \n    let checkMonth = parseISO(`${currentMonth}-01`);\n    const hasCurrentMonth = monthsWithDonations.has(currentMonth);\n    \n    if (hasCurrentMonth) {\n      currentStreak = 1;\n      tempStreak = 1;\n      \n      for (let i = 1; i < 24; i++) {\n        const prevMonth = format(subMonths(checkMonth, i), 'yyyy-MM');\n        if (monthsWithDonations.has(prevMonth)) {\n          currentStreak++;\n          tempStreak++;\n        } else {\n          break;\n        }\n      }\n    }\n\n    longestStreak = currentStreak;\n\n    const sortedMonths = Array.from(monthsWithDonations).sort();\n    if (sortedMonths.length > 0) {\n      tempStreak = 1;\n      for (let i = 1; i < sortedMonths.length; i++) {\n        const prevDate = parseISO(`${sortedMonths[i - 1]}-01`);\n        const currDate = parseISO(`${sortedMonths[i]}-01`);\n        \n        const monthDiff = Math.abs(\n          (currDate.getFullYear() - prevDate.getFullYear()) * 12 +\n          (currDate.getMonth() - prevDate.getMonth())\n        );\n\n        if (monthDiff === 1) {\n          tempStreak++;\n          longestStreak = Math.max(longestStreak, tempStreak);\n        } else {\n          tempStreak = 1;\n        }\n      }\n    }\n\n    return {\n      current: currentStreak,\n      longest: longestStreak,\n      isActive: hasCurrentMonth,\n    };\n  }\n\n  private async getDonationsByCountry(\n    userId: string,\n    donations: Donation[]\n  ): Promise<DonationByCountry[]> {\n    const conflictIds = [...new Set(donations.map(d => d.conflictId))];\n    \n    const countryMap = new Map<string, { amount: number; count: number }>();\n\n    for (const donation of donations) {\n      const conflict = await storage.getConflict(donation.conflictId);\n      if (conflict) {\n        const existing = countryMap.get(conflict.country) || { amount: 0, count: 0 };\n        countryMap.set(conflict.country, {\n          amount: existing.amount + Number(donation.amount),\n          count: existing.count + 1,\n        });\n      }\n    }\n\n    return Array.from(countryMap.entries())\n      .map(([country, data]) => ({\n        country,\n        amount: data.amount,\n        count: data.count,\n      }))\n      .sort((a, b) => b.amount - a.amount);\n  }\n\n  private async getDonationsByCause(\n    userId: string,\n    donations: Donation[]\n  ): Promise<DonationByCause[]> {\n    const causeMap = new Map<string, { amount: number; count: number }>();\n\n    for (const donation of donations) {\n      const org = await storage.getOrganization(donation.organizationId);\n      if (org && org.causes) {\n        for (const cause of org.causes) {\n          const existing = causeMap.get(cause) || { amount: 0, count: 0 };\n          const shareAmount = Number(donation.amount) / org.causes.length;\n          causeMap.set(cause, {\n            amount: existing.amount + shareAmount,\n            count: existing.count + 1,\n          });\n        }\n      }\n    }\n\n    return Array.from(causeMap.entries())\n      .map(([cause, data]) => ({\n        cause,\n        amount: data.amount,\n        count: data.count,\n      }))\n      .sort((a, b) => b.amount - a.amount);\n  }\n\n  private async getMonthlyTimeline(donations: Donation[]): Promise<TimelineEntry[]> {\n    const dayMap = new Map<string, number>();\n\n    donations.forEach(d => {\n      const day = format(new Date(d.createdAt!), 'yyyy-MM-dd');\n      const existing = dayMap.get(day) || 0;\n      dayMap.set(day, existing + Number(d.amount));\n    });\n\n    return Array.from(dayMap.entries())\n      .map(([date, amount]) => ({ date, amount }))\n      .sort((a, b) => a.date.localeCompare(b.date));\n  }\n\n  private async getMonthComparison(\n    userId: string,\n    month: string\n  ): Promise<MonthComparison> {\n    const previousMonth = format(subMonths(parseISO(`${month}-01`), 1), 'yyyy-MM');\n    const previousReport = await storage.getMonthlyReport(userId, previousMonth);\n\n    const currentMonthStart = startOfMonth(parseISO(`${month}-01`));\n    const currentMonthEnd = endOfMonth(currentMonthStart);\n\n    const allDonations = await storage.getDonations(userId);\n    const currentDonations = allDonations.filter(d => {\n      const donationDate = new Date(d.createdAt!);\n      return donationDate >= currentMonthStart && donationDate <= currentMonthEnd;\n    });\n\n    const currentTotal = currentDonations.reduce((sum, d) => sum + Number(d.amount), 0);\n    const previousTotal = previousReport?.reportData.monthlyTotal || 0;\n\n    const change = currentTotal - previousTotal;\n    const changePercent = previousTotal === 0 ? 0 : (change / previousTotal) * 100;\n\n    return {\n      previousMonth,\n      previousTotal,\n      change,\n      changePercent,\n    };\n  }\n\n  private generateSuggestions(\n    monthlyTotal: number,\n    donationCount: number,\n    byCountry: DonationByCountry[],\n    byCause: DonationByCause[],\n    streak: StreakInfo\n  ): string[] {\n    const suggestions: string[] = [];\n\n    if (monthlyTotal === 0) {\n      suggestions.push(\"Start your humanitarian journey by making your first donation\");\n      return suggestions;\n    }\n\n    if (donationCount === 1) {\n      suggestions.push(\"Diversify your impact by supporting multiple organizations\");\n    }\n\n    if (byCountry.length === 1) {\n      suggestions.push(\"Explore conflicts in other regions to broaden your global impact\");\n    }\n\n    if (byCause.length < 3) {\n      suggestions.push(\"Consider supporting different humanitarian causes\");\n    }\n\n    if (streak.current > 0 && streak.current < 3) {\n      suggestions.push(\n        `Keep your ${streak.current}-month streak going by donating this month!`\n      );\n    }\n\n    if (streak.current >= 3) {\n      suggestions.push(\n        `Amazing! You've maintained a ${streak.current}-month giving streak`\n      );\n    }\n\n    if (monthlyTotal < 50) {\n      suggestions.push(\"Every dollar counts - even small donations make a big difference\");\n    }\n\n    if (suggestions.length === 0) {\n      suggestions.push(\"You're making a real difference in humanitarian causes worldwide\");\n    }\n\n    return suggestions;\n  }\n}\n\nexport const reportGenerator = new ReportGenerator();\n","size_bytes":10708},"server/trust-score-service.ts":{"content":"import { db } from \"./db\";\nimport { organizations, organizationTrustScores, donationFeedback, impactStories } from \"@shared/schema\";\nimport { eq, sql } from \"drizzle-orm\";\n\ninterface TrustScoreBreakdown {\n  financialTransparency: number;\n  impactReporting: number;\n  thirdPartyVerification: number;\n  operationalTransparency: number;\n  accountability: number;\n  communityReputation: number;\n}\n\ninterface TrustScoreResult {\n  score: number;\n  verificationLevel: number;\n  breakdown: TrustScoreBreakdown;\n}\n\nexport class TrustScoreService {\n  /**\n   * Calculate comprehensive trust score (0-100) for an organization\n   * \n   * Scoring breakdown:\n   * - Financial Transparency (25 points): Program expenses, overhead, transparency\n   * - Impact Reporting (20 points): Recent updates, stories published, data quality\n   * - Third-party Verification (20 points): Charity Navigator, GuideStar, BBB\n   * - Operational Transparency (15 points): Years operating, consistent filing, governance\n   * - Accountability (10 points): Verification level, audit availability\n   * - Community Reputation (10 points): User feedback, donation satisfaction\n   */\n  async calculateTrustScore(organizationId: string): Promise<TrustScoreResult> {\n    const org = await this.getOrganizationData(organizationId);\n    \n    if (!org) {\n      throw new Error('Organization not found');\n    }\n\n    let score = 0;\n    const breakdown: TrustScoreBreakdown = {\n      financialTransparency: 0,\n      impactReporting: 0,\n      thirdPartyVerification: 0,\n      operationalTransparency: 0,\n      accountability: 0,\n      communityReputation: 0,\n    };\n\n    // 1. Financial Transparency (25 points)\n    breakdown.financialTransparency = this.scoreFinancialTransparency(org);\n    score += breakdown.financialTransparency;\n\n    // 2. Impact Reporting (20 points)\n    breakdown.impactReporting = this.scoreImpactReporting(org) * 2; // Scale from 10 to 20\n    score += breakdown.impactReporting;\n\n    // 3. Third-party Verification (20 points)\n    breakdown.thirdPartyVerification = Math.min(20, (this.scoreRatings(org) / 30) * 20); // Scale from 30 to 20\n    score += breakdown.thirdPartyVerification;\n\n    // 4. Operational Transparency (15 points)\n    breakdown.operationalTransparency = this.scoreOperationalHistory(org);\n    score += breakdown.operationalTransparency;\n\n    // 5. Accountability (10 points)\n    breakdown.accountability = Math.min(10, (this.scoreVerificationLevel(org) / 15) * 10); // Scale from 15 to 10\n    score += breakdown.accountability;\n\n    // 6. Community Reputation (10 points)\n    breakdown.communityReputation = await this.scoreUserFeedback(organizationId) * 2; // Scale from 5 to 10\n    score += breakdown.communityReputation;\n\n    // Store trust score\n    await this.storeTrustScore(organizationId, {\n      total_score: Math.round(score),\n      breakdown: breakdown,\n      calculated_at: new Date(),\n    });\n\n    return {\n      score: Math.round(score),\n      verificationLevel: org.verificationLevel || 0,\n      breakdown: breakdown,\n    };\n  }\n\n  private scoreRatings(org: any): number {\n    let score = 0;\n\n    // Charity Navigator (up to 15 points)\n    if (org.charityNavigatorRating) {\n      const rating = parseFloat(org.charityNavigatorRating);\n      score += (rating / 4) * 15;\n    }\n\n    // GuideStar Seal (up to 10 points)\n    if (org.guidestarSeal) {\n      const sealPoints: Record<string, number> = {\n        bronze: 3,\n        silver: 5,\n        gold: 8,\n        platinum: 10,\n      };\n      score += sealPoints[org.guidestarSeal.toLowerCase()] || 0;\n    }\n\n    // BBB Accreditation (up to 5 points)\n    if (org.bbbAccredited) {\n      score += 5;\n    }\n\n    return score;\n  }\n\n  private scoreFinancialTransparency(org: any): number {\n    let score = 0;\n\n    // Program expense percentage (up to 15 points)\n    if (org.programExpensePercentage) {\n      const percentage = parseFloat(org.programExpensePercentage);\n      if (percentage >= 85) score += 15;\n      else if (percentage >= 75) score += 12;\n      else if (percentage >= 65) score += 8;\n      else score += 5;\n    }\n\n    // Overhead percentage (up to 10 points)\n    if (org.overheadPercentage) {\n      const overhead = parseFloat(org.overheadPercentage);\n      if (overhead <= 15) score += 10;\n      else if (overhead <= 25) score += 7;\n      else if (overhead <= 35) score += 4;\n      else score += 2;\n    }\n\n    return score;\n  }\n\n  private scoreOperationalHistory(org: any): number {\n    let score = 0;\n\n    // Years operating (up to 10 points)\n    const years = org.yearsOperating || 0;\n    if (years >= 10) score += 10;\n    else if (years >= 5) score += 7;\n    else if (years >= 2) score += 4;\n    else score += 2;\n\n    // Consistent Form 990 filing (up to 5 points)\n    if (org.consistent990Filing) {\n      score += 5;\n    }\n\n    return score;\n  }\n\n  private scoreVerificationLevel(org: any): number {\n    const levelPoints: Record<number, number> = {\n      1: 5,\n      2: 10,\n      3: 15,\n    };\n    return levelPoints[org.verificationLevel] || 0;\n  }\n\n  private scoreImpactReporting(org: any): number {\n    let score = 0;\n\n    // Recent impact updates (up to 5 points)\n    if (org.lastImpactUpdate) {\n      const daysSince = (Date.now() - new Date(org.lastImpactUpdate).getTime()) / (1000 * 60 * 60 * 24);\n      if (daysSince <= 30) score += 5;\n      else if (daysSince <= 90) score += 3;\n      else score += 1;\n    }\n\n    // Impact stories published (up to 5 points)\n    const storyCount = org.impactStoriesCount || 0;\n    if (storyCount >= 10) score += 5;\n    else if (storyCount >= 5) score += 3;\n    else if (storyCount >= 1) score += 1;\n\n    return score;\n  }\n\n  private async scoreUserFeedback(organizationId: string): Promise<number> {\n    const result = await db\n      .select({\n        totalDonations: sql<number>`count(*)`,\n        satisfactionRate: sql<number>`avg(case when ${donationFeedback.userSatisfied} then 1.0 else 0.0 end)`,\n      })\n      .from(donationFeedback)\n      .where(eq(donationFeedback.organizationId, organizationId));\n\n    const feedback = result[0];\n\n    if (!feedback || feedback.totalDonations < 10) {\n      return 3; // Neutral score for new organizations\n    }\n\n    const satisfactionRate = parseFloat(feedback.satisfactionRate as any) || 0;\n    return satisfactionRate * 5; // Up to 5 points\n  }\n\n  private getGrade(score: number): string {\n    if (score >= 90) return 'A+';\n    if (score >= 85) return 'A';\n    if (score >= 80) return 'A-';\n    if (score >= 75) return 'B+';\n    if (score >= 70) return 'B';\n    if (score >= 65) return 'B-';\n    if (score >= 60) return 'C+';\n    if (score >= 55) return 'C';\n    if (score >= 50) return 'C-';\n    return 'D';\n  }\n\n  private async storeTrustScore(\n    organizationId: string,\n    scoreData: { total_score: number; breakdown: TrustScoreBreakdown; calculated_at: Date }\n  ): Promise<void> {\n    // Insert into trust scores history\n    await db.insert(organizationTrustScores).values({\n      organizationId,\n      totalScore: scoreData.total_score,\n      breakdown: scoreData.breakdown,\n    });\n\n    // Update organization record\n    await db\n      .update(organizations)\n      .set({\n        trustScore: scoreData.total_score,\n        trustScoreUpdated: scoreData.calculated_at,\n      })\n      .where(eq(organizations.id, organizationId));\n  }\n\n  private async getOrganizationData(organizationId: string): Promise<any> {\n    const result = await db\n      .select({\n        organization: organizations,\n        impactStoriesCount: sql<number>`(\n          SELECT COUNT(*) \n          FROM ${impactStories} \n          WHERE ${impactStories.organizationId} = ${organizations.id}\n        )`,\n      })\n      .from(organizations)\n      .where(eq(organizations.id, organizationId))\n      .limit(1);\n\n    if (result.length === 0) {\n      return null;\n    }\n\n    return {\n      ...result[0].organization,\n      impactStoriesCount: result[0].impactStoriesCount,\n    };\n  }\n}\n","size_bytes":7922},"client/src/pages/Challenges.tsx":{"content":"import { useState, useEffect, useRef, useCallback } from \"react\";\nimport Navigation from \"@/components/Navigation\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Trophy, Zap, Heart, Target, Users, DollarSign, Award, Sparkles } from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Challenge {\n  id: string;\n  title: string;\n  description: string;\n  xp: number;\n  icon: React.ComponentType<any>;\n  target: number;\n  current: number;\n  type: 'donation' | 'action' | 'streak';\n}\n\nconst DAILY_CHALLENGES: Omit<Challenge, 'current'>[] = [\n  {\n    id: 'daily-donation',\n    title: 'Make a Donation',\n    description: 'Support a cause today',\n    xp: 50,\n    icon: Heart,\n    target: 1,\n    type: 'donation'\n  },\n  {\n    id: 'daily-action',\n    title: 'Take Action',\n    description: 'Join a protest or sign a petition',\n    xp: 30,\n    icon: Users,\n    target: 1,\n    type: 'action'\n  },\n  {\n    id: 'daily-generous',\n    title: 'Generous Giver',\n    description: 'Donate $10 or more',\n    xp: 75,\n    icon: DollarSign,\n    target: 10,\n    type: 'donation'\n  },\n  {\n    id: 'daily-streak',\n    title: 'Keep the Streak',\n    description: 'Donate for 3 consecutive days',\n    xp: 100,\n    icon: Target,\n    target: 3,\n    type: 'streak'\n  }\n];\n\nexport default function Challenges() {\n  const { user, loading } = useAuth();\n  const { toast } = useToast();\n  const [challenges, setChallenges] = useState<Challenge[]>([]);\n  const [completedChallenges, setCompletedChallenges] = useState<Challenge[]>([]);\n  const [totalXP, setTotalXP] = useState(0);\n  const [showPeaceDove, setShowPeaceDove] = useState(false);\n\n  // Refs to hold current state for event listeners\n  const challengesRef = useRef<Challenge[]>([]);\n  const completedChallengesRef = useRef<Challenge[]>([]);\n  const totalXPRef = useRef<number>(0);\n\n  // Update refs when state changes\n  useEffect(() => {\n    challengesRef.current = challenges;\n  }, [challenges]);\n\n  useEffect(() => {\n    completedChallengesRef.current = completedChallenges;\n  }, [completedChallenges]);\n\n  useEffect(() => {\n    totalXPRef.current = totalXP;\n  }, [totalXP]);\n\n  // Load challenges and XP from localStorage on mount\n  useEffect(() => {\n    const savedXP = localStorage.getItem('user-xp');\n    if (savedXP) {\n      setTotalXP(parseInt(savedXP));\n    }\n\n    const savedProgress = localStorage.getItem('challenge-progress');\n    const savedCompleted = localStorage.getItem('challenges-completed-today');\n    const lastReset = localStorage.getItem('challenges-last-reset');\n    const today = new Date().toDateString();\n\n    // Reset daily challenges if it's a new day\n    if (lastReset !== today) {\n      localStorage.setItem('challenges-last-reset', today);\n      localStorage.removeItem('challenge-progress');\n      localStorage.removeItem('challenges-completed-today');\n    }\n\n    const progressData = savedProgress ? JSON.parse(savedProgress) : {};\n    const completedIds = savedCompleted ? JSON.parse(savedCompleted) : [];\n\n    const activeChallenges = DAILY_CHALLENGES\n      .filter(c => !completedIds.includes(c.id))\n      .map(c => ({\n        ...c,\n        current: progressData[c.id] || 0\n      }));\n\n    const completedList = DAILY_CHALLENGES\n      .filter(c => completedIds.includes(c.id))\n      .map(c => ({\n        ...c,\n        current: c.target\n      }));\n\n    setChallenges(activeChallenges);\n    setCompletedChallenges(completedList);\n  }, []);\n\n  // Stable complete challenge function using refs\n  const completeChallenge = useCallback((challenge: Challenge) => {\n    // Use functional update to get latest XP\n    setTotalXP(prevXP => {\n      const newXP = prevXP + challenge.xp;\n      localStorage.setItem('user-xp', newXP.toString());\n      return newXP;\n    });\n\n    // Use functional update for completed challenges\n    setCompletedChallenges(prev => {\n      const updated = [...prev, { ...challenge, current: challenge.target }];\n      const completedIds = updated.map(c => c.id);\n      localStorage.setItem('challenges-completed-today', JSON.stringify(completedIds));\n      \n      // Check if all challenges are complete\n      if (updated.length >= DAILY_CHALLENGES.length) {\n        setTimeout(() => {\n          setShowPeaceDove(true);\n          const badges = JSON.parse(localStorage.getItem('unlocked-badges') || '[]');\n          if (!badges.includes('peace-dove')) {\n            badges.push('peace-dove');\n            localStorage.setItem('unlocked-badges', JSON.stringify(badges));\n          }\n        }, 500);\n      }\n      \n      return updated;\n    });\n\n    // Show toast\n    toast({\n      title: \"Challenge Completed! 🎉\",\n      description: `+${challenge.xp} XP earned`,\n    });\n\n    // Dispatch event for Profile page\n    window.dispatchEvent(new CustomEvent('challenge-completed', {\n      detail: {\n        title: challenge.title,\n        xp: challenge.xp,\n      }\n    }));\n  }, [toast]);\n\n  // Update challenge progress\n  const updateChallengeProgress = useCallback((type: string, value: number) => {\n    setChallenges(prev => {\n      const updated = prev.map(challenge => {\n        if (challenge.type === type) {\n          const newCurrent = type === 'donation' \n            ? challenge.current + value \n            : challenge.current + 1;\n          \n          return { ...challenge, current: Math.min(newCurrent, challenge.target) };\n        }\n        return challenge;\n      });\n\n      // Save progress\n      const progressData = updated.reduce((acc, c) => {\n        acc[c.id] = c.current;\n        return acc;\n      }, {} as Record<string, number>);\n      localStorage.setItem('challenge-progress', JSON.stringify(progressData));\n\n      // Check for completions using refs to avoid stale data\n      updated.forEach(challenge => {\n        if (challenge.current >= challenge.target) {\n          const alreadyCompleted = completedChallengesRef.current.find(c => c.id === challenge.id);\n          if (!alreadyCompleted) {\n            completeChallenge(challenge);\n          }\n        }\n      });\n\n      return updated.filter(c => c.current < c.target);\n    });\n  }, [completeChallenge]);\n\n  // Listen for donation and action events - stable listeners\n  useEffect(() => {\n    const handleDonation = (event: CustomEvent) => {\n      const amount = event.detail?.amount || 0;\n      updateChallengeProgress('donation', amount);\n    };\n\n    const handleAction = () => {\n      updateChallengeProgress('action', 1);\n    };\n\n    window.addEventListener('donation-made', handleDonation as EventListener);\n    window.addEventListener('action-completed', handleAction as EventListener);\n\n    return () => {\n      window.removeEventListener('donation-made', handleDonation as EventListener);\n      window.removeEventListener('action-completed', handleAction as EventListener);\n    };\n  }, [updateChallengeProgress]);\n\n  const closePeaceDovePopup = () => {\n    setShowPeaceDove(false);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navigation />\n        <div className=\"pt-24 pb-12 px-6 text-center\">\n          <p className=\"text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Navigation />\n        <div className=\"pt-24 pb-12 px-6 text-center\">\n          <p className=\"text-muted-foreground\">Please log in to view challenges.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-purple-50/20 dark:via-purple-950/20 to-background\">\n      <Navigation />\n      \n      <div className=\"pt-24 pb-12 px-6\">\n        <div className=\"max-w-4xl mx-auto\">\n          {/* Header */}\n          <div className=\"text-center mb-8\">\n            <div className=\"inline-flex items-center gap-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-full mb-4\">\n              <Trophy className=\"h-5 w-5\" />\n              <span className=\"font-semibold\">{totalXP} XP</span>\n            </div>\n            <h1 className=\"text-4xl font-display font-bold mb-2 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent\">\n              Daily Challenges\n            </h1>\n            <p className=\"text-muted-foreground\">Complete challenges to earn XP and unlock badges</p>\n          </div>\n\n          {/* Active Challenges */}\n          <div className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-4 flex items-center gap-2\">\n              <Zap className=\"h-5 w-5 text-yellow-500\" />\n              Active Challenges\n            </h2>\n            <div className=\"grid gap-4\">\n              {challenges.map((challenge, index) => {\n                const Icon = challenge.icon;\n                const progress = (challenge.current / challenge.target) * 100;\n                \n                return (\n                  <Card \n                    key={challenge.id} \n                    className=\"p-6 bg-gradient-to-br from-white to-purple-50/50 dark:from-gray-900 dark:to-purple-950/20 border-2 hover:border-purple-300 dark:hover:border-purple-700 transition-all duration-300 hover:shadow-lg hover:shadow-purple-200/50 dark:hover:shadow-purple-900/50\"\n                    data-testid={`challenge-${index}`}\n                    style={{\n                      animation: `fadeIn 0.${3 + index}s ease-out`\n                    }}\n                  >\n                    <div className=\"flex items-start justify-between mb-4\">\n                      <div className=\"flex items-start gap-4 flex-1\">\n                        <div className=\"p-3 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl shadow-lg\">\n                          <Icon className=\"h-6 w-6 text-white\" />\n                        </div>\n                        <div className=\"flex-1\">\n                          <h3 className=\"font-semibold text-lg mb-1\">{challenge.title}</h3>\n                          <p className=\"text-sm text-muted-foreground mb-3\">{challenge.description}</p>\n                          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                            <span>{challenge.current} / {challenge.target}</span>\n                          </div>\n                        </div>\n                      </div>\n                      <Badge \n                        className=\"bg-gradient-to-r from-yellow-400 to-orange-400 text-white border-0 shadow-md\"\n                        data-testid={`badge-xp-${index}`}\n                      >\n                        +{challenge.xp} XP\n                      </Badge>\n                    </div>\n\n                    <div className=\"space-y-3\">\n                      <Progress \n                        value={progress} \n                        className=\"h-3 bg-purple-100 dark:bg-purple-950\"\n                        style={{\n                          transition: 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)'\n                        }}\n                      />\n                      <Button \n                        className=\"w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white shadow-lg hover:shadow-xl transition-all duration-300\"\n                        data-testid={`button-start-${index}`}\n                      >\n                        <Sparkles className=\"h-4 w-4 mr-2\" />\n                        Start Challenge\n                      </Button>\n                    </div>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* Completed Today */}\n          {completedChallenges.length > 0 && (\n            <div>\n              <h2 className=\"text-xl font-semibold mb-4 flex items-center gap-2\">\n                <Award className=\"h-5 w-5 text-green-500\" />\n                Completed Today 🎉\n              </h2>\n              <div className=\"grid gap-4\">\n                {completedChallenges.map((challenge, index) => {\n                  const Icon = challenge.icon;\n                  \n                  return (\n                    <Card \n                      key={challenge.id} \n                      className=\"p-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-950/20 dark:to-emerald-950/20 border-2 border-green-300 dark:border-green-700\"\n                      data-testid={`completed-${index}`}\n                      style={{\n                        animation: 'slideIn 0.5s ease-out'\n                      }}\n                    >\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex items-start gap-4 flex-1\">\n                          <div className=\"p-3 bg-gradient-to-br from-green-500 to-emerald-500 rounded-xl shadow-lg\">\n                            <Icon className=\"h-6 w-6 text-white\" />\n                          </div>\n                          <div className=\"flex-1\">\n                            <h3 className=\"font-semibold text-lg mb-1\">{challenge.title}</h3>\n                            <p className=\"text-sm text-muted-foreground mb-2\">{challenge.description}</p>\n                            <Badge className=\"bg-green-500 text-white border-0\">\n                              ✓ Completed\n                            </Badge>\n                          </div>\n                        </div>\n                        <Badge className=\"bg-gradient-to-r from-yellow-400 to-orange-400 text-white border-0 shadow-md\">\n                          +{challenge.xp} XP\n                        </Badge>\n                      </div>\n                    </Card>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Peace Dove Unlocked Popup */}\n      {showPeaceDove && (\n        <div \n          className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-in fade-in duration-300\"\n          onClick={closePeaceDovePopup}\n        >\n          <Card \n            className=\"max-w-md p-8 bg-gradient-to-br from-white to-purple-50 dark:from-gray-900 dark:to-purple-950 text-center relative overflow-hidden\"\n            onClick={(e) => e.stopPropagation()}\n            style={{\n              animation: 'popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)'\n            }}\n          >\n            <div className=\"absolute inset-0 bg-gradient-to-r from-purple-400/20 to-pink-400/20 animate-pulse\" />\n            <div className=\"relative\">\n              <div className=\"mb-6 inline-block p-6 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full shadow-2xl animate-bounce\">\n                <Award className=\"h-16 w-16 text-white\" />\n              </div>\n              <h2 className=\"text-3xl font-display font-bold mb-3 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent\">\n                Peace Dove Unlocked!\n              </h2>\n              <p className=\"text-muted-foreground mb-6\">\n                You've completed all daily challenges! This badge has been added to your profile.\n              </p>\n              <Button \n                onClick={closePeaceDovePopup}\n                className=\"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white shadow-lg\"\n              >\n                Awesome!\n              </Button>\n            </div>\n          </Card>\n        </div>\n      )}\n\n      <style>{`\n        @keyframes fadeIn {\n          from {\n            opacity: 0;\n            transform: translateY(20px);\n          }\n          to {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        }\n\n        @keyframes slideIn {\n          from {\n            opacity: 0;\n            transform: translateX(-20px);\n          }\n          to {\n            opacity: 1;\n            transform: translateX(0);\n          }\n        }\n\n        @keyframes popIn {\n          0% {\n            opacity: 0;\n            transform: scale(0.5);\n          }\n          50% {\n            transform: scale(1.05);\n          }\n          100% {\n            opacity: 1;\n            transform: scale(1);\n          }\n        }\n      `}</style>\n    </div>\n  );\n}\n","size_bytes":16331},"client/src/components/TrustBadge.tsx":{"content":"import { Shield, Star, AlertTriangle, Info, Trophy, Award } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { useQuery } from \"@tanstack/react-query\";\n\ninterface TrustScore {\n  score: number;\n  verificationLevel: number;\n  breakdown: {\n    financialTransparency: number;\n    impactReporting: number;\n    thirdPartyVerification: number;\n    operationalTransparency: number;\n    accountability: number;\n    communityReputation: number;\n  };\n}\n\ninterface TrustBadgeProps {\n  organizationId: string;\n  variant?: \"full\" | \"compact\" | \"mini\";\n}\n\nfunction getTrustLevel(score: number): { \n  level: string; \n  badgeClasses: string; \n  glowClasses: string;\n  icon: typeof Shield;\n  gradient: string;\n} {\n  if (score >= 80) {\n    return {\n      level: \"Excellent\",\n      badgeClasses: \"bg-gradient-to-br from-emerald-400/20 to-emerald-600/20 text-emerald-700 dark:text-emerald-300 border-2 border-emerald-500/40 shadow-lg shadow-emerald-500/20\",\n      glowClasses: \"ring-2 ring-emerald-400/30\",\n      icon: Trophy,\n      gradient: \"from-emerald-400 to-emerald-600\",\n    };\n  } else if (score >= 60) {\n    return {\n      level: \"Good\",\n      badgeClasses: \"bg-gradient-to-br from-blue-400/20 to-blue-600/20 text-blue-700 dark:text-blue-300 border-2 border-blue-500/40 shadow-lg shadow-blue-500/20\",\n      glowClasses: \"ring-2 ring-blue-400/30\",\n      icon: Award,\n      gradient: \"from-blue-400 to-blue-600\",\n    };\n  } else if (score >= 40) {\n    return {\n      level: \"Fair\",\n      badgeClasses: \"bg-gradient-to-br from-yellow-400/20 to-yellow-600/20 text-yellow-700 dark:text-yellow-300 border-2 border-yellow-500/40 shadow-md shadow-yellow-500/10\",\n      glowClasses: \"ring-1 ring-yellow-400/20\",\n      icon: Shield,\n      gradient: \"from-yellow-400 to-yellow-600\",\n    };\n  } else {\n    return {\n      level: \"Limited\",\n      badgeClasses: \"bg-gradient-to-br from-orange-400/20 to-orange-600/20 text-orange-700 dark:text-orange-300 border-2 border-orange-500/40 shadow-md shadow-orange-500/10\",\n      glowClasses: \"ring-1 ring-orange-400/20\",\n      icon: AlertTriangle,\n      gradient: \"from-orange-400 to-orange-600\",\n    };\n  }\n}\n\nfunction getVerificationStars(level: number) {\n  return Array.from({ length: 3 }, (_, i) => i < level);\n}\n\nexport default function TrustBadge({ organizationId, variant = \"full\" }: TrustBadgeProps) {\n  const { data: trustScore, isLoading } = useQuery<TrustScore>({\n    queryKey: [\"/api/organizations\", organizationId, \"trust-score\"],\n  });\n\n  if (isLoading || !trustScore) {\n    return (\n      <div className=\"flex items-center gap-2\">\n        <div className=\"h-6 w-20 bg-muted animate-pulse rounded-full\" />\n      </div>\n    );\n  }\n\n  const { level, badgeClasses, glowClasses, icon: Icon, gradient } = getTrustLevel(trustScore.score);\n  const stars = getVerificationStars(trustScore.verificationLevel);\n\n  if (variant === \"mini\") {\n    return (\n      <TooltipProvider>\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Badge \n              className={`text-xs px-2 py-1 font-bold ${badgeClasses} ${glowClasses}`}\n              data-testid={`badge-trust-mini-${organizationId}`}\n            >\n              <Icon className=\"h-3 w-3 mr-1\" />\n              {trustScore.score}\n            </Badge>\n          </TooltipTrigger>\n          <TooltipContent className=\"max-w-xs p-4 bg-card border-2\">\n            <div className=\"space-y-2\">\n              <div className=\"font-bold text-sm\">Trust Score: {trustScore.score}/100</div>\n              <div className=\"text-xs text-muted-foreground\">\n                This organization has a <strong className=\"text-foreground\">{level}</strong> trust rating based on verified data.\n              </div>\n            </div>\n          </TooltipContent>\n        </Tooltip>\n      </TooltipProvider>\n    );\n  }\n\n  if (variant === \"compact\") {\n    return (\n      <div className=\"flex items-center gap-2 flex-wrap\" data-testid={`trust-badge-compact-${organizationId}`}>\n        <Badge \n          className={`text-xs px-2.5 py-1 font-bold ${badgeClasses}`}\n        >\n          <Icon className=\"h-3.5 w-3.5 mr-1.5\" />\n          <span className=\"font-extrabold\">{trustScore.score}</span>\n          <span className=\"opacity-70 ml-0.5\">/100</span>\n        </Badge>\n        <div className=\"flex items-center gap-0.5\">\n          {stars.map((filled, i) => (\n            <Star\n              key={i}\n              className={`h-3.5 w-3.5 transition-transform hover:scale-110 ${\n                filled ? \"fill-amber-400 text-amber-400 drop-shadow-sm\" : \"text-muted-foreground/40\"\n              }`}\n            />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-3\" data-testid={`trust-badge-full-${organizationId}`}>\n      <div className=\"flex items-center justify-between flex-wrap gap-2\">\n        <div className=\"flex items-center gap-2\">\n          <Badge \n            className={`px-3 py-1.5 font-extrabold text-sm ${badgeClasses}`}\n          >\n            <Icon className=\"h-4 w-4 mr-2\" />\n            Trust: <span className=\"text-base ml-1\">{trustScore.score}</span>\n            <span className=\"opacity-60\">/100</span>\n          </Badge>\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <button className=\"text-muted-foreground hover:text-foreground transition-all hover:scale-110\">\n                  <Info className=\"h-4 w-4\" />\n                </button>\n              </TooltipTrigger>\n              <TooltipContent className=\"max-w-sm p-4 bg-card border-2\" data-testid=\"tooltip-trust-breakdown\">\n                <div className=\"space-y-3\">\n                  <div className=\"font-bold text-sm border-b-2 pb-2 flex items-center gap-2\">\n                    <Icon className=\"h-4 w-4\" />\n                    Trust Score Breakdown\n                  </div>\n                  <div className=\"space-y-2 text-xs\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-muted-foreground\">Financial Transparency</span>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"h-1.5 w-16 bg-muted rounded-full overflow-hidden\">\n                          <div \n                            className={`h-full bg-gradient-to-r ${gradient} rounded-full`}\n                            style={{ width: `${(trustScore.breakdown.financialTransparency / 25) * 100}%` }}\n                          />\n                        </div>\n                        <span className=\"font-bold w-10 text-right\">{trustScore.breakdown.financialTransparency}/25</span>\n                      </div>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-muted-foreground\">Impact Reporting</span>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"h-1.5 w-16 bg-muted rounded-full overflow-hidden\">\n                          <div \n                            className={`h-full bg-gradient-to-r ${gradient} rounded-full`}\n                            style={{ width: `${(trustScore.breakdown.impactReporting / 20) * 100}%` }}\n                          />\n                        </div>\n                        <span className=\"font-bold w-10 text-right\">{trustScore.breakdown.impactReporting}/20</span>\n                      </div>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-muted-foreground\">Third-party Verification</span>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"h-1.5 w-16 bg-muted rounded-full overflow-hidden\">\n                          <div \n                            className={`h-full bg-gradient-to-r ${gradient} rounded-full`}\n                            style={{ width: `${(trustScore.breakdown.thirdPartyVerification / 20) * 100}%` }}\n                          />\n                        </div>\n                        <span className=\"font-bold w-10 text-right\">{trustScore.breakdown.thirdPartyVerification}/20</span>\n                      </div>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-muted-foreground\">Operational Transparency</span>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"h-1.5 w-16 bg-muted rounded-full overflow-hidden\">\n                          <div \n                            className={`h-full bg-gradient-to-r ${gradient} rounded-full`}\n                            style={{ width: `${(trustScore.breakdown.operationalTransparency / 15) * 100}%` }}\n                          />\n                        </div>\n                        <span className=\"font-bold w-10 text-right\">{trustScore.breakdown.operationalTransparency}/15</span>\n                      </div>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-muted-foreground\">Accountability</span>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"h-1.5 w-16 bg-muted rounded-full overflow-hidden\">\n                          <div \n                            className={`h-full bg-gradient-to-r ${gradient} rounded-full`}\n                            style={{ width: `${(trustScore.breakdown.accountability / 10) * 100}%` }}\n                          />\n                        </div>\n                        <span className=\"font-bold w-10 text-right\">{trustScore.breakdown.accountability}/10</span>\n                      </div>\n                    </div>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-muted-foreground\">Community Reputation</span>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"h-1.5 w-16 bg-muted rounded-full overflow-hidden\">\n                          <div \n                            className={`h-full bg-gradient-to-r ${gradient} rounded-full`}\n                            style={{ width: `${(trustScore.breakdown.communityReputation / 10) * 100}%` }}\n                          />\n                        </div>\n                        <span className=\"font-bold w-10 text-right\">{trustScore.breakdown.communityReputation}/10</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n        \n        <div className=\"flex items-center gap-1\">\n          <span className=\"text-xs font-semibold text-muted-foreground mr-1\">Verified:</span>\n          {stars.map((filled, i) => (\n            <Star\n              key={i}\n              className={`h-4 w-4 transition-all ${\n                filled ? \"fill-amber-400 text-amber-400 drop-shadow-md\" : \"text-muted-foreground/30\"\n              }`}\n              data-testid={`star-verification-${i}`}\n            />\n          ))}\n        </div>\n      </div>\n      \n      <div className=\"relative h-3 bg-muted/50 rounded-full overflow-hidden shadow-inner\">\n        <div\n          className={`h-full bg-gradient-to-r ${gradient} rounded-full transition-all duration-700 ease-out shadow-lg`}\n          style={{ width: `${trustScore.score}%` }}\n        />\n        <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shimmer\" />\n      </div>\n    </div>\n  );\n}\n","size_bytes":11807},"server/populate-conflict-details.ts":{"content":"import OpenAI from 'openai';\nimport { db } from './db';\nimport { conflicts } from '../shared/schema';\nimport { eq } from 'drizzle-orm';\n\nconst openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\n// Priority conflicts to populate first (12 most critical)\nconst PRIORITY_COUNTRIES = [\n  'Sudan', 'Yemen', 'Syria', 'Gaza/Palestine', 'Ukraine', 'Nigeria',\n  'Democratic Republic of the Congo', 'Myanmar', 'Haiti', 'Afghanistan', 'Somalia', 'Ethiopia'\n];\n\n// Approved humanitarian needs categories\nconst APPROVED_NEEDS = [\n  'Food Security', 'Medical Care', 'Shelter', 'Clean Water', 'Education', 'Protection'\n];\n\ninterface ExtractedStats {\n  peopleAffected: string | null;\n  internallyDisplaced: string | null;\n  refugeesAbroad: string | null;\n  crisisStartYear: string | null;\n  primaryNeeds: string[];\n  sources: string[];\n}\n\nasync function fetchReliefWebReports(country: string, limit = 5) {\n  try {\n    const response = await fetch('https://api.reliefweb.int/v1/reports', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        appname: 'aidatlas-humanitarian-app',\n        profile: 'full',\n        query: {\n          value: country,\n          operator: 'AND',\n          fields: ['title', 'body', 'country.name']\n        },\n        fields: {\n          include: ['title', 'body', 'date', 'theme', 'vulnerable_groups', 'country', 'disaster', 'source']\n        },\n        limit,\n        sort: ['date:desc']\n      })\n    });\n\n    if (!response.ok) {\n      console.error(`ReliefWeb API error for ${country}: ${response.status}`);\n      return null;\n    }\n\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error(`Failed to fetch ReliefWeb reports for ${country}:`, error);\n    return null;\n  }\n}\n\nfunction extractReportText(reliefWebData: any): string {\n  if (!reliefWebData?.data || reliefWebData.data.length === 0) {\n    return '';\n  }\n\n  const reports = reliefWebData.data.slice(0, 3); // Use top 3 most recent reports\n  const textSections = reports.map((report: any) => {\n    const title = report.fields?.title || '';\n    const body = report.fields?.body || '';\n    const summary = report.fields?.body_html || report.fields?.body || '';\n    \n    // Truncate to avoid token limits (max ~4000 chars per report)\n    const truncatedBody = summary.substring(0, 4000);\n    return `### Report: ${title}\\n${truncatedBody}\\n\\n`;\n  }).join('\\n');\n\n  return textSections;\n}\n\nfunction validateExtractedStats(stats: any, originalText: string): boolean {\n  // Validate peopleAffected format if present\n  if (stats.peopleAffected && !/\\d+(\\.\\d+)?\\s*(million|thousand|billion|M|K|B)/i.test(stats.peopleAffected)) {\n    console.warn('Invalid peopleAffected format:', stats.peopleAffected);\n    return false;\n  }\n\n  // Validate crisisStartYear if present\n  if (stats.crisisStartYear && !/^\\d{4}$/.test(stats.crisisStartYear)) {\n    console.warn('Invalid crisisStartYear format:', stats.crisisStartYear);\n    return false;\n  }\n\n  // Validate primaryNeeds array\n  if (stats.primaryNeeds && Array.isArray(stats.primaryNeeds)) {\n    const invalidNeeds = stats.primaryNeeds.filter((need: string) => !APPROVED_NEEDS.includes(need));\n    if (invalidNeeds.length > 0) {\n      console.warn('Invalid needs detected:', invalidNeeds);\n      stats.primaryNeeds = stats.primaryNeeds.filter((need: string) => APPROVED_NEEDS.includes(need));\n    }\n  }\n\n  return true;\n}\n\nasync function extractStatsWithOpenAI(country: string, reportText: string, retryCount = 0): Promise<ExtractedStats | null> {\n  if (!reportText.trim()) {\n    console.log(`No report text for ${country}, skipping OpenAI extraction`);\n    return null;\n  }\n\n  const prompt = `Extract humanitarian statistics from these UN OCHA ReliefWeb reports about ${country}:\n\n${reportText}\n\nExtract ONLY facts explicitly stated in the reports. Return valid JSON only with this exact structure:\n{\n  \"peopleAffected\": \"number with unit (e.g. '8.3 million') or null\",\n  \"internallyDisplaced\": \"number with unit or null\", \n  \"refugeesAbroad\": \"number with unit or null\",\n  \"crisisStartYear\": \"YYYY or null\",\n  \"primaryNeeds\": [\"array of: Food Security, Medical Care, Shelter, Clean Water, Education, Protection\"],\n  \"sources\": [\"which report each fact came from\"]\n}\n\nCRITICAL RULES:\n- Only extract numbers explicitly stated in reports\n- If not mentioned, return null (don't estimate or assume)\n- Include the unit (million, thousand, etc.)\n- Cite which report each statistic came from\n- Your ENTIRE response must be valid JSON, nothing else\n- Only use needs from this list: Food Security, Medical Care, Shelter, Clean Water, Education, Protection`;\n\n  try {\n    const completion = await openai.chat.completions.create({\n      model: 'gpt-4-turbo-preview',\n      temperature: 0.1,\n      messages: [\n        { \n          role: 'system', \n          content: 'You are a humanitarian data analyst. Extract only factual statistics explicitly stated in source documents. Never estimate or infer. Return valid JSON only.' \n        },\n        { role: 'user', content: prompt }\n      ]\n    });\n\n    let content = completion.choices[0].message.content || '';\n    \n    // Strip markdown code blocks if OpenAI wraps JSON\n    content = content.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n    \n    const stats = JSON.parse(content) as ExtractedStats;\n    \n    // Validate extracted stats\n    if (!validateExtractedStats(stats, reportText)) {\n      console.warn(`Validation failed for ${country}, extracted:`, stats);\n      if (retryCount < 1) {\n        console.log(`Retrying extraction for ${country}...`);\n        await new Promise(resolve => setTimeout(resolve, 1000)); // 1s delay before retry\n        return extractStatsWithOpenAI(country, reportText, retryCount + 1);\n      }\n      return null;\n    }\n\n    console.log(`✓ Extracted stats for ${country}:`, {\n      peopleAffected: stats.peopleAffected || 'none',\n      displaced: stats.internallyDisplaced || 'none',\n      refugees: stats.refugeesAbroad || 'none',\n      startYear: stats.crisisStartYear || 'none',\n      needsCount: stats.primaryNeeds?.length || 0\n    });\n\n    return stats;\n  } catch (error: any) {\n    console.error(`OpenAI extraction failed for ${country}:`, error.message);\n    \n    // Retry once on parsing errors\n    if (retryCount < 1 && (error instanceof SyntaxError || error.message?.includes('JSON'))) {\n      console.log(`Retrying extraction for ${country} due to JSON parse error...`);\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      return extractStatsWithOpenAI(country, reportText, retryCount + 1);\n    }\n    \n    return null;\n  }\n}\n\nasync function updateConflictDetails(conflictId: string, stats: ExtractedStats, sourceData: any) {\n  try {\n    await db.update(conflicts)\n      .set({\n        peopleAffected: stats.peopleAffected,\n        internallyDisplaced: stats.internallyDisplaced,\n        refugeesAbroad: stats.refugeesAbroad,\n        crisisStartYear: stats.crisisStartYear,\n        primaryNeeds: stats.primaryNeeds && stats.primaryNeeds.length > 0 ? stats.primaryNeeds : null,\n        detailsLastUpdated: new Date(),\n        sourceData: sourceData // Store ReliefWeb response for traceability\n      })\n      .where(eq(conflicts.id, conflictId));\n\n    return true;\n  } catch (error) {\n    console.error(`Failed to update conflict ${conflictId}:`, error);\n    return false;\n  }\n}\n\nexport async function populateConflictDetails(priorityOnly = false, dryRun = false) {\n  console.log('🔄 Starting conflict details population...');\n  console.log(`Mode: ${dryRun ? 'DRY RUN' : 'LIVE'}, Priority only: ${priorityOnly}`);\n\n  // Fetch all conflicts\n  const allConflicts = await db.select().from(conflicts);\n  \n  // Separate priority and non-priority conflicts\n  const priorityConflicts = allConflicts.filter(c => \n    PRIORITY_COUNTRIES.some(pc => c.country.toLowerCase().includes(pc.toLowerCase()))\n  );\n  const otherConflicts = allConflicts.filter(c => \n    !PRIORITY_COUNTRIES.some(pc => c.country.toLowerCase().includes(pc.toLowerCase()))\n  );\n\n  const conflictsToProcess = priorityOnly ? priorityConflicts : [...priorityConflicts, ...otherConflicts];\n  \n  console.log(`📊 Processing ${conflictsToProcess.length} conflicts (${priorityConflicts.length} priority, ${otherConflicts.length} others)`);\n\n  const results = {\n    total: conflictsToProcess.length,\n    processed: 0,\n    updated: 0,\n    failed: 0,\n    skipped: 0\n  };\n\n  // Process in batches of 4 with throttling to respect rate limits\n  const BATCH_SIZE = 4;\n  const BATCH_DELAY = 15000; // 15s between batches\n\n  for (let i = 0; i < conflictsToProcess.length; i += BATCH_SIZE) {\n    const batch = conflictsToProcess.slice(i, i + BATCH_SIZE);\n    \n    console.log(`\\n📦 Processing batch ${Math.floor(i / BATCH_SIZE) + 1}/${Math.ceil(conflictsToProcess.length / BATCH_SIZE)}`);\n    \n    await Promise.all(batch.map(async (conflict) => {\n      try {\n        console.log(`\\n🌍 Processing: ${conflict.country}`);\n        results.processed++;\n\n        // Fetch ReliefWeb reports\n        const reliefWebData = await fetchReliefWebReports(conflict.country);\n        if (!reliefWebData || !reliefWebData.data || reliefWebData.data.length === 0) {\n          console.log(`  ⚠️  No ReliefWeb data found for ${conflict.country}`);\n          results.skipped++;\n          return;\n        }\n\n        // Extract text from reports\n        const reportText = extractReportText(reliefWebData);\n        if (!reportText) {\n          console.log(`  ⚠️  No report text extracted for ${conflict.country}`);\n          results.skipped++;\n          return;\n        }\n\n        // Extract stats using OpenAI\n        const stats = await extractStatsWithOpenAI(conflict.country, reportText);\n        if (!stats) {\n          console.log(`  ❌ Failed to extract stats for ${conflict.country}`);\n          results.failed++;\n          return;\n        }\n\n        // Update database (unless dry run)\n        if (!dryRun) {\n          const updated = await updateConflictDetails(conflict.id, stats, reliefWebData);\n          if (updated) {\n            console.log(`  ✅ Updated ${conflict.country}`);\n            results.updated++;\n          } else {\n            console.log(`  ❌ Failed to update database for ${conflict.country}`);\n            results.failed++;\n          }\n        } else {\n          console.log(`  🔍 DRY RUN - Would update ${conflict.country} with:`, stats);\n          results.updated++;\n        }\n\n      } catch (error: any) {\n        console.error(`  ❌ Error processing ${conflict.country}:`, error.message);\n        results.failed++;\n      }\n    }));\n\n    // Throttle between batches (except for last batch)\n    if (i + BATCH_SIZE < conflictsToProcess.length) {\n      console.log(`\\n⏸️  Waiting ${BATCH_DELAY / 1000}s before next batch...`);\n      await new Promise(resolve => setTimeout(resolve, BATCH_DELAY));\n    }\n  }\n\n  console.log('\\n✨ Population complete!');\n  console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');\n  console.log(`Total conflicts: ${results.total}`);\n  console.log(`Successfully updated: ${results.updated}`);\n  console.log(`Failed: ${results.failed}`);\n  console.log(`Skipped (no data): ${results.skipped}`);\n  console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');\n\n  return results;\n}\n\n// Run if called directly\nif (import.meta.url === `file://${process.argv[1]}`) {\n  const args = process.argv.slice(2);\n  const priorityOnly = args.includes('--priority');\n  const dryRun = args.includes('--dry-run');\n  \n  populateConflictDetails(priorityOnly, dryRun)\n    .then((results) => {\n      console.log('\\n📊 Final results:', results);\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error('\\n❌ Fatal error:', error);\n      process.exit(1);\n    });\n}\n","size_bytes":11954},"server/automated-scraper-cron.ts":{"content":"/**\n * Automated Daily Conflict Scraping\n * Runs at midnight UTC to update conflict database from trusted sources\n */\n\nimport type { IStorage } from './storage';\n\ninterface ScraperConfig {\n  daysBack: number;\n  processLimit: number;\n  enableQualityControl: boolean;\n}\n\nexport class AutomatedScraper {\n  private storage: IStorage;\n  private isRunning: boolean = false;\n  private lastRunTime: Date | null = null;\n  private cronInterval: NodeJS.Timeout | null = null;\n\n  constructor(storage: IStorage) {\n    this.storage = storage;\n  }\n\n  /**\n   * Start automated daily scraping at midnight UTC\n   */\n  startDailyScraping() {\n    console.log('[AutoScraper] Starting automated daily scraping job');\n    \n    // Calculate milliseconds until next midnight UTC\n    const now = new Date();\n    const nextMidnight = new Date(Date.UTC(\n      now.getUTCFullYear(),\n      now.getUTCMonth(),\n      now.getUTCDate() + 1,\n      0, 0, 0, 0\n    ));\n    const msUntilMidnight = nextMidnight.getTime() - now.getTime();\n\n    // Schedule first run at next midnight\n    setTimeout(() => {\n      this.runDailyScrape();\n      \n      // Then run every 24 hours\n      this.cronInterval = setInterval(() => {\n        this.runDailyScrape();\n      }, 24 * 60 * 60 * 1000); // 24 hours in milliseconds\n    }, msUntilMidnight);\n\n    console.log(`[AutoScraper] Next scrape scheduled for ${nextMidnight.toISOString()}`);\n  }\n\n  /**\n   * Stop automated scraping\n   */\n  stopDailyScraping() {\n    if (this.cronInterval) {\n      clearInterval(this.cronInterval);\n      this.cronInterval = null;\n      console.log('[AutoScraper] Stopped automated scraping');\n    }\n  }\n\n  /**\n   * Run the daily scraping workflow\n   */\n  async runDailyScrape() {\n    if (this.isRunning) {\n      console.warn('[AutoScraper] Scrape already in progress, skipping');\n      return;\n    }\n\n    this.isRunning = true;\n    const startTime = new Date();\n    console.log(`[AutoScraper] Starting daily scrape at ${startTime.toISOString()}`);\n\n    try {\n      await this.executeScrape();\n\n      this.lastRunTime = new Date();\n      const duration = (this.lastRunTime.getTime() - startTime.getTime()) / 1000;\n\n      console.log(`[AutoScraper] ✓ Daily scrape completed in ${duration}s`);\n\n    } catch (error) {\n      console.error('[AutoScraper] Daily scrape failed:', error);\n      \n      // Clear flag before retrying\n      this.isRunning = false;\n      \n      // Retry logic: wait 5 minutes and try again (max 3 retries)\n      await this.retryWithBackoff(3);\n      return; // Exit early, don't clear flag again\n      \n    } finally {\n      this.isRunning = false;\n    }\n  }\n\n  /**\n   * Execute the scraping process (internal worker method)\n   */\n  private async executeScrape() {\n    const config: ScraperConfig = {\n      daysBack: 7, // Look back 7 days for daily updates\n      processLimit: 50,\n      enableQualityControl: true,\n    };\n\n    // 1. Scrape from ReliefWeb\n    const reliefWebResults = await this.scrapeReliefWeb(config);\n    \n    // 2. TODO: Add ACLED API scraping\n    // 3. TODO: Add UNHCR Data API scraping\n    // 4. TODO: Add ICRC RSS scraping\n\n    const totalScraped = reliefWebResults.scraped;\n    const totalPublished = reliefWebResults.published;\n\n    console.log(`[AutoScraper] Results: ${totalScraped} scraped, ${totalPublished} published`);\n  }\n\n  /**\n   * Scrape from ReliefWeb API\n   */\n  private async scrapeReliefWeb(config: ScraperConfig): Promise<{ scraped: number; published: number }> {\n    try {\n      const { ReliefWebScraper } = await import('./reliefweb-scraper');\n      const scraper = new ReliefWebScraper();\n      \n      console.log('[AutoScraper] Fetching from ReliefWeb...');\n      const conflicts = await scraper.scrape(config.daysBack);\n      \n      const scraped = conflicts.size;\n      let published = 0;\n\n      // Process each country's reports\n      for (const [, conflictData] of Array.from(conflicts)) {\n        try {\n          // Create simplified conflict profile (no AI processing for now)\n          const conflict = await this.storage.createConflict({\n            country: conflictData.countryName,\n            region: this.determineRegion(conflictData.countryName),\n            title: `${conflictData.countryName} Humanitarian Situation`,\n            summary: conflictData.reports[0]?.title || 'Humanitarian needs identified',\n            severityLevel: this.determineSeverity(conflictData.reports.length),\n            affectedGroups: conflictData.vulnerableGroups,\n            imageUrl: null,\n            source: 'reliefweb',\n            needsReview: false,\n            sourceData: {\n              reportCount: conflictData.reports.length,\n              sources: conflictData.sources,\n              themes: conflictData.themes,\n              disasters: conflictData.disasters,\n            },\n          });\n\n          published++;\n          console.log(`[AutoScraper] ✓ Published conflict: ${conflict.country}`);\n\n        } catch (error) {\n          console.error(`[AutoScraper] Failed to publish ${conflictData.countryName}:`, error);\n        }\n      }\n\n      return { scraped, published };\n\n    } catch (error: any) {\n      // Handle known ReliefWeb API 400 errors (pending API approval)\n      if (error?.message?.includes('400 Bad Request') || error?.message?.includes('ReliefWeb API error')) {\n        console.log('[AutoScraper] ReliefWeb API access pending approval - skipping ReliefWeb scraper');\n        console.log('[AutoScraper] Action required: Apply for ReliefWeb API approval at https://reliefweb.int/help/api');\n        return { scraped: 0, published: 0 };\n      }\n      \n      console.error('[AutoScraper] ReliefWeb scraping failed:', error);\n      throw error; // Re-throw for retry logic\n    }\n  }\n\n  /**\n   * Retry with exponential backoff\n   */\n  private async retryWithBackoff(maxRetries: number) {\n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      console.log(`[AutoScraper] Retry attempt ${attempt}/${maxRetries} in 5 minutes...`);\n      \n      await new Promise(resolve => setTimeout(resolve, 5 * 60 * 1000)); // 5 minutes\n      \n      try {\n        // Call internal scrape worker directly (isRunning already cleared by caller)\n        await this.executeScrape();\n        console.log(`[AutoScraper] Retry ${attempt} succeeded`);\n        this.lastRunTime = new Date();\n        return;\n      } catch (error) {\n        console.error(`[AutoScraper] Retry ${attempt} failed:`, error);\n      }\n    }\n    \n    console.error('[AutoScraper] All retry attempts exhausted');\n  }\n\n  /**\n   * Determine region from country name\n   */\n  private determineRegion(countryName: string): string {\n    const lowerName = countryName.toLowerCase();\n    \n    if (lowerName.includes('syria') || lowerName.includes('yemen') || lowerName.includes('iraq') || lowerName.includes('lebanon') || lowerName.includes('gaza') || lowerName.includes('palestine')) {\n      return 'Middle East';\n    }\n    if (lowerName.includes('somalia') || lowerName.includes('ethiopia') || lowerName.includes('kenya') || lowerName.includes('sudan') || lowerName.includes('south sudan') || lowerName.includes('uganda')) {\n      return 'Africa';\n    }\n    if (lowerName.includes('ukraine') || lowerName.includes('poland') || lowerName.includes('belarus')) {\n      return 'Eastern Europe';\n    }\n    if (lowerName.includes('afghanistan') || lowerName.includes('pakistan') || lowerName.includes('bangladesh')) {\n      return 'South Asia';\n    }\n    if (lowerName.includes('myanmar') || lowerName.includes('philippines')) {\n      return 'Southeast Asia';\n    }\n    if (lowerName.includes('nigeria') || lowerName.includes('cameroon') || lowerName.includes('mali') || lowerName.includes('burkina') || lowerName.includes('niger') || lowerName.includes('chad')) {\n      return 'Africa';\n    }\n    if (lowerName.includes('haiti') || lowerName.includes('venezuela') || lowerName.includes('colombia')) {\n      return 'Caribbean & Latin America';\n    }\n    if (lowerName.includes('tajikistan') || lowerName.includes('kyrgyzstan')) {\n      return 'Central Asia';\n    }\n    if (lowerName.includes('congo') || lowerName.includes('drc') || lowerName.includes('central african')) {\n      return 'Africa';\n    }\n    \n    return 'Other';\n  }\n\n  /**\n   * Determine severity from report count\n   */\n  private determineSeverity(reportCount: number): 'Critical' | 'High' | 'Moderate' {\n    if (reportCount >= 10) return 'Critical';\n    if (reportCount >= 5) return 'High';\n    return 'Moderate';\n  }\n\n  /**\n   * Get last run status\n   */\n  getStatus() {\n    return {\n      isRunning: this.isRunning,\n      lastRunTime: this.lastRunTime,\n      nextRunTime: this.cronInterval ? this.calculateNextMidnight() : null,\n    };\n  }\n\n  private calculateNextMidnight(): Date {\n    const now = new Date();\n    return new Date(Date.UTC(\n      now.getUTCFullYear(),\n      now.getUTCMonth(),\n      now.getUTCDate() + 1,\n      0, 0, 0, 0\n    ));\n  }\n}\n","size_bytes":8896},"server/manual-statistics-seed.ts":{"content":"import { db } from './db';\nimport { conflicts } from '../shared/schema';\nimport { eq } from 'drizzle-orm';\n\n// Verified statistics from UN OCHA, UNHCR, and other trusted humanitarian sources\n// All data sourced from web searches of official UN websites (November 2024 - February 2025)\n\nconst verifiedStats = [\n  {\n    country: 'Sudan',\n    peopleAffected: '30.4 million',\n    internallyDisplaced: '11-12 million',\n    refugeesAbroad: '3 million',\n    crisisStartYear: '2023',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Clean Water', 'Protection'],\n    source: 'UN OCHA December 2024'\n  },\n  {\n    country: 'Yemen',\n    peopleAffected: '19.5 million',\n    internallyDisplaced: '4.5 million',\n    refugeesAbroad: null,\n    crisisStartYear: '2014',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Clean Water', 'Protection'],\n    source: 'UNHCR/UN OCHA March 2025'\n  },\n  {\n    country: 'Gaza/Palestine',\n    peopleAffected: '2.1 million',\n    internallyDisplaced: '1.9 million',\n    refugeesAbroad: null,\n    crisisStartYear: '2023',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Clean Water', 'Protection'],\n    source: 'UN OCHA October 2025'\n  },\n  {\n    country: 'Syria',\n    peopleAffected: '16.5 million',\n    internallyDisplaced: '7.4 million',\n    refugeesAbroad: '6.0 million',\n    crisisStartYear: '2011',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Protection', 'Education'],\n    source: 'UNHCR 2024-2025'\n  },\n  {\n    country: 'Nigeria',\n    peopleAffected: '8.3 million',\n    internallyDisplaced: '2 million',\n    refugeesAbroad: null,\n    crisisStartYear: '2009',\n    primaryNeeds: ['Food Security', 'Protection', 'Shelter'],\n    source: 'UN OCHA 2024'\n  },\n  {\n    country: 'South Sudan',\n    peopleAffected: '7.1 million',\n    internallyDisplaced: '2.2 million',\n    refugeesAbroad: '2.3 million',\n    crisisStartYear: '2013',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Clean Water'],\n    source: 'UNHCR/UN OCHA 2024'\n  },\n  {\n    country: 'Democratic Republic of the Congo',\n    peopleAffected: '25.4 million',\n    internallyDisplaced: '6.9 million',\n    refugeesAbroad: '1.1 million',\n    crisisStartYear: '1996',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Protection', 'Clean Water'],\n    source: 'UN OCHA 2024'\n  },\n  {\n    country: 'Myanmar',\n    peopleAffected: '18.6 million',\n    internallyDisplaced: '3.0 million',\n    refugeesAbroad: '1.3 million',\n    crisisStartYear: '2021',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Protection'],\n    source: 'UNHCR/UN OCHA 2024'\n  },\n  {\n    country: 'Afghanistan',\n    peopleAffected: '23.7 million',\n    internallyDisplaced: '3.2 million',\n    refugeesAbroad: '5.7 million',\n    crisisStartYear: '1978',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Clean Water', 'Education'],\n    source: 'UNHCR 2024'\n  },\n  {\n    country: 'Somalia',\n    peopleAffected: '8.7 million',\n    internallyDisplaced: '3.8 million',\n    refugeesAbroad: '1.1 million',\n    crisisStartYear: '1991',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Clean Water', 'Shelter'],\n    source: 'UN OCHA 2024'\n  },\n  {\n    country: 'Ethiopia',\n    peopleAffected: '21.4 million',\n    internallyDisplaced: '4.5 million',\n    refugeesAbroad: '1.1 million',\n    crisisStartYear: '2020',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Protection'],\n    source: 'UN OCHA 2024'\n  },\n  {\n    country: 'Ukraine',\n    peopleAffected: '14.6 million',\n    internallyDisplaced: '3.7 million',\n    refugeesAbroad: '6.5 million',\n    crisisStartYear: '2022',\n    primaryNeeds: ['Shelter', 'Food Security', 'Medical Care', 'Protection'],\n    source: 'UNHCR/UN OCHA 2024'\n  },\n  {\n    country: 'Haiti',\n    peopleAffected: '5.5 million',\n    internallyDisplaced: '700,000',\n    refugeesAbroad: null,\n    crisisStartYear: '2021',\n    primaryNeeds: ['Food Security', 'Protection', 'Medical Care', 'Shelter'],\n    source: 'UN OCHA 2024'\n  },\n  {\n    country: 'Lebanon',\n    peopleAffected: '3.3 million',\n    internallyDisplaced: '1.1 million',\n    refugeesAbroad: null,\n    crisisStartYear: '2019',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter'],\n    source: 'UN OCHA 2024'\n  },\n  {\n    country: 'Mozambique',\n    peopleAffected: '3.3 million',\n    internallyDisplaced: '1.0 million',\n    refugeesAbroad: null,\n    crisisStartYear: '2017',\n    primaryNeeds: ['Food Security', 'Shelter', 'Protection', 'Medical Care'],\n    source: 'UNHCR 2024'\n  },\n  {\n    country: 'Democratic Republic of Congo',\n    peopleAffected: '27 million',\n    internallyDisplaced: '6.9 million',\n    refugeesAbroad: '1 million',\n    crisisStartYear: '1996',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Clean Water', 'Protection'],\n    source: 'UN OCHA 2025'\n  },\n  {\n    country: 'Cameroon',\n    peopleAffected: '3.3 million',\n    internallyDisplaced: '969,000',\n    refugeesAbroad: '431,000',\n    crisisStartYear: '2014',\n    primaryNeeds: ['Food Security', 'Shelter', 'Protection', 'Medical Care'],\n    source: 'UN OCHA/UNHCR 2025'\n  },\n  {\n    country: 'Chad',\n    peopleAffected: '7.8 million',\n    internallyDisplaced: '262,000',\n    refugeesAbroad: '723,000',\n    crisisStartYear: '2003',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Clean Water'],\n    source: 'UN OCHA 2025'\n  },\n  {\n    country: 'Mali',\n    peopleAffected: '6.4 million',\n    internallyDisplaced: '378,000',\n    refugeesAbroad: '318,000',\n    crisisStartYear: '2012',\n    primaryNeeds: ['Food Security', 'Protection', 'Medical Care', 'Shelter'],\n    source: 'UN OCHA 2025'\n  },\n  {\n    country: 'Burkina Faso',\n    peopleAffected: '5.9 million',\n    internallyDisplaced: '2 million',\n    refugeesAbroad: null,\n    crisisStartYear: '2015',\n    primaryNeeds: ['Food Security', 'Protection', 'Medical Care', 'Education'],\n    source: 'UN OCHA 2025'\n  },\n  {\n    country: 'Central African Republic',\n    peopleAffected: '2.4 million',\n    internallyDisplaced: '465,000',\n    refugeesAbroad: '439,000',\n    crisisStartYear: '2013',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Protection', 'Shelter'],\n    source: 'UN OCHA 2025'\n  },\n  {\n    country: 'Niger',\n    peopleAffected: '2.6 million',\n    internallyDisplaced: '507,000',\n    refugeesAbroad: '433,000',\n    crisisStartYear: '2015',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Shelter', 'Protection'],\n    source: 'UN OCHA/IOM 2025'\n  },\n  {\n    country: 'Zimbabwe',\n    peopleAffected: '7.6 million',\n    internallyDisplaced: null,\n    refugeesAbroad: null,\n    crisisStartYear: '2019',\n    primaryNeeds: ['Food Security', 'Clean Water', 'Medical Care'],\n    source: 'UN OCHA 2024-2025'\n  },\n  {\n    country: 'Kenya',\n    peopleAffected: '2.8 million',\n    internallyDisplaced: '330,000',\n    refugeesAbroad: null,\n    crisisStartYear: '2020',\n    primaryNeeds: ['Food Security', 'Clean Water', 'Medical Care', 'Shelter'],\n    source: 'UN OCHA 2025'\n  },\n  {\n    country: 'Uganda',\n    peopleAffected: '1.8 million',\n    internallyDisplaced: null,\n    refugeesAbroad: null,\n    crisisStartYear: '2013',\n    primaryNeeds: ['Food Security', 'Shelter', 'Medical Care', 'Protection'],\n    source: 'UNHCR 2024-2025'\n  },\n  {\n    country: 'Colombia',\n    peopleAffected: '9.1 million',\n    internallyDisplaced: '7 million',\n    refugeesAbroad: null,\n    crisisStartYear: '1960',\n    primaryNeeds: ['Protection', 'Food Security', 'Medical Care', 'Shelter'],\n    source: 'UN OCHA 2025'\n  },\n  {\n    country: 'Venezuela',\n    peopleAffected: '7.6 million',\n    internallyDisplaced: null,\n    refugeesAbroad: '7.7 million',\n    crisisStartYear: '2014',\n    primaryNeeds: ['Food Security', 'Medical Care', 'Protection'],\n    source: 'UN OCHA/R4V 2024-2025'\n  },\n  {\n    country: 'Tajikistan',\n    peopleAffected: '10,000',\n    internallyDisplaced: null,\n    refugeesAbroad: null,\n    crisisStartYear: '2021',\n    primaryNeeds: ['Food Security', 'Shelter', 'Protection'],\n    source: 'UNHCR 2024-2025'\n  },\n  {\n    country: 'Iraq',\n    peopleAffected: '3 million',\n    internallyDisplaced: '1 million',\n    refugeesAbroad: null,\n    crisisStartYear: '2014',\n    primaryNeeds: ['Shelter', 'Food Security', 'Medical Care', 'Clean Water'],\n    source: 'IOM/UN OCHA 2024'\n  },\n  {\n    country: 'Bangladesh',\n    peopleAffected: '18 million',\n    internallyDisplaced: '1 million',\n    refugeesAbroad: null,\n    crisisStartYear: '2017',\n    primaryNeeds: ['Food Security', 'Shelter', 'Medical Care', 'Protection'],\n    source: 'UN OCHA/UNHCR 2024-2025'\n  },\n  {\n    country: 'Pakistan',\n    peopleAffected: '6.3 million',\n    internallyDisplaced: '143,000',\n    refugeesAbroad: null,\n    crisisStartYear: '2022',\n    primaryNeeds: ['Food Security', 'Shelter', 'Clean Water', 'Medical Care'],\n    source: 'UN OCHA 2024-2025'\n  },\n  {\n    country: 'Philippines',\n    peopleAffected: '13 million',\n    internallyDisplaced: '115,000',\n    refugeesAbroad: null,\n    crisisStartYear: '2013',\n    primaryNeeds: ['Shelter', 'Food Security', 'Medical Care', 'Clean Water'],\n    source: 'UN OCHA 2024-2025'\n  }\n];\n\nexport async function seedManualStatistics() {\n  console.log('🌱 Seeding verified humanitarian statistics...\\n');\n  \n  let updated = 0;\n  let notFound = 0;\n  \n  for (const stat of verifiedStats) {\n    try {\n      // Find conflict by country\n      const existingConflicts = await db.select()\n        .from(conflicts)\n        .where(eq(conflicts.country, stat.country));\n      \n      if (existingConflicts.length === 0) {\n        console.log(`⚠️  Conflict not found: ${stat.country}`);\n        notFound++;\n        continue;\n      }\n      \n      const conflict = existingConflicts[0];\n      \n      // Update with verified statistics\n      await db.update(conflicts)\n        .set({\n          peopleAffected: stat.peopleAffected,\n          internallyDisplaced: stat.internallyDisplaced,\n          refugeesAbroad: stat.refugeesAbroad,\n          crisisStartYear: stat.crisisStartYear,\n          primaryNeeds: stat.primaryNeeds,\n          detailsLastUpdated: new Date(),\n          sourceData: {\n            manualVerification: true,\n            verifiedSource: stat.source,\n            verifiedDate: new Date().toISOString()\n          }\n        })\n        .where(eq(conflicts.id, conflict.id));\n      \n      console.log(`✅ ${stat.country}: ${stat.peopleAffected} affected, ${stat.internallyDisplaced} displaced`);\n      updated++;\n    } catch (error) {\n      console.error(`❌ Error updating ${stat.country}:`, error);\n    }\n  }\n  \n  console.log('\\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');\n  console.log(`✨ Seeding complete!`);\n  console.log(`   Updated: ${updated} conflicts`);\n  console.log(`   Not found: ${notFound} conflicts`);\n  console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\\n');\n}\n\n// Run if called directly\nif (import.meta.url === `file://${process.argv[1]}`) {\n  seedManualStatistics()\n    .then(() => {\n      console.log('✅ Manual statistics seed completed successfully');\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error('❌ Fatal error:', error);\n      process.exit(1);\n    });\n}\n","size_bytes":11312},"server/real-conflicts-seed.ts":{"content":"/**\n * Real conflict data from verified humanitarian sources\n * Sources: UN OCHA, UNHCR, ICRC, humanitarian news (as of November 2025)\n */\n\nexport const REAL_CONFLICTS_2025 = [\n  // MIDDLE EAST\n  { country: \"Yemen\", region: \"Middle East\", title: \"Yemen Humanitarian Emergency\", summary: \"Over 21.6 million people need humanitarian assistance in Yemen, making it one of the world's worst humanitarian crises. Ongoing conflict, economic collapse, and widespread disease outbreaks continue to devastate communities.\", severityLevel: \"Critical\", affectedGroups: [\"Children\", \"Women\", \"Internally Displaced\", \"Malnourished\"], source: \"reliefweb\" },\n  { country: \"Syria\", region: \"Middle East\", title: \"Syria Humanitarian Crisis\", summary: \"After 12+ years of conflict, 15.3 million Syrians need humanitarian assistance. Infrastructure destruction, displacement, and economic collapse affect millions across the country.\", severityLevel: \"Critical\", affectedGroups: [\"Children\", \"Women\", \"Refugees\", \"Internally Displaced\"], source: \"reliefweb\" },\n  { country: \"Gaza/Palestine\", region: \"Middle East\", title: \"Gaza Humanitarian Emergency\", summary: \"Ongoing conflict has created severe humanitarian needs affecting over 2 million people. Limited access to healthcare, clean water, and basic services continues.\", severityLevel: \"Critical\", affectedGroups: [\"Children\", \"Women\", \"Civilians\", \"Injured\"], source: \"reliefweb\" },\n  { country: \"Lebanon\", region: \"Middle East\", title: \"Lebanon Economic & Refugee Crisis\", summary: \"Severe economic collapse has left 80% of the population in poverty. The healthcare system is near collapse with critical shortages in electricity, medicine, and basic services. Lebanon faces one of the worst economic crises in modern history, further strained by hosting 1.5 million refugees.\", severityLevel: \"High\", affectedGroups: [\"Elderly\", \"Children\", \"Poor\", \"Chronically ill\"], source: \"reliefweb\" },\n  \n  // AFRICA\n  { country: \"Sudan\", region: \"Africa\", title: \"Sudan Conflict Crisis\", summary: \"Ongoing armed conflict has displaced over 7 million people. Widespread violence, food insecurity, and limited healthcare access create urgent humanitarian needs.\", severityLevel: \"Critical\", affectedGroups: [\"Internally Displaced\", \"Children\", \"Women\", \"Refugees\"], source: \"reliefweb\" },\n  { country: \"Ethiopia\", region: \"Africa\", title: \"Ethiopia Humanitarian Emergency\", summary: \"Multiple conflicts and drought affect over 20 million people. Tigray region recovery continues while other areas face renewed violence and displacement.\", severityLevel: \"Critical\", affectedGroups: [\"Internally Displaced\", \"Drought-affected\", \"Children\", \"Malnourished\"], source: \"reliefweb\" },\n  { country: \"Somalia\", region: \"Africa\", title: \"Somalia Drought & Conflict Crisis\", summary: \"Severe drought combined with ongoing conflict affects 8.25 million people. Widespread malnutrition, disease outbreaks, and displacement continue.\", severityLevel: \"Critical\", affectedGroups: [\"Children\", \"Pastoralists\", \"Internally Displaced\", \"Malnourished\"], source: \"reliefweb\" },\n  { country: \"Democratic Republic of Congo\", region: \"Africa\", title: \"DRC Humanitarian Emergency\", summary: \"Eastern DRC faces renewed violence displacing millions. Over 26 million people need humanitarian assistance across the country.\", severityLevel: \"Critical\", affectedGroups: [\"Internally Displaced\", \"Women\", \"Children\", \"Refugees\"], source: \"reliefweb\" },\n  { country: \"South Sudan\", region: \"Africa\", title: \"South Sudan Humanitarian Crisis\", summary: \"Ongoing conflict and flooding affect 9.4 million people. Widespread food insecurity, disease outbreaks, and displacement continue.\", severityLevel: \"Critical\", affectedGroups: [\"Internally Displaced\", \"Flood-affected\", \"Children\", \"Malnourished\"], source: \"reliefweb\" },\n  { country: \"Nigeria\", region: \"Africa\", title: \"Northeast Nigeria Humanitarian Emergency\", summary: \"Boko Haram insurgency and farmer-herder conflicts affect 8.3 million people in northeastern states. Widespread displacement and food insecurity.\", severityLevel: \"High\", affectedGroups: [\"Internally Displaced\", \"Children\", \"Women\", \"Farmers\"], source: \"reliefweb\" },\n  { country: \"Burkina Faso\", region: \"Africa\", title: \"Burkina Faso Conflict & Displacement Crisis\", summary: \"Armed group violence has displaced over 2 million people. Rapid deterioration of security situation creates widespread humanitarian needs.\", severityLevel: \"High\", affectedGroups: [\"Internally Displaced\", \"Children\", \"Women\", \"Farmers\"], source: \"reliefweb\" },\n  { country: \"Mali\", region: \"Africa\", title: \"Mali Humanitarian Crisis\", summary: \"Ongoing conflict and intercommunal violence affect millions. Displacement, food insecurity, and limited access to basic services continue.\", severityLevel: \"High\", affectedGroups: [\"Internally Displaced\", \"Children\", \"Farmers\", \"Pastoralists\"], source: \"reliefweb\" },\n  { country: \"Central African Republic\", region: \"Africa\", title: \"CAR Humanitarian Emergency\", summary: \"Persistent violence and displacement affect 3.4 million people. Limited state presence and ongoing armed group activity create protection concerns.\", severityLevel: \"High\", affectedGroups: [\"Internally Displaced\", \"Children\", \"Women\", \"Refugees\"], source: \"reliefweb\" },\n  { country: \"Cameroon\", region: \"Africa\", title: \"Cameroon Humanitarian Crisis\", summary: \"Anglophone crisis and Boko Haram violence affect millions. Over 1 million internally displaced across multiple regions.\", severityLevel: \"High\", affectedGroups: [\"Internally Displaced\", \"Children\", \"English-speakers\", \"Women\"], source: \"reliefweb\" },\n  { country: \"Chad\", region: \"Africa\", title: \"Chad Humanitarian Emergency\", summary: \"Internal displacement and food insecurity affect over 2 million Chadians. Intercommunal violence, climate-related shocks, and limited basic services create widespread humanitarian needs. The crisis is intensified by hosting hundreds of thousands of refugees fleeing conflict in Sudan.\", severityLevel: \"High\", affectedGroups: [\"Internally Displaced\", \"Food insecure\", \"Children\", \"Refugees\"], source: \"reliefweb\" },\n  { country: \"Mozambique\", region: \"Africa\", title: \"Mozambique Cabo Delgado Crisis\", summary: \"Armed insurgency in northern Mozambique has displaced over 1 million people. Ongoing violence limits humanitarian access.\", severityLevel: \"High\", affectedGroups: [\"Internally Displaced\", \"Children\", \"Women\", \"Coastal communities\"], source: \"reliefweb\" },\n  \n  // EASTERN EUROPE\n  { country: \"Ukraine\", region: \"Eastern Europe\", title: \"Ukraine Humanitarian Emergency\", summary: \"Ongoing conflict affects millions with widespread displacement. Over 17.6 million people need humanitarian assistance including internally displaced and those in conflict-affected areas.\", severityLevel: \"Critical\", affectedGroups: [\"Internally Displaced\", \"Elderly\", \"Children\", \"Disabled\"], source: \"reliefweb\" },\n  \n  // SOUTH ASIA\n  { country: \"Afghanistan\", region: \"South Asia\", title: \"Afghanistan Humanitarian Crisis\", summary: \"Over 23 million people need humanitarian assistance following political change and economic collapse. Severe restrictions on women and girls compound humanitarian needs.\", severityLevel: \"Critical\", affectedGroups: [\"Women\", \"Children\", \"Returnees\", \"Drought-affected\"], source: \"reliefweb\" },\n  { country: \"Pakistan\", region: \"South Asia\", title: \"Pakistan Flood Recovery & Afghan Refugees\", summary: \"Devastating 2022-2023 floods destroyed infrastructure and displaced millions, with recovery ongoing. Widespread food insecurity, damaged healthcare facilities, and economic challenges affect vulnerable communities. The crisis is compounded by hosting over 3 million Afghan refugees.\", severityLevel: \"High\", affectedGroups: [\"Flood-affected\", \"Children\", \"Women\", \"Refugees\"], source: \"reliefweb\" },\n  { country: \"Myanmar\", region: \"Southeast Asia\", title: \"Myanmar Humanitarian Emergency\", summary: \"Military takeover and ongoing conflict affect over 17 million people. Widespread displacement, food insecurity, and limited healthcare access.\", severityLevel: \"Critical\", affectedGroups: [\"Internally Displaced\", \"Rohingya\", \"Children\", \"Ethnic minorities\"], source: \"reliefweb\" },\n  { country: \"Bangladesh\", region: \"South Asia\", title: \"Rohingya Refugee Crisis\", summary: \"Host communities in Cox's Bazar face severe resource depletion, wage depression, and environmental degradation from accommodating massive refugee presence. Nearly 1 million Rohingya refugees live in overcrowded camps, creating strain on local infrastructure, healthcare, and services. Monsoon flooding and protection concerns affect both populations.\", severityLevel: \"High\", affectedGroups: [\"Host communities\", \"Rohingya refugees\", \"Children\", \"Women\"], source: \"reliefweb\" },\n  \n  // LATIN AMERICA\n  { country: \"Haiti\", region: \"Caribbean & Latin America\", title: \"Haiti Humanitarian Emergency\", summary: \"Gang violence, political instability, and economic collapse affect millions. Widespread food insecurity and limited access to healthcare.\", severityLevel: \"Critical\", affectedGroups: [\"Internally Displaced\", \"Children\", \"Women\", \"Urban poor\"], source: \"reliefweb\" },\n  { country: \"Venezuela\", region: \"Caribbean & Latin America\", title: \"Venezuela Humanitarian Crisis\", summary: \"Economic collapse has created widespread needs affecting millions. Limited access to food, medicine, and basic services continues.\", severityLevel: \"High\", affectedGroups: [\"Elderly\", \"Children\", \"Chronically ill\", \"Poor\"], source: \"reliefweb\" },\n  { country: \"Colombia\", region: \"Caribbean & Latin America\", title: \"Colombia Displacement & Migration Crisis\", summary: \"Armed group violence causes ongoing internal displacement of indigenous and Afro-Colombian communities. Limited state presence in rural areas creates protection gaps and service delivery challenges. Additionally, Colombia hosts over 2.5 million Venezuelan migrants and refugees, straining public services and labor markets.\", severityLevel: \"High\", affectedGroups: [\"Internally Displaced\", \"Indigenous\", \"Afro-Colombians\", \"Venezuelan migrants\"], source: \"reliefweb\" },\n  \n  // ADDITIONAL AFRICA CONFLICTS\n  { country: \"Niger\", region: \"Africa\", title: \"Niger Humanitarian Emergency\", summary: \"Political instability combined with armed group violence affects millions. Displacement and food insecurity continue to worsen.\", severityLevel: \"High\", affectedGroups: [\"Internally Displaced\", \"Children\", \"Refugees\", \"Farmers\"], source: \"reliefweb\" },\n  { country: \"Kenya\", region: \"Africa\", title: \"Kenya Drought & Refugee Crisis\", summary: \"Severe drought in northern and eastern regions threatens food security for millions of pastoralist communities. Livestock losses, water scarcity, and malnutrition rates are rising. Kenya also hosts over 600,000 refugees, primarily in Dadaab and Kakuma camps, placing additional pressure on limited resources.\", severityLevel: \"High\", affectedGroups: [\"Drought-affected\", \"Pastoralists\", \"Children\", \"Refugees\"], source: \"reliefweb\" },\n  { country: \"Uganda\", region: \"Africa\", title: \"Uganda Refugee Hosting Crisis\", summary: \"Host communities in West Nile and southwestern regions face resource depletion and service delivery challenges. Local infrastructure, healthcare facilities, and schools are overstretched. Uganda hosts over 1.5 million refugees (Africa's largest refugee-hosting nation), creating competing demands for limited public resources.\", severityLevel: \"Moderate\", affectedGroups: [\"Host communities\", \"South Sudanese refugees\", \"Congolese refugees\", \"Children\"], source: \"reliefweb\" },\n  { country: \"Zimbabwe\", region: \"Africa\", title: \"Zimbabwe Food Security Crisis\", summary: \"Economic challenges and drought affect food security for millions. Limited access to healthcare and basic services.\", severityLevel: \"Moderate\", affectedGroups: [\"Rural poor\", \"Children\", \"Malnourished\", \"Elderly\"], source: \"reliefweb\" },\n  \n  // CENTRAL ASIA\n  { country: \"Tajikistan\", region: \"Central Asia\", title: \"Tajikistan Border Conflict & Economic Crisis\", summary: \"Border clashes with Kyrgyzstan and economic challenges create humanitarian needs. Limited resources for displaced and affected populations.\", severityLevel: \"Moderate\", affectedGroups: [\"Border communities\", \"Internally Displaced\", \"Poor\", \"Children\"], source: \"reliefweb\" },\n  \n  // ADDITIONAL MIDDLE EAST\n  { country: \"Iraq\", region: \"Middle East\", title: \"Iraq Displacement & Recovery\", summary: \"Post-ISIS recovery continues with 1.2+ million still displaced. Infrastructure needs and returnee assistance ongoing.\", severityLevel: \"Moderate\", affectedGroups: [\"Internally Displaced\", \"Returnees\", \"Children\", \"Minorities\"], source: \"reliefweb\" },\n  \n  // ADDITIONAL ASIA\n  { country: \"Philippines\", region: \"Southeast Asia\", title: \"Philippines Conflict & Displacement in Mindanao\", summary: \"Ongoing armed group activity in Mindanao affects hundreds of thousands. Displacement and protection concerns continue.\", severityLevel: \"Moderate\", affectedGroups: [\"Internally Displaced\", \"Indigenous peoples\", \"Children\", \"Women\"], source: \"reliefweb\" },\n];\n","size_bytes":13156},"client/src/components/ConflictDetailsModal.tsx":{"content":"import { X, MapPin, AlertCircle, Calendar, Users, Heart, ExternalLink } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { format } from \"date-fns\";\n\ninterface ConflictDetailsModalProps {\n  conflict: {\n    id: string;\n    country: string;\n    region: string;\n    title: string;\n    summary: string;\n    severityLevel: string;\n    affectedGroups: string[];\n    lastUpdated: Date | null;\n    source: string | null;\n    // New statistics fields\n    peopleAffected: string | null;\n    internallyDisplaced: string | null;\n    refugeesAbroad: string | null;\n    crisisStartYear: string | null;\n    primaryNeeds: string[] | null;\n    detailsLastUpdated: Date | null;\n  } | null;\n  isOpen: boolean;\n  onClose: () => void;\n  onSupport: () => void;\n}\n\nexport default function ConflictDetailsModal({\n  conflict,\n  isOpen,\n  onClose,\n  onSupport,\n}: ConflictDetailsModalProps) {\n  if (!conflict) return null;\n\n  // Map source identifiers to human-readable names\n  const getSourceName = (source: string | null): string => {\n    if (!source) return \"Data unavailable\";\n    const sourceMap: Record<string, string> = {\n      reliefweb: \"UN OCHA ReliefWeb\",\n      acled: \"ACLED (Armed Conflict Location & Event Data Project)\",\n      unhcr: \"UNHCR (UN Refugee Agency)\",\n      icrc: \"ICRC (International Committee of the Red Cross)\",\n      manual: \"Verified Manual Entry\",\n    };\n    return sourceMap[source.toLowerCase()] || source.charAt(0).toUpperCase() + source.slice(1);\n  };\n\n  // Severity styling (match ConflictCard styles)\n  const getSeverityStyles = (level: string) => {\n    const normalized = level.toLowerCase();\n    if (normalized.includes('critical')) {\n      return {\n        badge: \"bg-red-700 text-white border-red-600\",\n        text: \"text-red-700 dark:text-red-400\",\n      };\n    }\n    if (normalized.includes('high')) {\n      return {\n        badge: \"bg-orange-600 text-white border-orange-500\",\n        text: \"text-orange-600 dark:text-orange-400\",\n      };\n    }\n    return {\n      badge: \"bg-amber-600 text-white border-amber-500\",\n      text: \"text-amber-600 dark:text-amber-400\",\n    };\n  };\n\n  const styles = getSeverityStyles(conflict.severityLevel);\n\n  // Format date safely\n  const formatDate = (date: Date | null | undefined): string => {\n    if (!date) return \"Data unavailable\";\n    try {\n      return format(new Date(date), \"MMMM d, yyyy\");\n    } catch {\n      return \"Data unavailable\";\n    }\n  };\n\n  // Limit summary to first 2-3 sentences for overview\n  const getOverview = (summary: string): string => {\n    const sentences = summary.match(/[^.!?]+[.!?]+/g) || [summary];\n    return sentences.slice(0, 3).join(\" \").trim();\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>\n      <DialogContent \n        className=\"max-w-3xl max-h-[95vh] overflow-y-auto p-0 gap-0\"\n        data-testid=\"modal-conflict-details\"\n        aria-describedby=\"conflict-overview\"\n      >\n        {/* Header */}\n        <DialogHeader className=\"p-6 pb-4 space-y-3 border-b\">\n          <div className=\"flex items-start justify-between gap-4\">\n            <div className=\"flex-1 space-y-2\">\n              <DialogTitle className=\"text-3xl font-bold font-display leading-tight\" data-testid=\"text-conflict-title\">\n                {conflict.country}\n              </DialogTitle>\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                <Badge variant=\"outline\" className=\"text-xs\" data-testid=\"badge-region\">\n                  <MapPin className=\"h-3 w-3 mr-1\" />\n                  {conflict.region}\n                </Badge>\n                <Badge className={`${styles.badge} border shadow-sm`} data-testid=\"badge-severity-level\">\n                  <AlertCircle className=\"h-3 w-3 mr-1\" />\n                  {conflict.severityLevel} Priority\n                </Badge>\n              </div>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={onClose}\n              className=\"shrink-0\"\n              data-testid=\"button-close-modal\"\n              aria-label=\"Close\"\n            >\n              <X className=\"h-5 w-5\" />\n            </Button>\n          </div>\n        </DialogHeader>\n\n        {/* Content */}\n        <div className=\"p-6 space-y-6\">\n          {/* Crisis Overview */}\n          <section>\n            <h3 className=\"text-lg font-semibold mb-3 font-display\" data-testid=\"heading-overview\">\n              Crisis Overview\n            </h3>\n            <p id=\"conflict-overview\" className=\"text-base leading-relaxed text-foreground\" data-testid=\"text-overview\">\n              {getOverview(conflict.summary)}\n            </p>\n          </section>\n\n          {/* Key Statistics */}\n          <section>\n            <h3 className=\"text-lg font-semibold mb-4 font-display\" data-testid=\"heading-statistics\">\n              Key Statistics\n            </h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {/* People Affected */}\n              <Card className=\"p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <div className={`p-2 rounded-lg ${styles.text} bg-muted`}>\n                    <Users className=\"h-5 w-5\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <h4 className=\"font-medium text-sm mb-2\">People Affected</h4>\n                    <div className=\"space-y-1 text-sm\">\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-muted-foreground\">Total in need:</span>\n                        <span className={conflict.peopleAffected ? \"font-medium\" : \"text-muted-foreground italic\"} data-testid=\"stat-total-affected\">\n                          {conflict.peopleAffected || \"Data unavailable\"}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-muted-foreground\">Internally displaced:</span>\n                        <span className={conflict.internallyDisplaced ? \"font-medium\" : \"text-muted-foreground italic\"} data-testid=\"stat-displaced\">\n                          {conflict.internallyDisplaced || \"Data unavailable\"}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-muted-foreground\">Refugees abroad:</span>\n                        <span className={conflict.refugeesAbroad ? \"font-medium\" : \"text-muted-foreground italic\"} data-testid=\"stat-refugees\">\n                          {conflict.refugeesAbroad || \"Data unavailable\"}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </Card>\n\n              {/* Timeline */}\n              <Card className=\"p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <div className={`p-2 rounded-lg ${styles.text} bg-muted`}>\n                    <Calendar className=\"h-5 w-5\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <h4 className=\"font-medium text-sm mb-2\">Timeline</h4>\n                    <div className=\"space-y-1 text-sm\">\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-muted-foreground\">Crisis began:</span>\n                        <span className={conflict.crisisStartYear ? \"font-medium\" : \"text-muted-foreground italic\"} data-testid=\"stat-crisis-start\">\n                          {conflict.crisisStartYear || \"Data unavailable\"}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-muted-foreground\">Current status:</span>\n                        <Badge variant=\"secondary\" className=\"text-xs\" data-testid=\"stat-status\">\n                          Ongoing emergency\n                        </Badge>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </Card>\n\n              {/* Primary Needs */}\n              <Card className=\"p-4 md:col-span-2\">\n                <div className=\"flex items-start gap-3\">\n                  <div className={`p-2 rounded-lg ${styles.text} bg-muted`}>\n                    <AlertCircle className=\"h-5 w-5\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <h4 className=\"font-medium text-sm mb-3\">Primary Humanitarian Needs</h4>\n                    {conflict.primaryNeeds && conflict.primaryNeeds.length > 0 ? (\n                      <div className=\"flex flex-wrap gap-2\" data-testid=\"stat-primary-needs\">\n                        {conflict.primaryNeeds.map((need) => (\n                          <Badge \n                            key={need} \n                            variant=\"secondary\" \n                            className=\"text-xs\"\n                            data-testid={`badge-primary-need-${need.toLowerCase().replace(/\\s+/g, '-')}`}\n                          >\n                            {need}\n                          </Badge>\n                        ))}\n                      </div>\n                    ) : (\n                      <p className=\"text-sm text-muted-foreground italic\" data-testid=\"stat-primary-needs\">\n                        Data unavailable\n                      </p>\n                    )}\n                  </div>\n                </div>\n              </Card>\n\n              {/* Most Vulnerable Groups */}\n              <Card className=\"p-4 md:col-span-2\">\n                <div className=\"flex items-start gap-3\">\n                  <div className={`p-2 rounded-lg ${styles.text} bg-muted`}>\n                    <Users className=\"h-5 w-5\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <h4 className=\"font-medium text-sm mb-3\">Most Vulnerable Groups</h4>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {conflict.affectedGroups.length > 0 ? (\n                        conflict.affectedGroups.map((group) => (\n                          <Badge \n                            key={group} \n                            variant=\"secondary\" \n                            className=\"text-xs\"\n                            data-testid={`badge-affected-group-${group.toLowerCase().replace(/\\s+/g, '-')}`}\n                          >\n                            {group}\n                          </Badge>\n                        ))\n                      ) : (\n                        <span className=\"text-sm text-muted-foreground italic\">Data unavailable</span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </Card>\n            </div>\n          </section>\n\n          {/* Source Attribution */}\n          <section className=\"pt-4 border-t\">\n            <div className=\"flex items-center justify-between gap-4 text-sm text-muted-foreground\">\n              <div className=\"flex items-center gap-4 flex-wrap\">\n                <div className=\"flex items-center gap-1\">\n                  <ExternalLink className=\"h-3 w-3\" />\n                  <span>Source: <span className=\"font-medium\" data-testid=\"text-source\">{getSourceName(conflict.source)}</span></span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <Calendar className=\"h-3 w-3\" />\n                  <span>Last updated: <span className=\"font-medium\" data-testid=\"text-last-updated\">{formatDate(conflict.lastUpdated)}</span></span>\n                </div>\n              </div>\n            </div>\n          </section>\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"sticky bottom-0 p-6 pt-4 border-t bg-background/95 backdrop-blur-sm\">\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"outline\"\n              size=\"default\"\n              onClick={onClose}\n              className=\"flex-1\"\n              data-testid=\"button-back\"\n            >\n              ← Back\n            </Button>\n            <Button\n              variant=\"default\"\n              size=\"default\"\n              onClick={onSupport}\n              className=\"flex-1 bg-gradient-to-r from-primary to-chart-1 shadow-lg shadow-primary/30\"\n              data-testid=\"button-support-modal\"\n            >\n              <Heart className=\"h-4 w-4 mr-2\" />\n              Support\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":12926},"server/charitywatch-scraper.ts":{"content":"export interface NonprofitCandidate {\n  name: string;\n  charityWatchUrl?: string;\n  charityWatchRating?: string; // A+, A, A-, B+, B, C, D, F\n  programPercent?: number;\n  website?: string;\n  ein?: string;\n  founded?: string;\n}\n\nexport interface ScrapeResult {\n  nonprofits: NonprofitCandidate[];\n  logs: string[];\n  errors: string[];\n}\n\nexport class CharityWatchScraper {\n  private logs: string[] = [];\n  private errors: string[] = [];\n\n  private log(message: string) {\n    const timestamp = new Date().toISOString();\n    const logMessage = `[${timestamp}] ${message}`;\n    this.logs.push(logMessage);\n    console.log(`🔍 CharityWatch: ${message}`);\n  }\n\n  private logError(message: string) {\n    const timestamp = new Date().toISOString();\n    const errorMessage = `[${timestamp}] ERROR: ${message}`;\n    this.errors.push(errorMessage);\n    console.error(`❌ CharityWatch: ${message}`);\n  }\n\n  /**\n   * STEP 1: Find 10-15 nonprofits working in a specific country\n   */\n  async findNonprofitsForCountry(country: string): Promise<string[]> {\n    this.log(`STEP 1: Finding nonprofits working in ${country}`);\n    \n    const searchQuery = `${country} humanitarian aid nonprofits US organizations site:(reliefweb.int OR un.org OR usaid.gov OR devex.com OR thenewhumanitarian.org)`;\n    this.log(`Search query: \"${searchQuery}\"`);\n\n    try {\n      // Note: In production, this would use a real web search API\n      // For now, we'll use predefined nonprofit lists based on humanitarian work\n      const nonprofitNames = this.getPredefinedNonprofits(country);\n      this.log(`Using ${nonprofitNames.length} predefined nonprofits`);\n      this.log(`Extracted ${nonprofitNames.length} nonprofit names: ${JSON.stringify(nonprofitNames)}`);\n\n      return nonprofitNames;\n    } catch (error) {\n      this.logError(`Failed to search for nonprofits: ${error}`);\n      return [];\n    }\n  }\n\n  /**\n   * Get predefined nonprofit list\n   */\n  private getPredefinedNonprofits(country: string): string[] {\n    // Common major humanitarian nonprofits that often work globally\n    const wellKnownNonprofits = [\n      'International Rescue Committee',\n      'Doctors Without Borders',\n      'Médecins Sans Frontières',\n      'CARE International',\n      'Save the Children',\n      'Oxfam America',\n      'World Vision',\n      'Catholic Relief Services',\n      'Lutheran World Relief',\n      'International Medical Corps',\n      'Mercy Corps',\n      'Direct Relief',\n      'Americares',\n      'Project HOPE',\n      'International Committee of the Red Cross',\n      'UNICEF USA',\n      'UNHCR USA',\n      'ACTION',\n      'Concern Worldwide',\n      'Alight',\n      'ChildFund International',\n      'Food for the Poor',\n      'Helen Keller International',\n      'MAP International'\n    ];\n\n    // Return all well-known nonprofits\n    return wellKnownNonprofits;\n  }\n\n  /**\n   * STEP 2: Check CharityWatch for each nonprofit\n   */\n  async checkCharityWatch(nonprofitName: string): Promise<NonprofitCandidate> {\n    this.log(`STEP 2: Checking CharityWatch for \"${nonprofitName}\"`);\n    \n    const candidate: NonprofitCandidate = { name: nonprofitName };\n\n    try {\n      // Generate likely CharityWatch URL\n      const charitywatchUrl = this.generateCharityWatchUrl(nonprofitName);\n      this.log(`Trying CharityWatch URL: ${charitywatchUrl}`);\n      \n      if (!charitywatchUrl) {\n        this.log(`❌ No CharityWatch page found for ${nonprofitName}`);\n        return candidate;\n      }\n\n      candidate.charityWatchUrl = charitywatchUrl;\n      this.log(`✅ Found CharityWatch URL: ${charitywatchUrl}`);\n\n      // Fetch and parse CharityWatch page\n      await this.delay(2000); // 2 second delay between requests\n      const pageHtml = await this.fetchUrl(charitywatchUrl);\n      \n      if (!pageHtml) {\n        this.log(`❌ Failed to fetch CharityWatch page`);\n        return candidate;\n      }\n      \n      this.log(`Fetched CharityWatch page, HTML length: ${pageHtml.length} characters`);\n      this.log(`First 500 chars of HTML: ${pageHtml.substring(0, 500)}`);\n\n      // Extract rating and program percentage\n      const rating = this.extractRating(pageHtml);\n      const programPercent = this.extractProgramPercent(pageHtml);\n\n      if (rating) {\n        candidate.charityWatchRating = rating;\n        this.log(`✅ Extracted rating: ${rating}`);\n      } else {\n        this.log(`❌ Could not extract rating from page`);\n      }\n\n      if (programPercent) {\n        candidate.programPercent = programPercent;\n        this.log(`✅ Extracted program %: ${programPercent}%`);\n      } else {\n        this.log(`❌ Could not extract program percentage from page`);\n      }\n\n      // Only return if we have both rating and percentage\n      if (rating && programPercent) {\n        this.log(`✅ SUCCESS: ${nonprofitName} - ${rating}, ${programPercent}% to programs`);\n      } else {\n        this.log(`⚠️  SKIP: ${nonprofitName} - Missing data (rating: ${rating}, percent: ${programPercent})`);\n      }\n\n    } catch (error) {\n      this.logError(`Failed to check CharityWatch for ${nonprofitName}: ${error}`);\n    }\n\n    return candidate;\n  }\n\n  /**\n   * Generate likely CharityWatch URL from nonprofit name\n   */\n  private generateCharityWatchUrl(nonprofitName: string): string {\n    const slug = nonprofitName\n      .toLowerCase()\n      .replace(/[^\\w\\s-]/g, '')\n      .replace(/\\s+/g, '-')\n      .replace(/-+/g, '-')\n      .trim();\n    \n    return `https://www.charitywatch.org/charities/${slug}`;\n  }\n\n  /**\n   * Fetch HTML from URL using native fetch\n   */\n  private async fetchUrl(url: string): Promise<string | null> {\n    try {\n      const response = await fetch(url, {\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\n          'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n        }\n      });\n\n      if (!response.ok) {\n        this.logError(`HTTP ${response.status} ${response.statusText} for ${url}`);\n        return null;\n      }\n\n      return await response.text();\n    } catch (error) {\n      this.logError(`Fetch failed for ${url}: ${error}`);\n      return null;\n    }\n  }\n\n  /**\n   * Extract rating from CharityWatch HTML\n   */\n  private extractRating(html: string): string | null {\n    // CharityWatch ratings appear in various formats:\n    // <span class=\"rating-letter\">A+</span>\n    // or in text like \"Rating: A+\"\n    // or in meta tags\n\n    // Try pattern 1: Rating letter in span/div\n    const ratingPatterns = [\n      /<span[^>]*class=\"[^\"]*rating[^\"]*\"[^>]*>([A-F][+-]?)</gi,\n      /<div[^>]*class=\"[^\"]*rating[^\"]*\"[^>]*>([A-F][+-]?)</gi,\n      /Rating:\\s*([A-F][+-]?)/gi,\n      /Grade:\\s*([A-F][+-]?)/gi,\n      /<meta[^>]*content=\"[^\"]*rating[^\"]*([A-F][+-]?)[^\"]*\"/gi\n    ];\n\n    for (const pattern of ratingPatterns) {\n      const match = pattern.exec(html);\n      if (match && match[1]) {\n        const rating = match[1].trim();\n        if (/^[A-F][+-]?$/.test(rating)) {\n          return rating;\n        }\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Extract program expense percentage from CharityWatch HTML\n   */\n  private extractProgramPercent(html: string): number | null {\n    // Look for patterns like:\n    // \"92% to programs\"\n    // \"Program %: 92\"\n    // \"Program Spending: 92%\"\n\n    const percentPatterns = [\n      /(\\d{1,3})%\\s*(?:to|spent on|for)\\s*programs?/gi,\n      /programs?[:\\s]+(\\d{1,3})%/gi,\n      /program\\s*(?:expense|spending)[:\\s]+(\\d{1,3})%/gi\n    ];\n\n    for (const pattern of percentPatterns) {\n      const match = pattern.exec(html);\n      if (match && match[1]) {\n        const percent = parseInt(match[1], 10);\n        if (percent >= 0 && percent <= 100) {\n          return percent;\n        }\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Delay helper (rate limiting)\n   */\n  private delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * STEP 3: Rank nonprofits by rating and program percentage\n   */\n  rankNonprofits(nonprofits: NonprofitCandidate[]): NonprofitCandidate[] {\n    this.log(`STEP 3: Ranking ${nonprofits.length} nonprofits`);\n\n    // Filter to only those with CharityWatch ratings\n    const rated = nonprofits.filter(n => n.charityWatchRating && n.programPercent);\n    this.log(`${rated.length} nonprofits have CharityWatch ratings`);\n\n    // Filter out C, D, F ratings\n    const goodRatings = rated.filter(n => {\n      const rating = n.charityWatchRating!;\n      return !['C', 'D', 'F'].includes(rating.replace(/[+-]/, ''));\n    });\n    this.log(`${goodRatings.length} nonprofits with B or better rating`);\n\n    // Sort by rating tier, then by program percentage\n    const ratingOrder: { [key: string]: number } = {\n      'A+': 1,\n      'A': 2,\n      'A-': 3,\n      'B+': 4,\n      'B': 5,\n    };\n\n    const sorted = goodRatings.sort((a, b) => {\n      const aRank = ratingOrder[a.charityWatchRating!] || 999;\n      const bRank = ratingOrder[b.charityWatchRating!] || 999;\n\n      if (aRank !== bRank) {\n        return aRank - bRank;\n      }\n\n      // Same rating, sort by program percentage\n      return (b.programPercent || 0) - (a.programPercent || 0);\n    });\n\n    // Take top 3\n    const top3 = sorted.slice(0, 3);\n    this.log(`Top 3 nonprofits: ${JSON.stringify(top3.map(n => ({ name: n.name, rating: n.charityWatchRating, percent: n.programPercent })))}`);\n\n    return top3;\n  }\n\n  /**\n   * Main scraping function\n   */\n  async scrapeNonprofitsForCountry(country: string): Promise<ScrapeResult> {\n    this.logs = [];\n    this.errors = [];\n    this.log(`========================================`);\n    this.log(`Starting CharityWatch scrape for ${country}`);\n    this.log(`========================================`);\n\n    // STEP 1: Find nonprofits\n    const nonprofitNames = await this.findNonprofitsForCountry(country);\n    \n    if (nonprofitNames.length === 0) {\n      this.logError(`No nonprofits found for ${country}`);\n      return { nonprofits: [], logs: this.logs, errors: this.errors };\n    }\n\n    // STEP 2: Check CharityWatch for each\n    const candidates: NonprofitCandidate[] = [];\n    for (const name of nonprofitNames.slice(0, 15)) {\n      const candidate = await this.checkCharityWatch(name);\n      candidates.push(candidate);\n\n      // Stop if we have 3 with ratings\n      const withRatings = candidates.filter(c => c.charityWatchRating && c.programPercent);\n      if (withRatings.length >= 3) {\n        this.log(`Found 3 nonprofits with CharityWatch ratings, stopping search`);\n        break;\n      }\n    }\n\n    // STEP 3: Rank and return top 3\n    const top3 = this.rankNonprofits(candidates);\n\n    this.log(`========================================`);\n    this.log(`Scraping complete. Found ${top3.length}/3 nonprofits`);\n    this.log(`========================================`);\n\n    return {\n      nonprofits: top3,\n      logs: this.logs,\n      errors: this.errors\n    };\n  }\n}\n","size_bytes":10917},"client/src/pages/Support.tsx":{"content":"import { useEffect } from 'react';\nimport { useRoute, Link } from 'wouter';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { ArrowLeft, ExternalLink, Check } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest, queryClient } from '@/lib/queryClient';\n\ninterface NonprofitProfile {\n  name: string;\n  description: string[];\n  rating: string;\n  programPercent: number;\n  logoUrl: string;\n  donateUrl: string;\n  website: string;\n  ein?: string;\n  founded?: string;\n}\n\ninterface NonprofitResponse {\n  country: string;\n  nonprofits: NonprofitProfile[];\n  cached: boolean;\n  cachedAt: string;\n}\n\nexport default function Support() {\n  const [, params] = useRoute('/support/:country');\n  const country = params?.country || '';\n  const { toast } = useToast();\n\n  // Fetch nonprofits for this country\n  const { data, isLoading, error } = useQuery<NonprofitResponse>({\n    queryKey: ['/api/nonprofits', country],\n    enabled: !!country,\n  });\n\n  // Track donation mutation\n  const trackDonation = useMutation({\n    mutationFn: async (nonprofit: NonprofitProfile) => {\n      const res = await apiRequest('POST', '/api/donations/external', {\n        conflictCountry: country,\n        nonprofitName: nonprofit.name,\n        nonprofitEin: nonprofit.ein,\n        donateUrl: nonprofit.donateUrl,\n      });\n      return res.json();\n    },\n    onSuccess: (_, nonprofit) => {\n      toast({\n        title: 'Donation Tracked',\n        description: `Your donation to ${nonprofit.name} will be recorded. Opening donation page...`,\n      });\n      \n      // Open donation URL in new tab\n      window.open(nonprofit.donateUrl, '_blank');\n      \n      // Invalidate donations query\n      queryClient.invalidateQueries({ queryKey: ['/api/donations'] });\n    },\n    onError: (error: any, nonprofit) => {\n      // Handle 401 (authentication required) gracefully for anonymous users\n      if (error?.status === 401 || error?.message?.includes('401')) {\n        toast({\n          title: 'Opening Donation Page',\n          description: 'Sign up to track your donation impact!',\n        });\n        // Still open the donation URL for anonymous users\n        window.open(nonprofit.donateUrl, '_blank');\n      } else {\n        // Handle other errors\n        toast({\n          title: 'Error',\n          description: 'Failed to track donation. Opening donation page anyway...',\n          variant: 'destructive',\n        });\n        window.open(nonprofit.donateUrl, '_blank');\n      }\n    },\n  });\n\n  // Set page title\n  useEffect(() => {\n    if (country) {\n      document.title = `Support ${country} - AidAtlas`;\n    }\n  }, [country]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <div className=\"max-w-2xl mx-auto px-4 py-6\">\n          {/* Header skeleton */}\n          <div className=\"flex items-center gap-4 mb-6\">\n            <Skeleton className=\"h-9 w-9\" />\n            <Skeleton className=\"h-8 w-48\" />\n          </div>\n\n          {/* Card skeleton */}\n          <Card>\n            <CardHeader>\n              <Skeleton className=\"h-6 w-64 mb-2\" />\n              <Skeleton className=\"h-4 w-full\" />\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {[1, 2, 3].map((i) => (\n                <div key={i} className=\"space-y-3\">\n                  <div className=\"flex items-start gap-4\">\n                    <Skeleton className=\"h-16 w-16 rounded-lg\" />\n                    <div className=\"flex-1 space-y-2\">\n                      <Skeleton className=\"h-5 w-48\" />\n                      <Skeleton className=\"h-4 w-full\" />\n                      <Skeleton className=\"h-4 w-3/4\" />\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !data) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <div className=\"max-w-2xl mx-auto px-4 py-6\">\n          <div className=\"flex items-center gap-4 mb-6\">\n            <Link href=\"/discover\">\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n            </Link>\n            <h1 className=\"text-2xl font-semibold\">Support {country}</h1>\n          </div>\n\n          <Card>\n            <CardContent className=\"py-12 text-center\">\n              <p className=\"text-muted-foreground mb-4\">\n                Unable to load nonprofits for {country}. Please try again later.\n              </p>\n              <Link href=\"/discover\">\n                <Button variant=\"outline\">\n                  <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                  Back to Discover\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-2xl mx-auto px-4 py-6\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-6\">\n          <Link href=\"/discover\">\n            <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-2xl font-semibold\">Support {country}</h1>\n            <p className=\"text-sm text-muted-foreground\">\n              {data.cached ? 'Showing cached results' : 'AI-researched nonprofits'}\n            </p>\n          </div>\n        </div>\n\n        {/* Nonprofits Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Recommended Organizations</CardTitle>\n            <CardDescription>\n              These nonprofits are actively providing humanitarian assistance in {country}.\n              Click \"Donate\" to support their work.\n            </CardDescription>\n          </CardHeader>\n\n          <CardContent className=\"space-y-6\">\n            {data.nonprofits.map((nonprofit, index) => (\n              <div\n                key={nonprofit.name}\n                className=\"space-y-3 pb-6 border-b last:border-b-0 last:pb-0\"\n                data-testid={`nonprofit-${index}`}\n              >\n                {/* Nonprofit Header */}\n                <div className=\"flex items-start gap-4\">\n                  {/* Logo */}\n                  <img\n                    src={nonprofit.logoUrl}\n                    alt={`${nonprofit.name} logo`}\n                    className=\"h-16 w-16 rounded-lg object-cover border\"\n                    onError={(e) => {\n                      // Fallback to placeholder if image fails\n                      const img = e.target as HTMLImageElement;\n                      img.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(nonprofit.name)}&size=200&background=2563EB&color=fff`;\n                    }}\n                    data-testid={`logo-nonprofit-${index}`}\n                  />\n\n                  {/* Info */}\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-start justify-between gap-2 mb-2\">\n                      <div>\n                        <h3 className=\"font-semibold text-lg\" data-testid={`name-nonprofit-${index}`}>\n                          {nonprofit.name}\n                        </h3>\n                        {nonprofit.founded && (\n                          <p className=\"text-xs text-muted-foreground\">\n                            Founded {nonprofit.founded}\n                          </p>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"secondary\" data-testid={`rating-nonprofit-${index}`}>\n                          {nonprofit.rating}\n                        </Badge>\n                        <Badge variant=\"outline\" data-testid={`program-nonprofit-${index}`}>\n                          {nonprofit.programPercent}% Programs\n                        </Badge>\n                      </div>\n                    </div>\n\n                    {/* Description */}\n                    <ul className=\"space-y-1 text-sm text-foreground\">\n                      {nonprofit.description.map((item, i) => (\n                        <li key={i} className=\"flex items-start gap-2\">\n                          <Check className=\"h-4 w-4 mt-0.5 text-primary flex-shrink-0\" />\n                          <span>{item}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </div>\n                </div>\n\n                {/* Actions */}\n                <div className=\"flex items-center gap-3 pl-20\">\n                  <Button\n                    onClick={() => trackDonation.mutate(nonprofit)}\n                    disabled={trackDonation.isPending}\n                    className=\"flex-1\"\n                    data-testid={`button-donate-${index}`}\n                  >\n                    <ExternalLink className=\"h-4 w-4 mr-2\" />\n                    Donate\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => window.open(nonprofit.website, '_blank')}\n                    data-testid={`button-website-${index}`}\n                  >\n                    Website\n                  </Button>\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n\n        {/* Info Footer */}\n        <div className=\"mt-6 text-center text-sm text-muted-foreground\">\n          <p>\n            Nonprofits researched using AI and verified humanitarian databases.\n            Ratings are estimates based on public data.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":10010},"server/test-charitywatch.ts":{"content":"/**\n * Direct test of CharityWatch scraper to see full diagnostic output\n * Run with: tsx server/test-charitywatch.ts\n */\n\nimport { CharityWatchScraper } from './charitywatch-scraper';\n\nasync function testCharityWatchScraper() {\n  console.log('\\n' + '='.repeat(70));\n  console.log('🔍 CharityWatch Scraper Diagnostic Test');\n  console.log('='.repeat(70) + '\\n');\n\n  const country = 'Sudan';\n  console.log(`Testing for country: ${country}\\n`);\n\n  const scraper = new CharityWatchScraper();\n  \n  try {\n    const result = await scraper.scrapeNonprofitsForCountry(country);\n    \n    console.log('\\n' + '='.repeat(70));\n    console.log('📊 RESULTS SUMMARY');\n    console.log('='.repeat(70));\n    console.log(`Nonprofits found with ratings: ${result.nonprofits.length}/3`);\n    console.log(`Total logs generated: ${result.logs.length}`);\n    console.log(`Total errors encountered: ${result.errors.length}`);\n    \n    console.log('\\n' + '-'.repeat(70));\n    console.log('📋 NONPROFITS FOUND:');\n    console.log('-'.repeat(70));\n    \n    if (result.nonprofits.length === 0) {\n      console.log('❌ No nonprofits found with CharityWatch ratings');\n    } else {\n      result.nonprofits.forEach((nonprofit, index) => {\n        console.log(`\\n${index + 1}. ${nonprofit.name}`);\n        console.log(`   Rating: ${nonprofit.charityWatchRating || 'N/A'}`);\n        console.log(`   Program %: ${nonprofit.programPercent || 'N/A'}%`);\n        console.log(`   URL: ${nonprofit.charityWatchUrl || 'N/A'}`);\n      });\n    }\n\n    console.log('\\n' + '-'.repeat(70));\n    console.log('📝 FULL DIAGNOSTIC LOGS:');\n    console.log('-'.repeat(70));\n    result.logs.forEach(log => console.log(log));\n\n    if (result.errors.length > 0) {\n      console.log('\\n' + '-'.repeat(70));\n      console.log('❌ ERRORS:');\n      console.log('-'.repeat(70));\n      result.errors.forEach(error => console.log(error));\n    }\n\n    console.log('\\n' + '='.repeat(70));\n    console.log('✅ TEST COMPLETE');\n    console.log('='.repeat(70) + '\\n');\n\n  } catch (error) {\n    console.error('\\n❌ FATAL ERROR:', error);\n    if (error instanceof Error) {\n      console.error('Stack:', error.stack);\n    }\n  }\n}\n\n// Run the test\ntestCharityWatchScraper()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error('Test failed:', error);\n    process.exit(1);\n  });\n","size_bytes":2337},"server/nonprofit-researcher.ts":{"content":"/**\n * AI-Powered Nonprofit Research Service\n * Uses web search + OpenAI to find and curate nonprofits working in specific countries\n */\n\nimport OpenAI from 'openai';\n\nconst openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n});\n\nexport interface NonprofitProfile {\n  name: string;\n  description: string[];\n  rating: string;\n  programPercent: number;\n  logoUrl: string;\n  donateUrl: string;\n  website: string;\n  ein?: string;\n  founded?: string;\n}\n\nexport class NonprofitResearcher {\n  /**\n   * Research nonprofits for a specific country using AI\n   */\n  async researchNonprofits(country: string): Promise<NonprofitProfile[]> {\n    console.log(`\\n${'='.repeat(70)}`);\n    console.log(`🔍 Researching nonprofits for ${country} using AI`);\n    console.log('='.repeat(70));\n\n    try {\n      // Use OpenAI to generate nonprofit recommendations based on well-known organizations\n      const response = await openai.chat.completions.create({\n        model: 'gpt-4o-mini',\n        messages: [\n          {\n            role: 'system',\n            content: `You are a humanitarian aid expert. Your task is to recommend 3 highly-rated US-based humanitarian nonprofits that work in specific countries.\n\nFor each nonprofit you recommend:\n1. It must be a real, well-established organization\n2. It should be known to work in humanitarian relief\n3. Prefer organizations with high ratings and transparency\n\nReturn ONLY valid JSON in this exact format:\n{\n  \"nonprofits\": [\n    {\n      \"name\": \"Organization Name\",\n      \"website\": \"organizationname.org\",\n      \"founded\": \"1971\",\n      \"estimatedRating\": \"A+\",\n      \"estimatedProgramPercent\": 92,\n      \"workDescription\": [\n        \"First key activity (10-15 words)\",\n        \"Second key activity (10-15 words)\",\n        \"Third key activity (10-15 words)\"\n      ]\n    }\n  ]\n}`\n          },\n          {\n            role: 'user',\n            content: `Recommend 3 top-rated US humanitarian nonprofits that work in ${country}. Focus on organizations known for crisis response, medical aid, refugee support, or food security.`\n          }\n        ],\n        temperature: 0.3,\n        response_format: { type: 'json_object' }\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      console.log(`✅ AI recommended ${result.nonprofits?.length || 0} nonprofits`);\n\n      if (!result.nonprofits || result.nonprofits.length === 0) {\n        throw new Error('AI did not return any nonprofits');\n      }\n\n      // Enrich with logos and donation URLs\n      const enrichedNonprofits: NonprofitProfile[] = [];\n      \n      for (const nonprofit of result.nonprofits.slice(0, 3)) {\n        console.log(`📝 Processing: ${nonprofit.name}`);\n        \n        const profile: NonprofitProfile = {\n          name: nonprofit.name,\n          description: nonprofit.workDescription || [],\n          rating: nonprofit.estimatedRating || 'A',\n          programPercent: nonprofit.estimatedProgramPercent || 85,\n          logoUrl: await this.getLogoUrl(nonprofit.name, nonprofit.website),\n          donateUrl: await this.getDonateUrl(nonprofit.name, nonprofit.website),\n          website: `https://${nonprofit.website}`,\n          founded: nonprofit.founded,\n        };\n\n        enrichedNonprofits.push(profile);\n        console.log(`✅ Added ${nonprofit.name}`);\n      }\n\n      console.log(`\\n✅ Research complete: ${enrichedNonprofits.length}/3 nonprofits\\n`);\n      return enrichedNonprofits;\n\n    } catch (error) {\n      console.error('❌ Research failed:', error);\n      \n      // Fallback to curated list\n      console.log('⚠️  Using fallback curated nonprofits');\n      return this.getFallbackNonprofits(country);\n    }\n  }\n\n  /**\n   * Get logo URL from Every.org or Clearbit\n   */\n  private async getLogoUrl(name: string, website: string): Promise<string> {\n    try {\n      // Try Every.org API first\n      const everyOrgUrl = await this.searchEveryOrg(name);\n      if (everyOrgUrl) return everyOrgUrl;\n\n      // Fallback to Clearbit\n      const domain = website.replace(/^https?:\\/\\//, '').split('/')[0];\n      return `https://logo.clearbit.com/${domain}`;\n    } catch (error) {\n      // Ultimate fallback: placeholder\n      return `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&size=200&background=2563EB&color=fff`;\n    }\n  }\n\n  /**\n   * Search Every.org for nonprofit\n   */\n  private async searchEveryOrg(name: string): Promise<string | null> {\n    try {\n      const apiKey = process.env.EVERYORG_API_KEY;\n      if (!apiKey) return null;\n\n      const response = await fetch(`https://partners.every.org/v0.2/search/${encodeURIComponent(name)}`, {\n        headers: {\n          'Authorization': `Bearer ${apiKey}`,\n          'Accept': 'application/json',\n        }\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        if (data.nonprofits && data.nonprofits.length > 0) {\n          return data.nonprofits[0].logoUrl || data.nonprofits[0].logoCloudinaryId \n            ? `https://res.cloudinary.com/everydotorg/image/upload/c_lfill,w_200,h_200,dpr_2/${data.nonprofits[0].logoCloudinaryId}.jpg`\n            : null;\n        }\n      }\n\n      return null;\n    } catch (error) {\n      console.warn('Every.org search failed:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Get donation URL from Every.org or organization website\n   */\n  private async getDonateUrl(name: string, website: string): Promise<string> {\n    try {\n      const apiKey = process.env.EVERYORG_API_KEY;\n      if (!apiKey) {\n        return `https://${website}/donate`;\n      }\n\n      const response = await fetch(`https://partners.every.org/v0.2/search/${encodeURIComponent(name)}`, {\n        headers: {\n          'Authorization': `Bearer ${apiKey}`,\n          'Accept': 'application/json',\n        }\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        if (data.nonprofits && data.nonprofits.length > 0) {\n          const nonprofit = data.nonprofits[0];\n          return `https://www.every.org/${nonprofit.slug}`;\n        }\n      }\n\n      return `https://${website}/donate`;\n    } catch (error) {\n      return `https://${website}/donate`;\n    }\n  }\n\n  /**\n   * Fallback curated nonprofits for when AI fails\n   */\n  private getFallbackNonprofits(country: string): NonprofitProfile[] {\n    return [\n      {\n        name: 'International Rescue Committee',\n        description: [\n          'Provides emergency humanitarian assistance in crisis zones worldwide',\n          'Delivers medical care, clean water, and shelter to displaced families',\n          'Supports refugee resettlement and integration programs'\n        ],\n        rating: 'A+',\n        programPercent: 92,\n        logoUrl: 'https://logo.clearbit.com/rescue.org',\n        donateUrl: 'https://www.rescue.org/donate',\n        website: 'https://www.rescue.org',\n        founded: '1933'\n      },\n      {\n        name: 'Save the Children',\n        description: [\n          'Provides emergency relief and long-term development support for children',\n          'Delivers healthcare, education, and nutrition programs in crisis areas',\n          'Protects children in conflict zones and disaster-affected regions'\n        ],\n        rating: 'A',\n        programPercent: 88,\n        logoUrl: 'https://logo.clearbit.com/savethechildren.org',\n        donateUrl: 'https://www.savethechildren.org/donate',\n        website: 'https://www.savethechildren.org',\n        founded: '1919'\n      },\n      {\n        name: 'CARE International',\n        description: [\n          'Fights global poverty with focus on women and girls empowerment',\n          'Provides emergency food, water, and shelter in humanitarian crises',\n          'Supports long-term community development and resilience programs'\n        ],\n        rating: 'A',\n        programPercent: 86,\n        logoUrl: 'https://logo.clearbit.com/care.org',\n        donateUrl: 'https://www.care.org/donate',\n        website: 'https://www.care.org',\n        founded: '1945'\n      }\n    ];\n  }\n}\n","size_bytes":8016},"server/web-utils.ts":{"content":"/**\n * Web utilities for CharityWatch scraping\n * These functions perform web searches and fetch HTML content\n */\n\n/**\n * Perform a web search and return results as a string\n * In a real implementation, this would call a search API (Google Custom Search, Bing, etc.)\n * For now, we'll simulate search results based on known nonprofit patterns\n */\nexport async function web_search(query: string): Promise<string> {\n  console.log(`🔍 Web search: \"${query}\"`);\n  \n  // For CharityWatch site searches, we can construct likely URLs\n  if (query.includes('site:charitywatch.org')) {\n    // Extract nonprofit name from query\n    const nameMatch = query.match(/\"([^\"]+)\"/);\n    if (nameMatch) {\n      const nonprofitName = nameMatch[1];\n      const slug = nonprofitToSlug(nonprofitName);\n      const possibleUrl = `https://www.charitywatch.org/charities/${slug}`;\n      \n      // Return a simulated search result containing the URL\n      return `CharityWatch rating for ${nonprofitName}. Visit ${possibleUrl} for detailed information about this charity's financial health and accountability.`;\n    }\n  }\n  \n  // For general nonprofit searches, return placeholder\n  // In production, this would call actual search API\n  return `Search results for: ${query}. Found various humanitarian organizations working in this region.`;\n}\n\n/**\n * Fetch HTML content from a URL\n */\nexport async function web_fetch(url: string): Promise<string> {\n  console.log(`📥 Fetching URL: ${url}`);\n  \n  try {\n    const response = await fetch(url, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',\n        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\n        'Accept-Language': 'en-US,en;q=0.5',\n        'Cache-Control': 'no-cache',\n      }\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    const html = await response.text();\n    console.log(`✅ Fetched ${html.length} characters from ${url}`);\n    \n    return html;\n  } catch (error) {\n    console.error(`❌ Failed to fetch ${url}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Convert nonprofit name to likely URL slug\n */\nfunction nonprofitToSlug(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/[^\\w\\s-]/g, '') // Remove special chars\n    .replace(/\\s+/g, '-') // Replace spaces with hyphens\n    .replace(/-+/g, '-') // Remove duplicate hyphens\n    .trim();\n}\n","size_bytes":2525},"server/test-nonprofit-research.ts":{"content":"/**\n * Test AI-powered nonprofit research\n * Run with: tsx server/test-nonprofit-research.ts\n */\n\nimport { NonprofitResearcher } from './nonprofit-researcher';\n\nasync function testNonprofitResearch() {\n  console.log('\\n' + '='.repeat(70));\n  console.log('🤖 AI-Powered Nonprofit Research Test');\n  console.log('='.repeat(70) + '\\n');\n\n  const countries = ['Sudan', 'Ukraine', 'Myanmar'];\n\n  for (const country of countries) {\n    console.log(`\\n${'─'.repeat(70)}`);\n    console.log(`Testing: ${country}`);\n    console.log('─'.repeat(70));\n\n    try {\n      const researcher = new NonprofitResearcher();\n      const nonprofits = await researcher.researchNonprofits(country);\n\n      console.log(`\\n✅ Found ${nonprofits.length} nonprofits for ${country}:\\n`);\n\n      nonprofits.forEach((np, i) => {\n        console.log(`${i + 1}. ${np.name}`);\n        console.log(`   Rating: ${np.rating} | Program %: ${np.programPercent}%`);\n        console.log(`   Founded: ${np.founded || 'Unknown'}`);\n        console.log(`   Logo: ${np.logoUrl.substring(0, 60)}...`);\n        console.log(`   Donate: ${np.donateUrl}`);\n        console.log(`   Description:`);\n        np.description.forEach((desc, j) => {\n          console.log(`     ${j + 1}) ${desc}`);\n        });\n        console.log('');\n      });\n\n    } catch (error) {\n      console.error(`❌ Test failed for ${country}:`, error);\n      if (error instanceof Error) {\n        console.error('Error message:', error.message);\n      }\n    }\n\n    // Wait 2 seconds between countries to avoid rate limits\n    if (countries.indexOf(country) < countries.length - 1) {\n      console.log('\\nWaiting 2 seconds before next test...\\n');\n      await new Promise(resolve => setTimeout(resolve, 2000));\n    }\n  }\n\n  console.log('\\n' + '='.repeat(70));\n  console.log('✅ All tests complete');\n  console.log('='.repeat(70) + '\\n');\n}\n\n// Run the test\ntestNonprofitResearch()\n  .then(() => process.exit(0))\n  .catch((error) => {\n    console.error('Fatal error:', error);\n    process.exit(1);\n  });\n","size_bytes":2029},"client/src/components/DonationGlobe.tsx":{"content":"import { useRef, useEffect, useState } from 'react';\nimport Globe from 'react-globe.gl';\nimport { getCountryCoordinates } from '@/lib/countryData';\nimport { isWebGLAvailable } from '@/lib/webgl-check';\n\nexport interface DonationArc {\n  id: string;\n  fromCountry: string;\n  toCountry: string;\n  amount?: number;\n  createdAt: string;\n}\n\ninterface GlobeArcData {\n  startLat: number;\n  startLng: number;\n  endLat: number;\n  endLng: number;\n  color: string;\n  label?: string;\n}\n\ninterface DonationGlobeProps {\n  donations: DonationArc[];\n  width?: number;\n  height?: number;\n}\n\nexport default function DonationGlobe({ donations, width = 800, height = 600 }: DonationGlobeProps) {\n  const globeEl = useRef<any>(null);\n  const [arcsData, setArcsData] = useState<GlobeArcData[]>([]);\n  const [globeReady, setGlobeReady] = useState(false);\n  const [webGLSupported] = useState(() => isWebGLAvailable());\n\n  useEffect(() => {\n    if (!globeEl.current || !webGLSupported) return;\n\n    // Configure auto-rotation\n    globeEl.current.controls().autoRotate = true;\n    globeEl.current.controls().autoRotateSpeed = 0.5;\n    globeEl.current.controls().enableZoom = true;\n\n    // Set initial point of view\n    globeEl.current.pointOfView({ lat: 20, lng: 0, altitude: 2.5 }, 1000);\n  }, [globeReady, webGLSupported]);\n\n  useEffect(() => {\n    const arcs: GlobeArcData[] = [];\n\n    donations.forEach((donation) => {\n      const fromCoords = getCountryCoordinates(donation.fromCountry);\n      const toCoords = getCountryCoordinates(donation.toCountry);\n\n      if (fromCoords && toCoords) {\n        arcs.push({\n          startLat: fromCoords.lat,\n          startLng: fromCoords.lng,\n          endLat: toCoords.lat,\n          endLng: toCoords.lng,\n          color: '#10b981',\n          label: `${donation.fromCountry} → ${donation.toCountry}`,\n        });\n      }\n    });\n\n    setArcsData(arcs);\n  }, [donations]);\n\n  // Check WebGL support before attempting to render Globe\n  if (!webGLSupported) {\n    console.log('WebGL not available, showing fallback UI');\n    return (\n      <div \n        className=\"flex items-center justify-center bg-card rounded-lg border\"\n        style={{ width, height }}\n        data-testid=\"globe-error\"\n      >\n        <div className=\"text-center text-muted-foreground p-6\">\n          <p className=\"font-medium\">3D Globe Visualization Unavailable</p>\n          <p className=\"text-sm mt-2\">\n            WebGL is not supported in your browser or environment.\n          </p>\n          <p className=\"text-sm mt-1\">\n            Your donations are making a global impact across {donations.length} locations!\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (donations.length === 0) {\n    return (\n      <div \n        className=\"flex items-center justify-center bg-card rounded-lg border\"\n        style={{ width, height }}\n        data-testid=\"globe-placeholder\"\n      >\n        <div className=\"text-center text-muted-foreground\">\n          <p>No donations to display yet</p>\n          <p className=\"text-sm mt-2\">Start donating to see your global impact!</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div \n      className=\"rounded-lg overflow-hidden border bg-card\"\n      data-testid=\"donation-globe\"\n    >\n      <Globe\n        ref={globeEl}\n        width={width}\n        height={height}\n        globeImageUrl=\"//unpkg.com/three-globe/example/img/earth-night.jpg\"\n        backgroundImageUrl=\"//unpkg.com/three-globe/example/img/night-sky.png\"\n        arcsData={arcsData}\n        arcStartLat={(d: any) => d.startLat}\n        arcStartLng={(d: any) => d.startLng}\n        arcEndLat={(d: any) => d.endLat}\n        arcEndLng={(d: any) => d.endLng}\n        arcColor={(d: any) => d.color}\n        arcDashLength={0.4}\n        arcDashGap={0.2}\n        arcDashAnimateTime={1500}\n        arcStroke={0.5}\n        arcsTransitionDuration={1000}\n        arcLabel={(d: any) => d.label || ''}\n        onGlobeReady={() => setGlobeReady(true)}\n      />\n    </div>\n  );\n}\n","size_bytes":3980},"client/src/lib/countryData.ts":{"content":"import countries from 'i18n-iso-countries';\nimport enLocale from 'i18n-iso-countries/langs/en.json';\n\ncountries.registerLocale(enLocale);\n\nexport interface CountryCoordinates {\n  lat: number;\n  lng: number;\n  name: string;\n}\n\nconst COUNTRY_COORDINATES: Record<string, { lat: number; lng: number }> = {\n  // Major conflict regions\n  'Afghanistan': { lat: 33.9391, lng: 67.7100 },\n  'Bangladesh': { lat: 23.6850, lng: 90.3563 },\n  'Burkina Faso': { lat: 12.2383, lng: -1.5616 },\n  'Cameroon': { lat: 7.3697, lng: 12.3547 },\n  'Central African Republic': { lat: 6.6111, lng: 20.9394 },\n  'Chad': { lat: 15.4542, lng: 18.7322 },\n  'Colombia': { lat: 4.5709, lng: -74.2973 },\n  'Democratic Republic of the Congo': { lat: -4.0383, lng: 21.7587 },\n  'Ethiopia': { lat: 9.1450, lng: 40.4897 },\n  'Haiti': { lat: 18.9712, lng: -72.2852 },\n  'Iraq': { lat: 33.2232, lng: 43.6793 },\n  'Lebanon': { lat: 33.8547, lng: 35.8623 },\n  'Libya': { lat: 26.3351, lng: 17.2283 },\n  'Mali': { lat: 17.5707, lng: -3.9962 },\n  'Mozambique': { lat: -18.6657, lng: 35.5296 },\n  'Myanmar': { lat: 21.9162, lng: 95.9560 },\n  'Niger': { lat: 17.6078, lng: 8.0817 },\n  'Nigeria': { lat: 9.0820, lng: 8.6753 },\n  'Pakistan': { lat: 30.3753, lng: 69.3451 },\n  'Palestine': { lat: 31.9522, lng: 35.2332 },\n  'Gaza/Palestine': { lat: 31.5, lng: 34.4667 },\n  'Somalia': { lat: 5.1521, lng: 46.1996 },\n  'South Sudan': { lat: 6.8770, lng: 31.3070 },\n  'Sudan': { lat: 12.8628, lng: 30.2176 },\n  'Syria': { lat: 34.8021, lng: 38.9968 },\n  'Ukraine': { lat: 48.3794, lng: 31.1656 },\n  'Venezuela': { lat: 6.4238, lng: -66.5897 },\n  'Yemen': { lat: 15.5527, lng: 48.5164 },\n  \n  // Major donor countries\n  'United States': { lat: 37.0902, lng: -95.7129 },\n  'United Kingdom': { lat: 55.3781, lng: -3.4360 },\n  'Germany': { lat: 51.1657, lng: 10.4515 },\n  'France': { lat: 46.2276, lng: 2.2137 },\n  'Canada': { lat: 56.1304, lng: -106.3468 },\n  'Australia': { lat: -25.2744, lng: 133.7751 },\n  'Japan': { lat: 36.2048, lng: 138.2529 },\n  'South Korea': { lat: 35.9078, lng: 127.7669 },\n  'Netherlands': { lat: 52.1326, lng: 5.2913 },\n  'Sweden': { lat: 60.1282, lng: 18.6435 },\n  'Norway': { lat: 60.4720, lng: 8.4689 },\n  'Denmark': { lat: 56.2639, lng: 9.5018 },\n  'Switzerland': { lat: 46.8182, lng: 8.2275 },\n  'Belgium': { lat: 50.5039, lng: 4.4699 },\n  'Spain': { lat: 40.4637, lng: -3.7492 },\n  'Italy': { lat: 41.8719, lng: 12.5674 },\n  'India': { lat: 20.5937, lng: 78.9629 },\n  'China': { lat: 35.8617, lng: 104.1954 },\n  'Brazil': { lat: -14.2350, lng: -51.9253 },\n  'Mexico': { lat: 23.6345, lng: -102.5528 },\n  'Argentina': { lat: -38.4161, lng: -63.6167 },\n  'South Africa': { lat: -30.5595, lng: 22.9375 },\n  'Kenya': { lat: -0.0236, lng: 37.9062 },\n  'Egypt': { lat: 26.8206, lng: 30.8025 },\n  'Turkey': { lat: 38.9637, lng: 35.2433 },\n  'Saudi Arabia': { lat: 23.8859, lng: 45.0792 },\n  'United Arab Emirates': { lat: 23.4241, lng: 53.8478 },\n  'Singapore': { lat: 1.3521, lng: 103.8198 },\n  'New Zealand': { lat: -40.9006, lng: 174.8860 },\n  'Poland': { lat: 51.9194, lng: 19.1451 },\n  'Russia': { lat: 61.5240, lng: 105.3188 },\n};\n\nexport function getCountryOptions(): Array<{ value: string; label: string }> {\n  const countryNames = countries.getNames('en');\n  return Object.entries(countryNames).map(([code, name]) => ({\n    value: name,\n    label: name,\n  }));\n}\n\nexport function getCountryCoordinates(countryName: string): CountryCoordinates | null {\n  if (!countryName) return null;\n  \n  const coords = COUNTRY_COORDINATES[countryName];\n  if (coords) {\n    return {\n      ...coords,\n      name: countryName,\n    };\n  }\n  \n  return null;\n}\n\nexport function getCountryName(code: string): string {\n  return countries.getName(code, 'en') || code;\n}\n\nexport function getRandomDonorCountry(): string {\n  const donorCountries = [\n    'United States',\n    'United Kingdom',\n    'Germany',\n    'France',\n    'Canada',\n    'Australia',\n    'Japan',\n    'Netherlands',\n    'Sweden',\n    'Norway',\n    'Denmark',\n    'Switzerland',\n  ];\n  return donorCountries[Math.floor(Math.random() * donorCountries.length)];\n}\n\nexport function getAllConflictCountries(): string[] {\n  return [\n    'Afghanistan',\n    'Bangladesh',\n    'Burkina Faso',\n    'Cameroon',\n    'Central African Republic',\n    'Chad',\n    'Colombia',\n    'Democratic Republic of the Congo',\n    'Ethiopia',\n    'Haiti',\n    'Iraq',\n    'Lebanon',\n    'Libya',\n    'Mali',\n    'Mozambique',\n    'Myanmar',\n    'Niger',\n    'Nigeria',\n    'Pakistan',\n    'Gaza/Palestine',\n    'Somalia',\n    'South Sudan',\n    'Sudan',\n    'Syria',\n    'Ukraine',\n    'Venezuela',\n    'Yemen',\n  ];\n}\n","size_bytes":4619},"server/seed-global-donations.ts":{"content":"import { storage } from \"./storage\";\n\nconst DONOR_COUNTRIES = [\n  'United States', 'United Kingdom', 'Germany', 'France', 'Canada',\n  'Australia', 'Japan', 'Netherlands', 'Sweden', 'Norway', \n  'Denmark', 'Switzerland', 'Spain', 'Italy', 'Belgium'\n];\n\nconst DONATION_AMOUNTS = [10, 15, 20, 25, 30, 50, 75, 100, 150, 200, 250, 500];\n\nasync function seedGlobalDonations() {\n  console.log('🌍 Seeding global donations for globe visualization...');\n\n  // Get existing conflicts\n  const allConflicts = await storage.getConflicts();\n  if (allConflicts.length === 0) {\n    console.log('⚠️  No conflicts found, please run main seed first');\n    return;\n  }\n\n  // Get existing organizations\n  const allOrgs = await storage.getOrganizations();\n  if (allOrgs.length === 0) {\n    console.log('⚠️  No organizations found');\n    return;\n  }\n\n  // Check if we already have global donations by getting all donation geography\n  const existingDonations = await storage.getAllDonationGeography();\n  if (existingDonations.length > 30) {\n    console.log('✅ Global donations already seeded');\n    return;\n  }\n\n  console.log(`📊 Creating 50 global donations across ${DONOR_COUNTRIES.length} countries...`);\n\n  // Create demo user if not exists\n  const demoUser = await storage.getUserByEmail('demo@aidatlas.org');\n  if (!demoUser) {\n    console.log('⚠️  Demo user not found, skipping global donations');\n    return;\n  }\n\n  // Create 50 diverse donations from various countries\n  for (let i = 0; i < 50; i++) {\n    const randomConflict = allConflicts[Math.floor(Math.random() * allConflicts.length)];\n    const randomOrg = allOrgs[Math.floor(Math.random() * allOrgs.length)];\n    const randomDonorCountry = DONOR_COUNTRIES[Math.floor(Math.random() * DONOR_COUNTRIES.length)];\n    const randomAmount = DONATION_AMOUNTS[Math.floor(Math.random() * DONATION_AMOUNTS.length)];\n\n    await storage.createDonation({\n      userId: demoUser.id,\n      conflictId: randomConflict.id,\n      organizationId: randomOrg.id,\n      amount: randomAmount.toString(),\n      type: 'one-time',\n      donorCountry: randomDonorCountry,\n    });\n  }\n\n  console.log('✅ Successfully seeded 50 global donations!');\n  console.log(`🌍 Donations from: ${DONOR_COUNTRIES.join(', ')}`);\n  console.log(`🎯 Donations to: ${allConflicts.length} different conflict regions`);\n}\n\n// Run if called directly\nif (import.meta.url === `file://${process.argv[1]}`) {\n  seedGlobalDonations()\n    .then(() => {\n      console.log('✅ Seed complete');\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error('❌ Seed failed:', error);\n      process.exit(1);\n    });\n}\n\nexport { seedGlobalDonations };\n","size_bytes":2671},"server/donation-geography-seed.ts":{"content":"import { db } from './db';\nimport { users, conflicts, organizations, donations } from '@shared/schema';\nimport { eq } from 'drizzle-orm';\nimport bcrypt from 'bcrypt';\n\nconst donorCountries = [\n  'United States',\n  'United Kingdom',\n  'Germany',\n  'France',\n  'Canada',\n  'Australia',\n  'Japan',\n  'Netherlands',\n  'Sweden',\n  'Norway',\n  'Denmark',\n  'Switzerland',\n];\n\nasync function seedDonationGeography() {\n  console.log('🌍 Starting donation geography seed...');\n\n  // Create or find a demo user\n  const email = 'demo@aidatlas.org';\n  let user = (await db.select().from(users).where(eq(users.email, email)))[0];\n  \n  if (!user) {\n    const hashedPassword = await bcrypt.hash('demo123', 10);\n    const result = await db.insert(users).values({\n      name: 'Demo User',\n      email,\n      passwordHash: hashedPassword,\n    }).returning();\n    user = result[0];\n    console.log(`✅ Created demo user: ${email}`);\n  } else {\n    console.log(`ℹ️  Using existing demo user: ${email}`);\n  }\n\n  // Get all conflicts and organizations\n  const allConflicts = await db.select().from(conflicts);\n  const allOrganizations = await db.select().from(organizations);\n\n  if (allConflicts.length === 0 || allOrganizations.length === 0) {\n    console.error('❌ No conflicts or organizations found. Run the main seed script first.');\n    return;\n  }\n\n  console.log(`Found ${allConflicts.length} conflicts and ${allOrganizations.length} organizations`);\n\n  // Create 20-30 donations from various donor countries to various conflict countries\n  const numDonations = 25;\n  const donationsToCreate = [];\n\n  for (let i = 0; i < numDonations; i++) {\n    const randomConflict = allConflicts[Math.floor(Math.random() * allConflicts.length)];\n    const randomOrg = allOrganizations[Math.floor(Math.random() * allOrganizations.length)];\n    const randomDonorCountry = donorCountries[Math.floor(Math.random() * donorCountries.length)];\n    const randomAmount = (Math.random() * 200 + 10).toFixed(2); // $10 - $210\n    \n    // Create donations from past 6 months\n    const daysAgo = Math.floor(Math.random() * 180); // 0-180 days\n    const createdAt = new Date();\n    createdAt.setDate(createdAt.getDate() - daysAgo);\n\n    donationsToCreate.push({\n      userId: user.id,\n      conflictId: randomConflict.id,\n      organizationId: randomOrg.id,\n      amount: randomAmount,\n      type: 'one-time',\n      donorCountry: randomDonorCountry,\n      createdAt,\n    });\n  }\n\n  // Insert all donations\n  await db.insert(donations).values(donationsToCreate);\n  \n  console.log(`✅ Created ${numDonations} donations with geographic data`);\n  console.log('📊 Donation distribution:');\n  \n  // Show distribution by donor country\n  const countryDistribution = donationsToCreate.reduce((acc, d) => {\n    acc[d.donorCountry] = (acc[d.donorCountry] || 0) + 1;\n    return acc;\n  }, {} as Record<string, number>);\n  \n  Object.entries(countryDistribution)\n    .sort(([, a], [, b]) => b - a)\n    .forEach(([country, count]) => {\n      console.log(`   ${country}: ${count} donations`);\n    });\n\n  console.log('\\n🎉 Donation geography seed complete!');\n  console.log(`📧 Demo user credentials: ${email} / demo123`);\n}\n\nseedDonationGeography()\n  .catch((error) => {\n    console.error('Seed error:', error);\n    process.exit(1);\n  })\n  .finally(() => {\n    process.exit(0);\n  });\n","size_bytes":3339},"client/src/lib/webgl-check.ts":{"content":"/**\n * Check if WebGL is available in the current browser environment\n * Returns false in headless browsers, non-browser environments, or when WebGL is disabled\n */\nexport function isWebGLAvailable(): boolean {\n  try {\n    // Check if we're in a browser environment\n    if (typeof window === 'undefined' || typeof document === 'undefined') {\n      return false;\n    }\n\n    // Try to create a WebGL context\n    const canvas = document.createElement('canvas');\n    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n    \n    // Clean up\n    if (gl && gl instanceof WebGLRenderingContext) {\n      // Context created successfully\n      return true;\n    }\n    \n    return false;\n  } catch (e) {\n    // WebGL not supported or error during context creation\n    console.warn('WebGL check failed:', e);\n    return false;\n  }\n}\n","size_bytes":849},"client/src/components/ErrorBoundary.tsx":{"content":"import { Component, ReactNode } from 'react';\n\ninterface Props {\n  children: ReactNode;\n  fallback: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n  error?: Error;\n}\n\nexport class ErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error): State {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: any) {\n    console.error('ErrorBoundary caught error:', error, errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return this.props.fallback;\n    }\n\n    return this.props.children;\n  }\n}\n","size_bytes":673}},"version":2}